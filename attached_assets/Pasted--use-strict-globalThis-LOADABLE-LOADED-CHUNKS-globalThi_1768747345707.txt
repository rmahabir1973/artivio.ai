"use strict";
(globalThis.__LOADABLE_LOADED_CHUNKS__ = globalThis.__LOADABLE_LOADED_CHUNKS__ || []).push([["88"], {
    574698: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = {
            widthEdge: "6px",
            heightAxis: "26px",
            heightTrackSpace: "7px",
            heightTemplateTrackSpace: "15px",
            trackLeftPadding: "6px",
            widthTimelineHdMuteTemplate: "6px",
            segInnerMargin: "1px",
            "height-seg-hd": "28px",
            heightSegHd: "28px",
            "height-seg-bd-low": "36px",
            heightSegBdLow: "36px",
            "height-seg-bd-audio": "28px",
            heightSegBdAudio: "28px",
            "height-seg-bd": "50px",
            heightSegBd: "50px",
            "height-seg-template-post": "32px",
            heightSegTemplatePost: "32px",
            trakListPadding: "16px",
            trackListPaddingTop: "44px",
            trackListPaddingBottom: "44px",
            trackBeautyScrollWidth: "10px",
            segMinWidth: "6px"
        }
    },
    503372: function() {},
    429134: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = {
            "sider-menu-panel-margin-top": "10px",
            siderMenuPanelMarginTop: "10px",
            "sider-menu-panel-padding-x": "16px",
            siderMenuPanelPaddingX: "16px",
            "size-height-editor-nav": "56px",
            sizeHeightEditorNav: "56px",
            "size-width-min-editor": "1080px",
            sizeWidthMinEditor: "1080px",
            "size-height-min-editor": "550px",
            sizeHeightMinEditor: "550px",
            "size-height-min-editor-bd": "320px",
            sizeHeightMinEditorBd: "320px",
            "size-height-min-timeline": "128px",
            sizeHeightMinTimeline: "128px",
            "size-width-min-editor-player": "500px",
            sizeWidthMinEditorPlayer: "500px",
            "size-width-min-editor-attr": "320px",
            sizeWidthMinEditorAttr: "320px",
            "size-height-min-editor-tl": "128px",
            sizeHeightMinEditorTl: "128px",
            "size-height-min-batch-replace-tl": "200px",
            sizeHeightMinBatchReplaceTl: "200px",
            "size-height-editor-collapsed-tl": "70px",
            sizeHeightEditorCollapsedTl: "70px",
            "entry-container": "entry-container-R0571Y",
            entryContainer: "entry-container-R0571Y",
            "view-box": "view-box-wOAuQ8",
            viewBox: "view-box-wOAuQ8",
            initializing: "initializing-CcGWHC",
            hidden: "hidden-BeNRyS",
            favorViewBox: "favorViewBox-yPVvPk"
        }
    },
    983434: function() {},
    450032: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = {
            "entire-panel-skeleton": "entire-panel-skeleton-JatpOO",
            entirePanelSkeleton: "entire-panel-skeleton-JatpOO"
        }
    },
    112018: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = {
            "sider-menu-panel-margin-top": "10px",
            siderMenuPanelMarginTop: "10px",
            "sider-menu-panel-padding-x": "16px",
            siderMenuPanelPaddingX: "16px",
            "size-height-editor-nav": "56px",
            sizeHeightEditorNav: "56px",
            "size-width-min-editor": "1080px",
            sizeWidthMinEditor: "1080px",
            "size-height-min-editor": "550px",
            sizeHeightMinEditor: "550px",
            "size-height-min-editor-bd": "320px",
            sizeHeightMinEditorBd: "320px",
            "size-height-min-timeline": "128px",
            sizeHeightMinTimeline: "128px",
            "size-width-min-editor-player": "500px",
            sizeWidthMinEditorPlayer: "500px",
            "size-width-min-editor-attr": "320px",
            sizeWidthMinEditorAttr: "320px",
            "size-height-min-editor-tl": "128px",
            sizeHeightMinEditorTl: "128px",
            "size-height-min-batch-replace-tl": "200px",
            sizeHeightMinBatchReplaceTl: "200px",
            "size-height-editor-collapsed-tl": "70px",
            sizeHeightEditorCollapsedTl: "70px",
            "entry-container": "entry-container-LbcWJT",
            entryContainer: "entry-container-LbcWJT",
            "view-box": "view-box-aZ0ymm",
            viewBox: "view-box-aZ0ymm",
            initializing: "initializing-HqW_zC",
            hidden: "hidden-VVBjMU",
            "scroll-container": "scroll-container-eXBao4",
            scrollContainer: "scroll-container-eXBao4"
        }
    },
    45394: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = {
            "sider-menu-panel-margin-top": "10px",
            siderMenuPanelMarginTop: "10px",
            "sider-menu-panel-padding-x": "16px",
            siderMenuPanelPaddingX: "16px",
            "size-height-editor-nav": "56px",
            sizeHeightEditorNav: "56px",
            "size-width-min-editor": "1080px",
            sizeWidthMinEditor: "1080px",
            "size-height-min-editor": "550px",
            sizeHeightMinEditor: "550px",
            "size-height-min-editor-bd": "320px",
            sizeHeightMinEditorBd: "320px",
            "size-height-min-timeline": "128px",
            sizeHeightMinTimeline: "128px",
            "size-width-min-editor-player": "500px",
            sizeWidthMinEditorPlayer: "500px",
            "size-width-min-editor-attr": "320px",
            sizeWidthMinEditorAttr: "320px",
            "size-height-min-editor-tl": "128px",
            sizeHeightMinEditorTl: "128px",
            "size-height-min-batch-replace-tl": "200px",
            sizeHeightMinBatchReplaceTl: "200px",
            "size-height-editor-collapsed-tl": "70px",
            sizeHeightEditorCollapsedTl: "70px",
            hide: "hide-BWfBDb",
            "entry-container": "entry-container-bIVUl2",
            entryContainer: "entry-container-bIVUl2",
            initializing: "initializing-Z9ULQA",
            "tags-wrapper": "tags-wrapper-uyXMlL",
            tagsWrapper: "tags-wrapper-uyXMlL",
            tags: "tags-tO2aTb",
            "view-box-wrapper": "view-box-wrapper-jcUa3d",
            viewBoxWrapper: "view-box-wrapper-jcUa3d",
            "view-box": "view-box-ZFRlFK",
            viewBox: "view-box-ZFRlFK",
            hidden: "hidden-j3ntls",
            "scroll-container": "scroll-container-WmLsRB",
            scrollContainer: "scroll-container-WmLsRB",
            "view-box-category": "view-box-category-Q0MwQn",
            viewBoxCategory: "view-box-category-Q0MwQn",
            active_category: "active_category-cQMmvu",
            activeCategory: "active_category-cQMmvu",
            active_category_back_btn_wrap: "active_category_back_btn_wrap-mAx_wP",
            activeCategoryBackBtnWrap: "active_category_back_btn_wrap-mAx_wP",
            active_category_content: "active_category_content-yH7J9j",
            activeCategoryContent: "active_category_content-yH7J9j",
            active_category_back_btn: "active_category_back_btn-H2nCs2",
            activeCategoryBackBtn: "active_category_back_btn-H2nCs2",
            transitionTipWithPoly: "transitionTipWithPoly-hLqfB6"
        }
    },
    235240: function() {},
    335653: function() {},
    789945: function() {},
    933851: function() {},
    958412: function() {},
    776952: function() {},
    821829: function() {},
    379326: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = {
            loadingIcon: "loadingIcon-hHd6kF",
            loading: "loading-dW4IXT",
            content: "content-wxmgFW",
            cancelBtn: "cancelBtn-voYVXn"
        }
    },
    246727: function(e, t, i) {
        e.exports = i.p + "static/image/ai-movement-cover.86855735.jpg"
    },
    752727: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return a
            }
        });
        let a = () => {}
    },
    474780: function(e, t, i) {
        i.d(t, {
            N: () => w
        });
        var a = i("789786")
          , r = i("48498")
          , n = i("425241")
          , o = i("346215")
          , s = i("228156")
          , d = i("120706")
          , l = i("83310")
          , c = i("392554")
          , u = i("801497")
          , h = i("235001")
          , p = i("260963")
          , g = i("272619")
          , m = i("532666");
        class _ extends m.JT {
            constructor(e) {
                super(),
                this._websocketService = e,
                this._onDidUpload = this._store.add(new g.Q),
                this._uploadedCountCounter = new Map,
                this._uploadedAssetIds = [],
                this.onDidUpload = this._onDidUpload.event,
                this._onUploadFileSuccess = e => {
                    var t;
                    if (!e.ok || e.value.status !== h.Pk.DONE)
                        return;
                    let {upload_from: i=h.d0.PHONE, asset_id: a="", workspace_id: r=""} = e.value
                      , n = this._uploadedAssetIds.includes(a)
                      , o = `${r}_${i}`
                      , s = null !== (t = this._uploadedCountCounter.get(o)) && void 0 !== t ? t : 0;
                    !n && (s += 1,
                    this._uploadedAssetIds.push(a)),
                    this._uploadedCountCounter.set(o, s),
                    this._onDidUpload.fire({
                        workspaceId: r,
                        uploadFrom: i,
                        newUploadMaterialIds: [a],
                        uploadedCount: s
                    })
                }
                ,
                this._websocketService.registerCallback(h.h1.WorkspaceUploadLinkFileSuccess, this._onUploadFileSuccess)
            }
        }
        _ = (0,
        a.gn)([(0,
        a.fM)(0, h.J0), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === h.J0 ? Object : h.J0])], _);
        var f = i("658096")
          , v = i.n(f)
          , y = i("866653");
        let S = v().generate();
        class w {
            getUploadLink(e) {
                return this._observableData.linkByWorkspaceId[e]
            }
            async registerUploadLink(e) {
                var t, i, a;
                let {workspaceId: r} = e;
                if (!this._accountService.hasLogin) {
                    this._accountService.login({
                        reportParams: {
                            pageEnterFrom: l.d.FromPhone
                        }
                    });
                    return
                }
                if ((0,
                n.ZB)(r, "un expect undefined for workspaceId when login"),
                (null === (t = this._observableData.linkByWorkspaceId[r]) || void 0 === t ? void 0 : t.initializing) || (null === (i = this._observableData.linkByWorkspaceId[r]) || void 0 === i ? void 0 : i.link)) {
                    Object.values(h.d0).forEach(e => {
                        !this._observableData.linkByWorkspaceId[r].dataMap[e] && (this._observableData.linkByWorkspaceId[r].dataMap[e] = {
                            uploadFileCount: 0
                        })
                    }
                    );
                    return
                }
                (0,
                p.z)( () => {
                    this._observableData.linkByWorkspaceId[r] = {
                        initializing: !0,
                        initializeFailure: !1,
                        link: "",
                        dataMap: {
                            [e.uploadFrom]: {
                                uploadFileCount: 0
                            }
                        }
                    }
                }
                );
                let o = this._uploadLinkService.getRegisteredUploadLink(r);
                if (o.ok) {
                    (0,
                    p.z)( () => {
                        var t;
                        this._observableData.linkByWorkspaceId[r] = {
                            initializing: !1,
                            initializeFailure: !1,
                            link: (null !== (t = o.value.url) && void 0 !== t ? t : "").replace("www.capcut.com", location.host),
                            dataMap: {
                                [e.uploadFrom]: {
                                    uploadFileCount: 0
                                }
                            }
                        }
                    }
                    );
                    return
                }
                let s = await this._uploadLinkService.registerUploadLink({
                    workspaceId: r
                });
                if (!s.ok) {
                    (0,
                    p.z)( () => {
                        this._observableData.linkByWorkspaceId[r] = {
                            initializing: !1,
                            initializeFailure: !0,
                            link: "",
                            dataMap: {
                                [e.uploadFrom]: {
                                    uploadFileCount: 0
                                }
                            }
                        }
                    }
                    ),
                    null === (a = this._notificationService) || void 0 === a || a.error(u.ZP.t("web_graphic_request_failure_tips", {}, "Something went wrong. Try again later."));
                    return
                }
                (0,
                p.z)( () => {
                    var t;
                    this._observableData.linkByWorkspaceId[r] = {
                        initializing: !1,
                        initializeFailure: !1,
                        link: (null !== (t = s.value.url) && void 0 !== t ? t : "").replace("www.capcut.com", location.host),
                        dataMap: {
                            [e.uploadFrom]: {
                                uploadFileCount: 0
                            }
                        }
                    }
                }
                )
            }
            constructor(e, t, i, a, n) {
                this._options = e,
                this._uploadLinkService = t,
                this._accountService = a,
                this._containerService = n,
                this._observableData = (0,
                p.LO)({
                    linkByWorkspaceId: {}
                }),
                this.messageId = S,
                this._longLinkManager = this._containerService.createInstance(_),
                this._longLinkManager.onDidUpload(async e => {
                    let {workspaceId: t, newUploadMaterialIds: i, uploadedCount: a, uploadFrom: n} = e;
                    if (!this._observableData.linkByWorkspaceId[t])
                        return;
                    (0,
                    p.z)( () => {
                        this._observableData.linkByWorkspaceId[t].dataMap[n].uploadFileCount = a
                    }
                    );
                    let o = await (0,
                    r.x)({
                        assetIds: i,
                        fromWorkspaceId: t,
                        toWorkspaceId: t,
                        containerService: this._containerService
                    });
                    if (!o.ok) {
                        var s;
                        null === (s = this._notificationService) || void 0 === s || s.error(u.ZP.t("web_text_edit_title_disconnected", {}, "Something went wrong."));
                        return
                    }
                    o.value.forEach(e => {
                        var i, a;
                        null === (i = (a = this._options).onCreated) || void 0 === i || i.call(a, {
                            material: e,
                            fromWorkspaceId: t
                        })
                    }
                    )
                }
                ),
                this._uploadLinkService.onDidLinkUpdate(e => {
                    if (!!this._observableData.linkByWorkspaceId[e])
                        (0,
                        p.z)( () => {
                            let t = this._uploadLinkService.getRegisteredUploadLink(e);
                            t.ok && (this._observableData.linkByWorkspaceId[e].link = t.value.url)
                        }
                        )
                }
                ),
                this._notificationService = (0,
                y.O)(this._containerService, e.notificationGenerator)
            }
        }
        w = (0,
        a.gn)([(0,
        a.fM)(1, o.r), (0,
        a.fM)(2, s.b), (0,
        a.fM)(3, c.D), (0,
        a.fM)(4, d.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUploadMaterialFromLink ? Object : IUploadMaterialFromLink, void 0 === o.r ? Object : o.r, void 0 === s.b ? Object : s.b, void 0 === c.D ? Object : c.D, void 0 === d.T ? Object : d.T])], w)
    },
    329980: function(e, t, i) {
        i.d(t, {
            l: function() {
                return r
            }
        });
        var a, r = ((a = {}).Back = "back",
        a.Forward = "forward",
        a)
    },
    317492: function(e, t, i) {
        i.d(t, {
            G: function() {
                return h
            }
        });
        var a = i(789786)
          , r = i(662320)
          , n = i(272619)
          , o = i(52237)
          , s = i(532666)
          , d = i(425241)
          , l = i(976714)
          , c = i(392554)
          , u = i(510932);
        class h extends s.JT {
            get dirty() {
                return this._dirty
            }
            setMeta(e) {
                (0,
                d.Y2)(this._sharedMutex.tryLock(), "meta manager should setMeta only once."),
                this._meta = e,
                this._initMetaHook(),
                this._dirty = !0,
                this._onDidChangeMeta.fire()
            }
            getMeta() {
                return this._dirty && this._updateMeta(),
                this._meta
            }
            _consumeDirtySignal() {
                this._dirty = !1
            }
            _recordDirtyAndNotify() {
                this._dirty = !0,
                this._onDidChangeMeta.fire()
            }
            _makeSource() {
                return {
                    owner: this._accountService.userProfile.uid,
                    platform: u.fz.Browser,
                    systemVersion: window.navigator.userAgent,
                    appVersion: this._environmentService.appVersion,
                    createTime: Date.now(),
                    commitId: this.uuid
                }
            }
            constructor(e, t, i) {
                var a;
                super(),
                this._accountService = t,
                this._environmentService = i,
                this._onDidChangeMeta = new n.Q,
                this._sharedMutex = new r.L,
                this._meta = {
                    uploadSource: this._makeSource(),
                    createSource: this._makeSource(),
                    draft: {
                        id: "",
                        type: 0,
                        duration: 0,
                        updateTime: 0,
                        size: 0,
                        version: "",
                        platformSupport: "browser",
                        isMainTrackEmpty: !1,
                        isScriptTemplate: !1,
                        isBusiness: !1,
                        itemType: 0,
                        renderIndexTrackMode: !1,
                        createScenario: null !== (a = new URL(window.location.href).searchParams.get("scenario")) && void 0 !== a ? a : "",
                        transferedFrom: 0
                    }
                },
                this._dirty = !0,
                this.onDidChangeMeta = this._onDidChangeMeta.event,
                this._register(e.draftChangeEvent( () => {
                    this._dirty = !0
                }
                )),
                !this._accountService.hasLogin && (0,
                o.V)(this._accountService.onDidLogin)( () => {
                    this._dirty = !0
                }
                )
            }
        }
        h = (0,
        a.gn)([(0,
        a.fM)(1, c.D), (0,
        a.fM)(2, l.Y), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [Object, void 0 === c.D ? Object : c.D, void 0 === l.Y ? Object : l.Y])], h)
    },
    648667: function(e, t, i) {
        i.d(t, {
            I: function() {
                return a
            }
        });
        class a {
            constructor() {
                this.workspaceIdFromUrl = function() {
                    let {searchParams: e} = new URL(window.location.href);
                    return e.get("workspaceId")
                }(),
                this.spaceIdFromUrl = function() {
                    let {searchParams: e} = new URL(window.location.href);
                    return e.get("spaceId")
                }()
            }
        }
    },
    210780: function(e, t, i) {
        i.d(t, {
            N: () => g
        });
        var a = i("510973")
          , r = i("716378")
          , n = i("35574")
          , o = i("789786")
          , s = i("228156")
          , d = i("659873")
          , l = i("36495")
          , c = i("864343")
          , u = i("425241");
        class h extends c.I {
            onAfterUpdateToWorkspaceId() {
                if (!this.toWorkspaceId)
                    return
            }
            get md5() {
                return this._data.md5
            }
            getModel() {
                return {
                    ...this._data,
                    id: this.id,
                    addModelToDraft: this._addModelToDraftBinder,
                    onModelUpdate: this.onModelUpdate,
                    onResourceReady: this.onResourceReady,
                    onDidDone: this.onDidDone,
                    onDidRemove: this.onDidRemove,
                    status: this.status
                }
            }
            canRetryPrepare() {
                (0,
                u.ss)("unSupport method")
            }
            prepare() {
                (0,
                u.ss)("unSupport method")
            }
            canRetryUpload() {
                return !1
            }
            upload() {
                (0,
                u.ss)("unSupport method")
            }
            canCancelUpload() {
                return !1
            }
            cancelUpload() {
                (0,
                u.ss)("unSupport method")
            }
            canRetryTranscode() {
                return !1
            }
            transcode() {
                (0,
                u.ss)("unSupport method")
            }
            canSync2UserMaterial() {
                return !1
            }
            cancelSync2UserMaterial() {}
            sync2UserMaterial() {}
            delete() {
                (0,
                u.ss)("unSupport method")
            }
            _triggerSyncMaterialFromWorkspaceHelper() {}
            constructor(e, t, i) {
                super({
                    fromWorkspaceId: void 0,
                    toWorkspaceId: void 0,
                    addModelToDraft: e.addModelToDraft,
                    fromFolderId: void 0,
                    toFolderId: void 0,
                    notificationService: e.notificationService
                }),
                this._option = e,
                this._userMaterialsService = t,
                this._mainDraftService = i,
                this._addModelToDraftBinder = () => this.addModelToDraft(this);
                let a = this._option;
                this._data = a.data,
                this._updateStatus(d.a.Success)
            }
        }
        h = (0,
        o.gn)([(0,
        o.fM)(1, s.b), (0,
        o.fM)(2, l.v), (0,
        o.w6)("design:type", Function), (0,
        o.w6)("design:paramtypes", ["undefined" == typeof IPreviewTemplateBuildInMaterialLifecycle ? Object : IPreviewTemplateBuildInMaterialLifecycle, void 0 === s.b ? Object : s.b, void 0 === l.v ? Object : l.v])], h);
        var p = i("866653");
        function g(e) {
            let {data: t} = e
              , i = (0,
            p.O)(e.containerService, e.notificationGenerator);
            return t.map(t => {
                let o = (0,
                n.F)({
                    data: {
                        md5: t.md5,
                        decryptKey: t.decryptKey,
                        url: t.url,
                        decryptType: t.decryptType
                    },
                    fileType: t.fileType
                });
                return e.containerService.createInstance(h, {
                    data: {
                        sourceType: a.ov.PublicSpace,
                        uri: t.uri,
                        url: t.url,
                        key: t.key,
                        md5: t.md5,
                        size: t.size,
                        ...o
                    },
                    addModelToDraft: (0,
                    r.s)(e.containerService),
                    notificationService: i
                })
            }
            )
        }
    },
    994443: function(e, t, i) {
        i.d(t, {
            f: function() {
                return h
            }
        });
        var a = i(694131)
          , r = i(510973)
          , n = i(392554)
          , o = i(677231)
          , s = i(52237)
          , d = i(716378)
          , l = i(35574)
          , c = i(36495)
          , u = i(866653);
        function h(e) {
            let {templateId: t, data: i, toWorkspaceId: h, payinPayoutHelper: p} = e
              , g = (0,
            u.O)(e.containerService, e.notificationGenerator)
              , m = e.containerService.invokeFunction(async e => {
                let r = e.get(a.d)
                  , o = e.get(c.v);
                (!e.get(n.D).hasLogin || !o.draftWorkspaceManager.workspaceId) && await new Promise(e => {
                    (0,
                    s.V)(o.draftWorkspaceManager.onDidWorkspaceChange)( () => {
                        e()
                    }
                    )
                }
                );
                let d = await r.createSyncTask({
                    templateId: t,
                    data: i,
                    workspaceId: null != h ? h : o.draftWorkspaceManager.workspaceId
                });
                return o.draftWorkspaceManager.onDidWorkspaceChange( () => {
                    h !== o.draftWorkspaceManager.workspaceId && h && o.draftWorkspaceManager.workspaceId && d.ok && d.value.reSyncWhileWorkspaceIdChange(o.draftWorkspaceManager.workspaceId)
                }
                ),
                d
            }
            );
            return i.map(t => {
                let i = (0,
                l.F)({
                    data: {
                        md5: t.md5,
                        decryptKey: t.decryptKey,
                        url: t.url,
                        decryptType: t.decryptType
                    },
                    fileType: t.fileType
                });
                return e.containerService.createInstance(o.N, {
                    data: {
                        sourceType: r.ov.PublicSpace,
                        uri: t.uri,
                        url: t.url,
                        key: t.key,
                        md5: t.md5,
                        size: t.size,
                        ...i
                    },
                    toWorkspaceId: h,
                    syncParams: {
                        syncTask: m,
                        uri: t.uri
                    },
                    addModelToDraft: (0,
                    d.s)(e.containerService),
                    payinPayoutHelper: p,
                    notificationService: g
                })
            }
            )
        }
    },
    443784: function(e, t, i) {
        i.d(t, {
            J: function() {
                return p
            }
        });
        var a = i(228156)
          , r = i(136255)
          , n = i.n(r)
          , o = i(539822)
          , s = i(888195)
          , d = i(749904)
          , l = i(510973)
          , c = i(42680)
          , u = i(716378)
          , h = i(866653);
        function p(e) {
            let t = e.containerService.invokeFunction(e => e.get(a.b))
              , i = (0,
            h.O)(e.containerService, e.notificationGenerator);
            return e.tasks.map(a => {
                let r = n().getType(a.name);
                return e.containerService.createInstance(o.p, {
                    fromWorkspaceId: e.fromWorkspaceId,
                    toWorkspaceId: e.toWorkspaceId,
                    data: {
                        sourceType: l.ov.EverCloud,
                        assetType: c.pS.Material,
                        key: "",
                        filename: a.name,
                        fileType: r ? (0,
                        d.Gt)(r) : (0,
                        d.eF)({
                            file: {
                                name: a.name,
                                fileType: ""
                            }
                        }),
                        owner: "",
                        md5: "",
                        mime: null != r ? r : "",
                        size: a.size,
                        createdAt: Date.now().valueOf(),
                        updatedAt: Date.now().valueOf(),
                        cover: {
                            url: a.coverUrl
                        }
                    },
                    payinPayoutHelper: e.payinPayoutHelper,
                    autoUpload: e.autoUpload,
                    addModelToDraft: (0,
                    u.s)(e.containerService),
                    uploadMaterialLifecycleHelper: new s.$({
                        taskId: a.id,
                        fromWorkspaceId: e.fromWorkspaceId,
                        thirdpartyUploader: e.thirdpartyUploader,
                        userMaterialService: t,
                        payinPayoutHelper: e.payinPayoutHelper,
                        notificationService: i
                    }),
                    notificationService: i
                })
            }
            )
        }
    },
    396854: function(e, t, i) {
        i.d(t, {
            s: function() {
                return d
            }
        });
        var a = i(659873)
          , r = i(786805)
          , n = i(511216)
          , o = i(425241)
          , s = i(417957);
        class d {
            get _updateStatus() {
                return this._handler.updateStatus
            }
            get preparing() {
                return this._preparing
            }
            get result() {
                return (0,
                o.ZB)(this._successResult, "unExpect call function when no success"),
                this._successResult
            }
            bootstrap(e) {
                Object.entries(e.events).forEach(e => {
                    let[t,i] = e;
                    this._preparing[t] = i
                }
                ),
                this._handler = e.handler
            }
            async prepare(e) {
                if (this._updateStatus(a.a.Preparing),
                !this._veToolkitInstance) {
                    let e = new URL(i(787055),i.b).href
                      , t = new URL(i(241296),i.b).href
                      , a = new URL(i(905683),i.b).href;
                    this._veToolkitInstance = await s.B.createInstance({
                        audioExtractor: {
                            source: e,
                            wasm: t,
                            worker: a
                        }
                    })
                }
                try {
                    let t = this._veToolkitInstance.createAudioExtractorTask(this._file, null != e ? e : "");
                    if (!t) {
                        let e = (0,
                        n.wf)(-1, "not exist audioExtractor");
                        this._preparing.error = e,
                        this._updateStatus(a.a.PrepareFailure, {
                            errInfo: e
                        })
                    }
                    let i = (await t.run(e => {
                        this._handler.onProgress(e)
                    }
                    )).data;
                    i && (this._successResult = {
                        buffer: i,
                        fileName: `ve_audio_extractor_${this._file.name}`
                    },
                    this._updateStatus(a.a.Prepared))
                } catch (t) {
                    let e = (0,
                    n.wf)(-1, "extractor audio error");
                    this._preparing.error = e,
                    this._updateStatus(a.a.PrepareFailure, {
                        errInfo: e
                    })
                }
            }
            constructor(e) {
                this._params = e,
                this._veToolkitInstance = null,
                this.canRetryPrepare = () => !!(this._handler.status() === a.a.PrepareFailure && this._params.file),
                this.dispose = () => {
                    this._veToolkitInstance = null
                }
                ,
                this._file = e.file,
                this._preparing = {
                    progress: 0,
                    error: void 0,
                    type: r.U.ExtractAudio
                }
            }
        }
    },
    691472: function(e, t, i) {
        i.d(t, {
            Y: () => p
        });
        var a = i("662320")
          , r = i("52237")
          , n = i("511216")
          , o = i("659873")
          , s = i("510973")
          , d = i("139218")
          , l = i("896951")
          , c = i("815735")
          , u = i("157508")
          , h = i("108483");
        class p {
            get _assetId() {
                return this._params.assetId
            }
            get _fromWorkspaceId() {
                return this._params.fromWorkspaceId
            }
            get _handler() {
                return this._params.handler
            }
            get onDidTranscode() {
                return this._params.handler.onDidTranscode
            }
            get onTranscodeFailure() {
                return this._params.handler.onTranscodeFailure
            }
            get _updateStatus() {
                return this._params.handler.updateStatus
            }
            get _updateModel() {
                return this._params.handler.updateModel
            }
            get transcoding() {
                return this._transcoding
            }
            canRetryTranscode() {
                return this._handler.status() === o.a.TranscodeFailure
            }
            transcode() {
                return new Promise(async e => {
                    if (this._handler.status() === o.a.Transcoding)
                        return e((0,
                        n.wf)(-1, "current material is not transcoding"));
                    try {
                        let e = await this._params.userMaterialService.getEvercloudInstance(this._fromWorkspaceId);
                        await e.triggerImageResize({
                            ids: [this._assetId]
                        }),
                        this.listenTranscodeResult()
                    } catch (t) {
                        e((0,
                        n.wf)(-1, null == t ? void 0 : t.message))
                    }
                    return (0,
                    r.V)(this.onDidTranscode)( () => e((0,
                    n.ly)())),
                    (0,
                    r.V)(this.onTranscodeFailure)(t => e(null != t ? t : (0,
                    n.wf)(-1, "unknown"))),
                    (0,
                    n.ly)()
                }
                )
            }
            async listenTranscodeResult() {
                if (!this._mutex.tryLock())
                    return;
                this._transcoding = {
                    progress: 0,
                    onSuccess: this._params.handler.onDidTranscode,
                    error: void 0,
                    onError: this._params.handler.onTranscodeFailure
                };
                let e = (0,
                u.c)(3, {
                    onprogress: e => {
                        this._transcoding && (this._transcoding.progress = e,
                        this._params.handler.onProgress(e))
                    }
                });
                try {
                    let e = this._assetId
                      , t = await this._params.userMaterialService.getEvercloudInstance(this._fromWorkspaceId)
                      , i = await function(e, t) {
                        let {userMaterialInstance: i} = t
                          , {resolve: a, promise: r} = (0,
                        l.PQ)()
                          , o = async () => {
                            let t = await i.getAssetByFileId(e);
                            if ((0,
                            c.o)(t.imageTranscodeInfo, {
                                originSize: t.width && t.height ? {
                                    width: t.width,
                                    height: t.height
                                } : void 0
                            })) {
                                a((0,
                                n.ly)());
                                return
                            }
                            if (!t.imageAsyncResize) {
                                a((0,
                                n.wf)(-1, "transcode failure with old data"));
                                return
                            }
                            setTimeout(o, 2e3)
                        }
                        ;
                        return o(),
                        r
                    }(e, {
                        userMaterialInstance: t
                    });
                    if ((0,
                    h.tF)() && await (0,
                    h.wO)(),
                    i.ok) {
                        let e = await t.getAssets({
                            ids: [this._assetId],
                            material: !1
                        });
                        if (!e || 1 !== e.length) {
                            this._updateStatus(o.a.TranscodeFailure);
                            return
                        }
                        let i = (0,
                        d.V)(null == e ? void 0 : e[0]);
                        (null == i ? void 0 : i.fileType) === s.YB.Image ? (this._updateModel(i),
                        this._updateStatus(o.a.Transcoded),
                        this._updateStatus(o.a.Success)) : this._updateStatus(o.a.TranscodeFailure)
                    } else
                        this._updateStatus(o.a.TranscodeFailure)
                } finally {
                    this._mutex.unLock(),
                    e()
                }
            }
            constructor(e) {
                this._params = e,
                this._mutex = new a.L
            }
        }
    },
    945177: function(e, t, i) {
        i.d(t, {
            D: function() {
                return h
            }
        });
        var a = i(662320)
          , r = i(511216)
          , n = i(48819)
          , o = i(425241)
          , s = i(510973)
          , d = i(659873)
          , l = i(527976)
          , c = i(157508)
          , u = i(108483);
        class h {
            get _assetId() {
                return this._params.assetId
            }
            get _fromWorkspaceId() {
                return this._params.fromWorkspaceId
            }
            get _updateStatus() {
                return this._params.handler.updateStatus
            }
            get _updateModel() {
                return this._params.handler.updateModel
            }
            get transcoding() {
                return this._transcoding
            }
            canRetryTranscode() {
                return !1
            }
            transcode() {
                return (0,
                o.Y2)("unSupport retry transcode for video"),
                Promise.resolve((0,
                r.wf)(-1, "unSupport retry transcode for video"))
            }
            async listenTranscodeResult() {
                if (!this._mutex.tryLock())
                    return;
                let e = (0,
                c.c)(1e4, {
                    onprogress: e => {
                        this._transcoding && (this._transcoding.progress = e,
                        this._params.handler.onProgress(e))
                    }
                });
                try {
                    var t, i, a, h, p;
                    let e = this._assetId;
                    this._transcoding = {
                        progress: 0,
                        onSuccess: this._params.handler.onDidTranscode,
                        error: void 0,
                        onError: this._params.handler.onTranscodeFailure
                    };
                    let c = await this._params.userMaterialService.getEvercloudInstance(this._fromWorkspaceId)
                      , g = await c.getVideoAssetTranscodeStatus({
                        id: e
                    })
                      , m = await g.done();
                    if ("success" === m.status) {
                        let r = (0,
                        l.J)(m.data);
                        !(null === (t = m.data) || void 0 === t ? void 0 : t.audio) && await Promise.race([Promise.all([(async () => {
                            let t = await c.getAssetSpirtInfo({
                                id: e
                            });
                            await t.done()
                        }
                        )(), (async () => {
                            let t = await c.getAssetPreviewInfo({
                                id: e
                            });
                            await t.done()
                        }
                        )()]), (0,
                        n._)(3e3)]);
                        let h = await this._params.userMaterialService.getMaterialsByIds({
                            workspaceId: this._params.fromWorkspaceId,
                            assetIds: [e]
                        });
                        (0,
                        o.Y2)(h.ok && (null === (i = h.value) || void 0 === i ? void 0 : i[0]));
                        let {key: p, ...g} = null === (a = h.value) || void 0 === a ? void 0 : a[0];
                        this._updateModel(g.fileType === s.YB.Video ? {
                            ...g,
                            videoTranscodeInfo: r
                        } : {
                            ...g,
                            audioTranscodeInfo: r
                        }),
                        (0,
                        u.tF)() && await (0,
                        u.wO)(),
                        this._updateStatus(d.a.Transcoded),
                        this._updateStatus(d.a.Success)
                    }
                    "error" === m.status && (this._transcoding.error = (0,
                    r.wf)(null === (h = m.errInfo) || void 0 === h ? void 0 : h.code, null === (p = m.errInfo) || void 0 === p ? void 0 : p.msg),
                    this._updateStatus(d.a.TranscodeFailure)),
                    !(null == m ? void 0 : m.status) && (this._transcoding.error = (0,
                    r.wf)(-1, "un expect transcode failure"),
                    this._updateStatus(d.a.TranscodeFailure))
                } catch (e) {
                    this._updateStatus(d.a.TranscodeFailure)
                } finally {
                    e(),
                    this._mutex.unLock()
                }
            }
            constructor(e) {
                this._params = e,
                this._mutex = new a.L
            }
        }
    },
    818764: function(e, t, i) {
        i.d(t, {
            c: function() {
                return v
            }
        });
        var a = i(789786)
          , r = i(659873)
          , n = i(510973)
          , o = i(120706)
          , s = i(228156)
          , d = i(378899)
          , l = i(864343)
          , c = i(52237)
          , u = i(511216)
          , h = i(425241)
          , p = i(691472)
          , g = i(945177)
          , m = i(382893)
          , _ = i(999212)
          , f = i(764951);
        class v extends l.I {
            get md5() {
                return this._data.md5
            }
            getModel() {
                var e, t, i;
                return {
                    ...this._data,
                    id: this.id,
                    status: this.status,
                    addModelToDraft: this._addModelToDraftBinder,
                    onModelUpdate: this.onModelUpdate,
                    onResourceReady: this.onResourceReady,
                    onDidDone: this.onDidDone,
                    onDidRemove: this.onDidRemove,
                    uploading: null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e ? void 0 : e.uploading,
                    preparing: null === (t = this._prepareMaterialLifecycleHelper) || void 0 === t ? void 0 : t.preparing,
                    transcoding: null === (i = this._transcodeMaterialHelper) || void 0 === i ? void 0 : i.transcoding
                }
            }
            canRetryPrepare() {
                var e, t;
                return null !== (t = null === (e = this._prepareMaterialLifecycleHelper) || void 0 === e ? void 0 : e.canRetryPrepare()) && void 0 !== t && t
            }
            prepare() {
                var e;
                null === (e = this._prepareMaterialLifecycleHelper) || void 0 === e || e.prepare()
            }
            canRetryUpload() {
                var e, t;
                return null !== (t = null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e ? void 0 : e.canRetryUpload()) && void 0 !== t && t
            }
            upload() {
                var e;
                null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e || e.upload()
            }
            changeUploadWorkspace(e) {
                var t;
                if (!(0,
                f.p)(this))
                    this._updateFromWorkspaceId(e),
                    null === (t = this._uploadMaterialLifecycleHelper) || void 0 === t || t.updateFromWorkspaceId(e)
            }
            canCancelUpload() {
                var e, t;
                return null !== (t = null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e ? void 0 : e.canCancelUpload()) && void 0 !== t && t
            }
            cancelUpload() {
                var e;
                null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e || e.cancelUpload(),
                super.cancelUpload()
            }
            canRetryTranscode() {
                var e, t;
                return null !== (t = null === (e = this._transcodeMaterialHelper) || void 0 === e ? void 0 : e.canRetryTranscode()) && void 0 !== t && t
            }
            transcode() {
                return (0,
                h.Y2)(this._transcodeMaterialHelper, "helper not found"),
                this._transcodeMaterialHelper.transcode()
            }
            canSync2UserMaterial() {
                var e, t;
                return null !== (t = null === (e = this._syncFromWorkspaceHelper) || void 0 === e ? void 0 : e.canSync2UserMaterial()) && void 0 !== t && t
            }
            sync2UserMaterial() {
                this._triggerSyncMaterialFromWorkspaceHelper(),
                this._syncFromWorkspaceHelper.sync2UserMaterial()
            }
            cancelSync2UserMaterial() {
                this.status === r.a.Syncing2UserMaterial && this._updateToWorkspaceId(this.fromWorkspaceId)
            }
            async delete(e) {
                try {
                    return !(null == e ? void 0 : e.onlyDeleteInCache) && await this._userMaterialsService.deleteMaterials({
                        workspaceId: this.fromWorkspaceId,
                        assetIds: [this._data.assetId]
                    }),
                    await super.delete(),
                    (0,
                    u.ly)()
                } catch (e) {
                    var t;
                    return (0,
                    u.wf)(-1, null !== (t = null == e ? void 0 : e.message) && void 0 !== t ? t : "unexpected error")
                }
            }
            get _needPrepare() {
                return !!this._prepareMaterialLifecycleHelper
            }
            _initUploadMaterialLifecycleHelper(e) {
                var t;
                let {file: i} = e;
                this._uploadMaterialLifecycleHelper = new _.x({
                    file: i,
                    fromWorkspaceId: this.fromWorkspaceId,
                    fromFolderId: this.fromFolderId,
                    userMaterialUploadService: this._userMaterialUploadService,
                    userMaterialService: this._userMaterialsService,
                    payinPayoutHelper: this._option.payinPayoutHelper,
                    fastImportAnalyzeHelper: this._option.fastImportAnalyzeHelper,
                    uploadParams: this._option.uploadParams,
                    notificationService: this._notificationService
                }),
                null === (t = this._uploadMaterialLifecycleHelper) || void 0 === t || t.bootstrap({
                    handler: {
                        model: () => this.getModel(),
                        status: () => this.status,
                        delete: () => {
                            this.delete()
                        }
                        ,
                        onProgress: () => {
                            this._fireModelUpdate()
                        }
                        ,
                        onCancelUpload: () => {
                            this._onDidCancelUpload.fire()
                        }
                        ,
                        updateStatus: this._updateStatus.bind(this),
                        updateModel: e => {
                            this._partialUpdateModel(e)
                        }
                    },
                    events: {
                        onSuccess: this.onDidUpload,
                        onError: this.onUploadFailure
                    }
                })
            }
            _bindListenerWithLifecycle() {
                this._needPrepare && (0,
                c.V)(this.onDidPrepare)( () => {
                    Promise.resolve().then( () => {
                        var e, t;
                        if (this.hasBeenRemoved)
                            return;
                        let i = null === (e = this._prepareMaterialLifecycleHelper) || void 0 === e ? void 0 : e.result;
                        (0,
                        h.ZB)(null == i ? void 0 : i.file),
                        this._initUploadMaterialLifecycleHelper({
                            file: null == i ? void 0 : i.file
                        }),
                        this._updateStatus(r.a.WaitingUpload),
                        null === (t = this._uploadMaterialLifecycleHelper) || void 0 === t || t.upload()
                    }
                    )
                }
                ),
                (0,
                c.V)(this.onDidUpload)( () => {
                    Promise.resolve().then( () => {
                        var e;
                        if (null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e || e.dispose(),
                        !this.hasBeenRemoved)
                            this._data.fileType === n.YB.Image ? this._transcodeMaterialHelper = new p.Y({
                                assetId: this._data.assetId,
                                fromWorkspaceId: this.fromWorkspaceId,
                                userMaterialService: this._userMaterialsService,
                                handler: {
                                    status: () => this.status,
                                    onProgress: () => this._onModelUpdate.fire(this.getModel()),
                                    onDidTranscode: this.onDidTranscode,
                                    onTranscodeFailure: this.onTranscodeFailure,
                                    updateStatus: this._updateStatus.bind(this),
                                    updateModel: e => this._partialUpdateModel(e)
                                }
                            }) : [n.YB.Audio, n.YB.Video].includes(this._data.fileType) ? this._transcodeMaterialHelper = new g.D({
                                assetId: this._data.assetId,
                                fileType: this._data.fileType,
                                fromWorkspaceId: this.fromWorkspaceId,
                                userMaterialService: this._userMaterialsService,
                                handler: {
                                    status: () => this.status,
                                    onProgress: () => this._onModelUpdate.fire(this.getModel()),
                                    onDidTranscode: this.onDidTranscode,
                                    onTranscodeFailure: this.onTranscodeFailure,
                                    updateStatus: this._updateStatus.bind(this),
                                    updateModel: e => this._partialUpdateModel(e)
                                }
                            }) : (0,
                            h.ss)("unexpected logic"),
                            this._updateStatus(r.a.Transcoding),
                            this._transcodeMaterialHelper.listenTranscodeResult()
                    }
                    )
                }
                ),
                (0,
                c.V)(this.onDidTranscode)( () => {
                    Promise.resolve().then( () => {
                        if (!this.hasBeenRemoved) {
                            if (void 0 === this.toWorkspaceId || this.fromWorkspaceId === this.toWorkspaceId) {
                                this._updateStatus(r.a.Success);
                                return
                            }
                            this.sync2UserMaterial()
                        }
                    }
                    )
                }
                ),
                this.onDidSync2UserMaterial( () => {
                    Promise.resolve().then( () => {
                        if (!this.hasBeenRemoved)
                            this._updateStatus(r.a.Success)
                    }
                    )
                }
                )
            }
            _triggerSyncMaterialFromWorkspaceHelper() {
                (0,
                h.ZB)(this.toWorkspaceId),
                this._syncFromWorkspaceHelper = this._containerService.createInstance(m.k, {
                    assetId: this._data.assetId,
                    fromWorkspaceId: this.fromWorkspaceId,
                    toWorkspaceId: this.toWorkspaceId,
                    userMaterialService: this._userMaterialsService,
                    payinPayoutHelper: this._option.payinPayoutHelper,
                    handler: {
                        status: () => this.status,
                        updateStatus: this._updateStatus.bind(this)
                    },
                    notificationService: this._notificationService
                })
            }
            _partialUpdateModel(e) {
                this._data.key && delete e.key,
                Object.assign(this._data, e),
                this._fireModelUpdate()
            }
            constructor(e, t, i, a) {
                var r;
                super({
                    fromWorkspaceId: e.fromWorkspaceId,
                    toWorkspaceId: e.toWorkspaceId,
                    addModelToDraft: e.addModelToDraft,
                    fromFolderId: e.fromFolderId,
                    toFolderId: e.toFolderId,
                    notificationService: e.notificationService
                }),
                this._option = e,
                this._userMaterialsService = t,
                this._userMaterialUploadService = i,
                this._containerService = a,
                this._addModelToDraftBinder = () => this.addModelToDraft(this);
                let n = this._option;
                this._data = n.data,
                this._prepareMaterialLifecycleHelper = n.prepareMaterialLifecycleHelper,
                null === (r = this._prepareMaterialLifecycleHelper) || void 0 === r || r.bootstrap({
                    handler: {
                        status: () => this.status,
                        delete: () => {
                            this.delete()
                        }
                        ,
                        onProgress: () => {
                            this._fireModelUpdate()
                        }
                        ,
                        updateStatus: this._updateStatus.bind(this)
                    },
                    events: {
                        onSuccess: this.onDidPrepare,
                        onError: this.onPrepareFailure
                    }
                }),
                setTimeout( () => {
                    var e;
                    null === (e = this._prepareMaterialLifecycleHelper) || void 0 === e || e.prepare()
                }
                ),
                this._bindListenerWithLifecycle()
            }
        }
        v = (0,
        a.gn)([(0,
        a.fM)(1, s.b), (0,
        a.fM)(2, d.ec), (0,
        a.fM)(3, o.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IExtractAudioAndUploadMaterialLifecycle ? Object : IExtractAudioAndUploadMaterialLifecycle, void 0 === s.b ? Object : s.b, void 0 === d.ec ? Object : d.ec, void 0 === o.T ? Object : o.T])], v)
    },
    238274: function(e, t, i) {
        i.d(t, {
            E: function() {
                return g
            }
        });
        var a = i(789786)
          , r = i(511216)
          , n = i(425241)
          , o = i(228156)
          , s = i(659873)
          , d = i(510973)
          , l = i(882566)
          , c = i(801497)
          , u = i(864343)
          , h = i(68439)
          , p = i(755662);
        class g extends u.I {
            get md5() {
                return this._data.md5
            }
            getModel() {
                return {
                    ...this._data,
                    id: this.id,
                    status: this.status,
                    draftDelta: this._draftDelta,
                    addModelToDraft: this._addModelToDraftBinder,
                    onModelUpdate: this.onModelUpdate,
                    onResourceReady: this.onResourceReady,
                    onDidDone: this.onDidDone,
                    onDidRemove: this.onDidRemove,
                    syncingUserMaterial: this.syncingUserMaterial
                }
            }
            canRetryPrepare() {
                return !1
            }
            prepare() {
                (0,
                n.ss)("should not be called when canRetryUpload is false")
            }
            canRetryUpload() {
                return !1
            }
            upload() {
                (0,
                n.ss)("should not be called when canRetryUpload is false")
            }
            canCancelUpload() {
                return !1
            }
            cancelUpload() {
                (0,
                n.ss)("should not be called when canCancelUpload is false")
            }
            canRetryTranscode() {
                return !1
            }
            canSync2UserMaterial() {
                return void 0 !== this.toWorkspaceId && this.fromWorkspaceId !== this.toWorkspaceId
            }
            cancelSync2UserMaterial() {
                this.status === s.a.Syncing2UserMaterial && this._updateToWorkspaceId(this.fromWorkspaceId)
            }
            async sync2UserMaterial() {
                (0,
                n.Y2)(this.status !== s.a.Syncing2UserMaterial, "could not call this function before it change to final status");
                let e = this._genSyncResultChecker();
                this.syncingUserMaterial = {
                    progress: 0
                };
                try {
                    this._updateStatus(s.a.Syncing2UserMaterial);
                    let {fromWorkspaceId: t, toWorkspaceId: i} = this;
                    if ((0,
                    n.Y2)(this._data.sourceType === d.ov.EverCloud),
                    (0,
                    n.ZB)(t),
                    (0,
                    n.ZB)(i),
                    this.toWorkspaceId !== this.fromWorkspaceId) {
                        let e = await this._userMaterialService.copyMaterialToWorkspace({
                            fromWorkspaceId: t,
                            toWorkspaceId: i,
                            assetId: this._data.assetId,
                            meta: ""
                        });
                        if (!e.ok) {
                            this._updateStatus(s.a.Sync2UserMaterialFailure, {
                                errInfo: e
                            }),
                            this.syncingUserMaterial.error = e,
                            this._handleSyncError(e.code),
                            this._reportService.reportDevError("sync-material-from-workspace", this.syncingUserMaterial.error);
                            return
                        }
                    }
                    e() && (this._updateStatus(s.a.Synced2UserMaterial),
                    this._afterSync2UserMaterial())
                } catch (t) {
                    if (e()) {
                        let e = (0,
                        r.wf)(-1, null == t ? void 0 : t.message);
                        this._updateStatus(s.a.Sync2UserMaterialFailure, {
                            errInfo: e
                        }),
                        this.syncingUserMaterial.error = e
                    }
                }
            }
            transcode() {
                (0,
                n.ss)("should not be called when transcode is false")
            }
            async delete(e) {
                try {
                    if ((0,
                    n.Y2)(this._data.sourceType === d.ov.EverCloud),
                    (0,
                    n.ZB)(this.fromWorkspaceId),
                    !(null == e ? void 0 : e.onlyDeleteInCache)) {
                        let e = await this._userMaterialService.deleteMaterials({
                            workspaceId: this.fromWorkspaceId,
                            assetIds: [this._data.assetId]
                        });
                        if (!e.ok)
                            return e
                    }
                    return await super.delete(),
                    (0,
                    r.ly)()
                } catch (e) {
                    var t;
                    return (0,
                    r.wf)(-1, null !== (t = null == e ? void 0 : e.message) && void 0 !== t ? t : "unexpected error")
                }
            }
            _afterSync2UserMaterial() {
                this._updateStatus(s.a.Success)
            }
            _handleSyncError(e) {
                let t = Number(e);
                if (!this._option.payinPayoutHelper) {
                    var i;
                    null === (i = this._notificationService) || void 0 === i || i.error(c.ZP.t("web_personal_invite_copy_wrong", {}, "Couldn\u2019t copy"));
                    return
                }
                if (t === o.F.Insufficient)
                    (0,
                    h.i)({
                        payinPayoutHelper: this._option.payinPayoutHelper,
                        payScene: p.Mm.SYNC,
                        workspaceId: this.toWorkspaceId,
                        onPaySuccess: () => {
                            this.sync2UserMaterial()
                        }
                    })
            }
            updateVideoTranscodeInfo(e) {
                this._data.fileType === d.YB.Video && (this._data.videoTranscodeInfo = e,
                this._fireModelUpdate())
            }
            constructor(e, t, i) {
                let {data: a, toWorkspaceId: r, fromWorkspaceId: n, fromFolderId: o, toFolderId: d, ...l} = e;
                super({
                    toWorkspaceId: r,
                    fromWorkspaceId: n,
                    fromFolderId: o,
                    toFolderId: d,
                    addModelToDraft: e.addModelToDraft,
                    notificationService: e.notificationService
                }),
                this._userMaterialService = t,
                this._reportService = i,
                this._addModelToDraftBinder = () => this.addModelToDraft(this),
                this._option = l,
                this._data = a,
                this._updateFromWorkspaceId(e.fromWorkspaceId),
                this._updateToWorkspaceId(e.toWorkspaceId),
                this._draftDelta = e.packageDelta,
                this.canSync2UserMaterial() ? this._updateStatus(s.a.WaitForSync2UserMaterial) : this._updateStatus(s.a.Success)
            }
        }
        g = (0,
        a.gn)([(0,
        a.fM)(1, o.b), (0,
        a.fM)(2, l.m), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof FileMaterialLifecycleParams ? Object : FileMaterialLifecycleParams, void 0 === o.b ? Object : o.b, void 0 === l.m ? Object : l.m])], g)
    },
    108974: function(e, t, i) {
        i.d(t, {
            n: function() {
                return v
            }
        });
        var a = i(789786)
          , r = i(555791)
          , n = i(228156)
          , o = i(847637)
          , s = i(659873)
          , d = i(510973)
          , l = i(120706)
          , c = i(864343)
          , u = i(52237)
          , h = i(511216)
          , p = i(425241)
          , g = i(439044)
          , m = i(41930)
          , _ = i(382893)
          , f = i(839011);
        class v extends c.I {
            get md5() {
                return this._data.md5
            }
            getModel() {
                var e, t, i, a;
                return {
                    ...this._data,
                    id: this.id,
                    addModelToDraft: this._addModelToDraftBinder,
                    onModelUpdate: this.onModelUpdate,
                    onResourceReady: this.onResourceReady,
                    onDidRemove: this.onDidRemove,
                    onDidDone: this.onDidDone,
                    status: this.status,
                    uploading: null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e ? void 0 : e.uploading,
                    transcoding: null === (t = this._transcodeMaterialHelper) || void 0 === t ? void 0 : t.transcoding,
                    preparing: null === (i = this._prepareMaterialLifecycleHelper) || void 0 === i ? void 0 : i.preparing,
                    syncingUserMaterial: null === (a = this._syncFromWorkspaceHelper) || void 0 === a ? void 0 : a.syncingUserMaterial
                }
            }
            canRetryPrepare() {
                (0,
                p.ss)("VeExtractAudioAndUploadToPublicSpaceLifecycle::canRetryPrepare")
            }
            prepare() {
                (0,
                p.ss)("VeExtractAudioAndUploadToPublicSpaceLifecycle::prepare")
            }
            canRetryUpload() {
                var e, t;
                return null !== (t = null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e ? void 0 : e.canRetryUpload()) && void 0 !== t && t
            }
            upload() {
                var e;
                null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e || e.upload()
            }
            canCancelUpload() {
                var e, t;
                return null !== (t = null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e ? void 0 : e.canCancelUpload()) && void 0 !== t && t
            }
            cancelUpload() {
                var e;
                null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e || e.cancelUpload(),
                super.cancelUpload()
            }
            canRetryTranscode() {
                var e, t;
                return null !== (t = null === (e = this._transcodeMaterialHelper) || void 0 === e ? void 0 : e.canRetryTranscode()) && void 0 !== t && t
            }
            transcode() {
                return (0,
                p.Y2)(this._transcodeMaterialHelper, "helper not found"),
                this._transcodeMaterialHelper.transcode()
            }
            canSync2UserMaterial() {
                var e, t;
                return null !== (t = null === (e = this._syncFromWorkspaceHelper) || void 0 === e ? void 0 : e.canSync2UserMaterial()) && void 0 !== t && t
            }
            cancelSync2UserMaterial() {
                this.status === s.a.Syncing2UserMaterial && this._updateToWorkspaceId(this.fromWorkspaceId)
            }
            sync2UserMaterial() {
                this._triggerSyncMaterialFromWorkspaceHelper(),
                (0,
                p.ZB)(this._syncFromWorkspaceHelper),
                this._syncFromWorkspaceHelper.sync2UserMaterial()
            }
            async delete(e) {
                var t, i;
                try {
                    return this._hasBeenSync ? ((0,
                    p.Y2)(this._data.sourceType === d.ov.EverCloud),
                    !(null == e ? void 0 : e.onlyDeleteInCache) && await this._userMaterialsService.deleteMaterials({
                        workspaceId: this.fromWorkspaceId,
                        assetIds: [this._data.assetId]
                    })) : [s.a.Uploading, s.a.UploadFailure, s.a.WaitingUpload].includes(this.status) && (null === (t = this._uploadMaterialLifecycleHelper) || void 0 === t || t.cancelUpload()),
                    await super.delete(),
                    (0,
                    h.ly)()
                } catch (e) {
                    return (0,
                    h.wf)(-1, null !== (i = null == e ? void 0 : e.message) && void 0 !== i ? i : "unexpected error")
                }
            }
            get _needPrepare() {
                return !!this._prepareMaterialLifecycleHelper
            }
            bindListenerWithLifecycle() {
                this._needPrepare && (0,
                u.V)(this.onDidPrepare)( () => {
                    Promise.resolve().then( () => {
                        var e, t, i, a;
                        if (this.hasBeenRemoved)
                            return;
                        let r = null === (e = this._prepareMaterialLifecycleHelper) || void 0 === e ? void 0 : e.result;
                        (0,
                        p.ZB)(null == r ? void 0 : r.buffer);
                        let n = new File([new Blob([null == r ? void 0 : r.buffer],{
                            type: "audio/m4a"
                        })],null !== (a = null == r ? void 0 : r.fileName) && void 0 !== a ? a : "undefined.m4a",{
                            type: "audio/m4a"
                        });
                        this._uploadMaterialLifecycleHelper = new f.I({
                            file: n,
                            publicSpaceUploadService: this._publicSpaceUploadService,
                            userMaterialService: this._userMaterialsService,
                            fastImportAnalyzeHelper: this._option.fastImportAnalyzeHelper,
                            fileCalcMd5Service: this._lazyFileMd5CalcService,
                            notificationService: this._notificationService
                        }),
                        null === (t = this._uploadMaterialLifecycleHelper) || void 0 === t || t.bootstrap({
                            handler: {
                                model: () => this.getModel(),
                                status: () => this.status,
                                delete: () => {
                                    this.delete()
                                }
                                ,
                                onProgress: () => {
                                    this._fireModelUpdate()
                                }
                                ,
                                updateStatus: this._updateStatus.bind(this),
                                updateModel: e => {
                                    this._partialUpdateModel(e)
                                }
                            },
                            events: {
                                onSuccess: this.onDidUpload,
                                onError: this.onUploadFailure
                            }
                        }),
                        this._updateStatus(s.a.WaitingUpload),
                        null === (i = this._uploadMaterialLifecycleHelper) || void 0 === i || i.upload()
                    }
                    )
                }
                ),
                (0,
                u.V)(this.onDidUpload)( () => {
                    Promise.resolve().then( () => {
                        var e, t;
                        if (!this.hasBeenRemoved)
                            null === (e = this._uploadMaterialLifecycleHelper) || void 0 === e || e.dispose(),
                            (0,
                            p.Y2)(this._data.sourceType === d.ov.PublicSpace, "current material is not from publicSpace"),
                            this._transcodeMaterialHelper = new g.L({
                                taskId: this._data.publicSpaceId,
                                fileType: this._data.fileType,
                                userMaterialService: this._userMaterialsService,
                                handler: {
                                    status: () => this.status,
                                    onProgress: () => this._onModelUpdate.fire(this.getModel()),
                                    onDidTranscode: this.onDidTranscode,
                                    onTranscodeFailure: this.onTranscodeFailure,
                                    updateStatus: this._updateStatus.bind(this),
                                    updateModel: e => this._partialUpdateModel(e)
                                }
                            }),
                            this._updateStatus(s.a.Transcoding),
                            null === (t = this._transcodeMaterialHelper) || void 0 === t || t.listenTranscodeResult()
                    }
                    )
                }
                ),
                (0,
                u.V)(this.onDidTranscode)( () => {
                    Promise.resolve().then( () => {
                        if (!this.hasBeenRemoved) {
                            if (this.toWorkspaceId) {
                                this.sync2UserMaterial();
                                return
                            }
                            this._updateStatus(s.a.WaitForSync2UserMaterial)
                        }
                    }
                    )
                }
                ),
                this.onDidSync2UserMaterial( () => {
                    Promise.resolve().then( () => {
                        if (!this.hasBeenRemoved)
                            this._hasBeenSync = !0,
                            this._updateFromWorkspaceId(this.toWorkspaceId),
                            this._updateStatus(s.a.Success)
                    }
                    )
                }
                )
            }
            _triggerSyncMaterialFromWorkspaceHelper() {
                (!this._syncFromWorkspaceHelper || this._syncHelperType !== this._data.sourceType) && (this._syncHelperType = this._data.sourceType,
                this._data.sourceType === d.ov.PublicSpace ? this._syncFromWorkspaceHelper = this._containerService.createInstance(m.B, {
                    vid: this._data.vid,
                    toFolderId: this.toFolderId,
                    toWorkspaceId: this.toWorkspaceId,
                    payinPayoutHelper: this._option.payinPayoutHelper,
                    userMaterialService: this._userMaterialsService,
                    handler: {
                        model: () => this.getModel(),
                        status: () => this.status,
                        updateStatus: this._updateStatus.bind(this),
                        updateModel: e => this._partialUpdateModel(e),
                        onProgress: () => this._onModelUpdate.fire(this.getModel())
                    }
                }) : this._syncFromWorkspaceHelper = this._containerService.createInstance(_.k, {
                    assetId: this._data.assetId,
                    fromWorkspaceId: this.fromWorkspaceId,
                    toWorkspaceId: this.toWorkspaceId,
                    userMaterialService: this._userMaterialsService,
                    payinPayoutHelper: this._option.payinPayoutHelper,
                    handler: {
                        status: () => this.status,
                        updateStatus: this._updateStatus.bind(this)
                    },
                    notificationService: this._notificationService
                }))
            }
            _partialUpdateModel(e) {
                this._data.key && delete e.key,
                Object.assign(this._data, e)
            }
            constructor(e, t, i, a, r) {
                var n;
                super({
                    fromWorkspaceId: void 0,
                    toWorkspaceId: void 0,
                    addModelToDraft: e.addModelToDraft,
                    fromFolderId: void 0,
                    toFolderId: void 0,
                    notificationService: e.notificationService
                }),
                this._option = e,
                this._publicSpaceUploadService = t,
                this._userMaterialsService = i,
                this._lazyFileMd5CalcService = a,
                this._containerService = r,
                this._hasBeenSync = !1,
                this._addModelToDraftBinder = () => this.addModelToDraft(this);
                let o = this._option;
                this._data = o.data,
                this._prepareMaterialLifecycleHelper = o.prepareMaterialLifecycleHelper,
                null === (n = this._prepareMaterialLifecycleHelper) || void 0 === n || n.bootstrap({
                    handler: {
                        status: () => this.status,
                        delete: () => {
                            this.delete()
                        }
                        ,
                        onProgress: () => {
                            this._fireModelUpdate()
                        }
                        ,
                        updateStatus: this._updateStatus.bind(this)
                    },
                    events: {
                        onSuccess: this.onDidPrepare,
                        onError: this.onPrepareFailure
                    }
                }),
                setTimeout( () => {
                    var e;
                    null === (e = this._prepareMaterialLifecycleHelper) || void 0 === e || e.prepare()
                }
                ),
                this.bindListenerWithLifecycle()
            }
        }
        v = (0,
        a.gn)([(0,
        a.fM)(1, r.S), (0,
        a.fM)(2, n.b), (0,
        a.fM)(3, o.w), (0,
        a.fM)(4, l.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IVeExtractAudioAndUploadToPublicSpaceLifecycle ? Object : IVeExtractAudioAndUploadToPublicSpaceLifecycle, void 0 === r.S ? Object : r.S, void 0 === n.b ? Object : n.b, void 0 === o.w ? Object : o.w, void 0 === l.T ? Object : l.T])], v)
    },
    707200: function(e, t, i) {
        i.d(t, {
            e: function() {
                return u
            }
        });
        var a = i(52237)
          , r = i(272619)
          , n = i(532666)
          , o = i(425241)
          , s = i(659873)
          , d = i(510973)
          , l = i(764951)
          , c = i(898592);
        class u extends n.JT {
            get isReady() {
                return this._isReady
            }
            bootstrap(e) {
                let t = [];
                (null == e ? void 0 : e.autoMaterials) && e.autoMaterials.forEach(e => {
                    var t, i, a;
                    let r = e.getModel();
                    this._addAndBindMaterial(e, "auto"),
                    this.getOrCreateAutoGeneratedMaterialNamespace(null !== (a = null === (i = r.draftDelta) || void 0 === i ? void 0 : null === (t = i.meta) || void 0 === t ? void 0 : t.id) && void 0 !== a ? a : c.U).addMaterials([e])
                }
                ),
                e.materials.forEach(e => {
                    var i, a, r, n, o, s;
                    let d = e.getModel();
                    if (!(null === (i = d.draftDelta) || void 0 === i ? void 0 : i.meta) || (null === (r = d.draftDelta) || void 0 === r ? void 0 : null === (a = r.meta) || void 0 === a ? void 0 : a.visible)) {
                        this._addAndBindMaterial(e, "user"),
                        t.push(e);
                        return
                    }
                    this._addAndBindMaterial(e, "auto"),
                    this.getOrCreateAutoGeneratedMaterialNamespace(null !== (s = null === (o = d.draftDelta) || void 0 === o ? void 0 : null === (n = o.meta) || void 0 === n ? void 0 : n.id) && void 0 !== s ? s : c.U).addMaterials([e])
                }
                ),
                t.forEach(e => {
                    this._referenceData.userGeneratedMaterials.add(e.id)
                }
                ),
                this._onDidMaterialAdd.fire(e.materials.map(e => e.id)),
                this._isReady = !0,
                this._onDidReady.fire()
            }
            getMaterials() {
                let e = []
                  , t = [];
                for (let i of (this._referenceData.userGeneratedMaterials.forEach(t => {
                    e.push(this._materials.get(t).getModel())
                }
                ),
                this._namespaceMap.values()))
                    t.push(...i.getMaterials());
                return {
                    userGeneratedMaterials: e,
                    autoGeneratedMaterials: t
                }
            }
            getUnUploadedMaterials() {
                let e = [];
                for (let t of this._materials.values())
                    !(0,
                    l.p)(t) && e.push(t.getModel());
                return e
            }
            getMaterialById(e) {
                let t = this._materials.get(e);
                return (0,
                o.ZB)(t),
                t.getModel()
            }
            invokeFunctionWithLifeCycleById(e, t) {
                let i = this._materials.get(e);
                (0,
                o.ZB)(i),
                t(i)
            }
            invokeFunctionWithLifeCycle(e) {
                for (let t of this._materials.values())
                    e(t)
            }
            isMaterialAllDone() {
                if (!this._isReady)
                    return !1;
                for (let e of this._getUsedMaterialIds())
                    if (this._materials.get(e).status !== s.a.Success)
                        return !1;
                return !0
            }
            hasMaterialSyncing() {
                if (!this._isReady)
                    return !1;
                for (let e of this._getUsedMaterialIds()) {
                    let t = this._materials.get(e);
                    if (t.status === s.a.Preparing || t.status === s.a.WaitingUpload || t.status === s.a.Uploading || t.status === s.a.Transcoding || t.status === s.a.WaitForSync2UserMaterial || t.status === s.a.Syncing2UserMaterial)
                        return !0
                }
                return !1
            }
            getMaterialsByMd5(e) {
                let t = [];
                for (let i of this._materials.values())
                    i.md5 === e && t.push(i.getModel());
                return (0,
                o.Y2)(t.length, `material is not found by md5(${e}), please check`),
                t
            }
            getMaterialsByAssetId(e) {
                for (let t of this._materials.values()) {
                    let i = t.getModel();
                    if (i.sourceType === d.ov.EverCloud && i.assetId === e)
                        return i
                }
                (0,
                o.ss)(`material is not found by assetId(${e}), please check`)
            }
            getMaterialByKey(e) {
                for (let t of this._materials.values())
                    if (t.getModel().key === e)
                        return t.getModel();
                (0,
                o.ss)("not found resource key")
            }
            isMaterialExistByKey(e) {
                for (let t of this._referenceData.userGeneratedMaterials) {
                    let i = this._materials.get(t);
                    if ((null == i ? void 0 : i.getModel().key) === e)
                        return !0
                }
                for (let t of this._namespaceMap.values())
                    if (t.getMaterials().find(t => t.key === e))
                        return !0;
                return !1
            }
            isMaterialExistInUserGeneratedByMd5(e) {
                for (let t of this._referenceData.userGeneratedMaterials) {
                    let i = this._materials.get(t);
                    if ((null == i ? void 0 : i.md5) === e)
                        return !0
                }
                return !1
            }
            isMaterialExistInUserGenerated(e) {
                return this._referenceData.userGeneratedMaterials.has(e)
            }
            addToUserGenerated(e, t) {
                this._addAndBindMaterial(e, "user"),
                this._referenceData.userGeneratedMaterials.add(e.id),
                this._onDidMaterialAdd.fire([e.id], t),
                e.onDidDelete( () => {
                    this.removeFromUserGenerated(e.id)
                }
                ),
                this._removeWhenDuplicateMd5(e)
            }
            removeFromUserGenerated(e) {
                let t = this._materials.get(e);
                (0,
                o.Y2)(t, "material not found, could not remove"),
                this._referenceData.userGeneratedMaterials.delete(e),
                this._onDidMaterialRemove.fire([t.getModel()]),
                this._checkAndNotifyMaterialDoneState()
            }
            addToAutoGenerated(e) {
                this.getOrCreateAutoGeneratedMaterialNamespace(c.U).addMaterials([e])
            }
            batchAddToAutoGenerated(e) {
                this.getOrCreateAutoGeneratedMaterialNamespace(c.U).addMaterials(e)
            }
            removeFromAutoGenerated(e) {
                this.getOrCreateAutoGeneratedMaterialNamespace(c.U).removeMaterials([e])
            }
            getOrCreateAutoGeneratedMaterialNamespace(e) {
                if (this._namespaceMap.has(e))
                    return this._namespaceMap.get(e);
                let t = new c.m({
                    namespace: e,
                    handler: {
                        findById: e => this._materials.get(e).getModel(),
                        add: e => {
                            this._addAndBindMaterial(e, "auto")
                        }
                        ,
                        remove: e => {
                            this._checkAndNotifyMaterialDoneState()
                        }
                        ,
                        replace: (e, t) => {
                            this._replaceAndBindMaterial(e, t, "auto")
                        }
                        ,
                        onDidAdd: e => {
                            this._onDidMaterialAdd.fire(e)
                        }
                        ,
                        onDidRemove: e => {
                            this._onDidMaterialRemove.fire(e)
                        }
                        ,
                        onDidReplace: (e, t) => {
                            this._onDidMaterialReplace.fire(e, t)
                        }
                    }
                });
                return this._namespaceMap.set(e, t),
                t
            }
            _addAndBindMaterial(e, t) {
                if (this._materials.has(e.id))
                    return;
                let i = [e.onDidDone, e.onSyncing2UserMaterial].map(e => e( () => {
                    this._checkAndNotifyMaterialDoneState()
                }
                ));
                (0,
                a.V)(e.onDidRemove)( () => {
                    i.forEach(e => null == e ? void 0 : e.dispose())
                }
                ),
                this._materials.set(e.id, e),
                e.status === s.a.Success || (this._checkAndNotifyMaterialDoneState(!1),
                (0,
                a.V)(e.onDidCancelUpload)( () => {
                    "user" === t ? this.removeFromUserGenerated(e.id) : this.removeFromAutoGenerated(e.id)
                }
                ))
            }
            _replaceAndBindMaterial(e, t, i) {
                this._addAndBindMaterial(t, i),
                this._checkAndNotifyMaterialDoneState()
            }
            _checkAndNotifyMaterialDoneState(e) {
                void 0 === e && (e = this.isMaterialAllDone()),
                this._preNotifyMaterialIsDone !== e && (this._preNotifyMaterialIsDone = e,
                this._onMaterialAllDoneChange.fire(this._preNotifyMaterialIsDone))
            }
            _getUsedMaterialIds() {
                let e = new Set;
                for (let t of (this._referenceData.userGeneratedMaterials.forEach(t => {
                    e.add(t)
                }
                ),
                this._namespaceMap.values()))
                    t.getMaterials().forEach(t => {
                        e.add(t.id)
                    }
                    );
                return [...e]
            }
            _removeWhenDuplicateMd5(e) {
                let t = () => {
                    let t = [];
                    for (let i of [...this._referenceData.userGeneratedMaterials]) {
                        if (i === e.id)
                            continue;
                        let a = this._materials.get(i);
                        (null == a ? void 0 : a.status) === s.a.Success && (null == a ? void 0 : a.md5) === e.md5 && (this.removeFromUserGenerated(i),
                        t.push(this._materials.get(i).getModel()))
                    }
                    this._onMaterialDuplicate.fire(t)
                }
                ;
                e.status === s.a.Success ? t() : (0,
                a.V)(e.onDidDone)( () => {
                    t()
                }
                )
            }
            constructor() {
                super(),
                this._isReady = !1,
                this._onDidReady = this._store.add(new r.Q),
                this.onDidReady = this._onDidReady.event,
                this._namespaceMap = new Map,
                this._preNotifyMaterialIsDone = !0,
                this._onMaterialAllDoneChange = this._store.add(new r.Q),
                this.onMaterialAllDoneChange = this._onMaterialAllDoneChange.event,
                this._onDidMaterialAdd = this._store.add(new r.Q),
                this.onDidMaterialAdd = this._onDidMaterialAdd.event,
                this._onDidMaterialRemove = this._store.add(new r.Q),
                this.onDidMaterialRemove = this._onDidMaterialRemove.event,
                this._onMaterialDuplicate = this._store.add(new r.Q),
                this.onMaterialDuplicate = this._onMaterialDuplicate.event,
                this._onDidMaterialReplace = this._store.add(new r.Q),
                this.onDidMaterialReplace = this._onDidMaterialReplace.event,
                this._materials = new Map,
                this._referenceData = {
                    userGeneratedMaterials: new Set
                },
                this.getOrCreateAutoGeneratedMaterialNamespace(c.U)
            }
        }
    },
    201019: function(e, t, i) {
        i.d(t, {
            b: function() {
                return o
            }
        });
        var a = i(214149)
          , r = i(532666)
          , n = i(29351);
        class o extends r.JT {
            get phase() {
                return this.phaseEmitter.currentPhase < n.f.DraftLoaded ? n.B.Started : this.phaseEmitter.currentPhase < n.f.Restored ? n.B.DraftLoaded : n.B.Restored
            }
            didPassPhase(e) {
                return this.phaseEmitter.currentPhase >= e
            }
            setWorkbenchLoaded(e) {
                this.setLifecyclePhase(n.f.WorkbenchLoaded)
            }
            setDraftLoaded() {
                this.setLifecyclePhase(n.f.DraftLoaded)
            }
            setRenderLoaded() {
                this.setLifecyclePhase(n.f.RendererLoaded)
            }
            setRestored() {
                this.setLifecyclePhase(n.f.Restored)
            }
            setCompleted() {
                this.setLifecyclePhase(n.f.Completed)
            }
            setDestroyed() {
                this.setLifecyclePhase(n.f.Destroyed)
            }
            get onDraftLoaded() {
                return this.phaseEmitter.when(n.f.DraftLoaded)
            }
            get onRestored() {
                return this.phaseEmitter.when(n.f.Restored)
            }
            setLifecyclePhase(e) {
                this.phaseEmitter.setPhase(e)
            }
            get isDestroyed() {
                return this.phaseEmitter.currentPhase === n.f.Destroyed
            }
            constructor(...e) {
                super(...e),
                this.phaseEmitter = new a.K(n.f.Started,{
                    checker: (e, t) => e <= t
                })
            }
        }
    },
    848078: function(e, t, i) {
        i.d(t, {
            E: function() {
                return a
            }
        });
        let a = (0,
        i(935473).yh)("media-sdier-menu-service")
    },
    537992: function(e, t, i) {
        i.d(t, {
            x: function() {
                return a
            }
        });
        let a = (0,
        i(935473).yh)("sync-report-to-slardar-service")
    },
    66915: function(e, t, i) {
        i.d(t, {
            $: function() {
                return c
            }
        });
        var a = i(789786)
          , r = i(635594)
          , n = i(40901)
          , o = i(83310)
          , s = i(299293)
          , d = i(801497)
          , l = i(856504);
        class c extends s.j {
            fetchData(e) {
                return this._brandDataService.getBrandAdjustmentPresets(e)
            }
            updateBrandResource(e) {
                return this._brandDataService.updateBrandResource(e)
            }
            deleteBrandResource(e) {
                return this._brandDataService.deleteBrandResource(e)
            }
            get titleText() {
                return d.ZP.t("web_space_brandkit_editor_regulate_preset", {}, "Adjust Presets")
            }
            constructor(e, t, i, a) {
                let {managerConfig: r, preloadData: n, shouldPaginate: o} = e;
                (null == n ? void 0 : n.list) && (n.list = (0,
                l.B)(n.list)),
                super(i, a, r, n),
                this._brandDataService = t,
                this._workspaceService = i,
                this._capcutAccountService = a,
                this.setInitialData(null == n ? void 0 : n.list, o)
            }
        }
        c = (0,
        a.gn)([(0,
        a.fM)(1, r.X), (0,
        a.fM)(2, n.W), (0,
        a.fM)(3, o.Gw), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserBrandManagerOptions ? Object : IUserBrandManagerOptions, void 0 === r.X ? Object : r.X, void 0 === n.W ? Object : n.W, void 0 === o.Gw ? Object : o.Gw])], c)
    },
    532385: function(e, t, i) {
        i.d(t, {
            C: function() {
                return u
            }
        });
        var a = i(789786)
          , r = i(635594)
          , n = i(493775)
          , o = i(40901)
          , s = i(83310)
          , d = i(801497)
          , l = i(299293)
          , c = i(856504);
        class u extends l.j {
            fetchData(e) {
                return this._stickerDataService.getBrandStickers(e)
            }
            updateBrandResource(e) {
                return this._brandDataService.updateBrandResource(e)
            }
            deleteBrandResource(e) {
                return this._brandDataService.deleteBrandResource(e)
            }
            get titleText() {
                return d.ZP.t("web_space_brandkit_editor_brand_sticker", {}, "Stickers")
            }
            constructor(e, t, i, a, r) {
                let {managerConfig: n, preloadData: o, shouldPaginate: s} = e;
                (null == o ? void 0 : o.list) && (o.list = (0,
                c.B)(o.list)),
                super(a, r, n, o),
                this._brandDataService = t,
                this._stickerDataService = i,
                this._workspaceService = a,
                this._capcutAccountService = r,
                this.setInitialData(null == o ? void 0 : o.list, s)
            }
        }
        u = (0,
        a.gn)([(0,
        a.fM)(1, r.X), (0,
        a.fM)(2, n.c), (0,
        a.fM)(3, o.W), (0,
        a.fM)(4, s.Gw), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserBrandManagerOptions ? Object : IUserBrandManagerOptions, void 0 === r.X ? Object : r.X, void 0 === n.c ? Object : n.c, void 0 === o.W ? Object : o.W, void 0 === s.Gw ? Object : s.Gw])], u)
    },
    356752: function(e, t, i) {
        i.d(t, {
            C: function() {
                return a
            }
        });
        let a = (0,
        i(935473).yh)("user-brand")
    },
    947193: function(e, t, i) {
        i.d(t, {
            N3: function() {
                return r
            },
            NZ: function() {
                return a
            },
            VY: function() {
                return n
            },
            it: function() {
                return o
            },
            mx: function() {
                return s
            }
        });
        let a = 21001
          , r = 0x4000016
          , n = "709"
          , o = "348188"
          , s = "36ab246bababe651ca877ddabc929e61"
    },
    477136: function(e, t, i) {
        i.d(t, {
            g: function() {
                return T
            }
        });
        var a = i(789786)
          , r = i(6820)
          , n = i(691862)
          , o = i(329980)
          , s = i(510973)
          , d = i(659873)
          , l = i(120706)
          , c = i(42680)
          , u = i(463977)
          , h = i(325016)
          , p = i(378899)
          , g = i(228156)
          , m = i(937746)
          , _ = i(272619)
          , f = i(511216)
          , v = i(425241)
          , y = i(716378)
          , S = i(893708)
          , w = i(813448)
          , b = i(332220)
          , M = i(722169)
          , k = i(726951);
        class T extends r.Z {
            addFileToFolderWhereFileLocated(e, t) {
                var i, a, r, o;
                let s = e.fromWorkspaceId;
                if ((0,
                v.ZB)(s),
                !e.fromFolderId)
                    return this.createFileByPath(this.formatPathFromArray([this.root.path, e.id]), e, {
                        deduplicationStrategy: null !== (r = null == t ? void 0 : t.deduplicationStrategy) && void 0 !== r ? r : h.c.NotAdd,
                        insertPosition: null !== (o = null == t ? void 0 : t.insertPosition) && void 0 !== o ? o : n.O.Beginning,
                        needClone: null == t ? void 0 : t.needClone,
                        cloneOptions: null == t ? void 0 : t.cloneOptions
                    });
                {
                    let r = this.getFolderById(e.fromFolderId)
                      , o = null == r ? void 0 : r.path;
                    return (0,
                    v.ZB)(o),
                    this.createFileByPath(this.formatPathFromArray([o, e.id]), e, {
                        deduplicationStrategy: null !== (i = null == t ? void 0 : t.deduplicationStrategy) && void 0 !== i ? i : h.c.NotAdd,
                        insertPosition: null !== (a = null == t ? void 0 : t.insertPosition) && void 0 !== a ? a : n.O.Beginning,
                        needClone: null == t ? void 0 : t.needClone,
                        cloneOptions: null == t ? void 0 : t.cloneOptions
                    })
                }
            }
            addFileToCurrentPath(e, t, i) {
                if (t.getModel().fileType === s.YB.File)
                    return {
                        hasDeduplicated: !1,
                        hasAdded: !1
                    };
                let a = !1;
                if ((null == i ? void 0 : i.deduplicationStrategy) === h.c.NotAdd) {
                    if (this._checkDuplicateFileFromCloud(t))
                        return {
                            hasDeduplicated: !0,
                            hasAdded: !1
                        }
                } else
                    (null == i ? void 0 : i.deduplicationStrategy) === h.c.DeleteExistFromCache ? {hasDeleted: a} = this._duplicateFileAndDeleteExist(t, {
                        onlyDeleteFromCache: !0
                    }) : (null == i ? void 0 : i.deduplicationStrategy) === h.c.DeleteExistFromCloud && ({hasDeleted: a} = this._duplicateFileAndDeleteExist(t, {
                        onlyDeleteFromCache: !1
                    }));
                let r = t;
                (null == i ? void 0 : i.needClone) && (r = this._containerService.createInstance(S.G, {
                    lifecycle: r,
                    fromWorkspaceId: this._params.workspaceId,
                    toWorkspaceId: this._params.workspaceId,
                    addModelToDraft: (0,
                    y.s)(this._containerService),
                    options: i.cloneOptions,
                    notificationService: this._notificationService
                })),
                super.addFileToCurrentPath(e, r, i);
                let n = this.getFileById(e);
                return (0,
                v.ZB)(n),
                this._updateParentFolderChild(n),
                {
                    hasDeduplicated: a,
                    hasAdded: !1
                }
            }
            addFolderToCurrentPath(e, t, i) {
                if ((null == i ? void 0 : i.deduplicationStrategy) === h.c.NotAdd && this._checkDuplicateFolderFromCloud(t))
                    return {
                        hasDeduplicated: !0,
                        hasAdded: !1
                    };
                (null == i ? void 0 : i.shouldNotFetchMoreWhenOpen) && this._foldersNotFetchMoreWhenOpen.add(t.assetId),
                super.addFolderToCurrentPath(e, t, i);
                let a = this.getFolderById(e);
                return (0,
                v.ZB)(a),
                this._updateParentFolderChild(a),
                {
                    hasDeduplicated: !1,
                    hasAdded: !0
                }
            }
            createFileByPath(e, t, i) {
                if (t.getModel().fileType === s.YB.File)
                    return {
                        hasDeduplicated: !1,
                        hasAdded: !1
                    };
                let a = !1;
                if ((null == i ? void 0 : i.deduplicationStrategy) === h.c.NotAdd) {
                    if (this._checkDuplicateFileFromCloud(t))
                        return {
                            hasDeduplicated: !0,
                            hasAdded: !1
                        }
                } else
                    (null == i ? void 0 : i.deduplicationStrategy) === h.c.DeleteExistFromCache ? {hasDeleted: a} = this._duplicateFileAndDeleteExist(t, {
                        onlyDeleteFromCache: !0
                    }) : (null == i ? void 0 : i.deduplicationStrategy) === h.c.DeleteExistFromCloud && ({hasDeleted: a} = this._duplicateFileAndDeleteExist(t, {
                        onlyDeleteFromCache: !1
                    }));
                let r = t;
                (null == i ? void 0 : i.needClone) && (r = this._containerService.createInstance(S.G, {
                    lifecycle: r,
                    fromWorkspaceId: this._params.workspaceId,
                    toWorkspaceId: this._params.workspaceId,
                    addModelToDraft: (0,
                    y.s)(this._containerService),
                    options: i.cloneOptions,
                    notificationService: this._notificationService
                })),
                super.createFileByPath(e, r, i);
                let n = this.getFileByPath(e);
                return (0,
                v.ZB)(n),
                this._updateParentFolderChild(n),
                {
                    hasDeduplicated: a,
                    hasAdded: !0
                }
            }
            createFolderByPath(e, t, i) {
                if ((null == i ? void 0 : i.deduplicationStrategy) === h.c.NotAdd && this._checkDuplicateFolderFromCloud(t))
                    return {
                        hasDeduplicated: !0,
                        hasAdded: !1
                    };
                (null == i ? void 0 : i.shouldNotFetchMoreWhenOpen) && this._foldersNotFetchMoreWhenOpen.add(t.assetId),
                super.createFolderByPath(e, t, i);
                let a = this.getFolderByPath(e);
                return (0,
                v.ZB)(a),
                this._updateParentFolderChild(a),
                {
                    hasDeduplicated: !1,
                    hasAdded: !0
                }
            }
            batchAddNodes(e, t) {
                if ((null == t ? void 0 : t.deduplicationStrategy) === h.c.NotAdd) {
                    let t = []
                      , i = !1;
                    return e.forEach(e => {
                        if (e.type === n.t.File) {
                            if (this._checkDuplicateFileFromCloud(e.data)) {
                                i = !0;
                                return
                            }
                            t.push(e)
                        } else if (e.type === n.t.Folder) {
                            if (this._checkDuplicateFolderFromCloud(e.data)) {
                                i = !0;
                                return
                            }
                            t.push(e)
                        }
                    }
                    ),
                    super.batchAddNodes(t),
                    {
                        hasDeduplicated: i,
                        hasAdded: !!t.length
                    }
                }
                return super.batchAddNodes(e),
                {
                    hasDeduplicated: !1,
                    hasAdded: !!e.length
                }
            }
            async deleteFileById(e) {
                let t;
                let i = super.getFileById(e);
                if ((0,
                v.ZB)(i, `Folder or file with id ${e} cannot be found, so delete failed.`),
                (0,
                k.F)(i.data.status)) {
                    i.data.canCancelUpload() && i.data.cancelUpload();
                    let t = this.getParentFolder(i);
                    return super.deleteFileById(e),
                    t && this._updateChildNum(t),
                    (0,
                    f.ly)()
                }
                if (i.type === n.t.File) {
                    let e = i.data.getModel();
                    e.sourceType === s.ov.EverCloud && ({assetId: t} = e)
                }
                (0,
                v.ZB)(t);
                let a = await i.data.delete()
                  , r = this.getParentFolder(i);
                return super.deleteFileById(e),
                r && this._updateChildNum(r),
                a
            }
            async deleteFolderById(e) {
                let t;
                let i = super.getFolderById(e);
                (0,
                v.ZB)(i, `Folder or file with id ${e} cannot be found, so delete failed.`),
                i.type === n.t.Folder && ({assetId: t} = i.data),
                (0,
                v.ZB)(t);
                let a = await this._userMaterialsService.deleteMaterials({
                    assetIds: [t],
                    workspaceId: this._params.workspaceId
                });
                if (a.ok) {
                    let t = this.getParentFolder(i);
                    super.deleteFolderById(e),
                    t && this._updateChildNum(t)
                }
                return a
            }
            async fetchMore(e) {
                let {currentFolderId: t} = e
                  , i = this._fetchMoreParamsMap.get(t);
                if (null == i ? void 0 : i.fetchMoreMutex.isLocked)
                    return;
                if (this._foldersNotFetchMoreWhenOpen.has(t)) {
                    console.warn("no permission, this folder has been configured not to fetch more"),
                    this._updateFetchParams(t, {
                        isFolderInitialize: !0,
                        hasMore: !1
                    });
                    return
                }
                let a = this.getFolderById(t);
                (0,
                v.Y2)(a, "folder is undefined when fetch more");
                let {path: r} = a;
                if ((0,
                v.Y2)(i, "fetchMoreParams is undefined when fetch more"),
                await i.fetchMoreMutex.acquire(),
                !i.hasMore) {
                    i.fetchMoreMutex.release();
                    return
                }
                i.isFetchingData = !0,
                i.isFetchFailure = !1,
                this._onFetchMoreParamsChange.fire();
                let o = () => {
                    i.isFetchFailure = !0,
                    i.isFetchingData = !1,
                    this._onFetchMoreParamsChange.fire()
                }
                ;
                try {
                    var d;
                    let e = await this._userMaterialsService.getUserAssets((0,
                    u.ib)({
                        count: i.count,
                        orderBy: "directory_create",
                        order: 1,
                        workspaceId: this._params.workspaceId,
                        parentId: null !== (d = this.currentFolder.data.assetId) && void 0 !== d ? d : s.ZF,
                        isCrossFolder: !1,
                        assetTypes: [c.pS.Material, c.pS.Folder, c.pS.Exported],
                        offset: i.offset
                    }, [], {
                        hasMore: !0,
                        offset: i.offset
                    }));
                    if (!e.ok) {
                        o();
                        return
                    }
                    let {hasMore: a, offset: l, value: p} = e.value
                      , g = [];
                    p.forEach(e => {
                        if (e.assetType === c.pS.Material && e.fileType !== s.YB.File) {
                            var t, i;
                            let a = (0,
                            b.Q)(e, {
                                fromWorkspaceId: this._params.workspaceId,
                                toWorkspaceId: void 0,
                                fromFolderId: this.currentFolder.data.assetId,
                                toFolderId: void 0,
                                payinPayoutHelper: null === (i = this._params) || void 0 === i ? void 0 : null === (t = i.options) || void 0 === t ? void 0 : t.payinPayoutHelper,
                                containerService: this._containerService
                            });
                            g.push({
                                path: this.formatPathFromArray([r, a.id]),
                                data: a,
                                type: n.t.File
                            })
                        }
                        e.assetType === c.pS.Folder && g.push({
                            path: this.formatPathFromArray([r, e.assetId]),
                            data: e,
                            type: n.t.Folder
                        })
                    }
                    );
                    let {hasAdded: m} = this.batchAddNodes(g, {
                        deduplicationStrategy: h.c.NotAdd
                    });
                    i.offset = l,
                    i.hasMore = a,
                    i.isFetchingData = !1,
                    i.isFetchFailure = !1,
                    i.isFolderInitialize = !0,
                    this._updateFetchParams(t, i),
                    !m && (i.fetchMoreMutex.release(),
                    i.hasMore && (i.isFetchingData = !0,
                    this._updateFetchParams(t, i),
                    this.fetchMore({
                        currentFolderId: t
                    })))
                } catch (e) {
                    o()
                } finally {
                    i.fetchMoreMutex.isLocked && i.fetchMoreMutex.release()
                }
            }
            getFetchParams(e) {
                return this._fetchMoreParamsMap.get(e)
            }
            print() {
                super.print({
                    formatter: e => {
                        var t;
                        return null !== (t = e.type === n.t.Folder ? e.data.filename : e.data.getModel().filename) && void 0 !== t ? t : ""
                    }
                })
            }
            _bootstrap() {
                this._initFetchParamOfCurrentFolder()
            }
            _updateChildNum(e) {
                var t;
                let i = null === (t = this.getFolderChildNodes(null == e ? void 0 : e.id)) || void 0 === t ? void 0 : t.length;
                e.data.childFileNum = null != i ? i : 0,
                this.dangerouslyUpdateFolder(e.id, e.data)
            }
            _updateParentFolderChild(e) {
                let t = this.getParentFolder(e);
                t && this._updateChildNum(t)
            }
            _initFetchParamOfCurrentFolder() {
                !this._fetchMoreParamsMap.get(this.currentFolder.id) && this._fetchMoreParamsMap.set(this.currentFolder.id, this._getDefaultFetchMoreParams())
            }
            _updateFetchParams(e, t) {
                let i = this._fetchMoreParamsMap.get(e);
                (0,
                v.Y2)(i),
                this._fetchMoreParamsMap.set(e, {
                    ...i,
                    ...t
                }),
                this._onFetchMoreParamsChange.fire()
            }
            _checkDuplicateFileFromCloud(e) {
                let t = e.getModel();
                if (t.sourceType === s.ov.EverCloud)
                    return !!t.assetId && this._nodeFromCloudMap.has(t.assetId);
                return !1
            }
            _checkDuplicateFolderFromCloud(e) {
                return this._nodeFromCloudMap.has(e.assetId)
            }
            _getDefaultFetchMoreParams() {
                return {
                    isFetchingData: !1,
                    isFetchFailure: !1,
                    hasMore: !0,
                    count: 30,
                    offset: 0,
                    isFolderInitialize: !1,
                    fetchMoreMutex: new w.w
                }
            }
            _listenPathChangeAndFetchMore() {
                this.onPathChange(async e => {
                    let {action: t} = e;
                    this._initFetchParamOfCurrentFolder(),
                    this._onFetchMoreParamsChange.fire(),
                    t !== o.l.Back && await this.fetchMore({
                        currentFolderId: this.currentFolder.id
                    }),
                    this._updateFetchParams(this.currentFolder.id, {
                        isFolderInitialize: !0
                    })
                }
                )
            }
            _listenAddAndUpdateNodeMap() {
                this.onAdd(e => {
                    e.forEach(e => {
                        if (e.type === n.t.File) {
                            let t = e.data.getModel();
                            if (t.sourceType === s.ov.PublicSpace) {
                                let t = e.data.onModelUpdate( () => {
                                    let i = e.data.getModel();
                                    i.assetId && (this._nodeFromCloudMap.set(i.assetId, e),
                                    t.dispose())
                                }
                                );
                                return
                            }
                            if (t.sourceType === s.ov.EverCloud && t.fileType !== s.YB.File) {
                                if (void 0 === t.assetId) {
                                    if (e.data.status !== d.a.Success) {
                                        let t = e.data.onModelUpdate( () => {
                                            let i = e.data.getModel();
                                            i.assetId && (this._nodeFromCloudMap.set(i.assetId, e),
                                            t.dispose())
                                        }
                                        )
                                    }
                                    return
                                }
                                this._nodeFromCloudMap.set(t.assetId, e)
                            }
                        } else {
                            let t = e.data;
                            if (void 0 === t.assetId)
                                return;
                            this._nodeFromCloudMap.set(t.assetId, e)
                        }
                    }
                    )
                }
                )
            }
            _listenFolderNotExistWhenUpload() {
                this.onAdd(e => {
                    e.forEach(e => {
                        if (e.type === n.t.File) {
                            let t = e.data;
                            t.onUploadFailure(e => {
                                if (t.fromWorkspaceId && (null == e ? void 0 : e.code) === p.H9.FolderNotExist) {
                                    let e = this.getFileById(t.id)
                                      , i = this.extractParentPath(e.path);
                                    t.cancelUpload(),
                                    i === this.currentPath && this.open(this.root.id);
                                    let a = this.extractCurrentId(i);
                                    this.deleteFolderById(a)
                                }
                            }
                            )
                        }
                    }
                    )
                }
                )
            }
            _duplicateFileAndDeleteExist(e, t) {
                var i;
                let a = null !== (i = null == t ? void 0 : t.onlyDeleteFromCache) && void 0 !== i && i
                  , r = e.getModel();
                if (r.sourceType === s.ov.EverCloud && r.assetId) {
                    if (this._checkDuplicateFileFromCloud(e)) {
                        let e = this._nodeFromCloudMap.get(r.assetId);
                        return a ? super.deleteFileById(e.id) : this.deleteFileById(e.id),
                        {
                            hasDeleted: !0
                        }
                    }
                } else
                    (0,
                    k.F)(e.status) && e.onDidUpload( () => {
                        this._checkDuplicateFileFromCloud(e) && this.syncPreorderTraversal(this.root.id, t => {
                            if (t.type === n.t.File) {
                                let i = t.data.getModel()
                                  , r = e.getModel();
                                if (i.sourceType === s.ov.EverCloud && r.sourceType === s.ov.EverCloud && i.assetId === r.assetId && i.id !== r.id) {
                                    let e = t.data;
                                    a ? super.deleteFileById(e.id) : this.deleteFileById(e.id)
                                }
                            }
                        }
                        )
                    }
                    );
                return {
                    hasDeleted: !1
                }
            }
            constructor(e, t, i, a) {
                super((0,
                M.omit)(e, "options")),
                this._params = e,
                this._userMaterialsService = t,
                this._containerService = i,
                this._notificationService = a,
                this._fetchMoreParamsMap = new Map,
                this._onFetchMoreParamsChange = this._store.add(new _.Q),
                this._nodeFromCloudMap = new Map,
                this._foldersNotFetchMoreWhenOpen = new Set,
                this.onFetchMoreParamsChange = this._onFetchMoreParamsChange.event,
                this._bootstrap(),
                this._listenPathChangeAndFetchMore(),
                this._listenAddAndUpdateNodeMap(),
                this._listenFolderNotExistWhenUpload()
            }
        }
        T = (0,
        a.gn)([(0,
        a.fM)(1, g.b), (0,
        a.fM)(2, l.T), (0,
        a.fM)(3, m.lT), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IWorkspaceDirectoryManagerOptions ? Object : IWorkspaceDirectoryManagerOptions, void 0 === g.b ? Object : g.b, void 0 === l.T ? Object : l.T, void 0 === m.lT ? Object : m.lT])], T)
    },
    20956: function(e, t, i) {
        i.d(t, {
            O: function() {
                return l
            },
            T: function() {
                return u
            }
        });
        var a = i(789786)
          , r = i(882566)
          , n = i(186158)
          , o = i(511216)
          , s = i(722169);
        class d {
            getEventParams() {
                return {
                    ...this._params
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "editor_layer_render"
            }
        }
        function l(e, t) {
            (0,
            n.K)(e, d, [t], {
                important: !0
            })
        }
        class c {
            getEventParams() {
                let {stage: e, error: t} = this._params
                  , i = (0,
                s.omit)(this._params, "error");
                if (i.errorMessage = "missing error instance",
                i.errorCause = "missing error instance",
                t) {
                    this._reportService.reportDevError("editor_layer_render_fail", t, {
                        msg: e
                    });
                    let a = (0,
                    o.oi)(t) ? t.cause : t;
                    i.errorMessage = `${null == a ? void 0 : a.name}-${null == a ? void 0 : a.message}`,
                    i.errorCause = a instanceof Error ? `${null == a ? void 0 : a.name}-${a.cause}` : "missing error cause"
                }
                return i
            }
            constructor(e, t) {
                this._params = e,
                this._reportService = t,
                this.eventName = "editor_layer_render_fail"
            }
        }
        function u(e, t) {
            (0,
            n.K)(e, c, [t], {
                important: !0
            })
        }
        c = (0,
        a.gn)([(0,
        a.fM)(1, r.m), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IEditorLayerRenderFailParams ? Object : IEditorLayerRenderFailParams, void 0 === r.m ? Object : r.m])], c)
    },
    290483: function(e, t, i) {
        i.d(t, {
            X: function() {
                return r
            }
        });
        var a, r = ((a = {})[a.None = 0] = "None",
        a[a.Local = 1] = "Local",
        a[a.Online = 2] = "Online",
        a[a.Transcoding = 3] = "Transcoding",
        a[a.Downloading = 4] = "Downloading",
        a[a.Preparing = 5] = "Preparing",
        a[a.Pending = 6] = "Pending",
        a[a.Uploading = 7] = "Uploading",
        a[a.TranscodeFailed = 8] = "TranscodeFailed",
        a[a.DownloadFailed = 9] = "DownloadFailed",
        a[a.UploadFailed = 10] = "UploadFailed",
        a[a.LoginSyncing = 11] = "LoginSyncing",
        a[a.LoginSyncFailed = 12] = "LoginSyncFailed",
        a[a.LoginSynced = 13] = "LoginSynced",
        a[a.NoTranscodeInformation = 14] = "NoTranscodeInformation",
        a[a.TranscodeNotSupported = 15] = "TranscodeNotSupported",
        a)
    },
    575930: function(e, t, i) {
        i.d(t, {
            Z: () => c
        });
        var a = i("772322")
          , r = i("459232")
          , n = i("972349")
          , o = i("574119")
          , s = i("75085")
          , d = i("105789")
          , l = i.n(d);
        function c(e) {
            let {className: t, style: i} = e;
            return (0,
            n.i)() ? (0,
            a.jsx)(o.Tu, {
                type: "entrance",
                className: t
            }) : (0,
            a.jsx)("img", {
                src: (0,
                r.C)("data:image/webp;base64,UklGRgwEAABXRUJQVlA4WAoAAAAQAAAAZgAAMQAAQUxQSHsAAAABcFzbttLc6KNJh6K0h2g9OB3k/yk+e3eciJgAbJ3kW9tJY1u/I8FxOE6aD/7etZy0z6+bctI/BxBODD1IT2F0oolj+CXxaknUhoSZ/hA0JH41iepN4hGRCO4dhUEQUHAB5ARSALjm6mXXDeD1qnUujiV8V1YlU70CwRYAVlA4IGoDAABQEQCdASpnADIAPp1AnEsuJyioqlVbWLATiWMAxyheSXYII/dP7483iA0lMy7yAfUnAGGH1m5NZAEPpvDaJZj1tD4Et7mhH8F7gM+LPgC6u6lemIljoD3xzesTKiVKfPszXeBMRkrAv67ln2MOEq4j8+wA34AT28MSdeWfhE8eIhxIGiJqNXXGXOHd8wIo7nfmuiAA/vYARZSJcL2p05H+XhDW/Dmr5Ri6nC104AIqc1O4XDW7PcFdURBZ8Y+xJ8eUP9x5lTsQu/BBcBa4nsPGARN6J/VCyij9iZWllPWN8t+5SbKWrr8Y7WsT7sOH5oABXIA1yjZiYDCFBiZDj/NMwFklKHnO0sJCV40yx9hFgsjudsrrn+28zix1UCDZJP6Ucvv65Kwb/+RSEjTh4vAJVJPD1BsL8x5ztGekWFdhcveVzi/076B13ScZ4yYfVVVEhZnAWXdM3kSSD+3byJPO24Sbk+rXtfUedHFQHAyCldvqw53F1uA3GRGygCC+86F3c6LeVt+j6NWs5mwfcgu3RekB/H14N2syFRzgeMNEI6WbeNOvixeE+knAc9TPd4pIus+F+BnMID1nZZEKrywGJWoKd5dDLvefOt0qQlkethDbqKbW3kD+X5F0/ogTqnAUwr8b7Gr95RFgiG45wb1MG/qgJttnAx5tIjGn6VtMiCpSe9WN9nhlA8rsQXm3UgGDkhtkkkPtv5mUEbl+/6j0e6nGaeznLN9nFSQQevWXyNXEZXZ4vmbXqKci+wNopfQK+pn838xf7Ft9GCI4gfqde0c/Mmhj0T5dHA2Q9gZBnpeeAUqCF5O08HWQ5P/EKfyOhFsNqmCmurGZTavnOYhBBZjbLYyuhCGufmci5zuAsbqQxu0PH9qKqmJXZRbiRaA69dfs/D8CzVi1HqQgyyxd95d/0+b0W1iL17aoBbxQEUKAPYpMtIutEodX2+MjmTWDmP2Uzal3SqkJ9OaItReqM6Qt7Mfrc8KYKx/ZNoDcOckdIuuun7+nZPhmKFfG6SrQawJB7Ob4K+cl1Rp6tAzHB0FK8dUoH8nGNZ0VaFMsO7tnrQCM5OVcR3vvP+wAyl0jwWhQIyAznaBHm/v3wFheCe3piK6Iri1BUj9AmGLelWuLa0Ytm3WPV/a0f1N/wZn/qif6m/3AAAAA", null, {
                    logType: "js.href/src",
                    reportOnly: "false",
                    blackConfig: "{}",
                    configMode: "merge",
                    isCloseSSRReport: !1,
                    bid: "cc_web_editor",
                    region: "sg-capcut",
                    urlLimit: "10000",
                    htmlLimit: "-1",
                    isSaveValidUrl: !1,
                    isRuntimeLog: !1,
                    isDOMParser: !1,
                    escapeRule: "escape-report",
                    reportUrl: "https://mon-sg.capcutapi.com/monitor_browser/collect/batch/security/?bid=cc_web_editor",
                    scmBranch: "-",
                    scmName: "W$Zk$2$rd3llREprTWxacFRETmFjRnBI$m5aW%1qbDFZa2RzZFZwWFJub*FNM$o2",
                    scmVersion: "1.0.1.7201",
                    webpackPluginVersion: "3.4.10",
                    filename: "$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1teHNZM2s1-WxrelpHeFph$*w2WTIxTmRscFh$bkJr%npsN$RETmFjRnBI$m5aT%0wNT$XW*s1-W1Je%1-%mlNalIy$1ZoT2$scFl$bnBNTW14c$lqSTBkR1J0-khkT$-xcD$Xb*RWZEdKW*JHd*FSM2hz$Ec1%2$t$khSbmxhTTFaNg"
                }),
                alt: "",
                className: l()(s.Z.icon, t),
                style: i
            })
        }
    },
    85059: function(e, t, i) {
        i.d(t, {
            K: function() {
                return s
            }
        });
        var a = i(772322)
          , r = i(459232)
          , n = i(916853)
          , o = i(655450);
        let s = e => {
            let {url: t, visible: i, withCredentials: s} = e;
            return (0,
            a.jsx)("div", {
                className: n.Z.dragImageContainer,
                style: {
                    visibility: i ? "visible" : "hidden"
                },
                children: (0,
                a.jsx)(o.Z, {
                    className: n.Z.image,
                    src: (0,
                    r.C)(t, null, {
                        logType: "js.href/src",
                        reportOnly: "false",
                        blackConfig: "{}",
                        configMode: "merge",
                        isCloseSSRReport: !1,
                        bid: "cc_web_editor",
                        region: "sg-capcut",
                        urlLimit: "10000",
                        htmlLimit: "-1",
                        isSaveValidUrl: !1,
                        isRuntimeLog: !1,
                        isDOMParser: !1,
                        escapeRule: "escape-report",
                        reportUrl: "https://mon-sg.capcutapi.com/monitor_browser/collect/batch/security/?bid=cc_web_editor",
                        scmBranch: "-",
                        scmName: "W$Zk$2$rd3llREprTWxacFRETmFjRnBI$m5aW%1qbDFZa2RzZFZwWFJub*FNM$o2",
                        scmVersion: "1.0.1.7201",
                        webpackPluginVersion: "3.4.10",
                        filename: "$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1teHNZM2s1-WxrelpHeFph$*w2WTIxTmRscFh$bkJr%npsN$RETmFjRnBI$m5aT%0wNT$XW*s1-W1Je%1-%mlNalIy$1RJNWRHTkhPWFZh$np$d1kzaz$hMk50%m01T$dFNTFX$mhDZW1*SE9%Qk1NbEo1$1ZkamRHRlhN$2hhTWxWMFpESnNNR0ZET$R*amJ-ZDFaRWhPTkZsW$NtNWtXRTA5"
                    }),
                    crossOrigin: s ? "use-credentials" : "anonymous"
                })
            })
        }
    },
    887984: function(e, t, i) {
        i.d(t, {
            N: function() {
                return o
            }
        });
        var a = i(772322)
          , r = i(987572)
          , n = i(85059);
        let o = e => {
            var t, i;
            let {imageInfo: o, segmentInfo: s, currentHoverTarget: d, preAttachView: l, postAttachView: c} = e
              , u = null !== (t = o.disabled) && void 0 !== t ? t : "timeline" === d;
            return (0,
            a.jsxs)(a.Fragment, {
                children: [(0,
                a.jsx)(r.A, {
                    name: s.name,
                    duration: s.duration,
                    background: s.background,
                    format: "?mm:ss:ff",
                    visible: u,
                    preAttachView: l,
                    postAttachView: c
                }), (0,
                a.jsx)(n.K, {
                    url: null !== (i = o.url) && void 0 !== i ? i : "",
                    withCredentials: o.withCredentials,
                    visible: !u
                })]
            })
        }
    },
    702402: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return o
            }
        });
        var a = i(195265)
          , r = i(218571);
        let n = (e, t, i, a) => {
            let r = t.getBoundingClientRect()
              , n = e.clientX + t.scrollLeft - r.left - a;
            return n < i.left && (n = i.left),
            n > i.right && (n = i.right),
            {
                x: n,
                y: 0
            }
        }
          , o = e => {
            let {bounds: t, onMouseDown: i, onDrag: o, onStop: s, onReset: d, setRef: l, children: c, operationWidth: u=0} = e
              , h = (0,
            r.useRef)()
              , [p,g] = (0,
            r.useState)(!1)
              , m = (0,
            r.useRef)(!1)
              , _ = (0,
            r.useCallback)(e => {
                i(e),
                g(!0),
                m.current = !1
            }
            , [i, g])
              , f = e => {
                var i;
                if (!p || m.current)
                    return;
                let a = null === (i = h.current) || void 0 === i ? void 0 : i.parentElement;
                a && o(e, n(e, a, t, u))
            }
              , v = (0,
            r.useCallback)(e => {
                var i;
                if (m.current = !0,
                !p)
                    return;
                let a = null === (i = h.current) || void 0 === i ? void 0 : i.parentElement;
                a && s(e, n(e, a, t, u)),
                g(!1)
            }
            , [s, p, g, t])
              , {run: y} = (0,
            a.default)( () => {
                if (!!p)
                    d(),
                    g(!1)
            }
            , 16);
            return (0,
            r.useEffect)( () => (document.body.addEventListener("mousemove", f),
            document.body.addEventListener("mouseup", v),
            document.body.addEventListener("mouseleave", y),
            () => {
                document.body.removeEventListener("mousemove", f),
                document.body.removeEventListener("mouseup", v),
                document.body.removeEventListener("mouseleave", y)
            }
            ), [f, v, y]),
            (0,
            r.useEffect)( () => {
                null == l || l(h.current)
            }
            , [h.current]),
            r.cloneElement(r.Children.only(c), {
                ref: h,
                onMouseDown: _
            })
        }
    },
    126752: function(e, t, i) {
        i.d(t, {
            x: function() {
                return f
            }
        });
        var a = i(218571)
          , r = i(178203)
          , n = i(735396)
          , o = i(752842)
          , s = i(727764)
          , d = i(510973)
          , l = i(120706)
          , c = i(659873)
          , u = i(870041)
          , h = i(953605)
          , p = i(535386)
          , g = i(179368)
          , m = i(121504);
        let _ = e => {
            let t = e.getModel();
            switch (t.fileType) {
            case d.YB.Image:
                return {
                    type: m.r.UserPhoto,
                    sourceFrom: "quick-upload",
                    dragSource: t
                };
            case d.YB.Video:
                return {
                    type: m.r.UserVideo,
                    sourceFrom: "quick-upload",
                    dragSource: t
                };
            default:
                throw Error()
            }
        }
        ;
        function f(e) {
            let {modules: t, mutableVideos: i, mountType: d, isTemplate: m, templateId: f=""} = e
              , {draftOperation: v, sider: y, mutableUpload: S, fileUpload: w, mutableReplaceTaskManager: b, autoReplace: M} = t
              , k = (0,
            g.G)(l.T)
              , T = (e, t) => {
                let {fileType: i, size: a=0, filename: o="", status: s} = e.getModel();
                if (![c.a.Success, c.a.TranscodeFailure, c.a.UploadFailure].includes(s))
                    return;
                let d = m ? r.oH.TEMPLATE : r.oH.EDITOR;
                (0,
                n.vK)(k, {
                    scenario: m ? r.cn.TEMPLATE : r.cn.EDIT,
                    featureKey: m ? "normal_template" : "material",
                    featureEntrance: d,
                    featureEntranceDetail: `${d}-material_upload`,
                    uploadType: i,
                    status: t,
                    fileSize: a,
                    fileExtension: o.indexOf(".") > -1 ? o.split(".").pop() : "",
                    templateId: f
                })
            }
              , I = (0,
            a.useCallback)(async (e, t) => {
                (0,
                o.b)(k, {
                    relatedEvent: o.Z.AddMaterialToTrack,
                    actionType: "click",
                    optionType: "replace"
                });
                let i = _(t)
                  , a = await M.expand(e, "mutable", {
                    type: i.type,
                    data: i.dragSource
                })
                  , r = await v.mutable.setMutableVideos({
                    dragData: i,
                    mutableVideoList: a
                });
                r && v.mutable.addMaterialToTrackReport({
                    model: t.getModel(),
                    status: r.result.ok ? "success" : "fail",
                    waitTime: r.performanceDuration,
                    mountType: d
                })
            }
            , []);
            return {
                uploadFileAndReplaceMutable: (0,
                a.useCallback)(async (e, t) => {
                    var a, r;
                    let o = (0,
                    p.f)(t)
                      , d = i.find(t => t.id === e);
                    if (0 === o.length || !d)
                        return;
                    y.siderActiveTabSet(s.j.SiderMenuMedia, "project");
                    let[l,...c] = o
                      , g = await S.uploadFile(e, l)
                      , m = await w.createUploadTask(c, {
                        autoUpload: !1
                    })
                      , _ = !1
                      , f = () => {
                        if (!_)
                            _ = !0,
                            m.forEach(e => {
                                e.upload()
                            }
                            )
                    }
                      , v = (0,
                    h.D)(g, {
                        onSuccess: () => {
                            f(),
                            T(g, n.vm.SUCCESS)
                        }
                        ,
                        onError: () => {
                            f(),
                            T(g, n.vm.FAIL)
                        }
                        ,
                        onCancel: f
                    })
                      , M = b.get(e);
                    null == M || null === (a = M.token) || void 0 === a || a.onCancel( () => {
                        v.dispose()
                    }
                    ),
                    await v.done(),
                    (null == M ? void 0 : null === (r = M.token) || void 0 === r ? void 0 : r.status) !== u.a.CANCELED && I(e, g)
                }
                , [i]),
                cancelUpload: e => {
                    S.cancelUploadTask(e)
                }
                ,
                retryUpload: e => {
                    S.retryUploadTask(e)
                }
            }
        }
    },
    461373: function(e, t, i) {
        i.d(t, {
            ZP: function() {
                return g
            },
            Zw: function() {
                return p
            }
        });
        var a, r = i(772322);
        i(296818),
        i(20699),
        i(200025);
        var n = i(324160)
          , o = i(908642)
          , s = i(935512)
          , d = i(626225)
          , l = i(218571)
          , c = i(105789)
          , u = i.n(c)
          , h = i(930369);
        i(840957);
        let p = {
            media_card: {
                width: 135,
                height: 76
            },
            square: {
                width: 135,
                height: 135
            },
            rect: {
                width: 135,
                height: 135
            },
            strip: {
                height: 72
            },
            text_card: {
                width: 120,
                height: 120
            },
            min_card: {
                width: 60,
                height: 60
            }
        }
          , g = (0,
        l.forwardRef)( (e, t) => {
            let {className: i="", children: c, type: g="square", label: m="", tl: _, tr: f, bl: v, br: y, actionMenus: S=[], onHoverDelay: w=300, onHover: b, onHoverEnd: M, onSelect: k, onClick: T, onContextMenu: I, onInView: P, isDepModel: F=!1, selected: D=!1, attrs: A={}, width: x=null !== (a = p[g].width) && void 0 !== a ? a : "100%", height: C=p[g].height, shouldHandleClickLoading: R=!1, spinProps: E} = e
              , [O,j] = (0,
            l.useState)(!1)
              , [V,U] = (0,
            l.useState)(0)
              , [W,L] = (0,
            l.useState)(!1)
              , [Z,B] = (0,
            n.default)();
            (0,
            l.useEffect)( () => {
                B && (null == P || P())
            }
            , [B]);
            let N = () => {
                if (!D)
                    j(!1),
                    null == k || k()
            }
              , H = async e => {
                N();
                try {
                    R && L(!0),
                    await (null == T ? void 0 : T(e))
                } finally {
                    R && L(!1)
                }
            }
            ;
            return (0,
            r.jsxs)("div", {
                className: u()("card-item-wrapper", i),
                style: {
                    width: x
                },
                ref: t,
                onMouseEnter: () => {
                    if (!!b) {
                        if (0 === w) {
                            b();
                            return
                        }
                        U(Number(setTimeout( () => b(), w)))
                    }
                }
                ,
                onMouseLeave: () => {
                    V && clearTimeout(V),
                    null == M || M()
                }
                ,
                ...A,
                children: [(0,
                r.jsx)(d.Z, {
                    trigger: "contextMenu",
                    popupVisible: O,
                    onVisibleChange: e => {
                        S.length && j(e)
                    }
                    ,
                    droplist: S.length ? (0,
                    r.jsx)(s.Z, {
                        className: "card-item-menu",
                        children: S.map( (e, t) => (0,
                        r.jsx)(s.Z.Item, {
                            className: e.className,
                            onClick: () => {
                                var t;
                                null === (t = e.fn) || void 0 === t || t.call(e),
                                j(!1)
                            }
                            ,
                            children: e.label
                        }, `${t}`))
                    }) : null,
                    children: (0,
                    r.jsxs)("div", {
                        onClick: H,
                        onContextMenu: e => {
                            null == I || I(e)
                        }
                        ,
                        style: {
                            width: x,
                            height: C
                        },
                        className: u()("card-item", {
                            "card-item--active": D,
                            [`card-item--${g}`]: !0
                        }),
                        ref: Z,
                        children: [(0,
                        r.jsxs)("div", {
                            className: "card-item__content",
                            children: [(0,
                            r.jsx)("div", {
                                className: "children",
                                children: R && W ? (0,
                                r.jsx)(o.Z, {
                                    loading: !0,
                                    ...E
                                }) : null != c ? c : "Default"
                            }), (0,
                            r.jsx)("div", {
                                className: "tl",
                                children: _
                            }), (0,
                            r.jsx)("div", {
                                className: "tr",
                                children: f
                            }), (0,
                            r.jsx)("div", {
                                className: "bl",
                                children: v
                            }), (0,
                            r.jsx)("div", {
                                className: "br",
                                children: y
                            })]
                        }), F && (0,
                        r.jsx)(h.dhu, {
                            style: {
                                position: "absolute",
                                right: 5,
                                top: 5
                            }
                        })]
                    })
                }), m && (0,
                r.jsx)("div", {
                    className: "card-item-label",
                    style: {
                        height: 16,
                        width: x
                    },
                    children: m
                })]
            })
        }
        )
    },
    530530: function(e, t, i) {
        i.d(t, {
            B7: function() {
                return v
            },
            CZ: function() {
                return u
            },
            Fb: function() {
                return g
            },
            H6: function() {
                return _
            },
            HW: function() {
                return m
            },
            Rr: function() {
                return c
            },
            Ru: function() {
                return f
            },
            cp: function() {
                return h
            },
            fQ: function() {
                return I
            },
            g4: function() {
                return P
            },
            m: function() {
                return p
            },
            rk: function() {
                return y
            },
            u$: function() {
                return w
            },
            zD: function() {
                return l
            },
            zx: function() {
                return S
            }
        });
        var a, r, n, o, s = i(343584), d = i(266225);
        let l = 30
          , c = 100000n
          , u = d.pMA.div(1000000n, l, "bigint")
          , h = 7
          , p = 6
          , g = 10
          , m = 3
          , _ = 5e3
          , f = 3e3
          , v = 3e3
          , y = 3e3
          , S = 3e3
          , w = 500
          , {searchParams: b} = new URL(window.location.href)
          , M = "480"
          , k = "_is_gpu_exist";
        try {
            let {isCompatible: e} = (0,
            s.z)();
            if (e) {
                let e = {
                    cpu: 8,
                    gpu: 1
                }
                  , t = navigator.hardwareConcurrency
                  , i = localStorage.getItem(k);
                null === i && (i = document.createElement("canvas").getContext("webgl")instanceof WebGLRenderingContext ? "1" : "0",
                localStorage.setItem(k, i)),
                e.cpu <= t && e.gpu === Number(i) && (M = "720")
            }
        } catch (e) {}
        window._canvas_resolution = M;
        let T = {
            480: [864, 864],
            720: [1296, 1296],
            1080: [1944, 1944]
        }
          , I = {
            width: null !== (n = null == T ? void 0 : null === (a = T[M]) || void 0 === a ? void 0 : a[0]) && void 0 !== n ? n : 864,
            height: null !== (o = null == T ? void 0 : null === (r = T[M]) || void 0 === r ? void 0 : r[1]) && void 0 !== o ? o : 864
        }
          , P = 1080
          , F = b.get("mock_log_level");
        F && Number.isFinite(parseInt(F, 10)) && parseInt(F, 10)
    },
    61719: function(e, t, i) {
        i.d(t, {
            yv: function() {
                return n
            }
        });
        var a = i(772322)
          , r = i(801497);
        let n = [{
            key: "select-all",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_select_all", {}, "Select all")
            }),
            bindings: {
                windows: "ctrl+a",
                osx: "meta+a"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "multi-select",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_Multi_selection", {}, "\u591A\u9009")
            }),
            bindings: {
                windows: "ctrl+click",
                osx: "meta+click"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "split",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("split_web", {}, "\u5206\u5272")
            }),
            bindings: {
                windows: "ctrl+b",
                osx: "meta+b"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "zoom-in",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("zoom_web_i_web_n", {}, "\u8F68\u9053\u653E\u5927")
            }),
            bindings: {
                windows: "ctrl+plus",
                osx: "meta+plus"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "zoom-out",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("zoom_web_ou_web_t", {}, "\u8F68\u9053\u7F29\u5C0F")
            }),
            bindings: {
                windows: "ctrl+-",
                osx: "meta+-"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "scroll-vertical",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("timeline_scrolls_up_and_down", {}, "\u65F6\u95F4\u7EBF\u4E0A\u4E0B\u6EDA\u52A8")
            }),
            bindings: {
                windows: "scroll",
                osx: "scroll"
            },
            ignore: !0,
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "scroll-horizontal",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("timeline_scrolls_left_and_right", {}, "\u65F6\u95F4\u7EBF\u5DE6\u53F3\u6EDA\u52A8")
            }),
            bindings: {
                windows: "shift+scroll",
                osx: "shift+scroll"
            },
            ignore: !0,
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "previous",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("last_web_frame", {}, "\u4E0A\u4E00\u5E27")
            }),
            bindings: {
                windows: "ctrl+left",
                osx: "meta+left"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "next",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("next_web_fram_web_e", {}, "\u4E0B\u4E00\u5E27")
            }),
            bindings: {
                windows: "ctrl+right",
                osx: "meta+right"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "copy",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("copy_web", {}, "\u590D\u5236")
            }),
            bindings: {
                windows: "ctrl+c",
                osx: "meta+c"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "cut",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("cut_web", {}, "\u526A\u5207")
            }),
            bindings: {
                windows: "ctrl+x",
                osx: "meta+x"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "paste",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("past_web_e", {}, "\u7C98\u8D34")
            }),
            bindings: {
                windows: "ctrl+v",
                osx: "meta+v"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "delete",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("delete_web", {}, "\u5220\u9664")
            }),
            bindings: {
                windows: ["backspace", "del", "delete"],
                osx: ["backspace", "del", "delete"]
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "backspace",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("delete_web", {}, "\u5220\u9664")
            }),
            bindings: {
                windows: "backspace",
                osx: "backspace"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "undo",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("Undo_web", {}, "\u64A4\u9500")
            }),
            bindings: {
                windows: "ctrl+z",
                osx: "meta+z"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "redo",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("red_web_o", {}, "\u6062\u590D")
            }),
            bindings: {
                windows: "ctrl+shift+z",
                osx: "shift+meta+z"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "redo-backup",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("red_web_o", {}, "\u6062\u590D")
            }),
            bindings: {
                windows: "ctrl+y",
                osx: "meta+y"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "up",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_up", {}, "Up")
            }),
            bindings: {
                windows: "up",
                osx: "up"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "left",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_left", {}, "Left")
            }),
            bindings: {
                windows: "left",
                osx: "left"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "right",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_right", {}, "Right")
            }),
            bindings: {
                windows: "right",
                osx: "right"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "down",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_down", {}, "Down")
            }),
            bindings: {
                windows: "down",
                osx: "down"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "up10",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_up_10", {}, "Up 10px")
            }),
            bindings: {
                windows: "shift+up",
                osx: "shift+up"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "left10",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_left_10", {}, "Left 10px")
            }),
            bindings: {
                windows: "shift+left",
                osx: "shift+left"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "right10",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_right_10", {}, "Right 10px")
            }),
            bindings: {
                windows: "shift+right",
                osx: "shift+right"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "down10",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_down_10", {}, "Down 10px")
            }),
            bindings: {
                windows: "shift+down",
                osx: "shift+down"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                visible: !1
            }
        }, {
            key: "previous-slot",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_last_slot", {}, "\u4E0A\u4E00\u69FD\u4F4D")
            }),
            bindings: {
                windows: "ctrl+shift+left",
                osx: "shift+meta+left"
            },
            scene: ["editor-template"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "next-slot",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_next_slot", {}, "\u4E0B\u4E00\u69FD\u4F4D")
            }),
            bindings: {
                windows: "ctrl+shift+right",
                osx: "shift+meta+right"
            },
            scene: ["editor-template"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "preview-line",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_curvespeed_text_tunnonoff_axis", {}, "Turn on/off preview axis")
            }),
            bindings: {
                windows: "s",
                osx: "s"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "play-pause",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("play_web_puse", {}, "\u64AD\u653E/\u6682\u505C")
            }),
            bindings: {
                windows: "space",
                osx: "space"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "newline",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("text_wrapping", {}, "\u6587\u672C\u6362\u884C")
            }),
            bindings: {
                windows: "ctrl+enter",
                osx: "meta+enter"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "split-sentence",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_split_sentence", {}, "Split sentence")
            }),
            bindings: {
                windows: "enter",
                osx: "enter"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "toggle-sidebar",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("expand_web_collapse_web_material", {}, "\u5C55\u5F00/\u6536\u8D77\u7D20\u6750\u9762\u677F")
            }),
            bindings: {
                windows: "ctrl+/",
                osx: "meta+/"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "toggle-timeline",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_visualPolish_button_clickPanel", {}, "Show/hide timeline")
            }),
            bindings: {
                windows: "ctrl+.",
                osx: "meta+."
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "import",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("import_web", {}, "\u5BFC\u5165\u5A92\u4F53")
            }),
            bindings: {
                windows: "ctrl+i",
                osx: "meta+i"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "export",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("export_web_vid_eo", {}, "\u5BFC\u51FA")
            }),
            bindings: {
                windows: "ctrl+e",
                osx: "meta+e"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "save",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("save_web", {}, "\u4FDD\u5B58")
            }),
            bindings: {
                windows: "ctrl+s",
                osx: "meta+s"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "exit",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("exi_web_t", {}, "\u9000\u51FA")
            }),
            bindings: {
                windows: "esc",
                osx: "esc"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "adsorb",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("attach_web", {}, "\u5438\u9644\u5F00\u5173")
            }),
            bindings: {
                windows: "n",
                osx: "n"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "detach-audio",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("separate/restore_audio", {}, "\u5206\u79BB/\u8FD8\u539F\u97F3\u9891")
            }),
            bindings: {
                windows: "ctrl+shift+s",
                osx: "shift+meta+s"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "fullscreen",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_fullscreen", {}, "Fullscreen")
            }),
            bindings: {
                windows: "ctrl+shift+f",
                osx: "shift+meta+f"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "move",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_move", {}, "Move")
            }),
            bindings: {
                windows: "V",
                osx: "V"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "hand-tool",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_hand_tool", {}, "Hand tool")
            }),
            bindings: {
                windows: "H",
                osx: "H"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "canvas-zoom-in",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_zoom_in", {}, "Zoom in")
            }),
            bindings: {
                windows: "shift+equal",
                osx: "shift+equal"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "canvas-zoom-out",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_zoom_out", {}, "Zoom out")
            }),
            bindings: {
                windows: "shift+minus",
                osx: "shift+minus"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "canvas-zoom-to-fit",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_zoom_to_fit", {}, "Zoom to fit")
            }),
            bindings: {
                windows: "shift+f",
                osx: "shift+f"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "canvas-zoom-to-50",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_zoom_to_fifty", {}, "Zoom to 50%")
            }),
            bindings: {
                windows: "shift+0",
                osx: "shift+0"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "canvas-zoom-to-100",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_zoom_to_one_hundred", {}, "Zoom to 100%")
            }),
            bindings: {
                windows: "shift+1",
                osx: "shift+1"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "canvas-zoom-to-200",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_check_hot_key_text_zoom_to_two_hundred", {}, "Zoom to 200%")
            }),
            bindings: {
                windows: "shift+2",
                osx: "shift+2"
            },
            scene: ["editor", "editor-template"],
            displayConfig: {
                category: "Canvas"
            }
        }, {
            key: "toggle-beat",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_musicbeat_button_move_add_beat", {}, "Add/Remove beats")
            }),
            bindings: {
                windows: "M",
                osx: "M"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Timeline"
            }
        }, {
            key: "duplicate",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_overlay_button_duplicate", {}, "Duplicate")
            }),
            bindings: {
                windows: "ctrl+d",
                osx: "meta+d"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "flip-horizontal",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_overlay_button_flip_horizon", {}, "Flip horizontally")
            }),
            bindings: {
                windows: "shift+h",
                osx: "shift+h"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }, {
            key: "flip-vertical",
            title: () => (0,
            a.jsx)(a.Fragment, {
                children: r.ZP.t("web_overlay_button_flip_vertical", {}, "Flip vertically")
            }),
            bindings: {
                windows: "shift+v",
                osx: "shift+v"
            },
            scene: ["editor"],
            displayConfig: {
                category: "Globe"
            }
        }]
    },
    293169: function(e, t, i) {
        i.d(t, {
            $$: function() {
                return m
            },
            EL: function() {
                return w
            },
            MY: function() {
                return s
            },
            My: function() {
                return u
            },
            R0: function() {
                return n
            },
            RI: function() {
                return S
            },
            YF: function() {
                return c
            },
            dS: function() {
                return l
            },
            du: function() {
                return y
            },
            dw: function() {
                return _
            },
            gX: function() {
                return o
            },
            ou: function() {
                return h
            },
            pn: function() {
                return f
            },
            se: function() {
                return v
            },
            uj: function() {
                return d
            },
            w8: function() {
                return g
            },
            yt: function() {
                return p
            }
        });
        var a = i(801497)
          , r = i(266225);
        let n = .008
          , o = .05
          , s = .22
          , d = 10
          , l = ""
          , c = .08
          , u = {
            get[`${r.v$U.Horizontal}_${r.s8r.Left}`]() {
                return a.oc.t("align_to_the_left", {}, "Align left")
            },
            get[`${r.v$U.Horizontal}_${r.s8r.Right}`]() {
                return a.oc.t("align_right", {}, "Align right")
            },
            get[`${r.v$U.Horizontal}_${r.s8r.Center}`]() {
                return a.oc.t("left_and_right_centered", {}, "Center horizontally")
            },
            get[`${r.v$U.Vertical}_${r.s8r.Up}`]() {
                return a.oc.t("align_up", {}, "Align up")
            },
            get[`${r.v$U.Vertical}_${r.s8r.Down}`]() {
                return a.oc.t("align_down", {}, "Align down")
            },
            get[`${r.v$U.Vertical}_${r.s8r.Center}`]() {
                return a.oc.t("up_and_down_center", {}, "Center vertically")
            }
        }
          , h = "#FFFFFF"
          , p = .9
          , g = .8
          , m = .15
          , _ = 1
          , f = 5
          , v = 8
          , y = -45
          , S = 1e3
          , w = {
            get MIXED_VALUES() {
                return "--"
            }
        }
    },
    480337: function(e, t, i) {
        i.d(t, {
            R: function() {
                return s
            }
        });
        var a = i(218571)
          , r = i(179368)
          , n = i(133907)
          , o = i(112549);
        function s(e) {
            let {updateOnPlaying: t=!0} = null != e ? e : {}
              , i = (0,
            r.G)(n.a)
              , [s,d] = (0,
            a.useState)(i.playerManager.status.progress)
              , {playing: l} = (0,
            o.g)()
              , c = (0,
            a.useRef)(l);
            return c.current = l,
            (0,
            a.useEffect)( () => {
                let e = i.playerManager.onProgress(e => {
                    if (!!t || !c.current)
                        d(e)
                }
                );
                return () => {
                    e.dispose()
                }
            }
            , [t]),
            (0,
            a.useEffect)( () => {
                !l && !t && d(i.playerManager.status.progress)
            }
            , [t, l]),
            {
                progress: s,
                playing: l
            }
        }
    },
    14362: function(e, t, i) {
        i.d(t, {
            z: function() {
                return n
            }
        });
        var a = i(914028);
        let r = e => {
            let {userAgent: t, platform: i, maxTouchPoints: a} = e;
            return void 0 !== t && "MacIntel" === i && "number" == typeof a && a > 1
        }
          , n = () => {
            var e;
            let t = (null === (e = navigator) || void 0 === e ? void 0 : e.userAgent) || ""
              , i = (0,
            a.Z)(t)
              , {mobile: n} = i
              , {os: o=""} = i
              , s = t.toLowerCase()
              , d = /crios/.test(s)
              , l = "other";
            return /android/.test(s) && (l = "android",
            n = !0),
            (/ios/.test(o) || /ipad|iphone|ipod|mac os x/i.test(s)) && (l = "apple"),
            {
                isMobile: !!n || r(navigator) || d,
                mobileType: l
            }
        }
    },
    399073: function(e, t, i) {
        i.d(t, {
            O: function() {
                return r
            }
        });
        var a = i(749904);
        let r = e => {
            let {acceptType: t} = e;
            return (null == t ? void 0 : t.length) ? (null == t ? void 0 : t.map(e => a.NF[e].accept)).join(",") : a.NF.allAccept
        }
    },
    154554: function(e, t, i) {
        i.d(t, {
            A: function() {
                return s
            },
            M: function() {
                return d
            }
        });
        var a = i(635364)
          , r = i(251801)
          , n = i(865034)
          , o = i(225252);
        function s(e) {
            let {box: t, videoHeight: i, videoWidth: o, rotate: s, scale: d} = e
              , l = d - 1
              , c = l * o / 2
              , u = l * i / 2
              , h = [o / 2, i / 2]
              , p = (0,
            r.a)([-c, i + u], s, h)
              , g = (0,
            r.a)([o - c, i + u], s, h)
              , m = (0,
            r.a)([-c, -u], s, h)
              , _ = {
                begin: p,
                end: g
            }
              , f = {
                begin: p,
                end: m
            }
              , v = [t.left, i - t.top]
              , y = [t.left + t.width, i - t.top]
              , S = [t.left, i - t.height - t.top]
              , w = [t.left + t.width, i - t.height - t.top]
              , b = o * d
              , M = i * d
              , k = (0,
            a.FH)((0,
            n.Ii)(f, v) / b)
              , T = (0,
            a.FH)((0,
            n.Ii)(_, v) / M)
              , I = (0,
            a.FH)((0,
            n.Ii)(f, y) / b)
              , P = (0,
            a.FH)((0,
            n.Ii)(_, y) / M)
              , F = (0,
            a.FH)((0,
            n.Ii)(f, S) / b)
              , D = (0,
            a.FH)((0,
            n.Ii)(_, S) / M)
              , A = (0,
            a.FH)((0,
            n.Ii)(f, w) / b);
            return {
                upperLeftX: k,
                upperLeftY: T,
                upperRightX: I,
                upperRightY: P,
                lowerLeftX: F,
                lowerLeftY: D,
                lowerRightX: A,
                lowerRightY: (0,
                a.FH)((0,
                n.Ii)(_, w) / M)
            }
        }
        function d(e) {
            let {upperLeftX: t, upperLeftY: i, upperRightX: s, upperRightY: d, lowerLeftX: l, lowerLeftY: c, shellHeight: u, shellWidth: h} = e
              , p = (0,
            n.qp)({
                begin: [0, 0],
                end: [h, 0]
            }, {
                begin: [t * h, -i * u],
                end: [s * h, -d * u]
            })
              , g = Math.round(p > 180 ? -(360 - p) : p)
              , m = (0,
            o.g)({
                width: h,
                height: u,
                left: 0,
                top: 0
            }, g)
              , _ = u * (m - 1) / 2
              , f = h * (m - 1) / 2
              , v = [-f + t * h * m, _ - i * u * m]
              , y = [-f + s * h * m, _ - d * u * m]
              , S = [-f + l * h * m, _ - c * u * m]
              , w = [h / 2, -u / 2]
              , b = (0,
            r.a)([0, 0], -g, w)
              , M = (0,
            r.a)([h, 0], -g, w)
              , k = (0,
            r.a)([0, -u], -g, w)
              , T = (0,
            n.Ii)({
                begin: b,
                end: M
            }, v)
              , I = (0,
            n.Ii)({
                begin: b,
                end: k
            }, v)
              , P = (0,
            a.Et)(v, y)
              , F = (0,
            a.Et)(v, S);
            return {
                scale: m,
                rotate: g,
                box: {
                    left: I,
                    top: T,
                    width: P,
                    height: F
                }
            }
        }
    },
    865034: function(e, t, i) {
        i.d(t, {
            A2: function() {
                return d
            },
            Ii: function() {
                return n
            },
            Io: function() {
                return s
            },
            qH: function() {
                return r
            },
            qp: function() {
                return l
            },
            uu: function() {
                return c
            }
        });
        var a = i(635364);
        function r(e, t) {
            let i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [0, 0]
              , r = -t
              , n = Math.cos(r * Math.PI / 180)
              , o = Math.sin(r * Math.PI / 180)
              , s = i[0] + (e[0] - i[0]) * n - (e[1] - i[1]) * o
              , d = i[1] + (e[0] - i[0]) * o + (e[1] - i[1]) * n;
            return [(0,
            a.FH)(s), (0,
            a.FH)(d)]
        }
        function n(e, t) {
            let {begin: i, end: r} = e;
            if (r[1] === i[1])
                return Math.abs(t[1] - i[1]);
            if (r[0] === i[0])
                return Math.abs(t[0] - i[0]);
            let n = -(r[0] - i[0]) / (r[1] - i[1])
              , o = i[1] * (r[0] - i[0]) / (r[1] - i[1]) - i[0]
              , s = (1 * t[0] + n * t[1] + o) / Math.sqrt(1 + n ** 2);
            return (0,
            a.FH)(Math.abs(s))
        }
        function o(e, t, i) {
            return (t[0] - e[0]) * (i[1] - e[1]) - (i[0] - e[0]) * (t[1] - e[1])
        }
        function s(e, t, i) {
            return o(e.begin, e.end, i) * o(t.begin, t.end, i) >= 0
        }
        function d(e, t) {
            let[i,a,r,n] = e;
            return o(i, a, t) * o(r, n, t) >= 0 && o(a, r, t) * o(n, i, t) >= 0
        }
        function l(e, t) {
            let i = e.end[0] - e.begin[0]
              , r = e.end[1] - e.begin[1]
              , n = t.end[0] - t.begin[0]
              , o = t.end[1] - t.begin[1]
              , s = Math.atan2(i * o - r * n, i * n + r * o) / Math.PI * 180;
            return (0,
            a.FH)((s + 360) % 360, 2)
        }
        let c = (e, t) => {
            let {x: i, y: a, width: r, height: n} = e
              , {x: o, y: s, width: d, height: l} = t
              , c = Math.max(i, o)
              , u = Math.max(a, s)
              , h = Math.max(Math.min(i + r, o + d) - c, 0)
              , p = Math.max(Math.min(a + n, s + l) - u, 0);
            return {
                x: c,
                y: u,
                width: h,
                height: p
            }
        }
    },
    788014: function(e, t, i) {
        i.d(t, {
            Ci: function() {
                return v
            },
            G8: function() {
                return _
            },
            J9: function() {
                return h
            },
            K9: function() {
                return m
            },
            VX: function() {
                return p
            },
            Vh: function() {
                return u
            },
            Y8: function() {
                return y
            },
            dR: function() {
                return c
            },
            f5: function() {
                return l
            },
            rH: function() {
                return g
            },
            u8: function() {
                return s
            }
        });
        var a = i(459232)
          , r = i(593062)
          , n = i(257230);
        let o = ["draftId", "__action_from", "__from_page", "__tool_type", "entryId", "permission", "folderId", "scenario", "create_id"]
          , s = ["workspaceId", "spaceId", "is_preview_template"];
        function d(e, t) {
            let i;
            let {excludeQuery: a=[]} = null != t ? t : {}
              , r = new URL(i = /^\/[^/]/.test(e) ? `${window.location.origin}${e}` : e.startsWith("//") ? `${window.location.protocol}${e}` : e);
            return new URL(window.location.href).searchParams.forEach( (e, t) => {
                if (!(o.includes(t) || a.includes(t)) && null === r.searchParams.get(t))
                    r.searchParams.set(t, e)
            }
            ),
            r.toString()
        }
        function l(e, t) {
            window.location.replace((0,
            a.C)(d(e, t), null, {
                logType: "js.window.location",
                reportOnly: "false",
                blackConfig: "{}",
                configMode: "merge",
                isCloseSSRReport: !1,
                bid: "cc_web_editor",
                region: "sg-capcut",
                urlLimit: "10000",
                htmlLimit: "-1",
                isSaveValidUrl: !1,
                isRuntimeLog: !1,
                isDOMParser: !1,
                escapeRule: "escape-report",
                reportUrl: "https://mon-sg.capcutapi.com/monitor_browser/collect/batch/security/?bid=cc_web_editor",
                scmBranch: "-",
                scmName: "W$Zk$2$rd3llREprTWxacFRETmFjRnBI$m5aW%1qbDFZa2RzZFZwWFJub*FNM$o2",
                scmVersion: "1.0.1.7201",
                webpackPluginVersion: "3.4.10",
                filename: "$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1teHNZM2s1-WxrelpHeFph$*w2WTIxTmRscFh$bkJr%npsN$RETmFjRnBI$m5aT%0wNT$XW*s1-W1Je%1-%mlNalIyWkZo%2NHSkl%WFpp%npsc$dWaFNjR0l5TkhWa1NFNW9ZMjFrT$dOM1B%MD0"
            }))
        }
        function c(e) {
            let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
              , {protocol: a, host: r, search: n, pathname: o} = i.g.location
              , s = new URLSearchParams(n);
            s.get("create_id") || t ? s.set("create_id", e) : s.get("utm_content") ? s.set("utm_content", e) : s.set("templateId", e);
            let d = `${a}//${r}${o}?${s.toString()}`;
            i.g.history.replaceState({}, "", d)
        }
        function u(e, t) {
            window.location.href = (0,
            a.C)(d(e, {
                excludeQuery: t
            }), null, {
                logType: "js.href/src",
                reportOnly: "false",
                blackConfig: "{}",
                configMode: "merge",
                isCloseSSRReport: !1,
                bid: "cc_web_editor",
                region: "sg-capcut",
                urlLimit: "10000",
                htmlLimit: "-1",
                isSaveValidUrl: !1,
                isRuntimeLog: !1,
                isDOMParser: !1,
                escapeRule: "escape-report",
                reportUrl: "https://mon-sg.capcutapi.com/monitor_browser/collect/batch/security/?bid=cc_web_editor",
                scmBranch: "-",
                scmName: "W$Zk$2$rd3llREprTWxacFRETmFjRnBI$m5aW%1qbDFZa2RzZFZwWFJub*FNM$o2",
                scmVersion: "1.0.1.7201",
                webpackPluginVersion: "3.4.10",
                filename: "$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1teHNZM2s1-WxrelpHeFph$*w2WTIxTmRscFh$bkJr%npsN$RETmFjRnBI$m5aT%0wNT$XW*s1-W1Je%1-%mlNalIyWkZo%2NHSkl%WFpp%npsc$dWaFNjR0l5TkhWa1NFNW9ZMjFrT$dOM1B%MD0"
            })
        }
        function h(e) {
            window.history.replaceState({}, document.title, d(e))
        }
        function p(e, t, i) {
            let a = (0,
            r.MY)(e);
            h(`${a({
                draftId: t
            })}${i ? `?entryId=${i}` : ""}`)
        }
        function g(e) {
            let t = new URL(window.location.href);
            Object.entries(e).forEach(e => {
                let[i,a] = e;
                t.searchParams.set(i, a)
            }
            ),
            window.history.replaceState({}, document.title, t)
        }
        function m(e) {
            let t = new URL(window.location.href);
            "string" == typeof e ? t.searchParams.delete(e) : e.forEach(e => t.searchParams.delete(e)),
            window.history.replaceState({}, document.title, t)
        }
        function _(e, t) {
            let i = Object.entries(t).map(e => {
                let[t,i] = e;
                return null == i ? "" : `${t}=${encodeURIComponent(i)}`
            }
            ).filter(Boolean)
              , a = e.includes("?") ? "&" : "?";
            return e + a + i.join("&")
        }
        let f = (0,
        r.EQ)(n.b);
        function v() {
            var e, t, i;
            let a = f(window.location.pathname)
              , {searchParams: r} = new URL(window.location.href)
              , o = r.get("draftId");
            return o && p(n.b, o),
            null !== (i = null !== (t = null == a ? void 0 : null === (e = a.params) || void 0 === e ? void 0 : e.draftId) && void 0 !== t ? t : o) && void 0 !== i ? i : null
        }
        function y() {
            let {searchParams: e} = new URL(window.location.href)
              , t = e.get("create_id") || e.get("utm_content") || void 0;
            return t && !/^\d+$/.test(t) && (t = void 0,
            e.has("create_id") && e.delete("create_id"),
            e.has("utm_content") && e.delete("utm_content"),
            h(`${window.location.protocol}//${window.location.host}${window.location.pathname}?${e.toString()}`)),
            t
        }
    },
    708011: function(e, t, i) {
        i.d(t, {
            A8: function() {
                return u
            },
            Bl: function() {
                return d
            },
            DU: function() {
                return l
            },
            JA: function() {
                return c
            },
            Sn: function() {
                return h
            },
            ad: function() {
                return n
            },
            hr: function() {
                return o
            },
            ov: function() {
                return r
            },
            po: function() {
                return s
            }
        });
        var a = i(266225);
        function r(e) {
            return (null == e ? void 0 : e.__segment_struct_type) === a.Ocy.SegmentVideo
        }
        function n(e) {
            return (null == e ? void 0 : e.__segment_struct_type) === a.Ocy.SegmentAudio
        }
        function o(e) {
            return (null == e ? void 0 : e.__segment_struct_type) === a.Ocy.SegmentText
        }
        function s(e) {
            return (null == e ? void 0 : e.__segment_struct_type) === a.Ocy.SegmentTextTemplate
        }
        function d(e) {
            var t;
            return s(e) && !!(null === (t = e.material) || void 0 === t ? void 0 : t.version)
        }
        function l(e) {
            var t;
            return (0,
            a.Q2R)(e) && !(null === (t = e.material) || void 0 === t ? void 0 : t.version)
        }
        function c(e) {
            return (null == e ? void 0 : e.__segment_struct_type) === a.Ocy.SegmentSticker
        }
        function u(e) {
            return !!(null == e ? void 0 : e.__segment_struct_type)
        }
        function h(e) {
            return r(e) || n(e)
        }
    },
    856173: function(e, t, i) {
        i.d(t, {
            FH: function() {
                return o
            },
            Ff: function() {
                return n
            },
            v5: function() {
                return r
            }
        });
        var a = i(266225);
        function r(e, t) {
            let i = 10 ** t;
            return Math.round(e * i) / i
        }
        function n(e) {
            return null != e && "type"in e && (null == e ? void 0 : e.type) === a.cVg.MetaTypeTransition
        }
        function o(e) {
            let t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 6;
            return Number.parseFloat(e.toFixed(t))
        }
    },
    167788: function(e, t, i) {
        i.d(t, {
            J: function() {
                return r
            },
            X: function() {
                return n
            }
        });
        var a = i(716984);
        function r() {
            let {referrer: e} = document;
            if (!e)
                return "first_page";
            try {
                let t = new URL(e)
                  , {location: i} = document;
                if (t.hostname === i.hostname && t.pathname === i.pathname)
                    return "first_page"
            } catch (e) {
                console.log("failed to parse url", e)
            }
            return "other"
        }
        function n() {
            let {searchParams: e} = new URL(window.location.href);
            if ((0,
            a.l0)())
                return a.dL;
            {
                var t, i;
                let a = r();
                return null !== (i = null !== (t = e.get("__from_page")) && void 0 !== t ? t : e.get("from_page")) && void 0 !== i ? i : a
            }
        }
    },
    636708: function(e, t, i) {
        i.d(t, {
            S: function() {
                return d
            },
            j: function() {
                return s
            }
        });
        var a = i(941342)
          , r = i(662415)
          , n = i(230267)
          , o = i(349290);
        function s(e) {
            let t = e.getCoverResourceToken();
            return t.startImmediately(),
            new Promise( (e, i) => {
                (0,
                n.x)(t).then(t => {
                    if (!t.ok)
                        throw Error(t.msg);
                    let {value: i} = t;
                    i.buffer && e({
                        coverUrl: (0,
                        a.Aw)(i.buffer)
                    })
                }
                ).catch(e => {
                    i(e)
                }
                )
            }
            )
        }
        function d(e) {
            let t = e.getCoverResourceToken();
            return t.startImmediately(),
            new Promise( (e, i) => {
                (0,
                n.x)(t).then(t => {
                    if (!t.ok)
                        throw Error(t.msg);
                    let {value: i} = t;
                    if (i.buffer) {
                        let t = (0,
                        a.Aw)(i.buffer);
                        (0,
                        o.c)(t, {
                            attrs: {
                                crossOrigin: "anonymous"
                            }
                        }, {
                            compress: {
                                height: r.c
                            }
                        }).then(i => {
                            e({
                                image: i,
                                width: i.width,
                                height: i.height,
                                coverUrl: t,
                                timestamp: 0n,
                                sourceTimestamp: 0n
                            })
                        }
                        )
                    }
                }
                )
            }
            )
        }
    },
    848239: function(e, t, i) {
        i.d(t, {
            AB: function() {
                return c
            },
            dl: function() {
                return p
            },
            wX: function() {
                return u
            }
        });
        var a = i(230267)
          , r = i(308358)
          , n = i(425241)
          , o = i(518038)
          , s = i(36751);
        let d = async (e, t, i) => {
            let a = []
              , d = []
              , l = new Map;
            for (let c of e) {
                let {buffer: e, mimeType: u, frameCount: h, imageWidth: p, imageHeight: g, singleFrameHeight: m, singleFrameWidth: _} = c
                  , f = await t.converter.bufferToImage(e, u);
                (!f.ok || !f.value) && (0,
                n.ss)("[TimelineResource] split sprites error"),
                f.value.width === p && f.value.height !== g && (f.value.height = g);
                let v = t.sprite.split({
                    graphic: f.value,
                    xCount: p / _,
                    yCount: g / m,
                    totalCount: h,
                    compress: {
                        height: null != i ? i : o.ts
                    }
                }, r.O.Canvas);
                for (let e of v)
                    d.push((0,
                    s.r)(e.graphic).then(t => (l.set(e, t),
                    t)));
                a.push(...v)
            }
            try {
                await Promise.all(d)
            } catch (e) {}
            return a.map(e => {
                var t;
                return {
                    image: null !== (t = l.get(e)) && void 0 !== t ? t : e.graphic,
                    x: e.x,
                    y: e.y,
                    width: e.width,
                    height: e.height,
                    timestamp: 0n,
                    sourceTimestamp: 0n
                }
            }
            )
        }
        ;
        async function l(e) {
            let t = await e.getThumbResourceTokens();
            try {
                await Promise.all(t.map(e => (0,
                a.x)(e)))
            } catch (e) {
                throw e
            }
            let i = [];
            for (let e of t) {
                (0,
                n.ZB)(e.value);
                let {buffer: t, contentType: a, frameCount: r, imageHeight: o, imageWidth: s, singleFrameHeight: d, singleFrameWidth: l} = e.value;
                i.push({
                    buffer: t,
                    mimeType: a,
                    frameCount: r,
                    imageHeight: o,
                    imageWidth: s,
                    singleFrameHeight: d,
                    singleFrameWidth: l
                })
            }
            return i
        }
        async function c(e, t, i) {
            return d(await l(e), t, i)
        }
        function u(e, t) {
            return {
                getResourceSpritesTask: () => l(e),
                splitSpritesTask: e => d(e, t)
            }
        }
        let h = function(e) {
            let t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1
              , {buffer: i, mimeType: a, frameCount: r, imageWidth: n, imageHeight: o, singleFrameHeight: s, singleFrameWidth: d} = e
              , l = URL.createObjectURL(new Blob([i],{
                type: a
            }))
              , c = (function(e, t) {
                let i = [];
                for (let a = 0; a < t; a++)
                    for (let t = 0; t < e; t++)
                        i.push({
                            x: t,
                            y: a
                        });
                return i
            }
            )(n / d, o / s).slice(0, r)
              , u = s * t
              , h = d * t;
            return c.map(e => ({
                url: l,
                x: e.x * h,
                y: e.y * u,
                width: h,
                height: u
            }))
        };
        async function p(e) {
            return (await l(e)).map(e => {
                let t = function(e) {
                    let {originHeight: t, targetHeight: i, originWidth: a, targetWidth: r} = e
                      , n = 1;
                    return t && i ? n = t / i : a && r && (n = a / r),
                    Math.max(1, n)
                }({
                    originHeight: e.singleFrameHeight,
                    targetHeight: o.ts
                });
                return h(e, t)
            }
            ).flat()
        }
    },
    304027: function(e, t, i) {
        i.d(t, {
            S: function() {
                return a
            }
        });
        function a(e) {
            let t = e;
            for (; t !== document.body && !t.dataset.attrTextInput && !t.dataset.exitRichTextEdit; ) {
                ;if (t.dataset.inRichTextEditing || t.matches(".workbench-tool-bars") || t.matches(".tool-bar-panel-container") || t.matches(".video-editor-color-picker-panel") || t.matches(".lv-trigger"))
                    return !0;
                if (!t.parentElement)
                    break;
                t = t.parentElement
            }
            return !1
        }
    },
    402930: function(e, t, i) {
        i.d(t, {
            HA: function() {
                return _
            },
            xe: function() {
                return u
            }
        });
        var a = i(50113)
          , r = i(865034)
          , n = i(825088)
          , o = i(708011)
          , s = i(266225)
          , d = i(472202);
        let l = (e, t, i, a, r) => {
            let n = 0
              , o = 0
              , {resourceType: s, config: l} = e || {}
              , {rotation: c} = l || {}
              , u = t * r[0]
              , h = i * r[1]
              , p = (null != c ? c : 0) % 360;
            switch (s) {
            case d.X.LINE:
                let g = t * a[0]
                  , m = -i * a[1];
                n = 0,
                o = 0,
                p > 45 && p <= 135 ? (u = t - (n = g),
                h = i) : p > 135 && p <= 225 ? (o = m,
                u = t,
                h = i - o) : p > 225 && p <= 315 ? (u = g,
                h = i) : (u = t,
                h = m);
                break;
            case d.X.RECTANGLE:
            default:
                n = u * a[0] / 2,
                o = -(h * a[1]) / 2
            }
            return {
                maskX: n,
                maskY: o,
                maskWidth: u,
                maskHeight: h
            }
        }
          , c = (e, t) => {
            let[i,a] = t;
            return e.filter(e => {
                var t;
                let {start: r=0n, duration: n=0n} = null !== (t = e.targetTimerange) && void 0 !== t ? t : {}
                  , o = r + n;
                return r >= i && r <= a || o >= i && o <= a || r <= i && o >= a
            }
            )
        }
          , u = (e, t) => {
            let i = e[0]
              , a = e[1]
              , r = i
              , n = a;
            t.sort( (e, t) => Number(e[0] - t[0]));
            for (let e = 0; e < t.length; e++) {
                let[i,a] = t[e];
                if (i !== a) {
                    if (r >= n || i <= r && a >= n)
                        return [0n, 0n];
                    i > r && (n = i),
                    i <= r && a < n && (r = a)
                }
            }
            return [r - i, n - i]
        }
          , h = (e, t) => {
            var i, a;
            if (!t.length)
                return 0n;
            let r = t.map(e => {
                let {start: t, duration: i} = e.targetTimerange;
                return [t, t + i]
            }
            );
            r.sort( (e, t) => Number(e[0] - t[0]));
            let n = null !== (i = e.targetTimerange.start) && void 0 !== i ? i : 0n
              , o = n + (null !== (a = e.targetTimerange.duration) && void 0 !== a ? a : 0n)
              , [s] = u([n, o], r);
            return s
        }
          , p = (e, t) => {
            var i, r, n, o, d, l, c, p, g, m, _, f;
            if (!(null === (r = e.animations) || void 0 === r ? void 0 : null === (i = r.animations) || void 0 === i ? void 0 : i.length) && !e.commonKeyframes.length)
                return h(e, t);
            let v = null === (n = e.animations) || void 0 === n ? void 0 : n.animations.filter(e => [s.VAL.Anim_In, s.VAL.Anim_Caption].includes(e.type) && 0n !== e.duration)
              , y = null === (o = e.animations) || void 0 === o ? void 0 : o.animations.find(e => e.type === s.VAL.Anim_Out && 0n !== e.duration)
              , S = null === (d = e.animations) || void 0 === d ? void 0 : d.animations.find(e => [s.VAL.Anim_Loop, s.VAL.Anim_Group].includes(e.type) && 0n !== e.duration)
              , w = null !== (l = e.targetTimerange.start) && void 0 !== l ? l : 0n
              , b = null !== (c = e.targetTimerange.duration) && void 0 !== c ? c : 0n
              , M = s.pMA.plus(0n, s.pMA.max(null !== (p = null == v ? void 0 : v.map(e => {
                var t;
                return null !== (t = e.duration) && void 0 !== t ? t : 0
            }
            )) && void 0 !== p ? p : [0n], "bigint"), "bigint")
              , k = b - (null !== (g = null == y ? void 0 : y.duration) && void 0 !== g ? g : 0n)
              , T = M
              , I = M;
            switch (null == S ? void 0 : S.type) {
            case s.VAL.Anim_Loop:
                I = k;
                break;
            case s.VAL.Anim_Group:
                I = (T = null !== (m = null == S ? void 0 : S.start) && void 0 !== m ? m : M) + (null !== (_ = null == S ? void 0 : S.duration) && void 0 !== _ ? _ : 0n)
            }
            let[P] = u([0n, b], [[0n, M], [T, I], [k, b]]);
            return P ? P : (null == v ? void 0 : v.length) ? (0,
            a.i1)(M + w, "floor") - w : S && 0n === T ? s.pMA.div(null !== (f = S.duration) && void 0 !== f ? f : 0n, 2, "bigint") + M : P
        }
          , g = (e, t) => {
            if (!(0,
            s.OvQ)(t))
                return 0;
            let i = e.findIndex(e => e.id === t.id);
            if (!i)
                return 0;
            let a = e[i - 1];
            if (!a.transition)
                return 0n;
            let {transition: {duration: r, isOverlap: n}} = a;
            return n ? r / 2n : r
        }
          , m = async (e, t, i, a, n, d, c, u) => {
            var h, p, g;
            let {segmentId: m, commonKeyframes: _, targetStart: f} = e
              , v = s.pMA.minus(null !== (p = null == n ? void 0 : n.targetTimerange.start) && void 0 !== p ? p : 0n, null !== (g = null == n ? void 0 : null === (h = n.sourceTimerange) || void 0 === h ? void 0 : h.start) && void 0 !== g ? g : 0n, "bigint");
            if (!_.length)
                return s.pMA.min([t, i], "bigint");
            let y = new Set(["KFTypePositionX", "KFTypePositionY", "KFTypeScale", "KFTypeScaleX", "KFTypeScaleY", "KFTypeAlpha", "KFTypeMaskPostion", "KFTypeMaskPostionX", "KFTypeMaskPostionY", "KFTypeMaskSize", "KFTypeMaskSizeX", "KFTypeMaskSizeY", "KFTypeGlobalAlpha"])
              , S = new Map;
            _.forEach(e => {
                let {propertyType: t, keyframeList: i} = e;
                i.forEach(e => {
                    let {timeOffset: i, ...a} = e;
                    S.has(i) ? S.get(i)[t] = a : S.set(i, {
                        [t]: a
                    })
                }
                )
            }
            );
            let w = [...new Set(_.flatMap(e => {
                let {propertyType: a, keyframeList: r} = e;
                return r.length > 1 && y.has(a) ? r.filter(e => {
                    let {timeOffset: a} = e;
                    return a > t && a <= i
                }
                ).map(e => {
                    let {timeOffset: t} = e;
                    return t
                }
                ) : []
            }
            ))].sort( (e, t) => s.pMA.minus(e, t))
              , [b,M] = a
              , k = b * M
              , T = 0
              , I = 1 / 0
              , P = s.pMA.min([t, i], "bigint")
              , F = (e, t, i) => {
                var a, n, o, s, d, c, u, h, p, g, m, _, f, v, y;
                let w = (null === (a = S.get(t)) || void 0 === a ? void 0 : a.KFTypeAlpha) || (null === (n = S.get(t)) || void 0 === n ? void 0 : n.KFTypeGlobalAlpha)
                  , k = null === (o = S.get(t)) || void 0 === o ? void 0 : o.KFTypeMaskPostion
                  , T = null === (s = S.get(t)) || void 0 === s ? void 0 : s.KFTypeMaskPostionX
                  , I = null === (d = S.get(t)) || void 0 === d ? void 0 : d.KFTypeMaskPostionY
                  , P = null === (c = S.get(t)) || void 0 === c ? void 0 : c.KFTypeMaskSize
                  , F = null === (u = S.get(t)) || void 0 === u ? void 0 : u.KFTypeMaskSizeX
                  , D = null === (h = S.get(t)) || void 0 === h ? void 0 : h.KFTypeMaskSizeY
                  , A = null === (p = S.get(t)) || void 0 === p ? void 0 : p.KFTypeScale
                  , x = null === (g = S.get(t)) || void 0 === g ? void 0 : g.KFTypeScaleX
                  , C = null === (m = S.get(t)) || void 0 === m ? void 0 : m.KFTypeScaleY
                  , R = null !== (_ = null == A ? void 0 : A.values) && void 0 !== _ ? _ : [1, 1];
                (null == x ? void 0 : x.values) && (R[0] = null == x ? void 0 : x.values[0]),
                (null == C ? void 0 : C.values) && (R[1] = null == C ? void 0 : C.values[0]);
                let E = null !== (f = null == w ? void 0 : w.values[0]) && void 0 !== f ? f : 1
                  , O = null !== (v = null == k ? void 0 : k.values) && void 0 !== v ? v : [0, 0];
                (null == T ? void 0 : T.values) && (O[0] = null == T ? void 0 : T.values[0]),
                (null == I ? void 0 : I.values) && (O[1] = null == I ? void 0 : I.values[0]);
                let j = null !== (y = null == P ? void 0 : P.values) && void 0 !== y ? y : [1, 1];
                (null == F ? void 0 : F.values) && (j[0] = null == F ? void 0 : F.values[0]),
                (null == D ? void 0 : D.values) && (j[1] = null == D ? void 0 : D.values[0]);
                let {maskX: V, maskY: U, maskWidth: W, maskHeight: L} = l(i.mask, b, M, O, j)
                  , {width: Z, height: B} = (0,
                r.uu)((0,
                r.uu)(e, {
                    x: 0,
                    y: 0,
                    width: b,
                    height: M
                }), {
                    x: V,
                    y: U,
                    width: W,
                    height: L
                });
                return Z * B * E * (i.isText ? R[0] * R[1] : 1)
            }
              , D = s.pMA.plus(f, v, "bigint");
            for (let t of w) {
                let i = await d.getSegmentRectangles({
                    dataSdk: c,
                    getSegmentById: e => c.draftView.getSegmentById(e, void 0, !1),
                    canvasSize: a,
                    segIds: [m],
                    selectedSegmentsIds: u.getSelectedSegmentsIds(),
                    current: s.pMA.plus(D, t, "bigint"),
                    parentSegIds: n ? [n.id] : void 0
                })
                  , r = c.draftView.getSegmentById(m, void 0, !1)
                  , l = {}
                  , h = !1;
                if (r && (0,
                o.ov)(r)) {
                    let e = (0,
                    s.P2G)(r);
                    e && (l.mask = e,
                    h = e.config.invert)
                }
                l.isText = (0,
                s.Ub2)(e);
                let p = F(i[0], t, l);
                if (p / k > .99)
                    return t;
                h ? p < I && (I = p,
                P = t) : p > T && (T = p,
                P = t)
            }
            return P
        }
          , _ = async (e, t, i, r, o) => {
            var d, l, u, h, _, f, v, y, S, w, b, M, k;
            let T = r.draftView.getCanvasConfig()
              , I = r.draftView.getDraftId()
              , P = null !== (h = null == t ? void 0 : null === (d = t.materialDraft) || void 0 === d ? void 0 : d.draft.getDraftId()) && void 0 !== h ? h : null
              , F = null !== (_ = null != P ? P : I) && void 0 !== _ ? _ : ""
              , D = null !== (f = r.cutSame.draftIdToMutableVideos[F]) && void 0 !== f ? f : []
              , A = null !== (v = r.cutSame.draftIdToMutableTexts[F]) && void 0 !== v ? v : []
              , x = (0,
            n.dx)(D, A, e)
              , C = r.draftView.getSegmentById(e)
              , R = null !== (y = null == C ? void 0 : C.targetTimerange.start) && void 0 !== y ? y : 0n
              , E = s.pMA.plus(R, null !== (S = null == C ? void 0 : C.targetTimerange.duration) && void 0 !== S ? S : 0n, "bigint")
              , O = c((null !== (w = null == t ? void 0 : null === (l = t.materialDraft) || void 0 === l ? void 0 : l.draft) && void 0 !== w ? w : r.draftView).getAllEffects(), [R, E])
              , j = Array.isArray(x) ? x[0] : x;
            if (!j || !C)
                return null;
            let {targetStart: V} = j
              , U = null !== (b = null == t ? void 0 : null === (u = t.sourceTimerange) || void 0 === u ? void 0 : u.start) && void 0 !== b ? b : 0n
              , W = s.pMA.max([s.pMA.minus(U, V, "bigint"), 0n], "bigint")
              , L = (0,
            s.udP)(j, t)
              , Z = s.pMA.max([p(C, O), g(D, j), W], "bigint")
              , B = s.pMA.plus(W, L, "bigint")
              , N = await m(j, Z, B, [T.width, T.height], t, i, r, o)
              , H = s.pMA.plus(V, N, "bigint")
              , z = s.pMA.minus(H, null != U ? U : 0n, "bigint")
              , $ = r.draftView.getTargetTimeRangeBySegmentId(e)
              , G = null !== (M = null == $ ? void 0 : $.start) && void 0 !== M ? M : U
              , K = s.pMA.plus(G, null !== (k = null == $ ? void 0 : $.duration) && void 0 !== k ? k : 0n, "bigint")
              , Y = z;
            t && (Y = s.pMA.plus(t.targetTimerange.start, r.draftView.getTargetStartBySpeed(z, t.targetTimerange.duration, t.speed), "bigint"));
            let J = (0,
            a.i1)(Y, "round");
            return J < G ? (0,
            a.i1)(Y, "ceil") : J >= K ? (0,
            a.i1)(Y, "floor") : J
        }
    },
    158969: function(e, t, i) {
        i.d(t, {
            Cr: function() {
                return d
            },
            F: function() {
                return s
            },
            GT: function() {
                return n
            },
            XX: function() {
                return o
            },
            gT: function() {
                return l
            }
        });
        var a = i(510932);
        let r = {
            [a.ZZ.remove_background]: "remove_background",
            [a.ZZ.resize_video]: "resize_video",
            [a.ZZ.ad_script]: "ad_script",
            [a.ZZ.text_to_image]: "text_to_image",
            [a.ZZ.image_to_image]: "image_to_image",
            [a.ZZ.portrait_generator]: "portrait_generator",
            [a.ZZ.image_style_transfer]: "image_style_transfer",
            [a.ZZ.video_style_transfer]: "video_style_transfer",
            [a.ZZ.image_upscaler]: "image_upscaler",
            [a.ZZ.ai_color_correction]: "ai_color_correction",
            [a.ZZ.photo_colorizer]: "photo_colorizer",
            [a.ZZ.old_photo_restoration]: "old_photo_restoration",
            [a.ZZ.low_light_image_enhancement]: "low_light_image_enhancement",
            [a.ZZ.video_upscaler]: "video_upscaler",
            [a.ZZ.super_slow_motion]: "super_slow_motion",
            [a.ZZ.video_stabilization]: "video_stabilization",
            [a.ZZ.chatgpt]: "chatgpt",
            [a.ZZ.autocut]: "autocut",
            [a.ZZ.text_to_video]: "text_to_video",
            [a.ZZ.chatgpt_search]: "chatgpt_search",
            [a.ZZ.long_to_short]: "clip_shorts",
            [a.ZZ.ai_video]: "ai_video",
            [a.ZZ.text_to_speech]: "text_to_speech",
            [a.ZZ.av_translator]: "av_translator",
            [a.ZZ.voice_changer]: "voice_changer",
            [a.ZZ.storyboard]: "storyboard"
        };
        function n(e) {
            return !!r[e]
        }
        function o(e) {
            return r[e]
        }
        function s(e, t) {
            let i = "edit";
            if (t && n(t) && t !== a.ZZ.chatgpt_search)
                i = "smart_tool";
            else if (e || t === a.ZZ.template || t === a.ZZ.chatgpt_search)
                i = "template";
            return i
        }
        function d(e, t) {
            if (t) {
                let i = e.getSegmentById(t);
                return !!(null == i ? void 0 : i.smartCrop)
            }
            return e.getAllSegments().some(e => {
                let t = null == e ? void 0 : e.smartCrop;
                return null != t
            }
            )
        }
        function l(e) {
            return !!e.getDraftChangedSummary().is_smart_crop
        }
    },
    602317: function(e, t, i) {
        i.d(t, {
            X: function() {
                return a
            }
        });
        function a(e) {
            return e.every(e => {
                var t, i;
                return (null === (t = e.speed) || void 0 === t ? void 0 : t.speed) === 1 && [0, -1].includes(null === (i = e.speed) || void 0 === i ? void 0 : i.mode) && !(null == e ? void 0 : e.reverse)
            }
            )
        }
    },
    571276: function(e, t, i) {
        i.d(t, {
            u: function() {
                return l
            },
            z: function() {
                return c
            }
        });
        var a = i(108919)
          , r = i(914886)
          , n = i(425241)
          , o = i(266225)
          , s = i(297071)
          , d = i(913237);
        let l = async (e, t, i, r, o, l, c) => {
            var u;
            let {md5: h, workspaceId: p} = c
              , g = await (0,
            s.J)({
                md5s: [h],
                packageDelta: {
                    meta: {
                        visible: !0
                    }
                },
                fromWorkspaceId: p,
                toWorkspaceId: p,
                fetchRetryOptions: {
                    delay: 500,
                    retryTimes: 20
                },
                containerService: l
            });
            (0,
            n.Y2)(g.ok, g.msg);
            let m = null === (u = g.value) || void 0 === u ? void 0 : u[0]
              , _ = m.getModel()
              , f = await (0,
            a.q3)(_, e.dataSdk, t, i, e.draftPathStore, r, l);
            return o.addToUserGenerated(m, {
                addFrom: d.a.Freeze
            }),
            f
        }
          , c = (e, t, i, a, s) => {
            var d;
            let {segment: l, progress: c, md5: u, duration: h, mediaInfo: p, path: g} = a
              , m = null === (d = e.getMaterialsByMd5(u)) || void 0 === d ? void 0 : d[0]
              , _ = (0,
            r.Rl)();
            (0,
            n.Y2)(m, "no draw frame asset."),
            i.api.batch.freezeVideo({
                segId: l.id,
                splitTime: c,
                videoParam: (0,
                o.lFK)({
                    segmentId: _,
                    mediaInfo: p,
                    path: g,
                    materialName: m.filename,
                    materialId: m.key,
                    duration: h,
                    sourceDuration: h,
                    sourcePlatform: 0,
                    sourceStartTime: c,
                    startTime: c
                })
            }, s),
            t.setSelectedData({
                segmentIds: [_]
            })
        }
    },
    632187: function(e, t, i) {
        i.d(t, {
            f: function() {
                return r
            }
        });
        var a = i(565616);
        function r(e, t) {
            let i = !(arguments.length > 2) || void 0 === arguments[2] || arguments[2];
            for (let r of t) {
                let {start: t, duration: n} = r.targetTimerange;
                if (!function(e, t, i) {
                    let r = !(arguments.length > 3) || void 0 === arguments[3] || arguments[3]
                      , n = i + e.duration;
                    return !t.some(t => {
                        let {start: o, duration: s} = t.targetTimerange;
                        return (!r || t.id !== e.id) && ((0,
                        a.vX)(i, [o, o + s]) || (0,
                        a.vX)(n, [o, o + s]) || i <= o && o + s <= n)
                    }
                    )
                }({
                    id: r.id,
                    duration: n
                }, e, t, i))
                    return !1
            }
            return !0
        }
    },
    235930: function(e, t, i) {
        i.d(t, {
            G: function() {
                return r
            }
        });
        var a = i(838236);
        async function r(e, t) {
            let {mimeType: i} = t
              , r = new Blob([e],{
                type: i
            })
              , n = URL.createObjectURL(r);
            try {
                return await (0,
                a.G)(n)
            } finally {
                URL.revokeObjectURL(n)
            }
        }
    },
    628323: function(e, t, i) {
        i.d(t, {
            r: function() {
                return n
            }
        });
        var a = i(234126)
          , r = i(880945);
        async function n(e, t) {
            let {mimeType: i, quality: n} = t
              , o = await (0,
            r.B)(e);
            return (await (0,
            a.f)(o, {
                mimeType: i
            }, {})).toDataURL(i, n)
        }
    },
    797068: function(e, t, i) {
        i.d(t, {
            N: function() {
                return r
            }
        });
        var a = i(490021);
        function r(e, t, i) {
            let r, n, {compress: o} = i;
            (0,
            a.G)(o) ? n = (r = o.width) * e.naturalHeight / e.naturalWidth : (0,
            a.f)(o) ? r = (n = o.height) * e.naturalWidth / e.naturalHeight : (r = e.naturalWidth,
            n = e.naturalHeight);
            let s = document.createElement("canvas");
            s.width = r,
            s.height = n;
            let d = s.getContext("2d");
            if (!d)
                throw Error("[htmlImage2CanvasSync] create context failed!");
            return d.drawImage(e, 0, 0, e.naturalWidth, e.naturalHeight, 0, 0, r, n),
            s
        }
    },
    708218: function(e, t, i) {
        i.d(t, {
            U: function() {
                return a
            }
        });
        function a(e) {
            let {width: t} = e
              , {height: i} = e
              , a = document.createElement("canvas");
            a.width = t,
            a.height = i;
            let r = a.getContext("2d");
            if (!r)
                throw Error("[imageData2CanvasSync] create context failed!");
            return r.putImageData(e, 0, 0),
            a
        }
    },
    843096: function(e, t, i) {
        i.d(t, {
            pY: function() {
                return o
            },
            qK: function() {
                return n
            },
            tt: function() {
                return s
            },
            xn: function() {
                return r
            }
        });
        var a = i(437483);
        function r(e) {
            let {width: t, height: i} = e;
            if (854 === t && 480 === i)
                return {
                    width: 864,
                    height: 486
                };
            if (480 === t && 854 === i)
                return {
                    width: 486,
                    height: 864
                };
            if (486 === t && 364 === i)
                return {
                    width: 492,
                    height: 369
                };
            else if (364 === t && 486 === i)
                return {
                    width: 369,
                    height: 492
                };
            else
                return {
                    width: t,
                    height: i
                }
        }
        function n(e, t) {
            let i, a;
            let r = !1;
            t.width > t.height ? (i = t.height,
            a = t.width,
            r = !0) : (i = t.width,
            a = t.height);
            let n = Math.floor(e * a / i);
            return r ? {
                width: n,
                height: e
            } : {
                width: e,
                height: n
            }
        }
        function o(e, t) {
            let i;
            return t && Object.values(e).forEach(e => {
                if (!i) {
                    for (let t of e)
                        if (!t.filled) {
                            i = t.id;
                            break
                        }
                }
            }
            ),
            !i
        }
        function s(e, t) {
            return 348188 === t ? 4 : e === a.WY.BUSINESS ? 1 : e === a.WY.CONSUMER ? 0 : void 0
        }
    },
    412011: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return o
            }
        });
        var a = i(772322);
        i(689486);
        var r = i(614940)
          , n = i(218571);
        let o = e => {
            let {value: t, valueMap: i={
                on: !0,
                off: !1
            }, onChange: o, ...s} = e
              , d = (0,
            n.useCallback)(e => {
                null == o || o(e ? i.on : i.off)
            }
            , [i, o]);
            return (0,
            a.jsx)(r.Z, {
                checked: i.on === t,
                onChange: d,
                ...s
            })
        }
    },
    354943: function(e, t, i) {
        i.d(t, {
            Z: () => v
        });
        var a = i("772322");
        i("218571");
        var r = i("670933")
          , n = i("105789")
          , o = i.n(n)
          , s = i("43637")
          , d = i("517996");
        i("517562");
        var l = i("384392")
          , c = i("801497")
          , u = i("860452")
          , h = i("909249")
          , p = i("637270")
          , g = i("179368")
          , m = i("120706");
        let _ = e => {
            let {onBack: t} = e
              , i = (0,
            g.G)(m.T);
            return (0,
            a.jsxs)("div", {
                className: o()("template-post-back-btn", h.Z.btn),
                children: [(0,
                a.jsx)(l.Z, {
                    size: "mini",
                    type: "default",
                    className: h.Z.btnIcon,
                    icon: (0,
                    a.jsx)(u.ZEK, {}),
                    onClick: () => {
                        (0,
                        p.m)(i),
                        null == t || t()
                    }
                }), (0,
                a.jsx)("span", {
                    className: h.Z.btnText,
                    children: c.ZP.t("web_posttemplate_button_back_to_editor", {}, "Back to editor")
                })]
            })
        }
        ;
        var f = i("330669");
        let v = (0,
        r.f3)("store", "modules")((0,
        r.Pi)(e => {
            let {store: t, modules: i, onBack: r} = e
              , {active: n} = t[s.gq];
            return (0,
            a.jsxs)("div", {
                className: o()("template-post-header", d.Z.container, n ? d.Z.active : void 0),
                children: [(0,
                a.jsx)("div", {
                    className: d.Z.top,
                    children: (0,
                    a.jsx)(_, {
                        onBack: r
                    })
                }), (0,
                a.jsx)("div", {
                    className: d.Z.bottom,
                    children: (0,
                    a.jsx)(f.Z, {})
                })]
            })
        }
        ))
    },
    767720: function(e, t, i) {
        i.d(t, {
            DQ: function() {
                return a
            },
            K8: function() {
                return n
            },
            YE: function() {
                return o
            },
            dU: function() {
                return r
            }
        });
        let a = "siderMenuBrandKit"
          , r = Object.freeze(new Set(["lut", "primary_color_wheels", "log_color_wheels"]))
          , n = Object.freeze(new Set(["font_style"]))
          , o = Object.freeze(new Set(["curve", "font_style", "bubble"]))
    },
    70580: function(e, t, i) {
        i.d(t, {
            DQ: function() {
                return n
            },
            Gn: function() {
                return o
            }
        });
        var a = i(461373);
        i(801497);
        var r = i(740430);
        let n = "siderMenuCaption";
        a.Zw.square;
        let o = {
            [r.rF.SUBTITLE_SRT]: "srt",
            [r.rF.SUBTITLE_TXT]: "txt",
            [r.rF.SUBTITLE_ASS]: "ass",
            [r.rF.SUBTITLE_LRC]: "lrc"
        }
    },
    68316: function(e, t, i) {
        i.d(t, {
            P: function() {
                return c
            }
        });
        var a = i(772322)
          , r = i(860452)
          , n = i(801497)
          , o = i(850433)
          , s = i(727764)
          , d = i(677449)
          , l = i(862649);
        let c = {
            siderMenu: [{
                id: o.DQ,
                name: s.j.SiderMenuEffect,
                position: "top",
                icon: () => (0,
                a.jsx)(r.t33, {}),
                tooltips: () => n.ZP.t("effects_web", {}, "Effects"),
                title: () => n.ZP.t("effects_web", {}, "Effects")
            }],
            siderMenuPanel: [{
                name: s.j.SiderMenuEffect,
                skeleton: e => {
                    let {containerWidth: t} = e;
                    return (0,
                    a.jsx)(d.M, {
                        containerWidth: (0,
                        l._)(t)
                    })
                }
            }]
        }
    },
    96906: function(e, t, i) {
        i.d(t, {
            P: function() {
                return c
            }
        });
        var a = i(772322)
          , r = i(860452)
          , n = i(801497)
          , o = i(454094)
          , s = i(727764)
          , d = i(277051)
          , l = i(862649);
        let c = {
            siderMenu: [{
                id: o.DQ,
                name: s.j.SiderMenuMedia,
                position: "top",
                icon: () => (0,
                a.jsx)(r.L_4, {}),
                tooltips: () => n.ZP.t("mediz_web_a", {}, "Media"),
                title: () => n.ZP.t("mediz_web_a", {}, "Media")
            }],
            siderMenuPanel: [{
                name: s.j.SiderMenuMedia,
                skeleton: e => {
                    let {containerWidth: t} = e;
                    return (0,
                    a.jsx)(d.Z, {
                        containerWidth: (0,
                        l._)(t)
                    })
                }
            }]
        }
    },
    363315: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            }
        });
        let a = "siderMenuPhoto"
    },
    837839: function(e, t, i) {
        i.d(t, {
            P: function() {
                return c
            }
        });
        var a = i(772322)
          , r = i(860452)
          , n = i(801497)
          , o = i(363315)
          , s = i(727764)
          , d = i(229312)
          , l = i(862649);
        let c = {
            siderMenu: [{
                id: o.D,
                name: s.j.SiderMenuPhoto,
                position: "top",
                icon: () => (0,
                a.jsx)(r.ltp, {}),
                tooltips: () => n.ZP.t("web_materialSearch_title_image", {}, "Images"),
                title: () => n.ZP.t("web_materialSearch_title_image", {}, "Images")
            }],
            siderMenuPanel: [{
                name: s.j.SiderMenuPhoto,
                skeleton: e => {
                    let {containerWidth: t} = e;
                    return (0,
                    a.jsx)(d.y, {
                        containerWidth: (0,
                        l._)(t)
                    })
                }
            }]
        }
    },
    114996: function(e, t, i) {
        i.d(t, {
            CH: function() {
                return o
            },
            DQ: function() {
                return a
            },
            _Z: function() {
                return r
            }
        });
        let a = "siderMenuTextEditMedia"
          , r = "transcript";
        var n, o = ((n = {}).SIL = "<sil>",
        n.IM = "IM",
        n.RM = "RM",
        n.C = "C",
        n)
    },
    588439: function(e, t, i) {
        i.d(t, {
            N8: function() {
                return d
            },
            _g: function() {
                return s
            },
            hk: function() {
                return o
            }
        });
        var a, r, n, o = ((a = {}).ENTRY = "entry",
        a.TRANSCRIPTING = "transcripting",
        a.EDIT_LIST = "editList",
        a.NO_CONTENT = "noContent",
        a.ERROR_PANEL = "errorPanel",
        a.CONTINUE_GENERATE = "continueGenerate",
        a);
        var s = ((r = {}).AutoSubtitles = "AutoSubtitles",
        r.IdentifyLyrics = "IdentifyLyrics",
        r);
        var d = ((n = {}).Forward = "Forward",
        n.Backward = "Backward",
        n)
    },
    162253: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            _: function() {
                return r
            }
        });
        let a = "siderMenuText"
          , r = 110
    },
    575187: function(e, t, i) {
        i.d(t, {
            P: function() {
                return c
            }
        });
        var a = i(772322)
          , r = i(860452)
          , n = i(801497)
          , o = i(162253)
          , s = i(727764)
          , d = i(655637)
          , l = i(862649);
        let c = {
            siderMenu: [{
                id: o.D,
                name: s.j.SiderMenuText,
                position: "top",
                icon: () => (0,
                a.jsx)(r.lFi, {}),
                tooltips: () => n.ZP.t("text_web", {}, "Text"),
                title: () => n.ZP.t("text_web", {}, "Text")
            }],
            siderMenuPanel: [{
                name: s.j.SiderMenuText,
                skeleton: e => {
                    let {containerWidth: t} = e;
                    return (0,
                    a.jsx)(d.Q, {
                        containerWidth: (0,
                        l._)(t)
                    })
                }
            }]
        }
    },
    206965: function(e, t, i) {
        i.d(t, {
            q: function() {
                return r
            }
        });
        var a = i(218571);
        function r(e) {
            let {dataSdk: t} = e
              , [i,r] = (0,
            a.useState)(!!t.draftView.getAllSegments().length);
            return (0,
            a.useEffect)( () => {
                let e = t.onChangeDiff( () => {
                    r(!!t.draftView.getAllSegments().length)
                }
                );
                return () => {
                    e.dispose()
                }
            }
            , []),
            i
        }
    },
    485592: function(e, t, i) {
        i.d(t, {
            U: function() {
                return o
            }
        });
        var a = i(324697)
          , r = i(801497);
        let n = e => e
          , o = () => ({
            key: a.F3.ChecklistBtnGuide,
            steps: [{
                target: ".header-right #nav-checklist",
                get title() {
                    return r.ZP.t("web_first_subscribe_text_capcut_pro", {
                        strong: n
                    }, "CapCut Pro")
                },
                content: r.ZP.t("web_first_subscribe_text_clik_to_go", {}, "You can view all Pro features and materials used in this project."),
                placement: "br"
            }],
            mask: !1,
            showSkipButton: !1,
            maskClosable: !0,
            get okText() {
                return r.ZP.t("web_first_subscribe_title_got_it", {}, "Got it")
            }
        })
    },
    561816: function(e, t, i) {
        i.d(t, {
            P: function() {
                return s
            }
        });
        var a = i(204652)
          , r = i(151042)
          , n = i(687589)
          , o = i(350512);
        let s = {
            titleBar: [{
                name: o.jR.TitlebarCollaborator,
                type: a._.Custom,
                position: "right",
                style: {
                    marginRight: "12px"
                },
                orderLevel: r.r.high,
                order: n.r.Collaborator,
                contributionSymbol: o.DQ
            }]
        }
    },
    646256: function(e, t, i) {
        i.d(t, {
            DQ: function() {
                return r
            },
            d4: function() {
                return o
            },
            jR: function() {
                return n
            }
        });
        var a = i(294670);
        let r = "titlebarEditorActions"
          , n = {
            TitlebarCursorMode: "TitlebarCursorMode",
            TitlebarCanvasZoomSize: "TitlebarCanvasZoomSize",
            TitlebarDraftUndo: "TitlebarDraftUndo",
            TitlebarDraftRedo: "TitlebarDraftRedo",
            TitlebarResizeCanvas: "TitlebarResizeCanvas"
        }
          , o = {
            move: {
                keyBindings: {
                    win: [a.VD.V],
                    mac: [a.VD.V]
                },
                handleFnName: "_handleChangeCursorToMouseForShortKey"
            },
            handle_tool: {
                keyBindings: {
                    win: [a.VD.H],
                    mac: [a.VD.H]
                },
                handleFnName: "_handleChangeCursorToToolForShortKey"
            },
            undo: {
                keyBindings: {
                    win: [a.N9.CTRL_WIN + a.VD.Z],
                    mac: [a.N9.COMMAND + a.VD.Z]
                },
                handleFnName: "_handleUndoFromShortKey"
            },
            redo: {
                keyBindings: {
                    win: [a.N9.SHIFT + a.N9.CTRL_WIN + a.VD.Z],
                    mac: [a.N9.SHIFT + a.N9.COMMAND + a.VD.Z]
                },
                handleFnName: "_handleRedoFromShortKey"
            }
        }
    },
    757245: function(e, t, i) {
        i.d(t, {
            A: function() {
                return r
            }
        });
        var a, r = ((a = {}).ExportForbidViewPermission = "export_forbid_view_permission",
        a.ExportForbidHasMaterialMiss = "export_forbid_has_material_miss",
        a.MaterialIsBeingTransferred = "material_is_being_transferred__please_wait",
        a.DraftHasFileFail = "draft_has_file_fail",
        a.DraftIsEmpty = "draft_is_empty_and_cannot_be_exported",
        a.NonLogin = "export_after_logging_in",
        a)
    },
    720176: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return n
            }
        });
        var a = i(772322);
        i(218571);
        var r = i(930369);
        i(333104);
        let n = e => {
            let {onClick: t, onMouseOver: i, onMouseEnter: n, disabled: o} = e;
            return (0,
            a.jsx)("div", {
                className: "Lv_Task-wrapper",
                onClick: t,
                onMouseOver: i,
                onMouseEnter: n,
                children: (0,
                a.jsx)("div", {
                    className: "Lv_Task-static-icon",
                    children: (0,
                    a.jsx)(r.Tnb, {
                        size: 20,
                        style: o ? {
                            color: "var(--lvv-color-text-disable)",
                            cursor: "not-allowed"
                        } : void 0
                    })
                })
            })
        }
    },
    720657: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            j: function() {
                return r
            }
        });
        let a = "titlebarRename"
          , r = {
            TitlebarRename: "TitlebarRename",
            TitlebarDraftMenu: "TitlebarDraftMenu"
        }
    },
    368397: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return d
            }
        });
        var a = i(772322);
        i(20699);
        var r = i(935512);
        i(218571);
        var n = i(826235)
          , o = i(994643)
          , s = i(801497);
        i(821829);
        let d = e => {
            let {selectedInputPreference: t, onInputPreferenceChange: i} = e
              , d = [{
                label: s.ZP.t("web_subtitle_button_preference_left_right", {}, "Left to right"),
                value: o.Q.Ltr
            }, {
                label: s.ZP.t("web_subtitle_button_preference_right_left", {}, "Right to left"),
                value: o.Q.Rtl
            }];
            return (0,
            a.jsx)(r.Z, {
                className: "user-menu-container",
                selectedKeys: [null != t ? t : d[0].value],
                children: d.map(e => (0,
                a.jsxs)(r.Z.Item, {
                    onClick: () => i(e.value),
                    children: [e.label, e.value === t ? (0,
                    a.jsx)(n.EgK, {
                        size: 20
                    }) : null]
                }, e.value))
            })
        }
    },
    211099: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return o
            }
        });
        var a = i(772322);
        i(20699);
        var r = i(935512);
        i(218571);
        var n = i(826235);
        i(821829);
        let o = e => {
            var t;
            let {onLanguageChange: i, getCurrentLocale: o, getSupportLocales: s} = e;
            return (0,
            a.jsx)(r.Z, {
                className: "user-menu-container",
                selectedKeys: [o()],
                children: null == s ? void 0 : null === (t = s()) || void 0 === t ? void 0 : t.map(e => (0,
                a.jsxs)(r.Z.Item, {
                    onClick: () => i(e.locale, e.text),
                    children: [e.text, e.locale === o() ? (0,
                    a.jsx)(n.EgK, {
                        size: 20
                    }) : null]
                }, e.locale))
            })
        }
    },
    317560: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            j: function() {
                return r
            }
        });
        let a = "titlebarSettings"
          , r = {
            TitlebarSettings: a
        }
    },
    694902: function(e, t, i) {
        i.d(t, {
            P: function() {
                return c
            }
        });
        var a = i(772322)
          , r = i(317560)
          , n = i(204652)
          , o = i(151042)
          , s = i(854690)
          , d = i(687589)
          , l = i(294344);
        let c = {
            titleBar: [{
                name: r.j.TitlebarSettings,
                type: n._.Custom,
                position: "right",
                orderLevel: o.r.low,
                order: d.r.Settings,
                content: () => (0,
                a.jsx)(s.V, {
                    isDisabled: !0
                }),
                contributionSymbol: r.D,
                showInMenu: {
                    priority: l.Yg.Settings,
                    group: l.kS.Settings,
                    withMenu: !1,
                    priorityInMenu: l.$9.Settings
                }
            }]
        }
    },
    308993: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return d
            }
        });
        var a = i(772322)
          , r = i(218571)
          , n = i(860452)
          , o = i(105789)
          , s = i.n(o);
        i(287325);
        let d = (0,
        r.forwardRef)( (e, t) => {
            let {active: i, onClick: r, onMouseOver: o, onMouseEnter: d, visuallyDisabled: l, ...c} = e;
            return (0,
            a.jsx)("div", {
                ref: t,
                ...c,
                id: "attribute-view-switch-btn",
                className: s()("attribute-view-nav-action-btn", {
                    active: i,
                    disabled: l
                }),
                onClick: r,
                onMouseOver: o,
                onMouseEnter: d,
                children: (0,
                a.jsx)(n.m5T, {
                    className: "nav-action-icon"
                })
            })
        }
        )
    },
    985623: function(e, t, i) {
        i.d(t, {
            P: function() {
                return l
            }
        });
        var a = i(772322)
          , r = i(727764)
          , n = i(801497)
          , o = i(860452)
          , s = i(428271)
          , d = i(506234);
        let l = {
            toolBar: [{
                id: i(543475).D,
                name: r.j.ToolbarAudioSpeed,
                type: "unpin",
                icon: () => (0,
                a.jsx)(o.fDY, {
                    fontSize: 20
                }),
                title: () => n.ZP.t("speed_web", {}, "Speed"),
                groups: [s.D.Audio]
            }],
            toolBarPanel: [{
                name: r.j.ToolbarAudioSpeed,
                content: (0,
                a.jsx)(d.v, {})
            }]
        }
    },
    133661: function(e, t, i) {
        i.d(t, {
            Q: function() {
                return c
            }
        });
        var a = i(772322);
        i(801772);
        var r = i(376548)
          , n = i(218571)
          , o = i(105789)
          , s = i.n(o)
          , d = i(138207)
          , l = i(930369);
        i(915805);
        let c = e => {
            let {name: t, title: i, shouldCollapse: o=!1, className: c="", extra: u, onClick: h, style: p, showPoint: g, isEntry: m, noBottom: _, id: f} = e
              , v = (0,
            n.useMemo)( () => i || u ? (0,
            a.jsxs)("div", {
                className: "attribute-block-header",
                children: [(0,
                a.jsx)("div", {
                    className: s()("attribute-block-header-text", {
                        "show-guide-point": g
                    }),
                    children: null != i ? i : ""
                }), u]
            }) : null, [i, u]);
            return o ? (0,
            a.jsx)(r.Z.Item, {
                className: s()("attribute-block", c),
                id: f,
                name: t,
                header: v,
                showExpandIcon: o,
                expandIcon: (0,
                a.jsx)(d.Z, {}),
                style: p,
                children: e.children
            }) : (0,
            a.jsxs)("div", {
                className: s()("attribute-block", c),
                onClick: h,
                style: p,
                id: f,
                children: [v ? (0,
                a.jsxs)("div", {
                    className: s()("attribute-block-header-wrapper", {
                        "attribute-block-header-wrapper-entry": m,
                        "attribute-block-header-wrapper-no_bottom": _
                    }),
                    children: [v, m && (0,
                    a.jsx)(l.O_V, {
                        className: "attribute-block-header-wrapper-icon"
                    })]
                }) : null, e.children]
            })
        }
    },
    139243: function(e, t, i) {
        i.d(t, {
            x: function() {
                return r
            }
        });
        var a = i(266225);
        let r = [a.Eu.KFTypePositionX, a.Eu.KFTypePositionY, a.Eu.KFTypePositionXY, a.Eu.KFTypeScale, a.Eu.KFTypeScaleX, a.Eu.KFTypeScaleY]
    },
    543884: function(e, t, i) {
        i.d(t, {
            K: () => h
        });
        var a = i("772322");
        i("180631"),
        i("689486");
        var r = i("657719")
          , n = i("614940")
          , o = i("218571")
          , s = i("471181")
          , d = i("105789")
          , l = i.n(d)
          , c = i("771889");
        let u = e => e.clientHeight < e.scrollHeight;
        i("419769");
        let h = (0,
        c.Q)(e => {
            var t, i;
            let d = (0,
            o.useRef)(null)
              , [c,h] = (0,
            o.useState)(!1);
            (0,
            o.useEffect)( () => {
                h(function(e) {
                    var t;
                    if (!e)
                        return !1;
                    return (t = e).scrollWidth > t.clientWidth || u(e)
                }(d.current))
            }
            , [e.description]);
            let p = (0,
            o.useMemo)( () => c ? (0,
            a.jsx)(r.Z, {
                content: e.description,
                children: (0,
                a.jsx)("div", {
                    className: "attribute-switch-field-des1",
                    ref: d,
                    children: e.description
                })
            }) : (0,
            a.jsx)("div", {
                className: "attribute-switch-field-des1",
                ref: d,
                children: e.description
            }), [c]);
            return (0,
            a.jsx)("div", {
                className: `attribute-switch-field ${null !== (i = e.className) && void 0 !== i ? i : ""}`,
                children: (0,
                a.jsxs)("div", {
                    className: "attribute-switch-field-top",
                    children: [e.logo ? (0,
                    a.jsx)("div", {
                        className: "attribute-switch-field-logo",
                        children: e.logo
                    }) : null, (0,
                    a.jsxs)("div", {
                        className: "attribute-switch-field-present",
                        children: [(0,
                        a.jsxs)("div", {
                            className: l()("attribute-switch-field-title", {
                                "show-guide-point": e.showGuidePoint
                            }),
                            children: [e.title, !!e.tips && (0,
                            a.jsx)(r.Z, {
                                content: null === (t = e.tips) || void 0 === t ? void 0 : t.content,
                                children: (0,
                                a.jsx)(s.Z, {
                                    className: "attribute-switch-field-icon",
                                    fontSize: 15
                                })
                            }), e.externalIcon ? (0,
                            a.jsx)("div", {
                                className: "attribute-switch-field-external-icon",
                                children: e.externalIcon
                            }) : null]
                        }), e.description ? p : null]
                    }), (0,
                    a.jsx)(r.Z, {
                        content: e.disabledTip,
                        children: (0,
                        a.jsx)(n.Z, {
                            className: "attribute-switch-field-button",
                            disabled: e.disabled,
                            checked: e.checked,
                            onChange: e.onChange,
                            loading: e.loading,
                            onPointerUp: () => {
                                var t;
                                return null === (t = e.onPointerUp) || void 0 === t ? void 0 : t.call(e, e.disabled, e.loading)
                            }
                        })
                    })]
                })
            })
        }
        )
    },
    771889: function(e, t, i) {
        i.d(t, {
            Q: function() {
                return n
            }
        });
        var a = i(772322)
          , r = i(361686);
        function n(e, t, i) {
            return n => {
                let o = n.label ? n.label : null != t ? t : "";
                return (0,
                a.jsx)(r.Z, {
                    label: o,
                    labelSizeType: i,
                    labelMarginBottom: n.labelMarginBottom,
                    children: (0,
                    a.jsx)(e, {
                        ...n
                    })
                })
            }
        }
    },
    472874: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            N: function() {
                return r
            }
        });
        let a = "toolbarEffectBasic"
          , r = "basic"
    },
    640327: function(e, t, i) {
        i.d(t, {
            P: function() {
                return l
            }
        });
        var a = i(772322)
          , r = i(727764)
          , n = i(801497)
          , o = i(860452)
          , s = i(428271)
          , d = i(506234);
        let l = {
            toolBar: [{
                id: i(472874).D,
                name: r.j.ToolbarEffectBasic,
                type: "unpin",
                icon: () => (0,
                a.jsx)(o.t33, {
                    fontSize: 20
                }),
                title: () => n.ZP.t("basic_web", {}, "Basic"),
                groups: [s.D.Effect],
                defaultActiveGroupList: [s.D.Effect]
            }],
            toolBarPanel: [{
                name: r.j.ToolbarEffectBasic,
                content: (0,
                a.jsx)(d.v, {})
            }]
        }
    },
    88245: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            N: function() {
                return r
            }
        });
        let a = "toolbarFilterBasic"
          , r = "basic"
    },
    427200: function(e, t, i) {
        i.d(t, {
            P: function() {
                return l
            }
        });
        var a = i(772322)
          , r = i(801497)
          , n = i(860452)
          , o = i(428271)
          , s = i(506234)
          , d = i(727764);
        let l = {
            toolBar: [{
                id: i(216795).D,
                name: d.j.ToolbarMutableAudioBasic,
                type: "unpin",
                icon: () => (0,
                a.jsx)(n.GCV, {
                    fontSize: 20
                }),
                title: () => r.ZP.t("audio_web", {}, "Audio"),
                groups: [o.D.Mutable]
            }],
            toolBarPanel: [{
                name: d.j.ToolbarMutableAudioBasic,
                content: (0,
                a.jsx)(s.v, {})
            }]
        }
    },
    250463: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            j: function() {
                return r
            }
        });
        let a = "toolbarStickerTracking"
          , r = {
            ToolbarStickerTracking: "ToolbarStickerTracking"
        }
    },
    940707: function(e, t, i) {
        i.d(t, {
            P: function() {
                return d
            }
        });
        var a = i(772322)
          , r = i(259444)
          , n = i(801497)
          , o = i(860452)
          , s = i(428271);
        let d = {
            toolBar: [{
                name: r.j.ToolbarTextTracking,
                type: "unpin",
                icon: () => (0,
                a.jsx)(o.nHE, {
                    fontSize: 20
                }),
                title: () => n.ZP.t("web_elements_title_tracking", {}, "Camera tracking"),
                groups: [s.D.Text, s.D.Caption]
            }],
            toolBarPanel: [{
                name: r.j.ToolbarTextTracking
            }]
        }
    },
    859790: function(e, t, i) {
        i.d(t, {
            C8: function() {
                return n
            },
            DQ: function() {
                return a
            },
            N3: function() {
                return r
            }
        });
        let a = "toolbarTextTts"
          , r = "text_to_speech"
          , n = {
            web_tts_toast_language_unsupported: "Can\u2019t generate speech. Current voice changers don\u2019t support the language of the text.",
            web_tts_toast_error_occurred: "Something went wrong. Try again later.",
            web_tts_toast_characters_limit: "Couldn\u2019t generate speech. The text reached the characters limit."
        }
    },
    320202: function(e, t, i) {
        i.d(t, {
            D: function() {
                return a
            },
            N: function() {
                return r
            }
        });
        let a = "toolbarVideoAudio"
          , r = "audio"
    },
    793548: function(e, t, i) {
        i.d(t, {
            P: function() {
                return l
            }
        });
        var a = i(772322)
          , r = i(727764)
          , n = i(801497)
          , o = i(860452)
          , s = i(428271)
          , d = i(506234);
        let l = {
            toolBar: [{
                id: i(320202).D,
                name: r.j.ToolbarVideoAudio,
                type: "unpin",
                icon: () => (0,
                a.jsx)(o.GCV, {
                    fontSize: 20
                }),
                title: () => n.ZP.t("audio_web", {}, "Audio"),
                groups: [s.D.Video, s.D.MutableVideo, s.D.Unselected]
            }],
            toolBarPanel: [{
                name: r.j.ToolbarVideoAudio,
                content: (0,
                a.jsx)(d.v, {})
            }]
        }
    },
    274992: function(e, t, i) {
        i.d(t, {
            DQ: function() {
                return a
            },
            N3: function() {
                return o
            },
            Rc: function() {
                return n
            },
            rb: function() {
                return s
            }
        });
        let a = "toolbarVideoElement";
        var r, n = ((r = {}).Clip = "clip",
        r.TEXT = "text",
        r.AUDIO = "audio",
        r);
        let o = "element"
          , s = ".attribute-element-wrapper"
    },
    558303: function(e, t, i) {
        i.d(t, {
            P: function() {
                return l
            }
        });
        var a = i(772322)
          , r = i(727764)
          , n = i(801497)
          , o = i(860452)
          , s = i(428271)
          , d = i(506234);
        let l = {
            toolBar: [{
                id: i(926388).DQ,
                name: r.j.ToolbarVideoSpeed,
                type: "unpin",
                icon: () => (0,
                a.jsx)(o.fDY, {
                    fontSize: 20
                }),
                title: () => n.ZP.t("speed_web", {}, "Speed"),
                groups: [s.D.Video, s.D.VideoCombination, s.D.Unselected]
            }],
            toolBarPanel: [{
                name: r.j.ToolbarVideoSpeed,
                content: (0,
                a.jsx)(d.v, {})
            }]
        }
    },
    588095: function(e, t, i) {
        i.d(t, {
            $x: function() {
                return f
            },
            Nw: function() {
                return v
            },
            Ny: function() {
                return F
            },
            TY: function() {
                return b
            },
            U3: function() {
                return y
            },
            fN: function() {
                return S
            },
            iM: function() {
                return C
            },
            p: function() {
                return D
            },
            pg: function() {
                return M
            },
            rx: function() {
                return k
            },
            uK: function() {
                return I
            },
            vs: function() {
                return A
            },
            xS: function() {
                return x
            },
            xf: function() {
                return T
            }
        });
        var a = i(266225)
          , r = i(297071)
          , n = i(592753)
          , o = i(722169)
          , s = i(432590)
          , d = i(201359)
          , l = i(108919)
          , c = i(676591)
          , u = i(42680)
          , h = i(914886)
          , p = i(425241)
          , g = i(271412)
          , m = i(428694)
          , _ = i(174696);
        let f = 1
          , v = e => (0,
        a.Ftn)(e) || (0,
        a.Q2R)(e)
          , y = e => (0,
        a.NHR)(e)
          , S = e => {
            var t;
            let i = e.digitalHuman;
            return null == i ? void 0 : null === (t = i.ttsMetas) || void 0 === t ? void 0 : t.map(e => e.text).join(" ")
        }
          , w = e => {
            let t = e[0].offset;
            e.forEach(e => {
                (0,
                a.dDv)(t, e.offset) && (e.offset = t),
                t = (0,
                a.yt6)(e.offset, e.mediaInfo.duration, "bigint")
            }
            )
        }
          , b = e => {
            let {segments: t, dataSdk: i, trackIndex: r} = e
              , n = [...t]
              , o = n[0].targetTimerange.start;
            n.forEach(e => {
                let t = e.targetTimerange.start;
                (0,
                a.dDv)(o, t) && (t = o,
                i.api.segment.move({
                    segmentId: e.id,
                    targetTrackIndex: r,
                    sourceTrackIndex: r,
                    targetStartTime: t
                })),
                o = (0,
                a.yt6)(t, e.targetTimerange.duration, "bigint")
            }
            )
        }
          , M = e => {
            w(e);
            let t = e[0].offset
              , i = []
              , r = [];
            for (let n of e) {
                let e = (0,
                a.rX1)((0,
                a.yt6)(n.offset, n.mediaInfo.duration), t);
                if ((0,
                a.dDv)(e, 720000000n))
                    i.push(r),
                    r = [{
                        ...n,
                        digitalHumanOffset: 0n
                    }],
                    t = n.offset;
                else {
                    let e = (0,
                    a.rX1)(n.offset, t, "bigint");
                    r.push({
                        ...n,
                        digitalHumanOffset: e
                    })
                }
            }
            return r.length && i.push(r),
            i
        }
        ;
        async function k(e, t, i, r, n, o) {
            let {ensureManager: s} = n
              , d = (0,
            c.l)(u._g.Mask, e)
              , l = s.ensureEffect(d);
            await l.waitForResourceValueReady();
            let h = {
                name: e.name,
                resourceType: e.maskType,
                resourceId: e.resourceId,
                segId: null != o ? o : "",
                isKeyframe: !1,
                path: s.getEffectPathForEnsuredEffect(e.resourceId),
                width: 1,
                height: 1,
                sourcePlatform: a.nj7.EffectPlatformArtist,
                positionInfo: a.HHr.stringify({
                    face_center_x: t,
                    face_center_y: i,
                    face_radius: r
                })
            };
            return {
                segmentId: o,
                maskParam: h
            }
        }
        let T = async (e, t, i, r) => {
            if (!i)
                return {
                    segmentId: r,
                    backgroundParam: null
                };
            if (i.type === a.cVg.MetaTypeCanvasColor)
                return {
                    segmentId: r,
                    backgroundParam: {
                        ...i,
                        imageId: "",
                        sourcePlatform: a.nj7.EffectPlatformLoki
                    }
                };
            let n = t.find(e => e.resourceId === i.value);
            if (!n)
                return {};
            let o = (0,
            c.l)(u._g.VideoBackground, n)
              , d = (0,
            s.do)(o.resource);
            try {
                let t = e.ensureManager.ensureEffect(o, d);
                await t.waitForResourceValueReady()
            } catch (e) {}
            return e.playerManager.pause(),
            {
                segmentId: r,
                backgroundParam: {
                    type: a.cVg.MetaTypeCanvasImage,
                    value: d,
                    imageId: n.resourceId,
                    sourcePlatform: _.t.formatEffectSourcePlatform(n.source)
                }
            }
        }
          , I = (e, t, i) => {
            let {mediaFileInfo: r, resource: n, resourceRecord: o} = e;
            return (0,
            a.lFK)({
                segmentId: (0,
                h.Rl)(),
                path: null == o ? void 0 : o.segmentPath,
                type: a.cVg.MetaTypeImage,
                materialName: n.getModel().filename,
                startTime: i.start,
                duration: i.duration,
                sourceStartTime: 0n,
                sourceDuration: 0n,
                materialId: "",
                originMaterialId: "",
                source: void 0,
                sourcePlatform: void 0,
                mediaInfo: r,
                size: {
                    width: r.width,
                    height: r.height
                }
            })
        }
          , P = new Map
          , F = async e => {
            var t, i, r;
            let {imageUrl: n, digitalHumanId: o, digitalHumanService: s, containerService: d, mainEditorWidgetService: l, position: c} = e
              , u = "";
            if (P.has(o))
                u = null !== (t = P.get(o)) && void 0 !== t ? t : "";
            else {
                let e = await s.downloadDefaultVideo(n, o);
                u = `/.preview-temp-file/${e.name}`,
                await (0,
                g.WZ)(e, u, l.renderManager),
                P.set(o, u)
            }
            let p = await l.renderManager.getMediaFileInfo(u, "");
            return (0,
            a.lFK)({
                segmentId: (0,
                h.Rl)(),
                path: u,
                type: a.cVg.MetaTypeVideo,
                materialName: o,
                startTime: c.start,
                duration: c.duration,
                sourceStartTime: 0n,
                sourceDuration: 0n,
                materialId: "",
                originMaterialId: "",
                source: void 0,
                sourcePlatform: void 0,
                mediaInfo: p,
                size: {
                    width: null !== (i = null == p ? void 0 : p.width) && void 0 !== i ? i : 0,
                    height: null !== (r = null == p ? void 0 : p.height) && void 0 !== r ? r : 0
                }
            })
        }
          , D = async e => {
            var t, i, r;
            let {imageUrl: n, digitalHumanId: o, digitalHumanService: s, containerService: d, mainEditorWidgetService: l, position: c} = e
              , u = "";
            if (P.has(o))
                u = null !== (t = P.get(o)) && void 0 !== t ? t : "";
            else {
                let e = await s.downloadDefaultImage(n, o);
                u = `/.preview-temp-file/${e.name}`,
                await (0,
                g.WZ)(e, u, l.renderManager),
                P.set(o, u)
            }
            let p = await l.renderManager.getMediaFileInfo(u, "");
            return (0,
            a.lFK)({
                segmentId: (0,
                h.Rl)(),
                path: u,
                type: a.cVg.MetaTypeImage,
                materialName: o,
                startTime: c.start,
                duration: c.duration,
                sourceStartTime: 0n,
                sourceDuration: 0n,
                materialId: "",
                originMaterialId: "",
                source: void 0,
                sourcePlatform: void 0,
                mediaInfo: p,
                size: {
                    width: null !== (i = null == p ? void 0 : p.width) && void 0 !== i ? i : 0,
                    height: null !== (r = null == p ? void 0 : p.height) && void 0 !== r ? r : 0
                }
            })
        }
          , A = async e => {
            var t, i, a, r, n, o;
            let {imageUrl: s, digitalHumanId: c, digitalHumanService: u, containerService: h, mainDraftService: g, mainEditorWidgetService: m, resourceService: _} = e
              , f = await u.uploadDefaultImage(s, c)
              , v = [{
                md5: null == f ? void 0 : f.md5,
                vid: "",
                url: "",
                key: ""
            }].filter(e => {
                var t;
                return null !== (t = e.md5) && void 0 !== t ? t : e.vid
            }
            )
              , [y,S] = (await h.invokeFunction(d.CH, {
                list: v
            }, {
                resourceType: 5
            }, {
                addToUserGenerated: !1
            })).pair();
            if (y || !S)
                throw Error("ensure material error");
            let w = await (0,
            l.q3)(null == S ? void 0 : null === (t = S[0]) || void 0 === t ? void 0 : t.getModel(), g.dataSdk, m.ensureManager, m.renderManager, g.draftPathStore, _, h)
              , b = await (null == S ? void 0 : null === (n = S[0]) || void 0 === n ? void 0 : null === (r = n.getModel) || void 0 === r ? void 0 : null === (a = r.call(n)) || void 0 === a ? void 0 : null === (i = a.addModelToDraft) || void 0 === i ? void 0 : i.call(a));
            (0,
            p.Y2)(!b || b.ok);
            let M = await m.renderManager.getMediaFileInfo(w.resPath, null !== (o = w.decryptKey) && void 0 !== o ? o : "");
            if (!M || !w)
                throw Error("ensure image error");
            return {
                mediaFileInfo: M,
                resource: null == S ? void 0 : S[0],
                resourceRecord: w
            }
        }
          , x = (e, t) => {
            let {position: i, imageInfo: a, ...r} = e
              , {mainDraftService: n} = t
              , o = a && i ? I(a, r.segmentId, i) : void 0;
            return n.dataSdk.api.video.updateDigitalHuman({
                videoParams: o ? [o] : void 0,
                ...r
            })
        }
          , C = async (e, t) => {
            var i, s, d, c, u;
            let {segmentId: h, digitalHumanId: g, taskId: _, resourceId: v, data: y, sourceTimerangeParam: S, volume: w, options: b} = e
              , {containerService: M, mainDraftService: k, mainEditorWidgetService: T, resourceService: I} = t
              , P = null == y ? void 0 : y.taskDetails
              , F = (null == P ? void 0 : P.map(e => e.md5)) || []
              , [D,A] = (await (0,
            r.J)({
                md5s: F,
                fromWorkspaceId: k.draftWorkspaceManager.workspaceId || "",
                toWorkspaceId: k.draftWorkspaceManager.workspaceId || "",
                containerService: M,
                addToUserGenerated: !1
            })).pair()
              , x = null == y ? void 0 : y.taskDetails.findIndex(e => "rgb" === e.resource_name)
              , C = null == y ? void 0 : y.taskDetails.findIndex(e => "alpha" === e.resource_name);
            if (D || (0,
            o.isNil)(x) || (0,
            o.isNil)(C))
                return;
            await Promise.all(A.map(e => new Promise( (t, i) => {
                if ((0,
                n.fA)(e.getModel())) {
                    t("");
                    return
                }
                e.onDidTranscode( () => t("")),
                e.onResourceReady( () => t("")),
                e.onPrepareFailure( () => i(Error("prepare failure"))),
                e.onTranscodeFailure( () => i(Error("transcode failure")))
            }
            )));
            let R = await Promise.all(A.map(async e => {
                var t, i;
                let a = null == e ? void 0 : null === (t = e.getModel) || void 0 === t ? void 0 : t.call(e)
                  , r = await (null == a ? void 0 : null === (i = a.addModelToDraft) || void 0 === i ? void 0 : i.call(a));
                return (0,
                p.Y2)(!r || r.ok),
                a
            }
            ))
              , E = await Promise.all(R.map(e => (0,
            l.ti)(e, k.dataSdk, T.ensureManager, T.renderManager, k.draftPathStore, I, M)))
              , O = await Promise.all(E.map(e => {
                var t;
                return T.renderManager.getMediaFileInfo(e.resPath, null !== (t = e.decryptKey) && void 0 !== t ? t : "")
            }
            ))
              , j = A.map( (e, t) => {
                let i = null == E ? void 0 : E[t]
                  , r = null == R ? void 0 : R[t]
                  , n = null == O ? void 0 : O[t];
                return (0,
                a.lFK)({
                    segmentId: h,
                    path: null == i ? void 0 : i.segmentPath,
                    materialName: r.filename,
                    startTime: 0n,
                    duration: n.duration,
                    type: a.cVg.MetaTypeVideo,
                    sourceStartTime: 0n,
                    sourceDuration: 0n,
                    materialId: "",
                    source: void 0,
                    sourcePlatform: void 0,
                    mediaInfo: n,
                    volume: w,
                    size: {
                        width: n.width,
                        height: n.height
                    }
                })
            }
            )
              , V = k.dataSdk.draftView.getSegmentById(h)
              , U = (0,
            m.q)(V)
              , W = !1;
            U && V && (W = (0,
            m.S)(V));
            let L = k.dataSdk.api.video.updateDigitalHumanRendered({
                segmentId: h,
                digitalPath: E[x].segmentPath,
                videoParam: j[x],
                mattingPath: null !== (s = null === (i = E[C]) || void 0 === i ? void 0 : i.segmentPath) && void 0 !== s ? s : "",
                sourceTimerangeParam: S
            });
            return (null == b ? void 0 : b.closeMatting) ? k.dataSdk.api.video.clearMatting({
                segId: h,
                path: null !== (c = null === (d = E[C]) || void 0 === d ? void 0 : d.segmentPath) && void 0 !== c ? c : ""
            }) : U && !W && (null === (u = E[C]) || void 0 === u ? void 0 : u.segmentPath) && k.dataSdk.api.video.clearMatting({
                segId: h,
                path: E[C].segmentPath
            }),
            T.timelineManager.segmentManager.setTimelineSegmentLoading(h, !1, f),
            L
        }
    },
    930228: function(e, t, i) {
        i.d(t, {
            O: function() {
                return w
            }
        });
        var a = i(789786)
          , r = i(947926)
          , n = i(120706)
          , o = i(957600)
          , s = i(65970)
          , d = i(193823)
          , l = i(311952)
          , c = i(229783)
          , u = i(578276)
          , h = i(353054)
          , p = i(219227)
          , g = i(278554)
          , m = i(779733)
          , _ = i(121504)
          , f = i(411171)
          , v = i(744140)
          , y = i(996847);
        function S(e, t, i) {
            let a = i.value;
            return i.value = async function() {
                for (var e = arguments.length, t = Array(e), i = 0; i < e; i++)
                    t[i] = arguments[i];
                let r = performance.now()
                  , n = await a.apply(this, t);
                return n.performanceDuration = performance.now() - r,
                n
            }
            ,
            i
        }
        class w {
            updateRenderManager(e) {
                this._addVideoSegmentHelper.updateRenderManager(e),
                this._addPhotoSegmentHelper.updateRenderManager(e),
                this._addAudioSegmentHelper.updateRenderManager(e),
                this._addStickerSegmentHelper.updateRenderManager(e),
                this._addFilterSegmentHelper.updateRenderManager(e),
                this._addEffectSegmentHelper.updateRenderManager(e),
                this._addTextSegmentHelper.updateRenderManager(e),
                this._addTextTemplateSegmentHelper.updateRenderManager(e),
                this._addTransitionHelper.updateRenderManager(e),
                this._addVideoTemplateSegmentHelper.updateRenderManager(e),
                this._addDigitalHumanSegmentHelper.updateRenderManager(e),
                this._addAdjustmentPresetSegmentHelper.updateRenderManager(e)
            }
            async addVideo(e, t, i) {
                return {
                    result: await this._addVideoSegmentHelper.add({
                        type: _.r.Video,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async batchAddVideo(e, t, i) {
                return {
                    result: await this._addVideoSegmentHelper.batchAdd(e, t, i),
                    performanceDuration: 0
                }
            }
            addVideoBySegment(e, t) {
                return this._addVideoSegmentHelper.addBySegment(e, t)
            }
            async addVideoToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
                  , i = arguments.length > 2 ? arguments[2] : void 0;
                return {
                    result: await this._addVideoSegmentHelper.addToCurrentProgress({
                        type: _.r.Video,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addUserVideo(e, t, i) {
                return {
                    result: await this._addVideoSegmentHelper.add({
                        type: _.r.UserVideo,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addUserVideoToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                return {
                    result: await this._addVideoSegmentHelper.addToCurrentProgress({
                        type: _.r.UserVideo,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addGif(e, t) {
                return {
                    result: await this._addVideoSegmentHelper.add({
                        type: _.r.Gif,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addGifToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                return {
                    result: await this._addVideoSegmentHelper.addToCurrentProgress({
                        type: _.r.Gif,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addPhoto(e, t, i) {
                return {
                    result: await this._addPhotoSegmentHelper.add({
                        type: _.r.Photo,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addPhotoToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
                  , i = arguments.length > 2 ? arguments[2] : void 0;
                return {
                    result: await this._addPhotoSegmentHelper.addToCurrentProgress({
                        type: _.r.Photo,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addUserPhoto(e, t, i) {
                return {
                    result: await this._addPhotoSegmentHelper.add({
                        type: _.r.UserPhoto,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addUserPhotoToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
                  , i = arguments.length > 2 ? arguments[2] : void 0;
                return {
                    result: await this._addPhotoSegmentHelper.addToCurrentProgress({
                        type: _.r.UserPhoto,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addAudio(e, t, i) {
                return {
                    result: await this._addAudioSegmentHelper.add({
                        type: _.r.Audio,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addAdjustemtPreset(e, t, i) {
                return {
                    result: await this._addAdjustmentPresetSegmentHelper.add({
                        type: _.r.AdjustmentPreset,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addAdjustemtPresetToCurrentProgress(e, t) {
                return {
                    result: await this._addAdjustmentPresetSegmentHelper.addToCurrentProgress({
                        type: _.r.AdjustmentPreset,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async batchAddAudio(e, t, i) {
                return {
                    result: await this._addAudioSegmentHelper.batchAdd(e, t, i),
                    performanceDuration: 0
                }
            }
            addAudioBySegment(e, t) {
                return this._addAudioSegmentHelper.addBySegment(e, t)
            }
            async addUserAudio(e, t) {
                return {
                    result: await this._addAudioSegmentHelper.add({
                        type: _.r.UserAudio,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addAudioToCurrentProgress(e, t) {
                return {
                    result: await this._addAudioSegmentHelper.addToCurrentProgress({
                        type: _.r.Audio,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addUserAudioToCurrentProgress(e) {
                return {
                    result: await this._addAudioSegmentHelper.addToCurrentProgress({
                        type: _.r.UserAudio,
                        value: e
                    }),
                    performanceDuration: 0
                }
            }
            async addSticker(e, t, i) {
                return {
                    result: await this._addStickerSegmentHelper.add({
                        type: _.r.Sticker,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addStickerToCurrentProgress(e, t) {
                return {
                    result: await this._addStickerSegmentHelper.addToCurrentProgress({
                        type: _.r.Sticker,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addFilter(e, t, i) {
                return {
                    result: await this._addFilterSegmentHelper.add({
                        type: _.r.Filter,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addFilterToCurrentProgress(e, t) {
                return {
                    result: await this._addFilterSegmentHelper.addToCurrentProgress({
                        type: _.r.Filter,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addEffect(e, t, i) {
                return {
                    result: await this._addEffectSegmentHelper.add({
                        value: e,
                        type: _.r.Effects
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addEffectToCurrentProgress(e, t) {
                return {
                    result: await this._addEffectSegmentHelper.addToCurrentProgress({
                        value: e,
                        type: _.r.Effects
                    }, t),
                    performanceDuration: 0
                }
            }
            async addText(e, t, i) {
                return {
                    result: await this._addTextSegmentHelper.add({
                        type: _.r.BasicText,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addTextPreset(e, t, i) {
                return {
                    result: await this._addTextSegmentHelper.add({
                        type: _.r.TextPreset,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addBrandTextPreset(e, t, i) {
                return {
                    result: await this._addTextSegmentHelper.add({
                        type: _.r.BrandText,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addTextToCurrentProgress(e, t) {
                return {
                    result: await this._addTextSegmentHelper.addToCurrentProgress({
                        type: _.r.BasicText,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addBrandTextToCurrentProgress(e, t) {
                return {
                    result: await this._addTextSegmentHelper.addToCurrentProgress({
                        type: _.r.BrandText,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addTextPresetToCurrentProgress(e, t) {
                return {
                    result: await this._addTextSegmentHelper.addToCurrentProgress({
                        type: _.r.TextPreset,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addTextToCurrentProgressBySegmentId(e, t, i) {
                return {
                    result: await this._addTextSegmentHelper.addToCurrentProgressBySegmentId({
                        type: _.r.BasicText,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addTextPresetToCurrentProgressBySegmentId(e, t, i) {
                return {
                    result: await this._addTextSegmentHelper.addToCurrentProgressBySegmentId({
                        type: _.r.TextPreset,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addTextTemplate(e, t, i) {
                return {
                    result: await this._addTextTemplateSegmentHelper.add({
                        type: _.r.TextTemplate,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addTextTemplateToCurrentProgress(e, t) {
                return {
                    result: await this._addTextTemplateSegmentHelper.addToCurrentProgress({
                        type: _.r.TextTemplate,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addTransition(e, t, i) {
                return {
                    result: await this._addTransitionHelper.add({
                        type: _.r.Transition,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addTransitionToCurrentProgress(e, t) {
                return {
                    result: await this._addTransitionHelper.addToCurrentProgress({
                        type: _.r.Transition,
                        value: e
                    }, t),
                    performanceDuration: 0
                }
            }
            async addTransitionToCurrentProgressBySegment(e, t, i) {
                return {
                    result: await this._addTransitionHelper.addToCurrentProgressBySegment({
                        type: _.r.Transition,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            addSubtitles(e) {
                return this._addCaptionSegmentHelper.addSubtitles(e)
            }
            addLyrics(e) {
                return this._addCaptionSegmentHelper.addLyrics(e)
            }
            async addVideoTemplate(e, t, i) {
                return {
                    result: await this._addVideoTemplateSegmentHelper.add({
                        type: _.r.VideoTemplate,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addVideoTemplateToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
                  , i = arguments.length > 2 ? arguments[2] : void 0;
                return {
                    result: await this._addVideoTemplateSegmentHelper.addToCurrentProgress({
                        type: _.r.VideoTemplate,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addDigitalHuman(e, t, i) {
                return {
                    result: await this._addDigitalHumanSegmentHelper.add({
                        type: _.r.DigitalHuman,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            async addDigitalHumanToCurrentProgress(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
                  , i = arguments.length > 2 ? arguments[2] : void 0;
                return {
                    result: await this._addDigitalHumanSegmentHelper.addToCurrentProgress({
                        type: _.r.DigitalHuman,
                        value: e
                    }, t, i),
                    performanceDuration: 0
                }
            }
            constructor(e, t, i, a, r, n, _, S, w) {
                this._dataSdk = e,
                this._ensureManager = i,
                this._preloadManager = a,
                this._selection = r,
                this._draftPathStore = n,
                this._callbackOptions = _,
                this._resourceService = S,
                this._containerService = w,
                this._addVideoSegmentHelper = new o.v(this._dataSdk,t,this._ensureManager,this._draftPathStore,this._callbackOptions,this._resourceService,this._containerService),
                this._addPhotoSegmentHelper = this._containerService.createInstance(d.y, this._dataSdk, t, this._ensureManager, this._draftPathStore, this._callbackOptions),
                this._addAudioSegmentHelper = this._containerService.createInstance(s.E, this._dataSdk, t, this._ensureManager, this._draftPathStore, this._callbackOptions),
                this._addStickerSegmentHelper = this._containerService.createInstance(l.Q, this._dataSdk, t, this._ensureManager, this._callbackOptions),
                this._addFilterSegmentHelper = this._containerService.createInstance(u.n, this._dataSdk, t, this._ensureManager, this._callbackOptions),
                this._addEffectSegmentHelper = this._containerService.createInstance(c.v, this._dataSdk, t, this._ensureManager, this._callbackOptions),
                this._addTextSegmentHelper = this._containerService.createInstance(h.D, this._dataSdk, t, this._ensureManager, this._selection, this._callbackOptions),
                this._addTextTemplateSegmentHelper = this._containerService.createInstance(p.n, this._dataSdk, t, this._ensureManager, this._callbackOptions),
                this._addTransitionHelper = this._containerService.createInstance(m.x, this._dataSdk, t, this._ensureManager, this._callbackOptions),
                this._addCaptionSegmentHelper = this._containerService.createInstance(f.U, this._dataSdk, this._callbackOptions),
                this._addVideoTemplateSegmentHelper = this._containerService.createInstance(g.z, this._dataSdk, t, this._ensureManager, this._preloadManager, this._callbackOptions),
                this._addDigitalHumanSegmentHelper = this._containerService.createInstance(v.x, this._dataSdk, t, this._ensureManager, this._callbackOptions),
                this._addAdjustmentPresetSegmentHelper = this._containerService.createInstance(y.Z, this._dataSdk, t, this._ensureManager, this._callbackOptions)
            }
        }
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IVideo ? Object : IVideo, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddVideoOptions ? Object : IAddVideoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addVideo", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [Array, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, Array]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "batchAddVideo", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IVideo ? Object : IVideo, void 0, "undefined" == typeof IAddVideoOptions ? Object : IAddVideoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addVideoToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserVideoLifecycleModel ? Object : IUserVideoLifecycleModel, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddVideoOptions ? Object : IAddVideoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addUserVideo", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserVideoLifecycleModel ? Object : IUserVideoLifecycleModel, void 0]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addUserVideoToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IGif ? Object : IGif, "undefined" == typeof PositionActionParam ? Object : PositionActionParam]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addGif", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IGif ? Object : IGif, void 0]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addGifToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IPhoto ? Object : IPhoto, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddPhotoOptions ? Object : IAddPhotoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addPhoto", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IPhoto ? Object : IPhoto, void 0, "undefined" == typeof IAddPhotoOptions ? Object : IAddPhotoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addPhotoToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserPhotoLifecycleModel ? Object : IUserPhotoLifecycleModel, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddPhotoOptions ? Object : IAddPhotoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addUserPhoto", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserPhotoLifecycleModel ? Object : IUserPhotoLifecycleModel, void 0, "undefined" == typeof IAddPhotoOptions ? Object : IAddPhotoOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addUserPhotoToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IAudio ? Object : IAudio, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddAudioOptions ? Object : IAddAudioOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addAudio", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IBrandAdjustmentPreset ? Object : IBrandAdjustmentPreset, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddAdjustmentPresetOptions ? Object : IAddAdjustmentPresetOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addAdjustemtPreset", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IBrandAdjustmentPreset ? Object : IBrandAdjustmentPreset, "undefined" == typeof IAddAdjustmentPresetOptions ? Object : IAddAdjustmentPresetOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addAdjustemtPresetToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [Array, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, Array]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "batchAddAudio", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserAudioLifecycleModel ? Object : IUserAudioLifecycleModel, "undefined" == typeof PositionActionParam ? Object : PositionActionParam]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addUserAudio", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IAudio ? Object : IAudio, "undefined" == typeof IAddAudioOptions ? Object : IAddAudioOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addAudioToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IUserAudioLifecycleModel ? Object : IUserAudioLifecycleModel]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addUserAudioToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ISticker ? Object : ISticker, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddStickerOptions ? Object : IAddStickerOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addSticker", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ISticker ? Object : ISticker, "undefined" == typeof IAddStickerOptions ? Object : IAddStickerOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addStickerToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IFilter ? Object : IFilter, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddFilterOptions ? Object : IAddFilterOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addFilter", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IFilter ? Object : IFilter, "undefined" == typeof IAddFilterOptions ? Object : IAddFilterOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addFilterToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IEffect ? Object : IEffect, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddEffectOptions ? Object : IAddEffectOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addEffect", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IEffect ? Object : IEffect, "undefined" == typeof IAddEffectOptions ? Object : IAddEffectOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addEffectToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof BasicTextSource ? Object : BasicTextSource, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addText", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextPreset ? Object : ITextPreset, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextPreset", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextPreset ? Object : ITextPreset, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addBrandTextPreset", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof BasicTextSource ? Object : BasicTextSource, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextPreset ? Object : ITextPreset, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addBrandTextToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextPreset ? Object : ITextPreset, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextPresetToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof BasicTextSource ? Object : BasicTextSource, String, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextToCurrentProgressBySegmentId", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextPreset ? Object : ITextPreset, String, "undefined" == typeof IAddTextOptions ? Object : IAddTextOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextPresetToCurrentProgressBySegmentId", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextTemplate ? Object : ITextTemplate, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddTextTemplateOptions ? Object : IAddTextTemplateOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextTemplate", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITextTemplate ? Object : ITextTemplate, "undefined" == typeof IAddTextTemplateOptions ? Object : IAddTextTemplateOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTextTemplateToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITransition ? Object : ITransition, "undefined" == typeof SegmentVideoReadonly ? Object : SegmentVideoReadonly, "undefined" == typeof IAddTransitionOptions ? Object : IAddTransitionOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTransition", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITransition ? Object : ITransition, "undefined" == typeof IAddTransitionOptions ? Object : IAddTransitionOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTransitionToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ITransition ? Object : ITransition, "undefined" == typeof SegmentVideoReadonly ? Object : SegmentVideoReadonly, "undefined" == typeof IAddTransitionOptions ? Object : IAddTransitionOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addTransitionToCurrentProgressBySegment", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IVideoTemplate ? Object : IVideoTemplate, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddVideoTemplateOptions ? Object : IAddVideoTemplateOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addVideoTemplate", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IVideoTemplate ? Object : IVideoTemplate, void 0, "undefined" == typeof IAddVideoTemplateOptions ? Object : IAddVideoTemplateOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addVideoTemplateToCurrentProgress", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IDigitalHuman ? Object : IDigitalHuman, "undefined" == typeof PositionActionParam ? Object : PositionActionParam, "undefined" == typeof IAddDigitalHumanOptions ? Object : IAddDigitalHumanOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addDigitalHuman", null),
        (0,
        a.gn)([S, (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IDigitalHuman ? Object : IDigitalHuman, Boolean, "undefined" == typeof IAddDigitalHumanOptions ? Object : IAddDigitalHumanOptions]), (0,
        a.w6)("design:returntype", Promise)], w.prototype, "addDigitalHumanToCurrentProgress", null),
        w = (0,
        a.gn)([(0,
        a.fM)(7, r.c), (0,
        a.fM)(8, n.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IDataSdk ? Object : IDataSdk, Object, "undefined" == typeof IEnsureManager ? Object : IEnsureManager, "undefined" == typeof IPreloadManager ? Object : IPreloadManager, "undefined" == typeof ISelection ? Object : ISelection, "undefined" == typeof DraftPathStore ? Object : DraftPathStore, "undefined" == typeof IAddSegmentCallbackOptions ? Object : IAddSegmentCallbackOptions, void 0 === r.c ? Object : r.c, void 0 === n.T ? Object : n.T])], w)
    },
    667212: function(e, t, i) {
        i.d(t, {
            z: function() {
                return u
            }
        });
        var a = i(789786)
          , r = i(106161)
          , n = i(511216)
          , o = i(913237)
          , s = i(774559)
          , d = i(207338)
          , l = i(947926)
          , c = i(903401);
        class u {
            async restoreDraft(e) {
                var t, i, a, r;
                let {meta: o, draftJson: d, preloadResourcePromise: l, overrideDraftId: c, overrideDraftName: u, isForceAutoMaterial: h, draftDataVersion: p, packageId: g} = e
                  , m = await l;
                if (this.draftMaterialsService.bootstrap({
                    autoMaterials: h ? [...null !== (t = null == m ? void 0 : m.userMaterialLifeCycles) && void 0 !== t ? t : [], ...null !== (i = null == m ? void 0 : m.invalidUserMaterialLifeCycles) && void 0 !== i ? i : []] : void 0,
                    materials: h ? [] : [...null !== (a = null == m ? void 0 : m.userMaterialLifeCycles) && void 0 !== a ? a : [], ...null !== (r = null == m ? void 0 : m.invalidUserMaterialLifeCycles) && void 0 !== r ? r : []]
                }),
                !d || !m)
                    throw Error("get empty package info");
                let _ = (0,
                s.V)(this._ensureManager, d, m, c, u);
                this._dataSdk.api.draft.setCanvasSize({
                    ratio: _.canvas_config.ratio,
                    containerHeight: _.canvas_config.height,
                    containerWidth: _.canvas_config.width
                }, !1, !1),
                this._dataSdk.resetDraft();
                let f = this._dataSdk.recoveryDraft(_);
                return p && this._dataSdk.updateDataVersion(p),
                g && this._mainDraftService.saveManager.setPackageId(g),
                o && this._mainDraftService.cloudMetaManager.resetMeta(o),
                (0,
                n.oW)(f)
            }
            removeDeletedMaterials() {
                let e = this.draftMaterialsService.getMaterials();
                e.userGeneratedMaterials.forEach(e => {
                    !this._comingPackageAssets.find(t => t.md5 === e.md5) && this.draftMaterialsService.removeFromUserGenerated(e.id)
                }
                ),
                e.autoGeneratedMaterials.forEach(e => {
                    !this._comingPackageAssets.find(t => t.md5 === e.md5) && this.draftMaterialsService.removeFromAutoGenerated(e.id)
                }
                )
            }
            hasQuickImport(e) {
                var t;
                return Object.values(null !== (t = e.preloadResources.materials) && void 0 !== t ? t : {}).some(e => (0,
                c.LL)(e.path))
            }
            constructor(e, t, i, a, r) {
                this._dataSdk = e,
                this._ensureManager = t,
                this._resourceService = i,
                this._mainDraftService = a,
                this.draftMaterialsService = r,
                this._comingPackageAssets = [],
                this.filterPackageAssets = e => {
                    this._comingPackageAssets = e;
                    let t = this.draftMaterialsService.getMaterials()
                      , i = [...t.autoGeneratedMaterials, ...t.userGeneratedMaterials].filter(e => this._mainDraftService.draftPathStore.getDraftPathFromResourceKey(e.key) && e.md5).map(e => e.md5);
                    return e.filter(e => !i.includes(e.md5))
                }
                ,
                this.filterOnlineResources = e => {
                    let t = {};
                    return Object.entries(e).forEach(e => {
                        let[i,a] = e
                          , r = this._resourceService.get(a.key, a.resource.type);
                        (null == r ? void 0 : r.status) !== d.n.complete && (t[i] = a)
                    }
                    ),
                    t
                }
            }
        }
        u = (0,
        a.gn)([(0,
        a.fM)(2, l.c), (0,
        a.fM)(3, r.n), (0,
        a.fM)(4, o.D), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IDataSdk ? Object : IDataSdk, "undefined" == typeof IEnsureManager ? Object : IEnsureManager, void 0 === l.c ? Object : l.c, void 0 === r.n ? Object : r.n, void 0 === o.D ? Object : o.D])], u)
    },
    29360: function(e, t, i) {
        i.d(t, {
            x: () => d
        });
        var a = i("772322")
          , r = i("195291")
          , n = i("670933")
          , o = i("218571");
        let s = (0,
        n.Pi)(e => {
            let {logs: t} = e
              , [i,r] = (0,
            o.useState)("25vh")
              , [n,s] = (0,
            o.useState)("50vh")
              , d = (0,
            o.useRef)(null)
              , l = (0,
            o.useCallback)( () => {
                "25vh" === i && r("20px"),
                "50vh" === n && s("20px")
            }
            , [i, n])
              , c = (0,
            o.useCallback)( () => {
                "20px" === i && r("25vh"),
                "20px" === n && s("50vh")
            }
            , [i, n]);
            return (0,
            o.useEffect)( () => {
                d.current.scrollTop = d.current.scrollHeight
            }
            ),
            (0,
            a.jsxs)("div", {
                className: "debugger-log-panel-container",
                onClick: c,
                style: {
                    maxHeight: i,
                    maxWidth: n
                },
                ref: d,
                children: [(0,
                a.jsx)("div", {
                    className: "debugger-log-panel-title",
                    children: "Collaboration message log"
                }), (0,
                a.jsx)("div", {
                    className: "debugger-log-panel-minimize",
                    onClick: e => {
                        e.isPropagationStopped(),
                        l()
                    }
                    ,
                    children: "20px" === i ? "\u02C5" : "^"
                }), (0,
                a.jsx)("ul", {
                    children: t.map(e => (0,
                    a.jsxs)("li", {
                        children: [(0,
                        a.jsx)("span", {
                            className: `debugger-log-panel-log-type-${e.type}`,
                            children: e.type
                        }), " ", (0,
                        a.jsx)("span", {
                            className: "debugger-log-panel-log-date",
                            children: e.date
                        }), " ", (0,
                        a.jsx)("span", {
                            className: "debugger-log-panel-log-message",
                            children: e.message
                        }), " ", (0,
                        a.jsx)("span", {
                            className: "debugger-log-panel-log-duration",
                            children: e.duration
                        })]
                    }, e.time))
                })]
            })
        }
        );
        function d(e) {
            let t = document.createElement("div");
            document.body.append(t),
            r.render((0,
            a.jsx)(s, {
                logs: e
            }), t)
        }
    },
    999898: function(e, t, i) {
        i.d(t, {
            l: () => $
        });
        var a = i("789786")
          , r = i("511216")
          , n = i("439508")
          , o = i("914886")
          , s = i("165440")
          , d = i("662320")
          , l = i("921536")
          , c = i("896951")
          , u = i("52237")
          , h = i("337181")
          , p = i("610266")
          , g = i("621476")
          , m = i("875957")
          , _ = i("913237")
          , f = i("266225")
          , v = i("659873")
          , y = i("707825")
          , S = i("120706")
          , w = i("249252")
          , b = i("463288")
          , M = i("760006")
          , k = i("134368")
          , T = i("228156")
          , I = i("722169")
          , P = i("776814")
          , F = i("939834")
          , D = i("76380")
          , A = i("292760")
          , x = i("212780")
          , C = i("317934")
          , R = i("580005")
          , E = i("79305")
          , O = i("139920")
          , j = i("134563")
          , V = i("465193")
          , U = i("40901")
          , W = i("919623")
          , L = i("272619")
          , Z = i("235001");
        class B {
            setDraftName(e) {
                this._cloudMeta.draft.name = e
            }
            setDraftId(e) {
                this._oldFileId = this._cloudMeta.draft.id,
                this._cloudMeta.draft.id = e
            }
            updateCreateTime(e) {
                this._cloudMeta.createSource.createTime = e,
                this._cloudMeta.uploadSource.createTime = e
            }
            async execute() {
                try {
                    this._updateCloudMeta();
                    let e = this._cloudMeta.draft.id
                      , t = this._workspaceService.getWorkspace(this._toWorkspaceId)
                      , i = this._workspaceService.getWorkspace(this._fromWorkspaceId)
                      , a = await this._userMaterialsService.getEvercloudInstance(this._toWorkspaceId)
                      , n = await a.copyFromSpace({
                        fromSpace: i.space_id,
                        fromIdc: i.space_idc,
                        resourceId: this._packageId,
                        resourceType: 3,
                        meta: this._cloudMeta,
                        toSpace: t.space_id,
                        toIdc: t.space_idc,
                        packageKey: e
                    })
                      , {data: o} = await n.done()
                      , {result_id: s} = o;
                    this._websocketService.sendMessage({
                        new_file_id: e,
                        new_workspace_id: this._toWorkspaceId,
                        old_file_id: this._oldFileId,
                        old_workspace_id: this._fromWorkspaceId
                    });
                    let d = (0,
                    r.oW)(s);
                    return this._onComplete.fire((0,
                    r.oW)({
                        newPackageId: s,
                        newPackageKey: e
                    })),
                    d
                } catch (t) {
                    let e = (0,
                    r.Mx)(-1, "sync draft to another space err", Error(String(t)));
                    return this._onComplete.fire(e),
                    e
                }
            }
            _updateCloudMeta() {
                this._cloudMeta.createSource.createTime = Date.now(),
                this._cloudMeta.uploadSource.createTime = Date.now(),
                this._cloudMeta.draft.updateTime = Date.now();
                let e = this._packageAssets.reduce( (e, t) => e += t.size, this._draftJson.length);
                this._cloudMeta.draft.size = e
            }
            constructor(e, t, i, a, r, n, o, s, d) {
                this._packageId = t,
                this._draftJson = i,
                this._fromWorkspaceId = a,
                this._toWorkspaceId = r,
                this._packageAssets = n,
                this._workspaceService = o,
                this._userMaterialsService = s,
                this._websocketService = d,
                this._oldFileId = "",
                this._onComplete = new L.Q,
                this.onComplete = this._onComplete.event,
                this._cloudMeta = (0,
                W.I)(e)
            }
        }
        B = (0,
        a.gn)([(0,
        a.fM)(6, U.W), (0,
        a.fM)(7, T.b), (0,
        a.fM)(8, Z.J0), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ICloudDraftMeta ? Object : ICloudDraftMeta, String, String, String, String, Array, void 0 === U.W ? Object : U.W, void 0 === T.b ? Object : T.b, void 0 === Z.J0 ? Object : Z.J0])], B);
        var N = i("821992")
          , H = i("133907")
          , z = i("688749");
        class $ extends h.l {
            get packageAssetsBuilder() {
                return this._packageAssetsBuilder
            }
            lockSave(e) {
                return (0,
                s.vu)(this._mutex, e)
            }
            refreshSizeChecker() {
                this._uploadSizeChecker.refresh(this._draftWorkspaceManager.workspaceId)
            }
            appendSaveDraftParams(e) {
                Object.assign(this._extraSaveDraftParams, e)
            }
            getPackageId() {
                return this._packageId
            }
            _setPackageId(e) {
                this._packageId = e
            }
            _canDraftSave() {
                if ("" === this._dataSdk.draftView.getDraftId() || "" === this._cloudMetaManager.getMeta().draft.id)
                    return (0,
                    r.wf)(-1, "no draftId.");
                if (this._dataSdkAborted)
                    return (0,
                    r.wf)(-1, "dataSdk aborted.");
                if ((0,
                D.Z)(this._containerService, {
                    action: "data_sdk_init",
                    duration: Date.now() - this.startSaveTimestamp
                }),
                !this._draftWorkspaceManager.workspaceId)
                    return this._shouldSaveWhenWorkspaceReady = !0,
                    (0,
                    r.wf)(-1, "no workspaceId.");
                if (this._mutex.isLocked())
                    return (0,
                    r.wf)(-1, "save locked.");
                let {userGeneratedMaterials: e, autoGeneratedMaterials: t} = this._draftMaterialsService.getMaterials();
                return (0,
                p.Po)([...e, ...t]) ? (0,
                r.wf)(0, "materials has syncing.") : t.some(e => O.di === e.filename && e.status !== v.a.Success) ? (0,
                r.wf)(0, "VideoAlgorithm json file is uploading.") : ((0,
                D.Z)(this._containerService, {
                    action: "draft_can_save_check_ok",
                    duration: Date.now() - this.startSaveTimestamp
                }),
                (0,
                r.ly)())
            }
            setOnlyCompleteOnce(e) {
                this._isOnlyCompleteOnce = e
            }
            async _generateDraftSaveTask() {
                let e = this._cloudMetaManager.getMeta()
                  , t = this.getPackageId()
                  , i = this._containerService.createInstance(V.e, e, this.getPackageId(), this._dataSdk.getDraftStr(), this._draftWorkspaceManager.workspaceId, this._packageAssetsBuilder.buildPackageAssets(), this._uploadSizeChecker, this._extraSaveDraftParams, this._consumeHasFirstFrameChanged(t));
                this._videoEnvironmentService.debugDraftSave && console.log(`[DraftSave] save task generated for ${t}`, i),
                (0,
                D.Z)(this._containerService, {
                    action: "draft_save_task_created",
                    duration: Date.now() - this.startSaveTimestamp
                });
                let[,a] = (await (0,
                c.Hp)(async e => {
                    let t = await this._draftCoverManager.getCoverTask();
                    return e.isCancellationRequested ? null : t
                }
                , 1e4)).pair();
                return a && a !== this._lastCoverTask && (i.setCoverTask(a),
                this._lastCoverTask = a),
                i.setPackageId(this.getPackageId()),
                (0,
                r.oW)(i)
            }
            async _generateSaveNewDraftTask(e) {
                this._saveState = g.Z.SAVING;
                let {workspaceId: t, name: i, defaultSaveTask: a} = e
                  , r = (0,
                o.k7)()
                  , n = a ? a.getCloudMeta() : this._cloudMetaManager.getMeta()
                  , s = a ? a.getDraftJsonWithNewDraftId(r) : this._dataSdk.getDraftStrWithNewDraftId(r)
                  , d = a ? a.getPackageAssets() : this._packageAssetsBuilder.buildPackageAssets()
                  , l = this._containerService.createInstance(N.g, n, h.J, s, t, d, this._uploadSizeChecker);
                if (l.setDraftId(r),
                l.setPackageId(h.J),
                l.setDraftName(i),
                l.updateCreateTime(Date.now()),
                !a) {
                    let e = await this._draftCoverManager.getCoverTask();
                    l.setCoverTask(e),
                    this._lastCoverTask = e
                }
                return await l.execute()
            }
            async _generateDraftMoveTask(e) {
                let {workspaceId: t, name: i, defaultSaveTask: a} = e
                  , n = this._containerService.createInstance(B, a ? a.getCloudMeta() : this._cloudMetaManager.getMeta(), this.getPackageId(), a ? a.getDraftJson() : this._dataSdk.getDraftStr(), this._draftWorkspaceManager.workspaceId, t, a ? a.getPackageAssets() : this._packageAssetsBuilder.buildPackageAssets())
                  , s = (0,
                o.k7)();
                n.setDraftName(i),
                n.setDraftId(s),
                n.updateCreateTime(Date.now());
                let d = ""
                  , l = "";
                n.onComplete(e => {
                    e.ok && ({newPackageId: d, newPackageKey: l} = e.value)
                }
                );
                let c = await n.execute();
                if (!c.ok)
                    return c;
                let u = a ? a.getDraftJsonWithNewDraftId(l) : this._dataSdk.getDraftStrWithNewDraftId(l)
                  , h = this._containerService.createInstance(V.e, a ? a.getCloudMeta() : this._cloudMetaManager.getMeta(), d, u, t, a ? a.getPackageAssets() : this._packageAssetsBuilder.buildPackageAssets(), this._uploadSizeChecker, {}, !0);
                h.setDraftName(i),
                h.setDraftId(l),
                h.updateCreateTime(Date.now());
                let p = await h.execute();
                return p.ok ? (0,
                r.oW)(l) : p
            }
            async _doSave(e) {
                try {
                    var t, i, a;
                    let n = this.getPackageId();
                    (0,
                    R.M)(this._containerService, {
                        versionStacking: Number(!!this.draftSaveTaskQueue.getCommittingTask()) + this.draftSaveTaskQueue.getWaitingQueue().length
                    });
                    let o = {};
                    if (e.getHasFirstFrameChanged()) {
                        let e = this._containerService.invokeFunction(e => e.get(H.a))
                          , t = await this._draftFirstFrameManager.getFirstFrameUrl(e.renderManager)
                          , i = null == t ? void 0 : null === (a = t.split("base64,")) || void 0 === a ? void 0 : a[1];
                        i && (o.draft_frame_content = i),
                        (0,
                        A.$)(this._containerService)
                    }
                    let s = await e.execute(o);
                    (0,
                    D.Z)(this._containerService, {
                        action: "draft_save_task_execute_done",
                        duration: Date.now() - this.startSaveTimestamp
                    });
                    let d = (null === (t = s.cause) || void 0 === t ? void 0 : t.ret) === "2010" || (null === (i = s.cause) || void 0 === i ? void 0 : i.ret) === "2013";
                    if (s.ok || d) {
                        d && (s = (0,
                        r.oW)((null == s ? void 0 : s.cause).data.package_id));
                        let[,e] = s.pair();
                        this.setPackageId(e),
                        this._videoEnvironmentService.debugDraftSave && console.log(`[DraftSave] first frame render for ${n}, current ${this.getPackageId()}, map: `, {
                            ...this._hasFirstFrameChangedMap
                        }),
                        (0,
                        D.Z)(this._containerService, {
                            action: "draft_save_finish",
                            duration: Date.now() - this.startSaveTimestamp
                        }),
                        this._extraSaveDraftParams = {}
                    }
                    return s
                } catch (t) {
                    let e = `doSave: ${(null == t ? void 0 : t.message) || "unknown error"}`;
                    return (0,
                    r.wf)(-1, e)
                }
            }
            async _doSaveAsNew(e) {
                let {workspaceId: t} = e;
                return t === this._draftWorkspaceManager.workspaceId ? await this._generateSaveNewDraftTask(e) : await this._generateDraftMoveTask(e)
            }
            _consumeHasFirstFrameChanged(e) {
                let t = this._hasFirstFrameChangedMap.get(e);
                return this._hasFirstFrameChangedMap.remove(e),
                null != t && t
            }
            _sendRenderFirstFrameRequest(e) {
                let t = this._dataSdk.draftView.getCanvasConfig();
                this._firstFrameDataService.renderFirstFrame({
                    draftId: this._dataSdk.draftView.getDraftId(),
                    workspaceId: this._draftWorkspaceManager.workspaceId,
                    packageId: this.getPackageId(),
                    frameChange: e,
                    draftInfo: {
                        canvasConfig: {
                            width: t.width,
                            height: t.height,
                            ratio: function(e) {
                                switch (e) {
                                case f.rxY.CanvasRatioOriginal:
                                    return 0;
                                case f.rxY.CanvasRatio16To9:
                                    return 2;
                                case f.rxY.CanvasRatio9To16:
                                    return 3;
                                case f.rxY.CanvasRatio4To3:
                                    return 4;
                                case f.rxY.CanvasRatio3To4:
                                    return 5;
                                case f.rxY.CanvasRatio1To1:
                                    return 6;
                                case f.rxY.CanvasRatio2To1:
                                    return 7;
                                case f.rxY.CanvasRatio2_35To1:
                                    return 8;
                                case f.rxY.CanvasRatio1_85To1:
                                    return 9;
                                case f.rxY.CanvasRatio1_125To2_436:
                                    return 10;
                                case f.rxY.CanvasRatioCustom:
                                    return 1;
                                default:
                                    return 0
                                }
                            }(t.ratio)
                        },
                        duration: Math.floor(P.h.usToMs(this._dataSdk.draftView.getDuration()))
                    }
                }),
                e && (0,
                A.$)(this._containerService)
            }
            _checkNeedRetry(e) {
                var t, i, a;
                return (null === (t = e.cause) || void 0 === t ? void 0 : t.code) === "ERR_NETWORK" || (null === (i = e.cause) || void 0 === i ? void 0 : i.code) === "ECONNABORTED" || (null === (a = e.cause) || void 0 === a ? void 0 : a.ret) === "2001" || e.code === n.pY.TimedOut
            }
            _prepare() {
                this._saveState === g.Z.IDLE || this._saveState === g.Z.SUCCESS ? this._saveState = g.Z.PREPARE : this._saveState === g.Z.SAVING && (this._needSaveAgain = !0)
            }
            _addEventListener() {
                this._register(this._dataSdk.onChangeDiff(e => {
                    if (this._videoEnvironmentService.debugDraftSave && console.log(`[DraftSave] diff change for ${this.getPackageId()}`),
                    e.actionOperateType !== f.aWQ.History && (void 0 === e.commit || !!e.commit) && (0 !== e[f.u4I.TRACK].length || 0 !== e[f.u4I.SEGMENT].length || 0 !== e[f.u4I.CONFIG].length))
                        this._prepare(),
                        this._saveDraftDebounce()
                }
                )),
                this._register(this._dataSdk.onAbort( () => {
                    this._dataSdkAborted = !0
                }
                )),
                this._register(this._dataSdk.onChangeFirstFrame( () => {
                    let e = this.getPackageId();
                    this._videoEnvironmentService.debugDraftSave && console.log(`[DraftSave] first frame change fired for ${e}`),
                    this._hasFirstFrameChangedMap.put(e, !0)
                }
                )),
                this._draftMaterialsService.onDidMaterialAdd( () => {
                    if (!!this._draftMaterialsService.isReady)
                        (0,
                        D.Z)(this._containerService, {
                            action: "save_by_material_add",
                            duration: 0
                        }),
                        this._prepare(),
                        this._saveDraftDebounce()
                }
                ),
                this._draftMaterialsService.onDidMaterialRemove( () => {
                    if (!!this._draftMaterialsService.isReady)
                        (0,
                        D.Z)(this._containerService, {
                            action: "save_by_material_remove",
                            duration: 0
                        }),
                        this._prepare(),
                        this._saveDraftDebounce()
                }
                ),
                this._draftMaterialsService.onDidMaterialReplace( () => {
                    if (!!this._draftMaterialsService.isReady)
                        (0,
                        D.Z)(this._containerService, {
                            action: "save_by_material_remove",
                            duration: 0
                        }),
                        this._prepare(),
                        this._saveDraftDebounce()
                }
                ),
                this._draftMaterialsService.onMaterialAllDoneChange(e => {
                    e && ((0,
                    D.Z)(this._containerService, {
                        action: "save_by_material_all_done",
                        duration: 0
                    }),
                    this._prepare(),
                    this._saveDraftDebounce())
                }
                ),
                !this._draftWorkspaceManager.workspaceId && this._register((0,
                u.V)(this._draftWorkspaceManager.onDidWorkspaceChange)( () => {
                    this._shouldSaveWhenWorkspaceReady && ((0,
                    D.Z)(this._containerService, {
                        action: "save_by_workspace_change",
                        duration: 0
                    }),
                    this._prepare(),
                    this._saveDraftDebounce())
                }
                )),
                this._register((0,
                F.n)(i.g, "online", () => {
                    this._isOnline = !0,
                    this._needUploadWhenOnline && (this._needUploadWhenOnline = !1,
                    (0,
                    D.Z)(this._containerService, {
                        action: "save_by_network_change",
                        duration: 0
                    }),
                    this._prepare(),
                    this._saveDraftDebounce())
                }
                )),
                this._register((0,
                F.n)(i.g, "offline", () => {
                    this._isOnline = !1
                }
                ))
            }
            async _getDrawFirstFrameLibra() {
                let e = this._configService.abTestManager.getBooleanAbTestValue("enable_draw_frame_from_fe")
                  , t = await this._teaAdapterService.getABTestVar("enable_draw_frame_from_fe", !1);
                this._enableDrawFrameFromFe = null != e ? e : t
            }
            constructor(e, t, i, a, r, n, o, s, c, u, p, g, _, f, v, y, S) {
                super(u),
                this._dataSdk = e,
                this._cloudMetaManager = t,
                this._draftCoverManager = i,
                this._referenceCountManager = a,
                this._draftPathStore = r,
                this._draftFirstFrameManager = n,
                this._draftWorkspaceManager = o,
                this.draftSaveService = s,
                this._containerService = c,
                this._draftMaterialsService = p,
                this._firstFrameDataService = g,
                this._userMaterialsService = _,
                this._videoEnvironmentService = f,
                this._loggerService = v,
                this._teaAdapterService = y,
                this._configService = S,
                this._isOnline = !0,
                this._packageId = h.J,
                this._isOnlyCompleteOnce = !1,
                this._enableDrawFrameFromFe = void 0,
                this._mutex = new d.L,
                this._needUploadWhenOnline = !1,
                this._extraSaveDraftParams = {},
                this._dataSdkAborted = !1,
                this._hasFirstFrameChangedMap = new l.z(20),
                this._logger = this._loggerService.createLogger("draft-save"),
                this._shouldSaveWhenWorkspaceReady = !1,
                this._saveDraftDebounce = (0,
                I.debounce)( () => {
                    if (this._dataSdkAborted) {
                        this._logger.info("cant save because of dataSdkAborted.");
                        return
                    }
                    !this._isOnline && (this._needUploadWhenOnline = !0);
                    let e = (0,
                    x.kK)(this._containerService, "auto");
                    this._videoEnvironmentService.debugDraftSave && console.log(`[DraftSave] generate save task for current ${this.getPackageId()}, map: `, {
                        ...this._hasFirstFrameChangedMap
                    }),
                    this.generateSaveTask().then(t => {
                        if (t.ok) {
                            t.value.onComplete(t => {
                                var i;
                                (null === (i = t.cause) || void 0 === i ? void 0 : i.ret) !== E.K.ERR_DRAFT_NOT_COMPLETE && e(t)
                            }
                            );
                            return
                        }
                        e(t)
                    }
                    )
                }
                , this._nextSaveTimeout),
                this._packageAssetsBuilder = this._containerService.createInstance(j.r, this._draftPathStore, this._referenceCountManager, this._dataSdk),
                this._uploadSizeChecker = new m.A({
                    userMaterialsService: this._userMaterialsService
                }),
                this._addEventListener()
            }
        }
        $ = (0,
        a.gn)([(0,
        a.fM)(7, y._), (0,
        a.fM)(8, S.T), (0,
        a.fM)(9, k.H), (0,
        a.fM)(10, _.D), (0,
        a.fM)(11, w.G), (0,
        a.fM)(12, T.b), (0,
        a.fM)(13, C.rO), (0,
        a.fM)(14, z.VZ), (0,
        a.fM)(15, M.w), (0,
        a.fM)(16, b.Ui), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IDataSdk ? Object : IDataSdk, "undefined" == typeof CloudMetaManager ? Object : CloudMetaManager, "undefined" == typeof DraftCoverManager ? Object : DraftCoverManager, "undefined" == typeof IReferenceCountManager ? Object : IReferenceCountManager, "undefined" == typeof DraftPathStore ? Object : DraftPathStore, "undefined" == typeof DraftFirstFrameManager ? Object : DraftFirstFrameManager, "undefined" == typeof DraftWorkspaceManager ? Object : DraftWorkspaceManager, void 0 === y._ ? Object : y._, void 0 === S.T ? Object : S.T, void 0 === k.H ? Object : k.H, void 0 === _.D ? Object : _.D, void 0 === w.G ? Object : w.G, void 0 === T.b ? Object : T.b, void 0 === C.rO ? Object : C.rO, void 0 === z.VZ ? Object : z.VZ, void 0 === M.w ? Object : M.w, void 0 === b.Ui ? Object : b.Ui])], $)
    },
    638537: function(e, t, i) {
        i.d(t, {
            gq: function() {
                return u
            }
        });
        var a = i(13860)
          , r = i(435290)
          , n = i(511216)
          , o = i(266225)
          , s = i(40901)
          , d = i(42680);
        let l = r.ED ? 1024 : 1e3
          , c = l * l * l
          , u = async (e, t, i, r) => {
            if (e.invokeFunction(e => {
                let t = e.get(s.W);
                if (!t.workspaceExpandInfoMap)
                    return !1;
                let i = t.workspaceExpandInfoMap[r];
                return !!i && i.isAutoSubscribe
            }
            ))
                return (0,
                n.ly)();
            let o = await i.getSize(r);
            return o.ok && o.value <= 0 && t > 20 * c ? (0,
            n.wf)(a.D3.INSUFFICIENT_SPACE, "INSUFFICIENT_SPACE error") : (0,
            n.ly)()
        }
        ;
        o.cVg.MetaTypePhoto,
        d._g.Photo,
        o.cVg.MetaTypeVideo,
        d._g.Video,
        o.cVg.MetaTypeSticker,
        d._g.Sticker,
        o.cVg.MetaTypeFilter,
        d._g.Filter,
        o.cVg.MetaTypeMusic,
        d._g.Audio,
        o.cVg.MetaTypeTransition,
        d._g.Transition,
        o.cVg.MetaTypeGif,
        d._g.Gif,
        o.cVg.MetaTypeVideoMask,
        d._g.Mask,
        o.cVg.MetaTypeCanvasImage,
        d._g.VideoBackground,
        o.cVg.MetaTypeFont,
        d._g.Font,
        o.cVg.MetaTypeVideoEffect,
        d._g.Effects,
        o.cVg.MetaTypeTextEffect,
        d._g.TextPreset,
        o.cVg.MetaTypeAudioEffect,
        d._g.VoiceChange,
        o.cVg.MetaTypeVideoMix,
        d._g.Mix,
        o.cVg.MetaTypeFaceEffect,
        d._g.FaceProp,
        o.cVg.MetaTypeText,
        d._g.TextPreset,
        o.cVg.MetaTypeTextTemplate,
        d._g.TextTemplate,
        o.cVg.MetaTypeTextToAudio,
        d._g.UserFile,
        o.cVg.MetaTypeDigitalHuman,
        d._g.DigitalHuman,
        o.cVg.MetaTypeSound,
        d._g.Audio,
        o.cVg.MetaTypeCombination,
        d._g.VideoTemplate
    },
    342133: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return r
            },
            t: function() {
                return n
            }
        });
        var a, r = ((a = {})[a.Init = 0] = "Init",
        a[a.Replace = 1] = "Replace",
        a);
        let n = (e, t) => {
            let {dataSdk: {api: i, draftView: a}} = e;
            i.template.setTemplateMute(a, 1 === t)
        }
    },
    441079: function(e, t, i) {
        i.d(t, {
            b: function() {
                return o
            }
        });
        var a = i(408281);
        let r = "click_cloud_entrance";
        class n {
            getEventParams() {
                return this._params
            }
            constructor(e) {
                this._params = e,
                this.eventName = r
            }
        }
        function o(e, t, i) {
            r === i && (0,
            a.K)(e, n, [t])
        }
    },
    90362: function(e, t, i) {
        i.d(t, {
            Hs: function() {
                return o
            },
            zW: function() {
                return s
            }
        });
        var a = i(863915);
        let r = a.Hs
          , n = a.zW;
        function o() {
            for (var e = arguments.length, t = Array(e), i = 0; i < e; i++)
                t[i] = arguments[i];
            r(...t)
        }
        function s() {
            for (var e = arguments.length, t = Array(e), i = 0; i < e; i++)
                t[i] = arguments[i];
            n(...t)
        }
    },
    160756: function(e, t, i) {
        i.d(t, {
            c: function() {
                return l
            }
        });
        var a = i(789786)
          , r = i(408281)
          , n = i(106161);
        class o {
            getEventParams() {
                var e, t;
                let i = null !== (t = this._mainDraftService.dataSdk.cutSame.getMutableVideos()) && void 0 !== t ? t : []
                  , a = (null == i ? void 0 : i.length) || 0
                  , r = (null == i ? void 0 : null === (e = i.filter(e => null == e ? void 0 : e.filled)) || void 0 === e ? void 0 : e.length) || 0;
                return {
                    fragment_cnt: a,
                    filled_fragment_cnt: r,
                    is_all_filled: (null == i ? void 0 : i.every(e => null == e ? void 0 : e.filled)) ? 1 : 0
                }
            }
            constructor(e) {
                this._mainDraftService = e,
                this.eventName = "edit_page_close"
            }
        }
        o = (0,
        a.gn)([(0,
        a.fM)(0, n.n), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === n.n ? Object : n.n])], o);
        let s = e => {
            (0,
            r.K)(e, o)
        }
          , d = null
          , l = e => {
            if (d)
                return d;
            let t = () => {
                s(e)
            }
            ;
            return window.addEventListener("beforeunload", t),
            d = () => {
                window.removeEventListener("beforeunload", t)
            }
        }
    },
    160936: function(e, t, i) {
        i.d(t, {
            P: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                return {
                    popup_type: "script_input_popup",
                    popup_from: "button",
                    ...this._params
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "ai_writer_popup"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    104150: function(e, t, i) {
        i.d(t, {
            m: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                return {
                    prompt_source: "input",
                    ...this._params
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "text_to_video_script_load_status"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    230088: function(e, t, i) {
        i.d(t, {
            n: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                return {
                    status: "success"
                }
            }
            constructor() {
                this.eventName = "pwa_install_status"
            }
        }
        function n(e) {
            (0,
            a.K)(e, r, [])
        }
    },
    943377: function(e, t, i) {
        i.d(t, {
            M: function() {
                return s
            },
            o: function() {
                return n
            }
        });
        var a = i(408281)
          , r = i(266225);
        let n = {
            [r.Ocy.SegmentFilter]: "filter",
            [r.Ocy.SegmentText]: "text_template",
            [r.Ocy.SegmentAudio]: "audio",
            [r.Ocy.SegmentSticker]: "sticker",
            [r.Ocy.SegmentPictureAdjust]: "picture_adjust",
            [r.Ocy.SegmentImageSticker]: "image_sticker",
            [r.Ocy.SegmentHandwrite]: "hand_write",
            [r.Ocy.SegmentTailLeader]: "tail_leader",
            [r.Ocy.SegmentVideo]: "video",
            [r.Ocy.SegmentVideoEffect]: "effect",
            [r.Ocy.SegmentTextTemplate]: "text_template",
            [r.Ocy.SegmentComposition]: "composition",
            [r.Ocy.SegmentAdcube]: "adcube",
            [r.Ocy.SegmentPluginEffect]: "plugin_effect",
            [r.Ocy.SegmentShape]: "shape"
        };
        class o {
            getEventParams() {
                let {action: e, vipMaterial: t, vipFunction: i} = this._params;
                return {
                    action: e,
                    vip_material: t,
                    vip_function: i
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "vip_toast"
            }
        }
        function s(e, t) {
            (0,
            a.K)(e, o, [t])
        }
    },
    786488: function(e, t, i) {
        i.d(t, {
            SC: function() {
                return s
            },
            rK: function() {
                return o
            },
            vV: function() {
                return l
            }
        });
        var a, r, n = i(408281);
        var o = ((a = {}).Success = "success",
        a.Failed = "fail",
        a.Cancel = "cancel",
        a);
        var s = ((r = {}).Cancel = "cancel",
        r.ServiceError = "server_error",
        r.NetworkError = "network_error",
        r.NoSubject = "no_object",
        r.Timeout = "timeout",
        r);
        class d {
            getEventParams() {
                var e;
                return {
                    material_type: null !== (e = this._params.materialType) && void 0 !== e ? e : "image",
                    material_format: this._params.materialFormat,
                    material_resolution: this._params.materialResolution,
                    crop_resolution: this._params.cropResolution,
                    time: this._params.time,
                    status: this._params.status,
                    fail_reason: this._params.failReason
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "smart_crop_status"
            }
        }
        function l(e, t) {
            (0,
            n.K)(e, d, [t])
        }
    },
    780661: function(e, t, i) {
        i.d(t, {
            O: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                let {actionType: e, aspectRatio: t, buttonStatus: i, colorCode: a, isCommercial: r, isVip: n, keywordSource: o, materialCategory: s, materialChannel: d, materialDuration: l, materialForthcategory: c="none", materialForthcategoryId: u="none", materialId: h, materialName: p, materialSubcategory: g="none", materialSubcategoryId: m="none", materialThirdcategory: _="none", materialThirdcategoryId: f="none", optionType: v, rank: y, scene: S, searchId: w, requestId: b, recommendId: M, searchKeyword: k, stickerCategory: T, wordPosition: I, searchTabName: P, searchStartTabName: F, materialGroupcategory: D, category: A, displayMode: x, keywordRegion: C, isSearchWordPreset: R, isSearchTemplatePreset: E, isPreset: O, space_id: j, space_type: V, space_user_cnt: U} = this._params;
                return {
                    category: A,
                    action_type: e,
                    aspect_ratio: t,
                    button_status: i,
                    color_code: a,
                    is_commercial: r ? "true" : "false",
                    is_vip: n ? 1 : 0,
                    keyword_source: o || void 0,
                    material_category: s,
                    material_channel: d,
                    material_duration: l ? Math.floor(l) : void 0,
                    material_forthcategory: c,
                    material_forthcategory_id: u,
                    material_id: h,
                    material_name: p,
                    material_subcategory: g,
                    material_subcategory_id: m,
                    material_thirdcategory: _,
                    material_thirdcategory_id: f,
                    option_type: v,
                    rank: y,
                    scene: S,
                    request_id: b,
                    search_id: w,
                    rec_id: M,
                    search_keyword: k || void 0,
                    sticker_category: T,
                    word_position: I || void 0,
                    search_tab_name: P,
                    search_start_tab_name: F,
                    material_groupcategory: D,
                    display_mode: x,
                    keyword_region: C,
                    search_word_preset: R ? "1" : "0",
                    search_template_preset: E ? "1" : "0",
                    is_preset: O,
                    space_id: j,
                    space_type: V,
                    space_user_cnt: U
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "click_material_item"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    325916: function(e, t, i) {
        i.d(t, {
            n: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                return {
                    option: this._params.show ? "on" : "off",
                    action_type: this._params.actionType
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "sidebar_option"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    803654: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                return {
                    intelligent_cost_time: this._params.costTime,
                    intelligent_error_msg: this._params.errorMsg,
                    intelligent_log_id: this._params.logId,
                    intelligent_stage: this._params.stage,
                    intelligent_type: this._params.type,
                    intelligent_value: this._params.value
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "web_template_intelligent_process"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    391632: function(e, t, i) {
        i.d(t, {
            o: function() {
                return s
            }
        });
        var a = i(789786)
          , r = i(106161)
          , n = i(408281);
        class o {
            getEventParams() {
                return {
                    draft_id: this._mainDraftService.dataSdk.draftView.getDraftId(),
                    current_page: this._params.current_page,
                    track_category: this._params.track_category,
                    is_soundtrack: this._params.is_soundtrack
                }
            }
            constructor(e, t) {
                this._params = e,
                this._mainDraftService = t,
                this.eventName = "click_audio_soundtrack_ban"
            }
        }
        function s(e, t) {
            (0,
            n.K)(e, o, [t])
        }
        o = (0,
        a.gn)([(0,
        a.fM)(1, r.n), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IParams ? Object : IParams, void 0 === r.n ? Object : r.n])], o)
    },
    350571: function(e, t, i) {
        i.d(t, {
            E: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                let {fail_reason: e, logid: t} = this._params;
                return {
                    fail_reason: e,
                    logid: t
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "template_publish_material_add"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    895408: function(e, t, i) {
        i.d(t, {
            d: function() {
                return r
            }
        });
        var a = i(801497);
        let r = {
            get in() {
                return a.ZP.t("in_web", {}, "\u5165\u573A")
            },
            get out() {
                return a.ZP.t("out_web", {}, "\u51FA\u573A")
            },
            get group() {
                return a.ZP.t("combo_web", {}, "\u7EC4\u5408")
            }
        }
    },
    529814: function(e, t, i) {
        i.d(t, {
            x: function() {
                return s
            }
        });
        var a = i(789786)
          , r = i(408281)
          , n = i(106161);
        class o {
            getEventParams() {
                return {
                    material_category: this._params.materialCategory,
                    material_format: this._params.materialFormat,
                    material_duration: this._params.materialDuration,
                    material_resolution: this._params.materialResolution,
                    material_size: this._params.materialSize,
                    material_name: this._params.materialName,
                    duration: this._params.duration,
                    status: this._params.status,
                    error_code: this._params.errorCode,
                    function_name: this._params.functionName
                }
            }
            constructor(e, t) {
                this._params = e,
                this._mainDraftService = t,
                this.eventName = "function_status"
            }
        }
        function s(e, t) {
            (0,
            r.K)(e, o, [t])
        }
        o = (0,
        a.gn)([(0,
        a.fM)(1, n.n), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IParams ? Object : IParams, void 0 === n.n ? Object : n.n])], o)
    },
    636267: function(e, t, i) {
        i.d(t, {
            x: function() {
                return u
            }
        });
        var a = i(789786)
          , r = i(66629)
          , n = i(408281)
          , o = i(40901)
          , s = i(510973)
          , d = i(392554)
          , l = i(378899);
        class c {
            getEventParams() {
                var e;
                let {searchParams: t} = new URL(window.location.href);
                return {
                    ...this._params,
                    uploader_type: this._userMaterialUploadService.uploaderType,
                    tool_type: null !== (e = t.get("__tool_type")) && void 0 !== e ? e : void 0,
                    is_login: this._accountService.hasLogin ? 1 : 0
                }
            }
            constructor(e, t, i, a) {
                this._params = e,
                this._accountService = t,
                this._workspaceService = i,
                this._userMaterialUploadService = a,
                this.eventName = "import_material_result"
            }
        }
        function u(e, t, i) {
            var a, o, d;
            let l = {
                ...i,
                material_duration: t.fileType === s.YB.Video || t.fileType === s.YB.Audio ? Math.round((null !== (a = t.duration) && void 0 !== a ? a : 0) * 1e3) : void 0,
                material_resolution: (t.fileType === s.YB.Video || t.fileType === s.YB.Image) && t.width && t.height ? `${null !== (o = t.width) && void 0 !== o ? o : 0} * ${null !== (d = t.height) && void 0 !== d ? d : 0}` : "",
                ...(0,
                r.U)(t)
            };
            (0,
            n.K)(e, c, [l])
        }
        c = (0,
        a.gn)([(0,
        a.fM)(1, d.D), (0,
        a.fM)(2, o.W), (0,
        a.fM)(3, l.ec), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ImportMaterialPrams ? Object : ImportMaterialPrams, void 0 === d.D ? Object : d.D, void 0 === o.W ? Object : o.W, void 0 === l.ec ? Object : l.ec])], c)
    },
    408281: function(e, t, i) {
        i.d(t, {
            K: function() {
                return r
            },
            z: function() {
                return n
            }
        });
        var a = i(745642);
        function r(e, t) {
            let i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : []
              , r = arguments.length > 3 ? arguments[3] : void 0;
            (0,
            a.K)(e, t, i, r)
        }
        function n(e, t) {
            let i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : []
              , r = arguments.length > 3 ? arguments[3] : void 0;
            (0,
            a.z)(e, t, i, r)
        }
    },
    531435: function(e, t, i) {
        i.d(t, {
            k: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                let {ucEnterFrom: e, action: t} = this._params;
                return {
                    uc_enter_from: e,
                    action: t
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "uc_bind_guide_click"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    212780: function(e, t, i) {
        i.d(t, {
            kK: function() {
                return o
            }
        });
        var a = i(52533)
          , r = i(340107)
          , n = i(352432);
        function o(e, t) {
            let {onSaveDraftSuccess: i, onSaveDraftFail: o} = (0,
            n.n)(e, t);
            return n => {
                let s;
                if (n.ok) {
                    let e = (0,
                    a.Z)(n.value) ? void 0 : n.value;
                    i(e),
                    s = {
                        saveStatus: "success",
                        packageId: e
                    }
                } else
                    o(n.msg),
                    s = {
                        saveStatus: "failed",
                        failReason: n.msg
                    };
                "auto" === t && (0,
                r.L)(e, s)
            }
        }
    },
    969667: function(e, t, i) {
        i.d(t, {
            c: function() {
                return n
            }
        });
        var a = i(408281);
        class r {
            getEventParams() {
                return {
                    ...this._params,
                    decrypt_key: this._params.decryptKey,
                    resource_path: this._params.resourcePath
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "ve_get_media_info"
            }
        }
        function n(e, t) {
            (0,
            a.K)(e, r, [t])
        }
    },
    887086: function(e, t, i) {
        i.d(t, {
            _J: function() {
                return o
            },
            kw: function() {
                return s
            },
            nV: function() {
                return l
            }
        });
        var a, r, n = i(408281);
        var o = ((a = {}).Unknown = "unknown",
        a.WebGLContextLost = "webgl_context_lost",
        a);
        var s = ((r = {}).Display = "render_error_modal_display",
        r.ReloadClick = "render_error_modal_reload_click",
        r);
        class d {
            getEventParams() {
                return {
                    ...this._params
                }
            }
            constructor(e) {
                this._params = e,
                this.eventName = "render_layer_error"
            }
        }
        function l(e, t) {
            (0,
            n.K)(e, d, [t])
        }
    },
    954609: function(e, t, i) {
        i.d(t, {
            J7: function() {
                return y
            },
            oI: function() {
                return m
            },
            zo: function() {
                return v
            }
        });
        var a = i(789786)
          , r = i(112033)
          , n = i(317934)
          , o = i(133907)
          , s = i(106161)
          , d = i(413820)
          , l = i(528817)
          , c = i(882566)
          , u = i(408281)
          , h = i(129851);
        function p(e, t) {
            let {msgOrigin: i, stack: a="", threadIdOrigin: r, threadStack: n} = e
              , {appVersion: o, veBuildId: s, veFullBuildVersion: d, isSIMD: l} = null != t ? t : {}
              , c = `${d}${l ? "_simd" : ""}`
              , u = null != i ? i : ""
              , h = r;
            if (/wasm-function\[\d*\]/gim.test(a))
                u = a.replace(/\n.*?(?:(\d*?:\d*?)\)|wasm-function\[(\d*)\]:0x[0-9a-z]+\)?)/gim, function() {
                    for (var e, t = arguments.length, i = Array(t), a = 0; a < t; a++)
                        i[a] = arguments[a];
                    return `,${null !== (e = i[1]) && void 0 !== e ? e : i[2]}`
                });
            else if (u) {
                let e = u.match(/(pthread sent an error!.*?: Uncaught Error: )(\d+): (.*$)/);
                if (e) {
                    let[,t,i] = e;
                    h = Number(i),
                    u = t
                }
            }
            let p = `[${c}] ${u}`;
            return {
                msg: u,
                unionMsg: p,
                stack: a,
                threadId: h,
                threadStack: n,
                appVersion: o,
                veVersion: s,
                videoEditorScmVersion: c,
                buildCommitId: "",
                buildTime: ""
            }
        }
        class g {
            getEventParams() {
                let {msg: e, unionMsg: t, appVersion: i, veVersion: a, videoEditorScmVersion: r=""} = p(this._params, this._videoEnvironmentService)
                  , n = r.split(".", 4).map(e => (0,
                l.hk)(e));
                return {
                    error_msg: e,
                    union_error_msg: t,
                    app_version: i,
                    ve_version: a,
                    videoeditor_scm_version: r,
                    videoeditor_scm_version_v1: n[0],
                    videoeditor_scm_version_v2: n[1],
                    videoeditor_scm_version_v3: n[2],
                    videoeditor_scm_version_v4: n[3],
                    url: location.href
                }
            }
            constructor(e, t) {
                this._params = e,
                this._videoEnvironmentService = t,
                this.eventName = "ve_on_crash_emit"
            }
        }
        function m(e, t) {
            (0,
            u.K)(e, g, [t])
        }
        g = (0,
        a.gn)([(0,
        a.fM)(1, n.rO), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IVeCrashCbParams ? Object : IVeCrashCbParams, void 0 === n.rO ? Object : n.rO])], g);
        class _ {
            _getDumpLog() {
                return this._mainEditorWidgetService.renderManager.dumpLogInfo()
            }
            _getCrashMsg(e) {
                let t = this._getDumpLog()
                  , i = e;
                if (/pthread sent an error!.*?: Uncaught Error: /.test(i)) {
                    let e = t.match(/\[Exception throw\](.|\n)*?(?:!@#\$|$)/gi);
                    null !== e && (i += e[e.length - 1].replace("!@#$", "").replace(/\n.*?(?:(\d*?:\d*?)\)|wasm-function\[(\d*)\]:0x[0-9a-z]+\)?)/gim, function() {
                        for (var e, t = arguments.length, i = Array(t), a = 0; a < t; a++)
                            i[a] = arguments[a];
                        return `,${null !== (e = i[1]) && void 0 !== e ? e : i[2]}`
                    }))
                }
                return i
            }
            _getCrashInfo() {
                return p(this._params, this._videoEnvironmentService)
            }
            getEventParams() {
                let {msg: e=""} = this._getCrashInfo();
                return {
                    error_msg: this._getCrashMsg(e)
                }
            }
            getLogContent() {
                let {threadId: e="", stack: t="", threadStack: i=""} = this._getCrashInfo()
                  , a = "";
                try {
                    a += JSON.stringify(t)
                } catch (e) {
                    a += t.toString()
                }
                let r = this._getDumpLog();
                return {
                    prefixContent: this._prefixContent,
                    threadId: e,
                    crashStack: a,
                    threadStack: i,
                    dumpLog: r
                }
            }
            getLogContextParams() {
                let {msg: e=""} = this._getCrashInfo()
                  , t = this._getCrashMsg(e)
                  , i = this._mainDraftService.dataSdk.getDraftStr();
                return {
                    ...(0,
                    r.Z)(this._mainDraftService, this._videoEnvironmentService),
                    log_name: this.eventName,
                    ...this._extra,
                    template: i,
                    crashMsg: t
                }
            }
            constructor(e, t, i, a, r, n) {
                this._prefixContent = e,
                this._extra = t,
                this._params = i,
                this._videoEnvironmentService = a,
                this._mainEditorWidgetService = r,
                this._mainDraftService = n,
                this.eventName = "VE_CRASH_LOG"
            }
        }
        _ = (0,
        a.gn)([(0,
        a.fM)(3, n.rO), (0,
        a.fM)(4, o.a), (0,
        a.fM)(5, s.n), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [String, "undefined" == typeof Record ? Object : Record, "undefined" == typeof IVeCrashCbParams ? Object : IVeCrashCbParams, void 0 === n.rO ? Object : n.rO, void 0 === o.a ? Object : o.a, void 0 === s.n ? Object : s.n])], _);
        class f extends _ {
            constructor(...e) {
                super(...e),
                this.eventName = "ve_on_crash_emit"
            }
        }
        function v(e, t) {
            let i = e.createInstance(new d.M(f,["", {}, t]));
            e.invokeFunction(async e => {
                let t = e.get(c.m);
                t.reportDevEvent(i.eventName, i.getEventParams());
                let a = JSON.stringify(i.getLogContent())
                  , r = await h.B.saveLog(a);
                r && t.reportDevEvent(`${i.eventName}_log`, {
                    key: r
                })
            }
            )
        }
        function y(e, t) {
            let {msgOrigin: i, threadIdOrigin: a, threadStack: r} = t;
            e.invokeFunction(e => {
                let t = e.get(c.m)
                  , n = `${i}|${a}|${r}`
                  , o = Error(`[data_layer] - ve_error (${n});`);
                t.reportDevError("data_layer", o, {
                    level: "error",
                    label: "data_layer",
                    reason: n,
                    describe: "ve_error"
                })
            }
            )
        }
    },
    373281: function(e, t, i) {
        i.d(t, {
            Z: function() {
                return r
            }
        });
        var a = i(317934);
        let r = class e {
            initAndExposeAbTest() {
                this._teaAdapterService.getABTestVar("enable_simd_optimization", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("enable_matting_optimization", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("enable_use_freid_v2", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("enable_preload_chunk", !1),
                this._teaAdapterService.getABTestVar("matting_thread_num", 0),
                this._teaAdapterService.getABTestVar("skeleton_thread_num", 0),
                this._teaAdapterService.getABTestVar("enable_et_data_capturing", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("ve_enable_stream_fetch_api", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("ve_enable_audio_worklet", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("skeleton_model_size_type", 0),
                this._teaAdapterService.getABTestVar("enable_facefitting_optimization", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("ve_enable_refresh_opt", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("ve_opt_render_handle_preload", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("ve_enable_swing_effect_algorithm_preload", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("enable_bach_algorithm_preload", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("enable_segment_xshader_reuse", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("enable_video_segment_lazy_load_tween_system", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("lua_gc_throttle_wait_time", 0),
                this._teaAdapterService.getABTestVar("enable_png_decode_simg_opt", !1),
                this._teaAdapterService.getABTestVar("enable_new_engine_transition", !1),
                this._teaAdapterService.getABTestVar("enable_delay_thread_optimization", {
                    enable: !1
                }),
                this._teaAdapterService.getABTestVar("veabtest_enable_switch_sticker", !1),
                this._teaAdapterService.getABTestVar("stickers_enableHotWords", !1).then(e => {
                    window.localStorage.setItem("stickers_enableHotWords", e ? "enabled" : "disabled")
                }
                ),
                this._teaAdapterService.getABTestVar("enable_new_algorithm_system_node_parallel", {
                    enable: !1
                }),
                this._environmentService.appSubType === a.cP.MultiTrack && this._teaAdapterService.getABTestVar("enable_video_cover_optimization", {
                    enableCoverInExport: !1,
                    enableCoverInTimeline: !0
                }).then(e => {
                    window.localStorage.setItem("enable_video_cover_optimization", JSON.stringify(e))
                }
                ),
                this._teaAdapterService.getABTestVar("use_editor_with_combine_tab", {
                    enable: 1
                }),
                this._teaAdapterService.getABTestVar("animseq_preload_count", -1),
                this._teaAdapterService.getABTestVar("enable_ai_writer", !1),
                this._teaAdapterService.getABTestVar("text-template-use-vimo", !1),
                this._teaAdapterService.getABTestVar("enable_stream_fetch_opt", !0),
                this._teaAdapterService.getABTestVar("veabtest_audio_reader_unit_refactor", !0),
                this._teaAdapterService.getABTestVar("enable_video_denoise", !1),
                this._teaAdapterService.getABTestVar("enable_draw_frame_from_fe", !1),
                this._teaAdapterService.getABTestVar("ve_enable_track_clip_opt", !1),
                this._teaAdapterService.getABTestVar("capcut_web_diversion_pc", {
                    ab_group: 0
                })
            }
            constructor(e, t) {
                this._teaAdapterService = e,
                this._environmentService = t,
                this.getBooleanAbTestValue = (e, t) => {
                    var i, a;
                    return !!((null === (a = window) || void 0 === a ? void 0 : null === (i = a._libra_abtest) || void 0 === i ? void 0 : i[e]) || t)
                }
                ,
                this.getAbTestValue = async (e, t) => {
                    var i, a;
                    let r = null === (a = window) || void 0 === a ? void 0 : null === (i = a._libra_abtest) || void 0 === i ? void 0 : i[e];
                    return void 0 === r && (r = await this._teaAdapterService.getABTestVar(e, t)),
                    r || t
                }
            }
        }
    },
    544211: function(e, t, i) {
        i.d(t, {
            o: function() {
                return a
            }
        });
        let a = (0,
        i(935473).yh)("draft-duplicate-service")
    },
    586058: function(e, t, i) {
        i.d(t, {
            X: function() {
                return o
            }
        });
        var a = i(272619)
          , r = i(425241)
          , n = i(266225);
        class o {
            getModels() {
                return this._models
            }
            getModel(e) {
                return this._models.get(e)
            }
            createModel(e) {
                let t = new n.hF;
                return e && (t._draft.recovery(e),
                t._onChangeDiff.fire(t.getChangeNodesFromModel())),
                this._onModelAdded.fire(t),
                t
            }
            destroyModel(e) {
                let t = this._models.get(e);
                (0,
                r.ZB)(t),
                this._models.delete(e),
                this._onModelRemoved.fire(t)
            }
            constructor() {
                this._models = new Map,
                this._onModelAdded = new a.Q,
                this._onModelRemoved = new a.Q,
                this.onModelAdded = this._onModelAdded.event,
                this.onModelRemoved = this._onModelRemoved.event
            }
        }
    },
    143355: function(e, t, i) {
        i.d(t, {
            I: function() {
                return s
            }
        });
        var a = i(772322);
        i(881321),
        i(517562);
        var r = i(198673)
          , n = i(384392)
          , o = i(801497);
        let s = e => {
            let {title: t, content: i, handleCancel: s, handleOk: d} = null != e ? e : {};
            return (0,
            a.jsx)(r.Z, {
                visible: !0,
                closable: !1,
                maskClosable: !1,
                title: null != t ? t : o.ZP.t("exit_web_project", {}, "\u786E\u8BA4\u9000\u51FA\u8349\u7A3F\uFF1F"),
                simple: !0,
                footer: (0,
                a.jsxs)(a.Fragment, {
                    children: [(0,
                    a.jsx)(n.Z, {
                        type: "default",
                        onClick: s,
                        tabIndex: -1,
                        children: o.ZP.t("cancel_web", {}, "\u53D6\u6D88")
                    }), (0,
                    a.jsx)(n.Z, {
                        type: "primary",
                        status: "danger",
                        onClick: d,
                        children: o.ZP.t("exi_web_t", {}, "\u9000\u51FA")
                    })]
                }),
                children: null != i ? i : o.ZP.t("current_web_project_web_no_web_saved", {}, "The current draft has not been saved successfully. Exiting may cause loss of draft information.")
            })
        }
    },
    774743: function(e, t, i) {
        i.d(t, {
            M: () => v
        });
        var a = i("789786")
          , r = i("390940")
          , n = i("616193")
          , o = i("896951")
          , s = i("425241")
          , d = i("772322");
        i("881321");
        var l = i("198673")
          , c = i("78991")
          , u = i("584338")
          , h = i("371327")
          , p = i("801497");
        function g(e) {
            (0,
            c.lT)(e.containerService, {
                action: c.UL.Show,
                tool_type: c.Yp.AiCharacter
            });
            let t = e.containerService.invokeFunction(e => e.get(u.J)).getAppConfigurationValue("starlingKey.digitalHuman.templates") || "web_edit_text_avatar_templates"
              , i = l.Z.confirm({
                icon: null,
                title: p.ZP.t("web_edit_text_solely_responsible", void 0, "You shall be solely responsible for content created using a sampled AI character."),
                content: (0,
                d.jsx)("div", {
                    children: p.ZP.t(t, {
                        href0: t => (0,
                        h.Pq)(t, () => {
                            (0,
                            c.lT)(e.containerService, {
                                action: c.UL.LearnMore,
                                tool_type: c.Yp.AiCharacter
                            })
                        }
                        )
                    }, `These AI characters were created with sampled content and certain synthetic elements. By using this feature, you agree to abide by CapCut\u{2019}s <href0>Community Guidelines</href0>. You shall be solely responsible for content created using a model derived from sampled content and certain other synthetic elements on CapCut, including, without limitation, disclosing in case of making your video public that your content has been artificially generated to avoid confusion.`)
                }),
                okText: p.ZP.t("web_magicTools_button_continue", {}, "Continue"),
                okButtonProps: {
                    status: "default",
                    type: "primary"
                },
                cancelText: p.ZP.t("web_magicTools_button_back", {}, "Go back"),
                onOk: function() {
                    e.onOk(),
                    (0,
                    c.lT)(e.containerService, {
                        action: c.UL.Continue,
                        tool_type: c.Yp.AiCharacter
                    })
                },
                onCancel: function() {
                    e.onCancel(),
                    (0,
                    c.lT)(e.containerService, {
                        action: c.UL.Cancel,
                        tool_type: c.Yp.AiCharacter
                    })
                },
                cancelButtonProps: {
                    onClick() {
                        e.onCancel(),
                        i.close(),
                        (0,
                        c.lT)(e.containerService, {
                            action: c.UL.GoBack,
                            tool_type: c.Yp.AiCharacter
                        })
                    }
                }
            })
        }
        var m = i("813072")
          , _ = i("109552")
          , f = i("675220");
        class v {
            async check(e, t) {
                if (this._checkedParams.find(t => this._isSameParams(t, e)))
                    return !0;
                let i = await this._doCheck(e, t);
                return i && this._checkedParams.push(e),
                i
            }
            async preload(e) {
                if (this._checkedParams.find(t => this._isSameParams(t, e)) || this._uncheckedParams.find(t => this._isSameParams(t, e)))
                    return;
                let t = await this._popupDataService.getPopupStatus(e);
                if (!!t.ok)
                    t.value.popup ? this._uncheckedParams.push(e) : this._checkedParams.push(e)
            }
            async _doCheck(e, t) {
                return !await this._shouldShowPopup(e) || this._showPopup(e, t)
            }
            async _shouldShowPopup(e) {
                if (this._uncheckedParams.find(t => this._isSameParams(t, e)))
                    return !0;
                let t = await this._popupDataService.getPopupStatus(e);
                return !t.ok || t.value.popup
            }
            _showPopup(e, t) {
                if (e.popup_scene === r.X.PopupSmartTool)
                    return this._showPopupSmartTool(e, t);
                (0,
                s.bP)(e.popup_scene)
            }
            _showPopupSmartTool(e, t) {
                switch (e.popup_item_id) {
                case r._.SmartToolTypeEnum_DigitalHuman:
                    return this._doShowPopup(e, g, t);
                case r._.SmartToolTypeEnum_VocalSeparation:
                    return this._doShowPopup(e, _.X, t);
                case r._.SmartToolTypeEnum_VocalBeautify:
                    return this._doShowPopup(e, f.s, t);
                default:
                    (0,
                    s.bP)(e.popup_item_id)
                }
            }
            _doShowPopup(e, t, i) {
                let a = (0,
                o.PQ)();
                return t({
                    onOk: () => {
                        a.resolve(!0),
                        this._confirmPopup(e)
                    }
                    ,
                    onCancel: () => {
                        a.resolve(!1)
                    }
                    ,
                    containerService: i
                }),
                a.promise
            }
            _confirmPopup(e) {
                this._popupDataService.confirmPopup(e)
            }
            _isSameParams(e, t) {
                return (0,
                m.Z)(e, t)
            }
            constructor(e) {
                this._popupDataService = e,
                this._checkedParams = [],
                this._uncheckedParams = []
            }
        }
        v = (0,
        a.gn)([(0,
        a.fM)(0, n.V), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === n.V ? Object : n.V])], v)
    },
    380439: function(e, t, i) {
        i.d(t, {
            g: function() {
                return a
            }
        });
        class a {
            cancel() {
                this._task.then(e => {
                    e.ok && e.value.cancel()
                }
                )
            }
        }
    },
    234050: function(e, t, i) {
        i.d(t, {
            B: function() {
                return c
            }
        });
        var a = i(789786)
          , r = i(511216)
          , n = i(105312)
          , o = i(392554)
          , s = i(137124)
          , d = i(380439)
          , l = i(81197);
        class c extends d.g {
            async execute() {
                return this._task = this._pipelineDataService.createPipelineTask(this._params),
                await this._task
            }
            transfer(e) {
                var t;
                let {pipeline_id: i, pipeline_result: a} = e
                  , n = null !== (t = null == a ? void 0 : a.product_asset_type) && void 0 !== t ? t : this._params.assetType
                  , o = {
                    type: s.FV.Pipeline,
                    assetId: this._params.assetId,
                    groupType: l.Jg[n],
                    pipelineId: i
                };
                return this._accountService.hasLogin && !(a.md5 || a.matting_md5) ? (0,
                r.wf)(-1, "pipeline should have md5 or matting_md5") : this._accountService.hasLogin || a.vid || a.matting_vid ? (this._accountService.hasLogin ? o.cloudData = {
                    md5: a.md5,
                    path: a.path,
                    mattingMd5: a.matting_md5,
                    mattingPath: a.matting_path,
                    edgeProductMd5: a.edge_product_md5,
                    edgeProductPath: a.edge_product_path
                } : o.onlineData = {
                    key: a.key,
                    url: a.url,
                    vid: a.vid,
                    path: a.path,
                    mattingKey: a.matting_key,
                    mattingUrl: a.matting_url,
                    mattingVid: a.matting_vid,
                    mattingPath: a.matting_path,
                    edgeProductKey: a.edge_product_key,
                    edgeProductUrl: a.edge_product_url,
                    edgeProductVid: a.edge_product_vid,
                    edgeProductPath: a.edge_product_path
                },
                (0,
                r.oW)(o)) : (0,
                r.wf)(-1, "pipeline should have vid or matting_vid")
            }
            constructor(e, t, i) {
                super(),
                this._params = e,
                this._pipelineDataService = t,
                this._accountService = i
            }
        }
        c = (0,
        a.gn)([(0,
        a.fM)(1, n.Z), (0,
        a.fM)(2, o.D), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ICreatePipelineTaskParams ? Object : ICreatePipelineTaskParams, void 0 === n.Z ? Object : n.Z, void 0 === o.D ? Object : o.D])], c)
    },
    347772: function(e, t, i) {
        i.d(t, {
            g: function() {
                return u
            }
        });
        var a = i(789786)
          , r = i(511216)
          , n = i(41565)
          , o = i(254050)
          , s = i(392554)
          , d = i(760006)
          , l = i(137124)
          , c = i(380439);
        class u extends c.g {
            async execute() {
                return this._task = this._reverseDataService.createReverseTask({
                    assetId: this._assetId,
                    workspaceId: this._workspaceId,
                    tmpId: this._accountService.hasLogin ? "" : await this._teaAdapterService.getWebId(),
                    platform: this._platform
                }),
                await this._task
            }
            transfer(e) {
                let t = {
                    type: l.FV.Reverse,
                    assetId: this._assetId
                };
                if (e.vid && e.url)
                    t.onlineData = {
                        vid: e.vid,
                        url: e.url,
                        key: e.key
                    };
                else {
                    if (!e.md5)
                        return (0,
                        r.wf)(-1, "reverse response invalid.");
                    t.cloudData = {
                        md5: e.md5
                    }
                }
                return (0,
                r.oW)(t)
            }
            constructor(e, t, i, a, r, n) {
                super(),
                this._assetId = e,
                this._platform = t,
                this._workspaceId = i,
                this._accountService = a,
                this._teaAdapterService = r,
                this._reverseDataService = n
            }
        }
        u = (0,
        a.gn)([(0,
        a.fM)(3, s.D), (0,
        a.fM)(4, d.w), (0,
        a.fM)(5, n.N), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [String, void 0 === o.hn ? Object : o.hn, String, void 0 === s.D ? Object : s.D, void 0 === d.w ? Object : d.w, void 0 === n.N ? Object : n.N])], u)
    },
    318978: function(e, t, i) {
        i.d(t, {
            M: function() {
                return h
            }
        });
        var a = i(789786)
          , r = i(511216)
          , n = i(163641)
          , o = i(254050)
          , s = i(392554)
          , d = i(760006)
          , l = i(137124)
          , c = i(380439)
          , u = i(479296);
        class h extends c.g {
            async execute() {
                return this._task = this._intelligentDataService.createIntelligentTask({
                    assetId: this._assetId,
                    workspaceId: this._workspaceId,
                    tmpId: this._accountService.hasLogin ? "" : await this._teaAdapterService.getWebId(),
                    platform: this._platform,
                    smartToolType: u.v.Stable,
                    reqJson: "",
                    params: JSON.stringify({
                        stable_level: this._stableParams.stableLevel
                    }),
                    scene: 2
                }),
                await this._task
            }
            transfer(e) {
                let t = e.taskDetails[0].transcodeVideoInfos
                  , i = e.taskDetails[0].transcodeImageInfos
                  , a = t.length ? l.wM.Video : l.wM.Image
                  , {vid: n} = e.taskDetails[0]
                  , o = ""
                  , s = "";
                if (n) {
                    let e;
                    t.length ? e = this._getResolution(t) : i.length && (e = this._getResolution(i)),
                    e && (o = e.url.replace(/^http:/, "https:"),
                    s = e.key)
                }
                let d = {
                    type: l.FV.Stable,
                    assetId: this._assetId,
                    md5: e.taskDetails[0].md5,
                    vid: n,
                    url: o,
                    key: s,
                    groupType: a,
                    resourceId: e.resourceId,
                    resourceName: e.resourceName,
                    taskId: e.taskId
                };
                return (0,
                r.oW)(d)
            }
            _getResolution(e) {
                return e.find(e => /480p?/.test(e.defination)) || e.find(e => /360p?/.test(e.defination)) || e.find(e => /720p?/.test(e.defination))
            }
            constructor(e, t, i, a, r, n, o) {
                super(),
                this._assetId = e,
                this._platform = t,
                this._workspaceId = i,
                this._stableParams = a,
                this._accountService = r,
                this._teaAdapterService = n,
                this._intelligentDataService = o
            }
        }
        h = (0,
        a.gn)([(0,
        a.fM)(4, s.D), (0,
        a.fM)(5, d.w), (0,
        a.fM)(6, n.p), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [String, void 0 === o.hn ? Object : o.hn, String, "undefined" == typeof IStableParams ? Object : IStableParams, void 0 === s.D ? Object : s.D, void 0 === d.w ? Object : d.w, void 0 === n.p ? Object : n.p])], h)
    },
    347519: function(e, t, i) {
        i.d(t, {
            f: function() {
                return d
            }
        });
        var a = i(789786)
          , r = i(511216)
          , n = i(810968)
          , o = i(254050)
          , s = i(137124);
        class d {
            async execute() {
                let e = this._vocalSeparationDataService.createVocalSeparationTask({
                    assetId: this._assetId,
                    platform: this._platform,
                    mode: this._mode,
                    timeRange: this._timeRange,
                    workspaceId: this._workspaceId
                }, this._urlParams);
                return await e
            }
            cancel() {}
            transfer(e) {
                let t = {
                    type: s.FV.VocalSeparation,
                    assetId: this._assetId,
                    taskId: e.taskId
                }
                  , [i] = e.taskDetails
                  , {transcodeAudioInfos: a} = i
                  , [n] = a;
                if (i.md5)
                    t.cloudData = {
                        md5: i.md5,
                        key: n.key
                    };
                else {
                    if (!i.vid || !n.url)
                        return (0,
                        r.wf)(-1, "vocal separation response invalid.");
                    t.onlineData = {
                        vid: i.vid,
                        url: n.url,
                        key: n.key
                    }
                }
                return (0,
                r.oW)(t)
            }
            constructor(e, t, i, a, r, n, o) {
                this._assetId = e,
                this._platform = t,
                this._mode = i,
                this._timeRange = a,
                this._workspaceId = r,
                this._urlParams = n,
                this._vocalSeparationDataService = o
            }
        }
        d = (0,
        a.gn)([(0,
        a.fM)(6, n.ty), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [String, void 0 === o.hn ? Object : o.hn, void 0 === n.gx ? Object : n.gx, Object, String, Object, void 0 === n.ty ? Object : n.ty])], d)
    },
    720484: function(e, t, i) {
        i.d(t, {
            v: function() {
                return a
            }
        });
        let a = (0,
        i(935473).yh)("sync-file-open-time-service")
    },
    447146: function(e, t, i) {
        i.d(t, {
            O: function() {
                return h
            }
        });
        var a = i(789786)
          , r = i(120706)
          , n = i(882566)
          , o = i(106161)
          , s = i(317934)
          , d = i(112033)
          , l = i(688749);
        function c(e) {
            return ["vesdk_event_editor_preview_frame_rate", "vesdk_editor_preview_flush_fps_by_interval"].includes(e)
        }
        class u {
            build() {
                return {
                    ...(0,
                    d.Z)(this._mainDraftService, this._environmentService),
                    log_name: this._loggerName
                }
            }
            constructor(e, t) {
                this._mainDraftService = e,
                this._environmentService = t,
                this._loggerName = "user_track"
            }
        }
        u = (0,
        a.gn)([(0,
        a.fM)(0, o.n), (0,
        a.fM)(1, s.rO), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === o.n ? Object : o.n, void 0 === s.rO ? Object : s.rO])], u);
        class h {
            reportBySlardar(e, t) {
                if (!this._notNeedReportToSlardarEvents.includes(e)) {
                    if (c(e)) {
                        let i = function(e, t) {
                            let i = {
                                ...t
                            };
                            if (!c(e))
                                return i;
                            let a = ["avClockDiff", "carton_rate", "carton_time", "curr_frame_rate", "duration", "first_frame_rate", "gop_size", "is_contain_matting", "media_time", "resolution_height", "resolution_width", "slightly_carton_rate", "track_number"];
                            return ("vesdk_event_editor_preview_frame_rate" === e ? a : [...a, "start_time", "video_number", "image_number", "effect_number", "avg_cost_time", "max_cost_time"]).forEach(e => {
                                let a = t[e];
                                i[e] = null != a ? Number(a) : a
                            }
                            ),
                            i
                        }(e, t);
                        this._reportService.reportDevEvent(e, i);
                        return
                    }
                    this._logger.info(`${e} %v`, t),
                    "editor_init" !== e && this._reportService.reportDevEvent(e, t)
                }
            }
            constructor(e, t, i) {
                this._containerService = e,
                this._reportService = t,
                this._loggerService = i,
                this._notNeedReportToSlardarEvents = ["video_editor_data_layer_error", "ve_on_crash_emit"],
                this._logger = this._loggerService.createLogger("tea-to-slardar", {
                    contextParams: this._containerService.createInstance(u)
                })
            }
        }
        h = (0,
        a.gn)([(0,
        a.fM)(0, r.T), (0,
        a.fM)(1, n.m), (0,
        a.fM)(2, l.VZ), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === r.T ? Object : r.T, void 0 === n.m ? Object : n.m, void 0 === l.VZ ? Object : l.VZ])], h)
    },
    88101: function(e, t, i) {
        i.d(t, {
            PB: function() {
                return d
            },
            fh: function() {
                return o
            },
            sV: function() {
                return s
            }
        });
        var a, r, n, o = ((a = {}).ExportWindow = "export_window",
        a.TrackBar = "track_bar",
        a);
        var s = ((r = {}).AddCover = "add_cover",
        r.EditCover = "edit_cover",
        r.DownloadCover = "download_cover",
        r.DeleteCover = "delete_cover",
        r.ConfirmDeleteCover = "confirm_delete_cover",
        r.CancelDeleteCover = "cancel_delete_cover",
        r);
        var d = ((n = {}).Draft = "draft",
        n.Exported = "exported",
        n.Material = "material",
        n)
    },
    503400: function(e, t, i) {
        i.d(t, {
            M: function() {
                return F
            }
        });
        var a = i(789786)
          , r = i(459232)
          , n = i(266225)
          , o = i(106161)
          , s = i(133907)
          , d = i(592753)
          , l = i(302787)
          , c = i(570120)
          , u = i(29351)
          , h = i(913237)
          , p = i(23994)
          , g = i(510973)
          , m = i(120706)
          , _ = i(947926)
          , f = i(882566)
          , v = i(42680)
          , y = i(378899)
          , S = i(133152)
          , w = i(662320)
          , b = i(272619)
          , M = i(532666)
          , k = i(425241);
        function T(e, t) {
            let i = t.getResourceKeyFromDraftPath(e) || e;
            return (0,
            k.Y2)(i, `getCoverResourceKey not found for path: ${e}`),
            i
        }
        function I(e) {
            var t;
            return null !== (t = e.getModel().md5) && void 0 !== t ? t : ""
        }
        let P = "GraphicCoverSpace";
        class F extends M.JT {
            get graphicPackageAssets() {
                return this._graphicPackageAssets
            }
            getFrames(e, t, i) {
                return this._mainEditorWidgetService.renderManager.getVideoFrames(e, t, i)
            }
            cancelGetFrames(e) {
                this._mainEditorWidgetService.renderManager.cancelGetVideoFrames(e)
            }
            setGraphicPackageAssets(e) {
                this._graphicPackageAssets = e
            }
            clearCover() {
                this._mainDraftService.dataSdk.api.draft.clearCover()
            }
            async setGraphicDraftCover(e, t) {
                let[i,a] = await Promise.all([this._uploadDraft(e), this._uploadCover(t.data)])
                  , {materialLifecycle: r, jsonString: n, size: o} = i
                  , {materialLifecycle: s, size: l, data: c} = a
                  , u = function(e) {
                    var t;
                    return null !== (t = e.getModel().md5) && void 0 !== t ? t : ""
                }(r)
                  , h = I(s)
                  , p = (0,
                d.GL)(s.getModel(), v._g.UserPhoto);
                this._resourceService.add(p.key, p.resource),
                this._resourceService.get(p.key, v._g.UserPhoto).getCoverResourceToken().start(),
                this._updateCache({
                    jsonString: n,
                    path: u,
                    size: o,
                    md5: r.md5
                }, {
                    data: c,
                    height: t.height,
                    path: h,
                    size: l,
                    width: t.width
                }),
                this._setGraphicCover({
                    materialLifecycle: r,
                    path: u
                }, {
                    width: t.width,
                    height: t.height,
                    materialLifecycle: s,
                    path: h
                })
            }
            async setStaticCover(e) {
                var t;
                (0,
                k.Y2)(e);
                let i = e.getModel()
                  , {width: a, height: r} = i
                  , n = await this._fetchCoverInfo(i);
                if (!n)
                    throw Error("fetch cover info failed");
                let o = (0,
                d.GL)(e.getModel(), v._g.UserPhoto);
                this._resourceService.add(o.key, o.resource);
                let s = I(e);
                this._coverAssetMap.set(s, {
                    path: s,
                    size: null !== (t = i.size) && void 0 !== t ? t : 0,
                    data: n.data,
                    width: a,
                    height: r
                }),
                this._updateStaticCover({
                    materialLifecycle: e,
                    path: s,
                    width: a,
                    height: r
                })
            }
            async getDraftJsonAsset() {
                await this._mutex.lockShared(),
                this._mutex.unLockShared();
                let e = this._mainDraftService.dataSdk.draftView.getCover();
                if (!!e)
                    return this._draftAssetMap.get(e.graphicDraftPath)
            }
            async getDraftJsonString() {
                let e = await this.getDraftJsonAsset();
                return null == e ? void 0 : e.jsonString
            }
            async getCoverAsset() {
                await this._mutex.lockShared(),
                this._mutex.unLockShared();
                let e = this._mainDraftService.dataSdk.draftView.getCover();
                if (!!e)
                    return this._coverAssetMap.get(e.imagePath)
            }
            _syncDataFromDraft() {
                return Promise.all([this._recoveryDraftAsset(), this._recoveryCoverAsset()])
            }
            async _recoveryDraftAsset() {
                var e;
                let t = this._mainDraftService.dataSdk.draftView.getCover();
                if (!t)
                    return;
                let {graphicDraftPath: i} = t;
                if (!i)
                    return;
                let a = this._draftMaterialService.getMaterialByKey(T(i, this._mainDraftService.draftPathStore));
                if (!a)
                    return;
                let r = a.md5
                  , n = await this._fetchDraftJsonString(r);
                this._draftAssetMap.set(i, {
                    path: i,
                    size: null !== (e = a.size) && void 0 !== e ? e : 0,
                    jsonString: n,
                    md5: a.md5
                })
            }
            async _recoveryCoverAsset() {
                var e;
                let t = this._mainDraftService.dataSdk.draftView.getCover();
                if (!t)
                    return;
                let {imagePath: i} = t;
                if (!i)
                    return;
                let a = this._draftMaterialService.getMaterialByKey(T(i, this._mainDraftService.draftPathStore));
                (0,
                k.ZB)(a, "cover asset material not found.");
                let r = await this._fetchCoverInfo(a);
                if (!!r)
                    this._coverAssetMap.set(i, {
                        path: i,
                        size: null !== (e = a.size) && void 0 !== e ? e : 0,
                        data: r.data,
                        width: a.width,
                        height: a.height
                    }),
                    this._onCoverChange.fire()
            }
            _fetchDraftJsonString(e) {
                let t = this._resourceService.get(e, v._g.UserFile);
                (0,
                k.ZB)(t, `could not get draft file by ${e})`);
                let i = t.getContentResourceToken();
                return new Promise( (e, t) => {
                    i.onReady(t => {
                        let {buffer: i} = t
                          , a = new Uint8Array(i);
                        e(new TextDecoder("utf-8").decode(a))
                    }
                    ),
                    i.onError(e => {
                        t(e)
                    }
                    ),
                    i.start()
                }
                )
            }
            _fetchCoverInfo(e) {
                let t = (0,
                d.nQ)(this._resourceService, v._g.UserPhoto, e).getResolutionResourceTokenByQueue([g.Mc["1080p"], g.Mc["720p"], g.Mc["480p"], g.Mc["360p"], g.Mc["2400p"], g.Mc.origin]);
                t.start();
                let i = {
                    previewUrl: void 0,
                    previewKey: void 0,
                    previewBuffer: void 0
                };
                return new Promise( (e, a) => {
                    t.onReady(async t => {
                        let {buffer: n, url: o, key: s} = t;
                        if (Object.assign(i, {
                            previewUrl: o,
                            previewKey: s,
                            previewBuffer: n
                        }),
                        !i.previewBuffer) {
                            e(null);
                            return
                        }
                        let {previewBuffer: d} = i;
                        try {
                            let t = await new Promise( (e, t) => {
                                let i = new FileReader;
                                i.onloadend = () => {
                                    let t = i.result;
                                    e(t)
                                }
                                ,
                                i.onerror = t;
                                let a = new Blob([d],{
                                    type: "image/jpeg"
                                });
                                i.readAsDataURL(a)
                            }
                            );
                            new Image().src = (0,
                            r.C)(t, null, {
                                logType: "js.href/src",
                                reportOnly: "false",
                                blackConfig: "{}",
                                configMode: "merge",
                                isCloseSSRReport: !1,
                                bid: "cc_web_editor",
                                region: "sg-capcut",
                                urlLimit: "10000",
                                htmlLimit: "-1",
                                isSaveValidUrl: !1,
                                isRuntimeLog: !1,
                                isDOMParser: !1,
                                escapeRule: "escape-report",
                                reportUrl: "https://mon-sg.capcutapi.com/monitor_browser/collect/batch/security/?bid=cc_web_editor",
                                scmBranch: "-",
                                scmName: "W$Zk$2$rd3llREprTWxacFRETmFjRnBI$m5aW%1qbDFZa2RzZFZwWFJub*FNM$o2",
                                scmVersion: "1.0.1.7201",
                                webpackPluginVersion: "3.4.10",
                                filename: "$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1teHNZM2s1-WxrelpHeFph$*w2WTIxTmRscFh$bkJr%npsN$RETmFjRnBI$m5aT%0wNT$XW*s1ZWxwW$NqSmhWMD$zWTNrN%1tRlh$bXhpZ$R*c$lqTmFiR05wT1dwa%0wcHN%REpPZ*1SdFZubE1XR%pzWTI1T2NHTXp$bXhp-l%1c1RESk9kb$J0$m5sT$dFSnNZMj$P-0dNel$te*li$T$z$Ec1%2$sbFlTbT$r$0%wOQ"
                            }),
                            e({
                                data: t
                            })
                        } catch (e) {
                            a(e)
                        }
                    }
                    ),
                    t.onError(e => {
                        a(e)
                    }
                    )
                }
                )
            }
            _setGraphicCover(e, t) {
                let {materialLifecycle: i, path: a} = e
                  , {materialLifecycle: r, width: n, height: o, path: s} = t;
                this._draftMaterialService.getOrCreateAutoGeneratedMaterialNamespace(P).replaceAllMaterials([i, r]),
                this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(s, s),
                this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(s, s),
                this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(a, a),
                this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(a, a);
                let d = this._mainDraftService.dataSdk.api.draft.setCover({
                    graphicDraftPath: a,
                    imageInfo: {
                        path: s,
                        width: n,
                        height: o,
                        name: "graphic_cover.jpg"
                    },
                    duration: this._coverDuration
                });
                if (d.ok)
                    this._reportService.reportDevEvent("setGraphicCover-success", {
                        draftPath: a,
                        coverPath: s,
                        duration: this._coverDuration.toString()
                    });
                else {
                    let e = Error(d.msg);
                    throw this._reportService.reportDevError("setGraphicCover-error", e, {
                        draftPath: a,
                        coverPath: s,
                        duration: this._coverDuration.toString()
                    }),
                    e
                }
            }
            _updateStaticCover(e) {
                let {width: t, height: i, materialLifecycle: a, path: r} = e;
                this._draftMaterialService.getOrCreateAutoGeneratedMaterialNamespace(P).replaceAllMaterials([a]),
                this._mainDraftService.draftPathStore.recordResourceKeyToDraftPath(r, r),
                this._mainDraftService.draftPathStore.recordDraftPathToResourceKey(r, r);
                let n = this._mainDraftService.dataSdk.api.draft.setCover({
                    imageInfo: {
                        path: r,
                        width: t,
                        height: i,
                        name: "static_cover.jpg"
                    },
                    duration: this._coverDuration
                });
                if (!n.ok)
                    throw Error(n.msg);
                this.updateGraphicPackageAssets([])
            }
            _updateCache(e, t) {
                this._draftAssetMap.set(e.path, e),
                this._coverAssetMap.set(t.path, t)
            }
            async _uploadDraft(e) {
                let t = new File([new Blob([e],{
                    type: "application/json"
                })],"graphic_cover.json",{
                    type: "application/json"
                })
                  , [i] = await (0,
                l.u)({
                    files: [t],
                    fromWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    toWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    packageDelta: {
                        meta: {
                            visible: !1
                        }
                    },
                    uploadParams: {
                        skipTranscode: !0,
                        uploadFlag: y.m5.InvisibleNoOccupation,
                        autoPromote: !0
                    },
                    payinPayoutHelper: this._payinPayoutHelper,
                    containerService: this._containerService
                });
                if (!i.ok)
                    throw Error(i.msg);
                let a = i.value;
                return new Promise( (i, r) => {
                    a.onDidDone( () => {
                        i({
                            materialLifecycle: a,
                            jsonString: e,
                            size: t.size
                        })
                    }
                    );
                    a.onUploadFailure(e => {
                        r(null == e ? void 0 : e.msg)
                    }
                    )
                }
                )
            }
            async _uploadCover(e) {
                let t = function(e, t) {
                    let i = e.split(",")
                      , a = i[0].match(/:(.*?);/)[1]
                      , r = atob(i[1])
                      , n = r.length
                      , o = new Uint8Array(n);
                    for (; n--; )
                        o[n] = r.charCodeAt(n);
                    return new File([o],t,{
                        type: a
                    })
                }(e, "graphic_cover.jpg")
                  , [i] = await (0,
                c.E)({
                    files: [t],
                    fromWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    toWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    packageDelta: {
                        meta: {
                            visible: !1
                        }
                    },
                    uploadParams: {
                        uploadFlag: y.m5.InvisibleNoOccupation,
                        autoPromote: !0
                    },
                    payinPayoutHelper: this._payinPayoutHelper,
                    containerService: this._containerService
                });
                if (!i.ok)
                    throw Error(i.msg);
                let a = i.value;
                return new Promise( (i, r) => {
                    a.onDidDone( () => {
                        i({
                            materialLifecycle: a,
                            size: t.size,
                            data: e
                        })
                    }
                    );
                    let n = e => {
                        r(null == e ? void 0 : e.msg)
                    }
                    ;
                    a.onUploadFailure(n),
                    a.onTranscodeFailure(n)
                }
                )
            }
            updateGraphicPackageAssets(e) {
                let t = new Set(e.map(e => e.md5))
                  , i = new Set
                  , a = []
                  , r = [];
                this._graphicPackageAssets.forEach(e => {
                    t.has(e.md5) ? i.add(e.md5) : r.push(e)
                }
                ),
                e.forEach(e => {
                    !i.has(e.md5) && a.push(e)
                }
                ),
                r.forEach(e => {
                    this._mainDraftService.saveManager.packageAssetsBuilder.removeExternalAsset(e)
                }
                ),
                a.forEach(e => {
                    this._mainDraftService.saveManager.packageAssetsBuilder.addExternalAsset(e)
                }
                ),
                this._graphicPackageAssets = e
            }
            getCoverMaterial() {
                let e = this._mainDraftService.dataSdk.draftView.getCover();
                if (!e)
                    return;
                let {imagePath: t} = e;
                if (!t)
                    return;
                let i = this._draftMaterialService.getMaterialByKey(T(t, this._mainDraftService.draftPathStore));
                return (0,
                k.ZB)(i, "cover asset material not found."),
                i
            }
            constructor(e, t, i, a, r, o, s) {
                super(),
                this._mainDraftService = e,
                this._draftMaterialService = t,
                this._mainEditorWidgetService = i,
                this._containerService = a,
                this._resourceService = r,
                this._lifecycleService = o,
                this._reportService = s,
                this._onCoverChange = new b.Q,
                this._onGetFrame = new b.Q,
                this._onRecovered = new b.Q,
                this._draftAssetMap = new Map,
                this._coverAssetMap = new Map,
                this._mutex = new w.L,
                this._coverDuration = 1000000n / 30n * 5n,
                this._graphicPackageAssets = [],
                this._inited = !1,
                this.onCoverChange = this._onCoverChange.event,
                this.onGetFrame = this._onGetFrame.event,
                this.onRecovered = this._onRecovered.event,
                this._payinPayoutHelper = this._containerService.createInstance(S.o);
                let d = async () => {
                    try {
                        await this._mutex.lock(),
                        await this._syncDataFromDraft(),
                        this._onRecovered.fire()
                    } finally {
                        this._mutex.unLock()
                    }
                }
                ;
                this._lifecycleService.didPassPhase(u.B.DraftLoaded) && !this._inited && (this._inited = !0,
                d()),
                this._register(this._mainDraftService.dataSdk.onChangeDiff(e => {
                    let t = e.videoDocument.getDraftProperty();
                    t && (t.retouchCover || t.canvasConfig) && this._onCoverChange.fire(),
                    e.actionOperateType === n.aWQ.History && (this._inited = !1),
                    !this._inited && (this._inited = !0,
                    d())
                }
                )),
                this._register(this._mainEditorWidgetService.onEventually( () => {
                    this._mainEditorWidgetService.renderManager.onGetFrames(e => {
                        this._onGetFrame.fire(e)
                    }
                    )
                }
                ))
            }
        }
        F = (0,
        a.gn)([(0,
        a.fM)(0, o.n), (0,
        a.fM)(1, h.D), (0,
        a.fM)(2, s.a), (0,
        a.fM)(3, m.T), (0,
        a.fM)(4, _.c), (0,
        a.fM)(5, p.g), (0,
        a.fM)(6, f.m), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === o.n ? Object : o.n, void 0 === h.D ? Object : h.D, void 0 === s.a ? Object : s.a, void 0 === m.T ? Object : m.T, void 0 === _.c ? Object : _.c, void 0 === p.g ? Object : p.g, void 0 === f.m ? Object : f.m])], F)
    },
    928264: function(e, t, i) {
        i.d(t, {
            p: function() {
                return U
            }
        });
        var a = i(789786)
          , r = i(232715)
          , n = i(260963)
          , o = i(658546)
          , s = i(776324)
          , d = i(32950)
          , l = i(106161)
          , c = i(133907)
          , u = i(825088)
          , h = i(266225)
          , p = i(633854)
          , g = i(503400)
          , m = i(676591)
          , _ = i(659873)
          , f = i(120706)
          , v = i(947926)
          , y = i(83310)
          , S = i(42680)
          , w = i(297071)
          , b = i(592753)
          , M = i(570120)
          , k = i(178203)
          , T = i(913237)
          , I = i(100473)
          , P = i(544581)
          , F = i(290483)
          , D = i(133152)
          , A = i(425241)
          , x = i(791354)
          , C = i(37655)
          , R = i(286870)
          , E = i(99884)
          , O = i(133353)
          , j = i(15753)
          , V = i(424566);
        class U {
            get modalOpenTime() {
                return this._modalOpenTime
            }
            refreshTracksInfo() {
                let e = this._mainDraftService.dataSdk.draftView.getAllTracks();
                this._isTracksEmpty = (0,
                u._3)(e),
                this._hasVideoSegment = (0,
                u.kv)(e),
                this._hasMatting = (0,
                u.W1)(e)
            }
            async openModal() {
                var e, t;
                let i = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {
                    modalType: r.w8.Edit,
                    selectType: r.UQ.video
                }
                  , {width: a=0, height: n=1} = this._mainDraftService.dataSdk.draftView.getCanvasConfig()
                  , s = this._mainDraftService.dataSdk.draftView.getDuration()
                  , d = this._store;
                this._modalOpenTime = new Date().getTime(),
                d._draftModifyTimeWhenOpen !== d.draftModifyTime && (d.setVideoParam(void 0),
                d.setHighlightParam(void 0),
                d.refreshDraftModifyTimeWhenOpen()),
                d.setVisible(!0),
                d.setModalType(null !== (e = i.modalType) && void 0 !== e ? e : r.w8.Edit),
                d.modalType === r.w8.SelectFrame && d.setSelectFramesForGraphicParams({
                    onSelectFrame: i.onSelectFrame,
                    onCancelSelect: i.onCancelSelect
                }),
                d.setAspectRatio(a / n),
                d.setDuration(s),
                this.moveMainEditorWidgetCanvasToModal({
                    width: a,
                    height: n
                }),
                d.setUpscalerSize((0,
                o.xV)(d.aspectRatio, 1080)),
                d.setFrameSize((0,
                o.xV)(d.aspectRatio, 480)),
                d.setHighlightFrameSize((0,
                o.xV)(d.aspectRatio, 240)),
                d.setUploadMaterial(null),
                d.setIsOpeningGraphic(!1),
                d.setIsSettingCover(!1),
                d.setHighlightParam({
                    candidateFrameList: [],
                    selectedIndex: 0,
                    loading: !1,
                    inited: !1
                }),
                this.startVideoSelect().then( () => {
                    this.getHighlightFrame()
                }
                ),
                this._prevProgress = this._mainEditorWidgetService.playerManager.status.progress,
                this._mainEditorWidgetService.timelineManager.timelineUI.cursor.setFreeze(!0),
                d.setSelectType(null !== (t = i.selectType) && void 0 !== t ? t : r.UQ.video),
                this._mainEditorWidgetService.playerManager.activeDefaultPlayer()
            }
            startVideoSelect() {
                return new Promise(async e => {
                    let t = this._store
                      , i = performance.now();
                    if (t.setVideoParam({
                        inited: !1,
                        loading: !0,
                        frameList: [],
                        getFrameCount: 0
                    }),
                    t.setVideoSeekTo(0n),
                    this._isTracksEmpty) {
                        let e = (0,
                        o.xV)(t.aspectRatio, 60)
                          , i = (0,
                        d.o)(e.width, e.height, "black");
                        (0,
                        n.z)( () => {
                            t.videoParam && (t.videoParam.frameList = Array(10).fill(i),
                            t.videoParam.getFrameCount = 10,
                            t.videoParam.loading = !1)
                        }
                        )
                    } else {
                        let e = (0,
                        o.Zw)(t.duration, 10, this._hasMatting);
                        await this.safeGetFrame(e, t.frameSize, async i => {
                            let a = e.findIndex(e => i.callbackData === e.callbackData)
                              , r = await (0,
                            s.AO)(i.imageData, {
                                width: i.width,
                                height: i.height
                            });
                            (0,
                            n.z)( () => {
                                if (t.videoParam) {
                                    var e, i;
                                    t.videoParam.frameList[a] = r,
                                    t.videoParam.getFrameCount = (null !== (i = null === (e = t.videoParam) || void 0 === e ? void 0 : e.getFrameCount) && void 0 !== i ? i : 0) + 1,
                                    t.videoParam.loading = !1
                                }
                            }
                            )
                        }
                        );
                        for (let i = e.length; i < 10; i++)
                            (0,
                            n.z)( () => {
                                if (t.videoParam) {
                                    var a, r;
                                    t.videoParam.frameList[i] = t.videoParam.frameList[e.length - 1],
                                    t.videoParam.getFrameCount = (null !== (r = null === (a = t.videoParam) || void 0 === a ? void 0 : a.getFrameCount) && void 0 !== r ? r : 0) + 1,
                                    t.videoParam.loading = !1
                                }
                            }
                            );
                        (0,
                        n.z)( () => {
                            t.videoParam.inited = !0
                        }
                        )
                    }
                    (0,
                    C.N)(this._containerService, {
                        time: performance.now() - i
                    }),
                    e(0)
                }
                )
            }
            async getHighlightFrame() {
                var e, t;
                let i = this._store;
                if (null === (e = i.highlightParam) || void 0 === e ? void 0 : e.loading)
                    return;
                if (i.setHighlightParam({
                    inited: !0,
                    loading: !0,
                    candidateFrameList: [],
                    selectedIndex: 0
                }),
                this._isTracksEmpty || !this._hasVideoSegment) {
                    i.highlightErrorSet("empty"),
                    i.highlightLoadingSet(!1);
                    return
                }
                i.highlightLoadingSet(!0),
                i.highlightErrorSet();
                let a = performance.now()
                  , {draftModifyTime: r} = i;
                try {
                    await this.getCandidateHighlightFrame();
                    let e = await this._coverApi.imagesHighlightAnalyse({
                        top_k: 5,
                        image_base64_list: i.highlightParam.candidateFrameList.map(e => e.url)
                    });
                    if (!e.ok)
                        throw Error(e.msg);
                    if (r !== i.draftModifyTime)
                        return;
                    let {value: a} = e;
                    (null === (t = a.highlightImageIndex) || void 0 === t ? void 0 : t.length) ? (a.highlightImageIndex.sort( (e, t) => e - t),
                    i.highlightListSet(a.highlightImageIndex),
                    i.highlightErrorSet("success")) : i.highlightErrorSet("empty")
                } catch (e) {
                    if (r !== i.draftModifyTime)
                        return;
                    i.highlightErrorSet("error")
                } finally {
                    r === i.draftModifyTime && (i.highlightLoadingSet(!1),
                    (0,
                    R.P)(this._containerService, {
                        time: performance.now() - a
                    }))
                }
            }
            safeGetFrame(e, t, i) {
                let a = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 12e4;
                return new Promise( (r, n) => {
                    let o = this._store
                      , s = e.reduce( (e, t) => ({
                        ...e,
                        [t.callbackData]: !1
                    }), {})
                      , d = null
                      , l = this._coverPersistenceManager.getFrames(e, t.width, t.height)
                      , c = async e => {
                        if (e.taskId !== l)
                            return;
                        if (!o.visible) {
                            null == d || d.dispose(),
                            this._coverPersistenceManager.cancelGetFrames(l),
                            n(Error("get frames error"));
                            return
                        }
                        if (void 0 !== s[e.callbackData])
                            s[e.callbackData] = !0,
                            await i(e).catch(e => n(e)),
                            !Object.values(s).includes(!1) && (null == d || d.dispose(),
                            this._coverPersistenceManager.cancelGetFrames(l),
                            clearTimeout(u),
                            r(0))
                    }
                    ;
                    d = this._coverPersistenceManager.onGetFrame(c);
                    let u = setTimeout( () => {
                        null == d || d.dispose(),
                        this._coverPersistenceManager.cancelGetFrames(l),
                        clearTimeout(u),
                        n(Error("get frames timeout"))
                    }
                    , a)
                }
                )
            }
            getCurrVideoFrameFile() {
                return new Promise( (e, t) => {
                    let i = this._store;
                    if (this._isTracksEmpty) {
                        let t = (0,
                        o.xV)(i.aspectRatio, 60);
                        e((0,
                        d.o)(t.width, t.height, "black"))
                    } else
                        this.safeGetFrame([(0,
                        o.s4)(i.seekTo)], i.frameSize, async t => {
                            e(await (0,
                            s.AO)(t.imageData, {
                                width: t.width,
                                height: t.height
                            }))
                        }
                        , 1e4).catch(e => t(e))
                }
                )
            }
            getHighlightSelectedFrameFile() {
                return new Promise( (e, t) => {
                    let i = this._store;
                    this.safeGetFrame([(0,
                    o.s4)(h.pMA.times(i.highlightParam.candidateFrameList[i.highlightParam.selectedIndex].process, 1e3, "bigint"))], i.frameSize, async t => {
                        e(await (0,
                        s.AO)(t.imageData, {
                            width: t.width,
                            height: t.height
                        }))
                    }
                    , 1e4).catch(e => t(e))
                }
                )
            }
            seekToSet(e) {
                var t;
                let i = this._store;
                if (!!(null === (t = i.videoParam) || void 0 === t ? void 0 : t.inited))
                    i.setVideoSeekTo(e),
                    this._mainEditorWidgetService.playerManager.seek(e)
            }
            previewToSet(e, t, i) {
                var a;
                let r = this._store;
                if (!!(null === (a = r.videoParam) || void 0 === a ? void 0 : a.inited))
                    (0,
                    n.z)( () => {
                        r.videoParam.previewTo = e
                    }
                    ),
                    this._mainEditorWidgetService.playerManager.seekWithSpeed(e, t, i)
            }
            getCandidateHighlightFrame() {
                var e, t;
                let i = this._store;
                if (null === (t = i.highlightParam) || void 0 === t ? void 0 : null === (e = t.candidateFrameList) || void 0 === e ? void 0 : e.length)
                    return Promise.resolve(0);
                (0,
                n.z)( () => {
                    i.highlightParam.candidateFrameList = []
                }
                );
                let a = (0,
                o.Zw)(i.duration, 15, this._hasMatting);
                return this.safeGetFrame(a, i.highlightFrameSize, async e => {
                    let t = await (0,
                    s.AO)(e.imageData, {
                        width: e.width,
                        height: e.height
                    });
                    (0,
                    n.z)( () => {
                        let r = a.findIndex(t => t.callbackData === e.callbackData);
                        i.highlightParam.candidateFrameList[r] = {
                            url: t,
                            process: e.callbackData
                        }
                    }
                    )
                }
                )
            }
            closeModal(e) {
                this._mainEditorWidgetService.timelineManager.timelineUI.cursor.setFreeze(!1);
                let t = this._store
                  , i = this._mainEditorWidgetService.playerManager.status.progress !== this._prevProgress;
                ( () => {
                    if (!!t.visible)
                        this.recoverCanvasToMainEditorWidget(),
                        t.visible && i && this._mainEditorWidgetService.playerManager.seek(this._prevProgress, h.Hqf.seekDone),
                        (0,
                        n.z)( () => {
                            var e, i, a;
                            t.visible = !1,
                            t.videoCanvas = void 0,
                            null === (i = t.selectFramesForGraphicParams) || void 0 === i || null === (e = i.onCancelSelect) || void 0 === e || e.call(i),
                            (null === (a = t.highlightParam) || void 0 === a ? void 0 : a.loading) && (t.highlightParam = void 0)
                        }
                        ),
                        this._mainEditorWidgetService.canvasManager.getIsVideoPreview() ? this._mainEditorWidgetService.playerManager.activePreviewPlayer() : this._mainEditorWidgetService.playerManager.activeDefaultPlayer()
                }
                )()
            }
            async highlightSuperToMd5() {
                var e = this;
                let t = await this.getHighlightSelectedFrameFile()
                  , i = async function() {
                    let a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0
                      , r = await (0,
                    P.U)(e, e._coverApi.createImg({
                        asset_id: t,
                        workspace_id: e._mainDraftService.draftWorkspaceManager.workspaceId,
                        platform: 3,
                        params: {
                            ...e._store.upscalerSize
                        }
                    }));
                    if (!r.ok) {
                        if (a < 2)
                            return i(a + 1);
                        throw Error(r.msg)
                    }
                    let {md5: n} = r.value.value.taskDetail[0];
                    if (!n) {
                        if (a < 2)
                            return i(a + 1);
                        throw Error("can not get md5")
                    }
                    return n
                }
                  , a = await i()
                  , r = async function() {
                    arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
                    let t = await (0,
                    w.J)({
                        md5s: [a],
                        fetchRetryOptions: {
                            retryTimes: 10,
                            delay: 500,
                            waitForFirstRequest: !0
                        },
                        fromWorkspaceId: e._mainDraftService.draftWorkspaceManager.workspaceId,
                        toWorkspaceId: e._mainDraftService.draftWorkspaceManager.workspaceId,
                        containerService: e._containerService
                    });
                    if (!t.ok)
                        throw Error(t.msg);
                    return t.value
                }
                  , n = (await r())[0];
                await new Promise(e => n.onResourceReady( () => e(void 0)));
                let o = (0,
                m.l)(S._g.UserPhoto, {
                    ...n.getModel(),
                    onProgress: n.onModelUpdate,
                    onReady: n.onResourceReady
                }, n.status === _.a.Success);
                return this._resourceService.add(o.key, o.resource),
                {
                    materialLifecycle: n,
                    base64: t
                }
            }
            _getFrameAsBlob() {
                return new Promise( (e, t) => {
                    let i = this._store;
                    this.safeGetFrame([(0,
                    o.s4)(i.seekTo)], i.frameSize, async i => {
                        let a = document.createElement("canvas");
                        a.width = i.width,
                        a.height = i.height;
                        let r = a.getContext("2d")
                          , n = null == r ? void 0 : r.createImageData(i.width, i.height);
                        n && (n.data.set(new Uint8ClampedArray(i.imageData)),
                        null == r || r.putImageData(n, 0, 0),
                        a.toBlob(i => {
                            i ? e(i) : t(Error("Failed to create blob"))
                        }
                        , "image/png")),
                        await Promise.resolve()
                    }
                    , 1e4).catch(t)
                }
                )
            }
            async _uploadFrameAndGetLifecycle(e) {
                let t = new File([e],"frame.png",{
                    type: "image/png"
                })
                  , i = await this.uploadCoverFile(t)
                  , a = async () => {
                    let e = await (0,
                    w.J)({
                        md5s: [i],
                        fetchRetryOptions: {
                            retryTimes: 10,
                            delay: 500,
                            waitForFirstRequest: !0
                        },
                        fromWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                        toWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                        containerService: this._containerService
                    });
                    if (!e.ok)
                        throw Error(e.msg);
                    return e.value
                }
                  , [r] = await a();
                return await new Promise(e => r.onResourceReady( () => e(void 0))),
                r
            }
            async videoSuperToMd5() {
                let e, t;
                var i = this;
                let a = await this.getCurrVideoFrameFile()
                  , r = async function() {
                    let e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0
                      , t = await (0,
                    P.U)(i, i._coverApi.createImg({
                        asset_id: a,
                        workspace_id: i._mainDraftService.draftWorkspaceManager.workspaceId,
                        platform: 3,
                        params: {
                            ...i._store.upscalerSize
                        }
                    }));
                    if (!t.ok) {
                        if (e < 2)
                            return r(e + 1);
                        throw Error(t.msg)
                    }
                    let {md5: n} = t.value.value.taskDetail[0];
                    if (!n) {
                        if (e < 2)
                            return r(e + 1);
                        throw Error("videoSuperToMd5 createImg api result do not have md5")
                    }
                    return n
                };
                try {
                    e = await r();
                    let i = async () => {
                        let t = await (0,
                        w.J)({
                            md5s: [e],
                            fetchRetryOptions: {
                                retryTimes: 10,
                                delay: 500,
                                waitForFirstRequest: !0
                            },
                            fromWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                            toWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                            containerService: this._containerService
                        });
                        if (!t.ok)
                            throw Error(t.msg);
                        return t.value
                    }
                      , [a] = await i();
                    t = a,
                    await new Promise(e => t.onResourceReady( () => e(void 0)));
                    let n = (0,
                    b.GL)(t.getModel(), S._g.UserPhoto);
                    this._resourceService.add(n.key, n.resource)
                } catch {
                    let e = await this._getFrameAsBlob();
                    t = await this._uploadFrameAndGetLifecycle(e)
                }
                return {
                    materialLifecycle: t,
                    base64: a
                }
            }
            checkIfNeedLogin() {
                return !!this._accountService.hasLogin || (this._accountService.login({
                    reportParams: {
                        pageEnterFrom: y.d.Cover
                    }
                }),
                !1)
            }
            async moveMainEditorWidgetCanvasToModal(e) {
                let {canvas: t} = this._mainEditorWidgetService
                  , {width: i, height: a} = t.style;
                this._canvasOriginStyle = {
                    width: i,
                    height: a
                };
                let r = e.width / e.height
                  , n = t.width / t.height
                  , o = "";
                if (r === n)
                    o = t.toDataURL();
                else {
                    let t = this._mainEditorWidgetService.renderManager.getVideoFrames([{
                        time: this._mainEditorWidgetService.playerManager.status.progress,
                        callbackData: Math.round(h.pMA.div(this._mainEditorWidgetService.playerManager.status.progress, 1e3))
                    }], e.width, e.height);
                    await new Promise(i => {
                        let a = this._mainEditorWidgetService.renderManager.onGetFrames(r => {
                            if (r.taskId === t)
                                try {
                                    let t = document.createElement("canvas");
                                    t.width = e.width,
                                    t.height = e.height;
                                    let i = t.getContext("2d");
                                    null == i || i.putImageData(new ImageData(new Uint8ClampedArray(r.imageData),r.width,r.height), 0, 0),
                                    o = t.toDataURL()
                                } finally {
                                    null == a || a.dispose(),
                                    i()
                                }
                        }
                        )
                    }
                    )
                }
                this._store.visible && o && this._mainEditorWidgetService.canvasManager.setPreview({
                    imageUrl: o
                }),
                !this._isTracksEmpty && this._mainEditorWidgetService.playerManager.seek(0n),
                this._store.setVideoCanvas(t)
            }
            recoverCanvasToMainEditorWidget() {
                this._mainEditorWidgetService.canvas.style.width = this._canvasOriginStyle.width,
                this._mainEditorWidgetService.canvas.style.height = this._canvasOriginStyle.height,
                this._mainEditorWidgetService.canvasManager.bindCanvas(this._mainEditorWidgetService.canvas),
                this._mainEditorWidgetService.canvasManager.resetPreview()
            }
            async uploadCoverFile(e) {
                var t;
                let {workspaceId: i} = this._mainDraftService.draftWorkspaceManager;
                if (!i)
                    throw Error("workspaceId is undefined");
                let[a] = await (0,
                M.E)({
                    files: [e],
                    fromWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    toWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    payinPayoutHelper: this._payinPayoutHelper,
                    containerService: this._containerService,
                    captureCoverAndThumbHelper: this._containerService.createInstance(V.W, {
                        captureImageFrameHelper: this._mainEditorWidgetService.captureImageFrameManager
                    }),
                    fastImportAnalyzeHelper: this._mainEditorWidgetService.fastImportAnalyzeManager
                });
                if (this._store.setUploadMaterial(null),
                !a.ok)
                    throw Error(a.msg);
                let r = a.value;
                return this._store.setUploadMaterial({
                    md5: r.md5,
                    status: F.X.Pending,
                    uploadProgress: 0,
                    isSupportPreview: null === (t = r.getModel().uploading) || void 0 === t ? void 0 : t.supportPreview
                }),
                (0,
                x.J)(this._containerService, a.value, {
                    action_type: k.jm.CLICK_ADD,
                    material_source: k.O9.LOCAL,
                    position: k.cg.COVER_EDIT,
                    fromWorkspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId
                }),
                new Promise( (e, t) => {
                    r.onDidDone( () => {
                        var t;
                        let i = r.getModel();
                        this._draftMaterialsService.addToUserGenerated(r, {
                            addFrom: T.a.Upload
                        });
                        let n = (0,
                        m.l)(S._g.UserPhoto, {
                            ...i,
                            onProgress: a.value.onModelUpdate,
                            onReady: a.value.onDidDone
                        }, !0);
                        if (this._resourceService.add(n.key, n.resource),
                        this._store.setUploadMaterial({
                            materialLifecycle: r,
                            status: F.X.Online
                        }),
                        null === (t = i.uploading) || void 0 === t ? void 0 : t.supportPreview)
                            e(i.md5);
                        else {
                            let t = this._resourceService.get(n.key, S._g.UserPhoto);
                            (0,
                            A.Y2)(t);
                            let a = t.getCoverResourceToken();
                            a.start(),
                            a.onReady(t => {
                                let {buffer: a} = t;
                                this._store.setUploadMaterial({
                                    coverUrl: URL.createObjectURL(new Blob([a])),
                                    materialLifecycle: r,
                                    status: F.X.Online
                                }),
                                e(i.md5)
                            }
                            )
                        }
                    }
                    ),
                    r.onTranscodeFailure( () => {
                        this._store.setUploadMaterial({
                            materialLifecycle: r,
                            status: F.X.TranscodeFailed
                        })
                    }
                    ),
                    r.onUploadFailure( () => {
                        this._store.setUploadMaterial({
                            materialLifecycle: r,
                            status: F.X.UploadFailed
                        })
                    }
                    ),
                    r.onModelUpdate( () => {
                        var e, i, a, n, o, s, d, l, c, u, h, p, g, m, f;
                        let v = r.getModel();
                        switch (v.status) {
                        case _.a.Uploading:
                            this._store.setUploadMaterial({
                                coverUrl: null === (e = v.uploading) || void 0 === e ? void 0 : e.coverBlob,
                                status: F.X.Uploading,
                                uploadProgress: null !== (a = null === (i = v.uploading) || void 0 === i ? void 0 : i.progress) && void 0 !== a ? a : 0
                            });
                            break;
                        case _.a.Uploaded:
                            this._store.setUploadMaterial({
                                status: F.X.Uploading,
                                uploadProgress: 1
                            });
                            break;
                        case _.a.UploadFailure:
                            this._store.setUploadMaterial({
                                uploadCode: null === (o = v.uploading) || void 0 === o ? void 0 : null === (n = o.error) || void 0 === n ? void 0 : n.code,
                                status: F.X.UploadFailed
                            }),
                            t(null === (d = v.uploading) || void 0 === d ? void 0 : null === (s = d.error) || void 0 === s ? void 0 : s.msg);
                            break;
                        case _.a.Transcoding:
                            this._store.setUploadMaterial({
                                coverUrl: null === (l = v.uploading) || void 0 === l ? void 0 : l.coverBlob,
                                status: F.X.Transcoding,
                                transcodeProgress: null !== (u = null === (c = v.transcoding) || void 0 === c ? void 0 : c.progress) && void 0 !== u ? u : 0
                            });
                            break;
                        case _.a.Transcoded:
                            (null === (h = this._store.uploadMaterial) || void 0 === h ? void 0 : h.status) !== F.X.Online && this._store.setUploadMaterial({
                                status: F.X.Transcoding,
                                transcodeProgress: 1
                            });
                            break;
                        case _.a.TranscodeFailure:
                            this._store.setUploadMaterial({
                                uploadCode: null === (g = v.transcoding) || void 0 === g ? void 0 : null === (p = g.error) || void 0 === p ? void 0 : p.code,
                                status: F.X.TranscodeFailed
                            }),
                            t(null === (f = v.transcoding) || void 0 === f ? void 0 : null === (m = f.error) || void 0 === m ? void 0 : m.msg)
                        }
                    }
                    )
                }
                )
            }
            async addCoverToGraphic() {
                let e;
                let {selectType: t, cover: i, selectFramesForGraphicParams: a} = this._store;
                switch (t) {
                case r.UQ.highlight:
                    {
                        let {materialLifecycle: t} = await this.highlightSuperToMd5();
                        e = t.md5;
                        break
                    }
                case r.UQ.video:
                    {
                        let {materialLifecycle: t} = await this.videoSuperToMd5();
                        e = t.md5;
                        break
                    }
                case r.UQ.staticCover:
                case r.UQ.upload:
                    break;
                default:
                    (0,
                    A.bP)(t)
                }
                e && a.onSelectFrame(e),
                this.closeModal(!0)
            }
            async setStaticCoverWithoutEditor() {
                let e;
                let {selectType: t, uploadMaterial: i} = this._store
                  , a = performance.now();
                switch (t) {
                case r.UQ.upload:
                    (0,
                    A.Y2)(null == i ? void 0 : i.materialLifecycle),
                    e = null == i ? void 0 : i.materialLifecycle;
                    break;
                case r.UQ.highlight:
                    e = (await this.highlightSuperToMd5()).materialLifecycle;
                    break;
                case r.UQ.video:
                    e = (await this.videoSuperToMd5()).materialLifecycle;
                    break;
                case r.UQ.staticCover:
                    this.closeModal(!0);
                    return;
                default:
                    (0,
                    A.bP)(t)
                }
                if (!!e)
                    switch (await this._coverPersistenceManager.setStaticCover(e),
                    this.closeModal(),
                    t) {
                    case r.UQ.upload:
                        (0,
                        E.T)(this._containerService, {
                            time: performance.now() - a
                        });
                        break;
                    case r.UQ.highlight:
                        (0,
                        O.B)(this._containerService, {
                            time: performance.now() - a
                        });
                        break;
                    case r.UQ.video:
                        (0,
                        j.S)(this._containerService, {
                            time: performance.now() - a
                        })
                    }
            }
            constructor(e, t, i, a, r, n, o, s, d) {
                this._store = e,
                this._coverPersistenceManager = t,
                this._coverApi = i,
                this._mainDraftService = a,
                this._mainEditorWidgetService = r,
                this._accountService = n,
                this._containerService = o,
                this._resourceService = s,
                this._draftMaterialsService = d,
                this._modalOpenTime = 0,
                this._isTracksEmpty = !1,
                this._hasVideoSegment = !1,
                this._hasMatting = !1,
                this._canvasOriginStyle = {
                    width: "0px",
                    height: "0px"
                },
                this._prevProgress = 0n,
                this._payinPayoutHelper = this._containerService.createInstance(D.o),
                this._uploadMaterialFromLocalManager = this._containerService.createInstance(I.K, {
                    payinPayoutHelper: this._payinPayoutHelper
                }),
                this._mainDraftService.dataSdk.onChangeDiff( () => {
                    this.refreshTracksInfo()
                }
                ),
                this.refreshTracksInfo(),
                this._accountService.onDidLogin( () => {
                    this._store.setIsLogin(!0)
                }
                ),
                this._accountService.onDidLogout( () => {
                    this._store.setIsLogin(!1)
                }
                ),
                this._store.setIsLogin(this._accountService.hasLogin)
            }
        }
        U = (0,
        a.gn)([(0,
        a.fM)(3, l.n), (0,
        a.fM)(4, c.a), (0,
        a.fM)(5, y.Gw), (0,
        a.fM)(6, f.T), (0,
        a.fM)(7, v.c), (0,
        a.fM)(8, T.D), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === r.ZP ? Object : r.ZP, void 0 === g.M ? Object : g.M, void 0 === p.ZP ? Object : p.ZP, void 0 === l.n ? Object : l.n, void 0 === c.a ? Object : c.a, void 0 === y.Gw ? Object : y.Gw, void 0 === f.T ? Object : f.T, void 0 === v.c ? Object : v.c, void 0 === T.D ? Object : T.D])], U)
    },
    113441: function(e, t, i) {
        i.d(t, {
            w: function() {
                return h
            }
        });
        var a = i(789786);
        i(4987);
        var r = i(439389)
          , n = i(459232)
          , o = i(801497)
          , s = i(166207)
          , d = i(120706)
          , l = i(106161)
          , c = i(317934)
          , u = i(487983);
        class h {
            get isReady() {
                return this._isReady
            }
            get element() {
                return this._iframe
            }
            async ready() {
                await this._initialPromise
            }
            async insertCoverByInit(e) {
                await this._initialPromise,
                this._bridge.action({
                    event: "INSERT_COVER_TO_CANVAS",
                    data: e
                })
            }
            dispose() {
                this._bridge.dispose()
            }
            _handlerGetDraftResource() {
                this._bridge.on("GET_DRAFT_RESOURCE", async e => {
                    try {
                        let t = await this.props.prefetchDraftResource;
                        this._bridge.action({
                            event: "GET_DRAFT_RESOURCE",
                            data: {
                                code: s.b.Success,
                                msg: "success",
                                data: t.value
                            }
                        }, {
                            actionId: e.actionId
                        })
                    } catch (t) {
                        this._bridge.action({
                            event: "GET_DRAFT_RESOURCE",
                            data: {
                                code: -1,
                                msg: `unexpected error:${null == t ? void 0 : t.message}`
                            }
                        }, {
                            actionId: e.actionId
                        })
                    }
                }
                )
            }
            _prefetchMaterialAsset(e) {
                let t = this._prefetchMaterialMap.get(e);
                if (t)
                    return t;
                if (!this.props.prefetchMaterialAsset)
                    throw Error("not found prefetchMaterialAsset props");
                let i = this.props.prefetchMaterialAsset({
                    md5: e
                });
                return this._prefetchMaterialMap.set(e, i),
                i
            }
            _handlerGetMaterialAsset() {
                this._bridge.on("GET_MATERIAL_ASSET", async e => {
                    try {
                        let t = await this._prefetchMaterialAsset(e.data.md5);
                        this._bridge.action({
                            event: "GET_MATERIAL_ASSET",
                            data: {
                                code: s.b.Success,
                                msg: "success",
                                data: t
                            }
                        }, {
                            actionId: e.actionId
                        })
                    } catch (t) {
                        this._bridge.action({
                            event: "GET_MATERIAL_ASSET",
                            data: {
                                code: -1,
                                msg: `unexpected error:${null == t ? void 0 : t.message}`
                            }
                        }, {
                            actionId: e.actionId
                        })
                    }
                }
                )
            }
            _handlerGetDraftAction() {
                this._bridge.on("GET_VIDEO_COVER_DRAFT", async e => {
                    try {
                        let t = await this._coverPersistenceManager.getDraftJsonString();
                        this._bridge.action({
                            event: "GET_VIDEO_COVER_DRAFT",
                            data: {
                                code: s.b.Success,
                                msg: "success",
                                data: {
                                    draft: t
                                }
                            }
                        }, {
                            actionId: e.actionId
                        })
                    } catch (t) {
                        this._bridge.action({
                            event: "GET_VIDEO_COVER_DRAFT",
                            data: {
                                code: -1,
                                msg: `unexpected error:${null == t ? void 0 : t.message}`
                            }
                        }, {
                            actionId: e.actionId
                        })
                    }
                }
                )
            }
            _handlerSaveAction() {
                this._bridge.on("SAVE_COVER", async e => {
                    try {
                        this._coverPersistenceManager.updateGraphicPackageAssets(e.data.packageAssets),
                        await this._coverPersistenceManager.setGraphicDraftCover(e.data.draft, e.data.cover),
                        this._bridge.action({
                            event: "SAVE_COVER",
                            data: {
                                code: s.b.Success,
                                msg: "success"
                            }
                        }, {
                            actionId: e.actionId
                        }),
                        (0,
                        u.V)(this._containerService, {
                            time: Date.now() - e.data.startedAt
                        }),
                        this.props.onClose()
                    } catch (t) {
                        r.Z.error(o.ZP.t("web_network_error", {}, "An error occurred. Try again later.")),
                        this._bridge.action({
                            event: "SAVE_COVER",
                            data: {
                                code: -1,
                                msg: `unexpected error:${null == t ? void 0 : t.message}`
                            }
                        }, {
                            actionId: e.actionId
                        })
                    }
                }
                )
            }
            _handlerSelectVideoFrame() {
                this._bridge.on("SELECT_VIDEO_FRAME", async e => {
                    let t = e => {
                        var t;
                        return {
                            event: "SELECT_VIDEO_FRAME",
                            data: {
                                code: -1,
                                msg: `unexpected error:${null !== (t = null == e ? void 0 : e.message) && void 0 !== t ? t : e}`
                            }
                        }
                    }
                    ;
                    try {
                        let i = await this.props.selectFrameFromVideo();
                        if (i) {
                            let t;
                            this._bridge.action((t = i,
                            {
                                event: "SELECT_VIDEO_FRAME",
                                data: {
                                    code: s.b.Success,
                                    msg: "success",
                                    data: {
                                        md5: t
                                    }
                                }
                            }), {
                                actionId: e.actionId
                            })
                        } else
                            this._bridge.action(t("not found md5"), {
                                actionId: e.actionId
                            })
                    } catch (i) {
                        r.Z.error(o.ZP.t("web_network_error", {}, "An error occurred. Try again later.")),
                        this._bridge.action(t(i), {
                            actionId: e.actionId
                        })
                    }
                }
                )
            }
            constructor(e, t, i, a, r, o) {
                var d, l;
                this._coverPersistenceManager = e,
                this._coverStore = t,
                this.props = i,
                this._mainDraftService = a,
                this._videoEnvironmentService = r,
                this._containerService = o,
                this._isReady = !1,
                this._prefetchMaterialMap = new Map,
                this._initialPromise = new Promise( (e, t) => {
                    this._initialResolve = e,
                    this._initialReject = t
                }
                );
                let u = window.document.createElement("iframe");
                u.setAttribute("style", "height: 100%;width: 100%;border: none;"),
                this._coverStore.setGraphicEditorIframe(u),
                this._iframe = u;
                let h = ""
                  , p = {
                    enter_from: "cover_edit",
                    from_page: this._videoEnvironmentService.appSubType === c.cP.Template ? "template_editor" : "editor",
                    original_edittype: this._videoEnvironmentService.appSubType === c.cP.Template ? "template" : "edit",
                    workspaceId: this._mainDraftService.draftWorkspaceManager.workspaceId,
                    videoDraftId: this._mainDraftService.dataSdk.draftView.getDraftId(),
                    coverId: i.coverId,
                    width: i.width,
                    height: i.height,
                    unit: null !== (d = null == i ? void 0 : i.unit) && void 0 !== d ? d : "px"
                };
                for (let e in p)
                    p[e] && (h += `&${e}=${p[e]}`);
                u.src = (0,
                n.C)(`/ai-design-cover?draftId=${null !== (l = i.draftId) && void 0 !== l ? l : ""}&editorType=web${h}`, null, {
                    logType: "js.href/src",
                    reportOnly: "false",
                    blackConfig: "{}",
                    configMode: "merge",
                    isCloseSSRReport: !1,
                    bid: "cc_web_editor",
                    region: "sg-capcut",
                    urlLimit: "10000",
                    htmlLimit: "-1",
                    isSaveValidUrl: !1,
                    isRuntimeLog: !1,
                    isDOMParser: !1,
                    escapeRule: "escape-report",
                    reportUrl: "https://mon-sg.capcutapi.com/monitor_browser/collect/batch/security/?bid=cc_web_editor",
                    scmBranch: "-",
                    scmName: "W$Zk$2$rd3llREprTWxacFRETmFjRnBI$m5aW%1qbDFZa2RzZFZwWFJub*FNM$o2",
                    scmVersion: "1.0.1.7201",
                    webpackPluginVersion: "3.4.10",
                    filename: "$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1teHNZM2s1-WxrelpHeFph$*w2WTIxTmRscFh$bkJr%npsN$RETmFjRnBI$m5aT%0wNT$XW*s1ZWxwW$NqSmhWMD$zWTNrN%1tRlh$bXhpZ$R*c$lqTmFiR05wT1dwa%0wcHN%REprZ$ZsW$FtOWhWMDEw$2xk%2NH%khPW*xNTW1SN$dWaENiMkZ-$FhS-$-xSndaRWM1Z$$4WE1Xa*li$$p1$2xoSmRX%kl%bWhq-ldReFkz-zlQ%T09"
                }),
                this._bridge = new s.A({
                    iframe: u
                }),
                this._bridge.on("READY", () => {
                    var e;
                    this._isReady = !0,
                    null === (e = i.onReady) || void 0 === e || e.call(i),
                    this._initialResolve()
                }
                ),
                this._bridge.on("CANCEL_GRAPHIC", () => {
                    this.props.onClose()
                }
                ),
                i.coverId && this._prefetchMaterialAsset(i.coverId),
                this._handlerGetMaterialAsset(),
                this._handlerGetDraftResource(),
                this._handlerGetDraftAction(),
                this._handlerSaveAction(),
                this._handlerSelectVideoFrame()
            }
        }
        h = (0,
        a.gn)([(0,
        a.fM)(3, l.n), (0,
        a.fM)(4, c.rO), (0,
        a.fM)(5, d.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof CoverPersistenceManager ? Object : CoverPersistenceManager, "undefined" == typeof CoverStore ? Object : CoverStore, "undefined" == typeof IGraphicEditor ? Object : IGraphicEditor, void 0 === l.n ? Object : l.n, void 0 === c.rO ? Object : c.rO, void 0 === d.T ? Object : d.T])], h)
    },
    75462: function(e, t, i) {
        function a(e) {
            return Object.values(e).reduce( (e, t) => {
                let {width: i, height: a, url: r, key: n} = t;
                return e[`${i}x${a}`] = {
                    full_url: r,
                    width: null != i ? i : 0,
                    height: null != a ? a : 0,
                    aesKey: null != n ? n : ""
                },
                e
            }
            , {})
        }
        function r(e) {
            let t = {
                "360p": {
                    width: 360,
                    height: 360
                },
                "480p": {
                    width: 480,
                    height: 480
                },
                "720p": {
                    width: 720,
                    height: 720
                },
                "1080p": {
                    width: 1080,
                    height: 1080
                }
            };
            return Object.keys(e).reduce( (i, a) => {
                var r, n;
                let {url: o, key: s} = e[a]
                  , d = e[a].width || (null === (r = t[a]) || void 0 === r ? void 0 : r.width) || 0
                  , l = e[a].height || (null === (n = t[a]) || void 0 === n ? void 0 : n.height) || 0;
                return i[`${d}x${l}`] = {
                    full_url: o,
                    width: d,
                    height: l,
                    aesKey: null != s ? s : ""
                },
                i
            }
            , {})
        }
        i.d(t, {
            R: function() {
                return a
            },
            d: function() {
                return r
            }
        })
    },
    457279: function(e, t, i) {
        i.d(t, {
            K: function() {
                return a
            }
        });
        let a = (e, t) => {
            let i = {
                throttle: 300,
                max: .9,
                ...t || {}
            }
              , a = Date.now()
              , r = !1
              , n = () => {
                let t = Math.min((Date.now() - a) / e, i.max);
                i.onprogress(t),
                t >= i.max || window.requestAnimationFrame(n)
            }
            ;
            return window.requestAnimationFrame(n),
            () => {}
        }
    },
    307739: function(e, t, i) {
        i.d(t, {
            u: function() {
                return r
            }
        });
        var a = i(134368);
        let r = (0,
        i(935473).LO)(a.H)
    },
    802475: function(e, t, i) {
        i.d(t, {
            Q: function() {
                return o
            }
        });
        var a = i(789786)
          , r = i(40901)
          , n = i(235001);
        class o {
            _init() {
                this._initWebSocket()
            }
            _initWebSocket() {
                this._initWebSocketCallbackMap(),
                this._registerWebSocketCallback()
            }
            _initWebSocketCallbackMap() {
                this._webSocketCallbackList = [{
                    method: n.h1.WorkspaceRemove,
                    callback: this._registerWorkspaceRemoveCallback
                }, {
                    method: n.h1.WorkspaceUpdate,
                    callback: this._registerWorkspaceUpdateCallback
                }, {
                    method: n.h1.WorkspaceNewMember,
                    callback: this._registerWorkspaceNewMemberCallback
                }]
            }
            _registerWebSocketCallback() {
                this._webSocketCallbackList.forEach(e => {
                    let {method: t, callback: i} = e;
                    this._websocketService.registerCallback(t, i)
                }
                )
            }
            getWebsocketCallbackList() {
                return this._webSocketCallbackList
            }
            constructor(e, t) {
                this._websocketService = e,
                this._workspaceService = t,
                this._webSocketCallbackList = [],
                this._registerWorkspaceRemoveCallback = e => {
                    if (!!e.ok)
                        this._workspaceService.triggerWorkspaceListChange({
                            ...e.value,
                            method: n.h1.WorkspaceRemove
                        })
                }
                ,
                this._registerWorkspaceUpdateCallback = e => {
                    if (!!e.ok)
                        this._workspaceService.triggerWorkspaceListChange({
                            ...e.value,
                            method: n.h1.WorkspaceUpdate
                        })
                }
                ,
                this._registerWorkspaceNewMemberCallback = e => {
                    if (!!e.ok)
                        this._workspaceService.triggerWorkspaceListChange({
                            ...e.value,
                            method: n.h1.WorkspaceNewMember
                        })
                }
                ,
                this._init()
            }
        }
        o = (0,
        a.gn)([(0,
        a.fM)(0, n.J0), (0,
        a.fM)(1, r.W), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === n.J0 ? Object : n.J0, void 0 === r.W ? Object : r.W])], o)
    },
    837767: function(e, t, i) {
        i.d(t, {
            o: function() {
                return c
            }
        });
        var a = i(789786)
          , r = i(532666)
          , n = i(266225)
          , o = i(937746)
          , s = i(570035)
          , d = i(801497)
          , l = i(906419);
        class c extends r.JT {
            setTimelineManager(e) {
                this._timelineManager = e,
                this._initCropListeners()
            }
            _initCropListeners() {
                if (this._store.clear(),
                !this._timelineManager)
                    return;
                let {segmentManager: e} = this._timelineManager;
                this._register(e.onSegmentCropStart( () => {
                    var e, t;
                    this._segmentSourceTimeRangeMap = null === (t = this._segmentSelection.selectionData) || void 0 === t ? void 0 : null === (e = t.getSelectedSegments()) || void 0 === e ? void 0 : e.reduce( (e, t) => {
                        var i;
                        let {start: a=0n, duration: r=0n} = null !== (i = t.sourceTimerange) && void 0 !== i ? i : {};
                        return e[t.id] = {
                            start: a,
                            duration: r
                        },
                        e
                    }
                    , {})
                }
                )),
                this._register(e.onSegmentCropEnd( () => {
                    var e, t, i, a, r;
                    let o = null === (e = this._segmentSelection.selectionData) || void 0 === e ? void 0 : e.getSelectedSegments();
                    if (Array.isArray(o))
                        for (let e of o) {
                            let o = (null === (t = e.material) || void 0 === t ? void 0 : t.type) === n.cVg.MetaTypeVideo;
                            if (!(0,
                            n.hey)(e) || !o || !(null === (i = this._segmentSourceTimeRangeMap) || void 0 === i ? void 0 : i[e.id]))
                                continue;
                            let {start: s=0n, duration: d=0n} = e.sourceTimerange
                              , {start: l=0n, duration: c=0n} = null !== (r = null === (a = this._segmentSourceTimeRangeMap) || void 0 === a ? void 0 : a[e.id]) && void 0 !== r ? r : {};
                            if (!(s >= l) || !(d <= c))
                                this._pipelineRerun({
                                    seg: e,
                                    start: s,
                                    duration: d
                                })
                        }
                    this._segmentSourceTimeRangeMap = {}
                }
                ))
            }
            hasNoiseReductionUsed(e, t) {
                return e.type === n.zzh.NoiseReduction && void 0 !== (null == t ? void 0 : t.level)
            }
            hasDeflickerUsed(e) {
                return e.type === n.zzh.Deflicker
            }
            _pipelineRerun(e) {
                let {seg: t, start: i, duration: a} = e
                  , {algorithms: r, noiseReduction: o} = t.material.videoAlgorithm
                  , {duration: c} = t.material
                  , u = r.reduce( (e, i) => {
                    if (this.hasNoiseReductionUsed(i, o)) {
                        if (this.noiseReductionCheck(t))
                            return e.concat(n.zzh.NoiseReduction);
                        this._notificationService.error(d.ZP.t("web_noise_toast_reduce_removed", {}, "Image noise reduction removed because the clip is longer than 15 minutes")),
                        this._removeSmartTool({
                            segment: t,
                            toolType: s.F2.VideoNoiseReduction
                        })
                    }
                    if (this.hasDeflickerUsed(i)) {
                        if (this.deflickerCheck(t).enable)
                            return e.concat(n.zzh.Deflicker);
                        this._notificationService.error(d.ZP.t("web_flicker_toast_reduce_removed", {}, "Flicker removal canceled because the clip is longer than 15 minutes")),
                        this._removeSmartTool({
                            segment: t,
                            toolType: s.F2.Deflicker
                        })
                    }
                    return e
                }
                , []);
                if (u.length < 1)
                    return;
                let {nextParams: h} = this._pipelineManager.checkApplyDelta(t, {
                    toolType: s.F2.VideoCut,
                    enable: !0,
                    param: {
                        start: i,
                        end: i + a
                    }
                })
                  , p = (0,
                l.Z)(h, "toolType")
                  , g = p[s.F2.VideoCut];
                if (!g)
                    return;
                let m = (c === a ? [] : [g]).concat(h.filter(e => e.toolType !== s.F2.VideoCut))
                  , _ = p[s.F2.VideoNoiseReduction]
                  , f = p[s.F2.Deflicker]
                  , v = this._getRegenerateText(h, p);
                if (this._pipelineManager.getUserActionDelta(t.id).length && (_ || f)) {
                    let e = this._pipelineManager.getTokenBySegmentId(t.id);
                    null == e || e.cancel(),
                    this._pipelineManager.setGlobalLoadingMessageContent(t, v.loading),
                    this._pipelineManager.setGlobalSuccessMessageContent(t, v.success),
                    u.forEach(e => {
                        let i = this._getToolTypeWithPersistType(e);
                        if (!!i)
                            this._pipelineManager.recordUserActionDelta(t.id, {
                                toolType: i,
                                enable: !0,
                                param: p[e]
                            }),
                            this._pipelineManager.switchIntelligent(t, i, m)
                    }
                    );
                    return
                }
                this._pipelineManager.setGlobalLoadingMessageContent(t, v.loading),
                this._pipelineManager.setGlobalSuccessMessageContent(t, v.success),
                this._pipelineManager.switchIntelligent(t, s.F2.VideoCut, m)
            }
            deflickerCheck(e) {
                let {duration: t} = e.sourceTimerange
                  , {duration: i} = e.targetTimerange
                  , {videoAlgorithm: a, width: r, height: o} = e.material
                  , s = a.algorithms.some(e => e.type === n.zzh.ComplementFrame)
                  , l = BigInt(9e8);
                return t > l || s && i > l ? {
                    enable: !1,
                    reason: d.ZP.t("web_flicker_toast_time_limit", {}, "Can\u2019t remove flicker in clips longer than 15 minutes")
                } : r < 128 || o < 128 || r >= 4080 || o >= 4080 ? {
                    enable: !1,
                    reason: d.ZP.t("web_flicker_hovertip_resolution_limit", {}, "You can only remove flicker in clips with both width and height between 128 and 4096 pixels.")
                } : {
                    enable: !0
                }
            }
            noiseReductionCheck(e) {
                if (!this._getIsVideoSeg(e))
                    return !0;
                let {duration: t} = e.sourceTimerange
                  , {duration: i} = e.targetTimerange
                  , {algorithms: a} = e.material.videoAlgorithm
                  , r = a.some(e => e.type === n.zzh.ComplementFrame)
                  , o = BigInt(9e8);
                return !(t > o) && (!r || !(i > o)) && !0
            }
            _removeSmartTool(e) {
                let {segment: t, toolType: i, videoOnly: a=!0} = e;
                if (a && !this._getIsVideoSeg(t))
                    return;
                let {duration: r} = t.sourceTimerange
                  , {duration: n} = t.material;
                r !== n && this._pipelineManager.handleSwitchIntelligent({
                    segment: t,
                    params: {
                        toolType: s.F2.VideoCut,
                        param: {},
                        enable: !1
                    }
                }),
                this._pipelineManager.handleSwitchIntelligent({
                    segment: t,
                    params: {
                        toolType: i,
                        enable: !1,
                        param: {}
                    }
                })
            }
            _getIsVideoSeg(e) {
                var t;
                return (null === (t = e.material) || void 0 === t ? void 0 : t.type) === n.cVg.MetaTypeVideo
            }
            _getRegenerateText(e, t) {
                return e.length > 2 ? {
                    loading: d.ZP.t("web_noise_toast_multiple_trim_reduce", {}, "Clip duration changed. Reapplying features..."),
                    success: d.ZP.t("web_noise_toast_multiple_success", {}, "Features applied")
                } : t[s.F2.VideoNoiseReduction] ? {
                    loading: d.ZP.t("web_noise_toast_trim_re_reduce", {}, "Clip duration changed. Re-reducing image noise..."),
                    success: d.ZP.t("web_noise_toast_reduced", {}, "Image noise reduced")
                } : t[s.F2.Deflicker] ? {
                    loading: d.ZP.t("web_flicker_toast_trim_re_reduce", {}, "Clip duration changed. Removing flicker again..."),
                    success: d.ZP.t("web_flicker_label_removed", {}, "Flicker removed")
                } : {
                    loading: d.ZP.t("web_noise_toast_multiple_trim_reduce", {}, "Clip duration changed. Reapplying features..."),
                    success: d.ZP.t("web_noise_toast_multiple_success", {}, "Features applied")
                }
            }
            _getToolTypeWithPersistType(e) {
                return e === n.zzh.NoiseReduction ? s.F2.VideoNoiseReduction : e === n.zzh.Deflicker ? s.F2.Deflicker : void 0
            }
            constructor(e, t, i, a) {
                super(),
                this._timelineManager = e,
                this._pipelineManager = t,
                this._segmentSelection = i,
                this._notificationService = a
            }
        }
        c = (0,
        a.gn)([(0,
        a.fM)(3, o.lT), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [Object, "undefined" == typeof PipelineManager ? Object : PipelineManager, "undefined" == typeof SegmentSelection ? Object : SegmentSelection, void 0 === o.lT ? Object : o.lT])], c)
    },
    699381: function(e, t, i) {
        i.d(t, {
            $: () => I
        });
        var a = i("789786")
          , r = i("863214")
          , n = i("425241")
          , o = i("266225")
          , s = i("120706")
          , d = i("530308")
          , l = i("272619")
          , c = i("532666")
          , u = i("511216")
          , h = i("357200")
          , p = i("483438")
          , g = i("137124")
          , m = i("947926")
          , _ = i("392554")
          , f = i("201359")
          , v = i("573478")
          , y = i("10134")
          , S = i("901888")
          , w = i("379851");
        class b extends c.JT {
            get source() {
                return p.Sc.Gameplay
            }
            get product() {
                return (0,
                n.Y2)(this._product),
                this._product
            }
            get status() {
                return this._cancellation.token.isCancellationRequested ? p.xR.Cancelled : this._job ? (0,
                y.s)(this._job.status) : p.xR.Running
            }
            get error() {
                return this._error
            }
            async _startJob() {
                var e;
                if (this._store.clear(),
                this._cancellation.token.isCancellationRequested)
                    return;
                let t = this._smartToolsService.makeBuilder()
                  , i = await (0,
                S.aP)(this._segment, this._draftPathStore, this._resourceService)
                  , a = (0,
                S.R5)(this._segment, this._accountService.hasLogin)
                  , r = (0,
                o.MnT)(this._segment.material);
                t.createGameplayTask(i, a, null !== (e = null == r ? void 0 : r.algorithm) && void 0 !== e ? e : ""),
                this._job = t.build(),
                this._job.onError(e => {
                    this._error = e,
                    this._onError.fire(this._error)
                }
                ),
                this._job.onProgress(e => {
                    this._onProgress.fire(e)
                }
                ),
                this._job.onSuccess(e => {
                    (0,
                    n.Y2)(1 === e.length),
                    this._downloadAndAddResourceService(e[0])
                }
                )
            }
            async _downloadAndAddResourceService(e) {
                var t, i;
                let a = [{
                    md5: null !== (t = e.md5) && void 0 !== t ? t : "",
                    vid: null !== (i = e.vid) && void 0 !== i ? i : "",
                    url: e.url,
                    key: e.key
                }].filter(e => "" !== e.md5 || "" !== e.vid)
                  , r = await this._containerService.invokeFunction(f.CH, {
                    list: a
                }, {
                    resourceType: p.uG.SmartTools,
                    resourceId: e.taskId,
                    isGameplay: !0
                });
                if (!r.ok) {
                    this._error = r,
                    this._onError.fire(this._error);
                    return
                }
                e.groupType === g.wM.Image ? this._accountService.hasLogin ? this._handleImageProduct(e, r.value) : this._handleFileProduct(e, r.value) : this._accountService.hasLogin ? this._handleVideoProduct(e, r.value) : this._handleFileProduct(e, r.value)
            }
            async _handleImageProduct(e, t) {
                let i = this._containerService.invokeFunction(f.Fq, t, this._draftPathStore)
                  , a = await this._containerService.invokeFunction(w.RG, i[0].id, i[0].path);
                if (!a.ok) {
                    this._error = a,
                    this._onError.fire(this._error);
                    return
                }
                this._product = {
                    path: i[0].path,
                    groupType: p.FI.Image,
                    resourceId: e.resourceId,
                    resourceName: e.resourceName
                },
                this._onSuccess.fire(this._product)
            }
            async _handleVideoProduct(e, t) {
                let i = this._containerService.invokeFunction(f.Rg, t, this._draftPathStore);
                (0,
                n.Y2)(i.length >= 1);
                let a = await (0,
                f.TB)(this._resourceService, i[0].id);
                this._product = {
                    path: i[0].path,
                    ...a,
                    groupType: p.FI.Video,
                    resourceId: e.resourceId,
                    resourceName: e.resourceName
                };
                let r = await this._containerService.invokeFunction(w.U3, this._renderManager, this._product);
                if (!r.ok) {
                    this._error = r,
                    this._onError.fire(this._error);
                    return
                }
                this._onSuccess.fire(this._product)
            }
            async _handleFileProduct(e, t) {
                let i = this._containerService.invokeFunction(f.Jy, t, this._draftPathStore);
                (0,
                n.Y2)(i.length >= 1);
                let a = await (0,
                f.gF)(this._resourceService, i[0].id);
                if (this._product = {
                    path: i[0].path,
                    ...a,
                    groupType: p.FI.Video,
                    resourceId: e.resourceId,
                    resourceName: e.resourceName
                },
                e.groupType === g.wM.Video) {
                    let e = await this._containerService.invokeFunction(w.U3, this._renderManager, this._product);
                    if (!e.ok) {
                        this._error = e,
                        this._onError.fire(this._error);
                        return
                    }
                } else if (e.groupType === g.wM.Image) {
                    let t = await this._containerService.invokeFunction(w.F4, e.resourceId, this._draftPathStore.getDraftPathFromResourceKey(e.resourceId));
                    if (!t.ok) {
                        this._error = t,
                        this._onError.fire(this._error);
                        return
                    }
                } else
                    (0,
                    n.bP)(e.groupType);
                this._onSuccess.fire(this._product)
            }
            constructor(e, t, i, a, r, n, o) {
                super(),
                this._segment = e,
                this._renderManager = t,
                this._draftPathStore = i,
                this._accountService = a,
                this._smartToolsService = r,
                this._containerService = n,
                this._resourceService = o,
                this._onProgress = new l.Q,
                this._onError = new l.Q,
                this._onSuccess = new l.Q,
                this._onCancel = new l.Q,
                this._cancellation = new h.A,
                this._error = (0,
                u.ly)(),
                this.cancel = () => {
                    this._job ? this._job.cancel() : this._cancellation.cancel(),
                    this._onCancel.fire()
                }
                ,
                this.onProgress = this._onProgress.event,
                this.onError = this._onError.event,
                this.onSuccess = this._onSuccess.event,
                this.onCancel = this._onCancel.event,
                this._preTask = new v.J(this._segment,this._draftPathStore,this._resourceService,this._accountService),
                this._register(this._preTask.onProgress(e => {
                    this._onProgress.fire(Math.floor(e / 2))
                }
                )),
                this._register(this._preTask.onSuccess( () => {
                    this._startJob()
                }
                )),
                this._register(this._preTask.onError(e => {
                    this._error = e,
                    this._onError.fire(this._error)
                }
                )),
                this._preTask.execute()
            }
        }
        b = (0,
        a.gn)([(0,
        a.fM)(3, _.D), (0,
        a.fM)(4, g.dM), (0,
        a.fM)(5, s.T), (0,
        a.fM)(6, m.c), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof SegmentVideoReadonly ? Object : SegmentVideoReadonly, "undefined" == typeof RenderManager ? Object : RenderManager, "undefined" == typeof DraftPathStore ? Object : DraftPathStore, void 0 === _.D ? Object : _.D, void 0 === g.dM ? Object : g.dM, void 0 === s.T ? Object : s.T, void 0 === m.c ? Object : m.c])], b);
        var M = i("657405")
          , k = i("803654");
        function T(e) {
            return e.reverse ? `${e.id}_${e.material.reversePath}` : `${e.id}_${e.material.path}`
        }
        class I {
            updateRenderManager(e) {
                this._renderManager = e
            }
            startGamePlay(e) {
                var t, i, a;
                let r = e
                  , n = r.id;
                if (!r)
                    return;
                let s = (0,
                o.MnT)(r.material)
                  , d = null !== (a = null == s ? void 0 : s.algorithm) && void 0 !== a ? a : ""
                  , l = (null == r ? void 0 : null === (t = r.material) || void 0 === t ? void 0 : t.path) || "";
                if (!d || !l)
                    return;
                this._originalMaterialMap.set(r.id, this._intelligenceStore.idToOriginMaterial[n]),
                null === (i = this._currentRequestMap[r.id]) || void 0 === i || i.cancel();
                let c = this._getOrCreateToken(r);
                if (this._currentRequestMap[r.id] = c,
                c.status === p.xR.Success)
                    return this._intelligenceStore.actionSetIntermediateMaterial(r.id, r.material.clone()),
                    this._replaceResource(r, c),
                    c;
                let u = Date.now();
                return (0,
                k.Z)(this._containerService, {
                    type: "gameplay",
                    stage: "start",
                    value: d,
                    errorMsg: c.error.msg
                }),
                c.onSuccess(e => {
                    if ((0,
                    k.Z)(this._containerService, {
                        type: "gameplay",
                        stage: "success",
                        value: d,
                        costTime: Date.now() - u,
                        errorMsg: c.error.msg
                    }),
                    !!(r = this._dataSdk.draftView.getSegmentById(n)))
                        this._intelligenceStore.actionSetIntermediateMaterial(r.id, r.material.clone()),
                        this._replaceResource(r, c)
                }
                ),
                c.onError(e => {
                    (0,
                    k.Z)(this._containerService, {
                        type: "gameplay",
                        stage: "fail",
                        value: d,
                        costTime: Date.now() - u,
                        errorMsg: c.error.msg
                    })
                }
                ),
                c.onCancel( () => {
                    (0,
                    k.Z)(this._containerService, {
                        type: "gameplay",
                        stage: "cancel",
                        value: d,
                        costTime: Date.now() - u,
                        errorMsg: c.error.msg
                    })
                }
                ),
                c
            }
            cancelGamePlay(e) {
                let t = !(arguments.length > 1) || void 0 === arguments[1] || arguments[1];
                !Array.isArray(e) && (e = [e]),
                e.forEach(e => {
                    var i;
                    null === (i = this._currentRequestMap[e]) || void 0 === i || i.cancel(),
                    t && this._recoverMutable(e),
                    this._originalMaterialMap.delete(e)
                }
                )
            }
            _getOrCreateToken(e) {
                (0,
                n.Y2)((0,
                o.hey)(e)),
                (0,
                n.Y2)("" !== e.material.path);
                let t = this._cache.getGameplayCache(T(e));
                if (t)
                    return t;
                let i = this._containerService.createInstance(b, e, this._renderManager, this._draftPathStore);
                return i.onSuccess( () => {
                    this._cache.setGameplayCache(T(e), i)
                }
                ),
                i
            }
            _replaceImageToImageGamePlayResult(e) {
                let t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : ""
                  , i = this._dataSdk.draftView.getSegmentById(e);
                if (!i)
                    return;
                let {path: a} = i.material;
                if (!a)
                    return;
                let r = this._dataSdk.draftView.getDraftIdAndSegById(i.id);
                if (!!r)
                    this._dataSdk.api.segment.innerReplace({
                        draftId: r.draftId,
                        identifier: {
                            id: i.id,
                            material: {
                                path: a
                            }
                        },
                        substitute: {
                            material: {
                                path: t,
                                sourcePlatform: o.cvu.MaterialPlatformDefault
                            }
                        }
                    })
            }
            _replaceImageToVideoGamePlayResult(e, t) {
                let {path: i, resourceId: a, resourceName: r} = t;
                if (!this._originalMaterialMap.get(e))
                    return;
                let n = this._dataSdk.draftView.getDraftIdAndSegById(e);
                if (!!n)
                    this._dataSdk.api.segment.innerReplace({
                        draftId: n.draftId,
                        identifier: {
                            id: n.segment.id,
                            material: {
                                path: n.segment.material.path
                            }
                        },
                        substitute: {
                            material: {
                                path: i,
                                type: o.cVg.MetaTypeVideo,
                                materialId: a,
                                materialName: r,
                                sourcePlatform: o.cvu.MaterialPlatformDefault,
                                duration: n.segment.targetTimerange.duration
                            }
                        }
                    })
            }
            async _recoverMutable(e) {
                let t = this._originalMaterialMap.get(e);
                if (t) {
                    let e = await (0,
                    M.jm)(this._dataSdk, this._renderManager, t);
                    this._dataSdk.api.template.setMutableVideos(e)
                }
            }
            _replaceResource(e, t) {
                (0,
                n.Y2)(t.status === p.xR.Success);
                try {
                    t.product.groupType === p.FI.Image ? this._replaceImageToImageGamePlayResult(e.id, t.product.path) : this._replaceImageToVideoGamePlayResult(e.id, {
                        path: t.product.path,
                        resourceId: t.product.resourceId,
                        resourceName: t.product.resourceName
                    })
                } catch (e) {} finally {
                    delete this._currentRequestMap[e.id]
                }
            }
            constructor(e, t, i, a, r, n) {
                this._cache = e,
                this._dataSdk = t,
                this._renderManager = i,
                this._draftPathStore = a,
                this._intelligenceStore = r,
                this._containerService = n,
                this._originalMaterialMap = new Map,
                this._currentRequestMap = {}
            }
        }
        I = (0,
        a.gn)([(0,
        a.fM)(5, s.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [void 0 === d.v ? Object : d.v, "undefined" == typeof IDataSdk ? Object : IDataSdk, "undefined" == typeof RenderManager ? Object : RenderManager, void 0 === r.H ? Object : r.H, "undefined" == typeof IntelligenceStore ? Object : IntelligenceStore, void 0 === s.T ? Object : s.T])], I)
    },
    644145: function(e, t, i) {
        i.d(t, {
            I: function() {
                return P
            }
        });
        var a = i(789786);
        i(4987);
        var r = i(439389)
          , n = i(266225)
          , o = i(570035)
          , s = i(186215)
          , d = i(120706)
          , l = i(947926)
          , c = i(392554)
          , u = i(42680)
          , h = i(28178)
          , p = i(425241)
          , g = i(801497)
          , m = i(722169)
          , _ = i(500445)
          , f = i(483438)
          , v = i(260963)
          , y = i(529814)
          , S = i(139302)
          , w = i(913237)
          , b = i(797352)
          , M = i(937746)
          , k = i(657405)
          , T = i(317934)
          , I = i(132994);
        class P {
            get _control() {
                return n.lLh.getInstance().get("attachment_video_algorithm.json")
            }
            get dataSdk() {
                return this._dataSdk
            }
            get timelineManager() {
                return this._timelineManager
            }
            get segmentManager() {
                return this._timelineManager.segmentManager
            }
            get intelligenceStore() {
                return this._intelligenceStore
            }
            updateRenderManager(e) {
                this._renderManager = e
            }
            setTimelineManager(e) {
                this._timelineManager = e
            }
            handleSwitchIntelligent(e) {
                let {segment: t, params: i, options: a} = e
                  , r = this.getTokenBySegmentId(t.id);
                null == r || r.cancel();
                let {isEqual: n, isEmpty: o, nextParams: s} = this.checkApplyDelta(t, i)
                  , d = this.getPipelineId(t);
                if (n && !(!d && (null == a ? void 0 : a.forcePipeline))) {
                    this.handleEqualUserAction(t);
                    return
                }
                if (o) {
                    this.handleEmptyUserAction(t, s);
                    return
                }
                this.setLoadingState(t.id, {
                    loading: !0,
                    loadingText: void 0,
                    progress: 0
                }),
                this.recordUserActionDelta(t.id, i),
                this.getUserActionDelta(t.id).every(e => !e.enable) && this._notificationService.info(g.ZP.t("web_color_correction_toast_restart_others", {
                    string0: this.getToastWhenDisabling(i.toolType)
                }, "{string0} was removed. Other features that were applied will be applied again, and it will take some time."));
                let l = this.switchIntelligent(t, i.toolType, s, null == a ? void 0 : a.onFinished);
                return this.addTokenBySegmentId(t.id, l),
                l
            }
            switchIntelligent(e, t, i, a, r) {
                (0,
                p.Y2)((0,
                n.hey)(e)),
                (0,
                p.Y2)("" !== e.material.path);
                let o = this._containerService.createInstance(h.o, e, i, this._renderManager, this._draftPathStore);
                if (this._reportFn(e, {
                    toolType: t,
                    functionName: this._getFunctionName(t),
                    status: "start",
                    duration: 0
                }),
                this._segmentIdDurationMap.set(e.id, performance.now()),
                this._segmentIdLoadingTimestamp = new Date().getTime(),
                this._segmentIdMaterialMap.set(e.id, this._intelligenceStore.idToOriginMaterial[e.id]),
                this._segmentIdTokenMap.set(e.id, o),
                o.onSuccess(i => {
                    r || this.handleSuccess(e, t, i),
                    null == a || a()
                }
                ),
                o.onError(i => {
                    this.handleError(e, t, i),
                    null == a || a()
                }
                ),
                o.onProgress( (t, i) => {
                    this.handleProgress(t, i, e)
                }
                ),
                o.onCancel( () => {
                    this.handleCancel(e, t)
                }
                ),
                o.onCancelWithMidProdApply(t => {
                    let {product: i, successToolTypes: r} = null != t ? t : {};
                    this.handleCancelWithMidProdApply(e, i, r),
                    null == a || a()
                }
                ),
                (0,
                n.hey)(e)) {
                    var s, d;
                    this._intelligenceStore.actionSetIntermediateMaterial(e.id, null === (s = (d = e.material).clone) || void 0 === s ? void 0 : s.call(d))
                }
                let l = this._segmentIdGlobalLoadingMessageContentMap.get(e.id);
                if (l) {
                    let t = (0,
                    I.f)({
                        content: l,
                        onCancel: () => {
                            o.cancelWithMidProdApply()
                        }
                        ,
                        notificationService: this._notificationService
                    });
                    this._segmentIdGlobalLoadingMessageCloseMap.set(e.id, t)
                }
                return o
            }
            handleSuccess(e, t, i, a) {
                var r;
                this._playManager.pause(),
                this.deleteTokenBySegmentId(e.id),
                this._updatePipelineId(e, i);
                let n = this._getNextParams(e).nextParams;
                this._updateAllIntelligent(e, n, i, a);
                let o = this._getSuccessText(e, t, n);
                this.segmentManager.setTimelineSegmentLoading(e.id, !1, this._segmentIdLoadingTimestamp),
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                this.deleteUserActionDelta(e.id),
                o && this._notificationService.success(o),
                this._reportFn(e, {
                    toolType: t,
                    functionName: this._getFunctionName(t),
                    status: "success",
                    duration: this._segmentIdDurationMap.get(e.id) ? performance.now() - this._segmentIdDurationMap.get(e.id) : 0
                }),
                this._segmentIdDurationMap.delete(e.id),
                this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),
                this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),
                null === (r = this._segmentIdGlobalLoadingMessageCloseMap.get(e.id)) || void 0 === r || r(),
                this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)
            }
            handleCancelWithMidProdApply(e, t, i) {
                var a;
                this._playManager.pause(),
                this.deleteTokenBySegmentId(e.id);
                let r = this._getNextParams(e).nextParams.filter(e => null == i ? void 0 : i.includes(e.toolType));
                t && r.length ? (this._updatePipelineId(e, t),
                this._updateAllIntelligent(e, r, t)) : this.deleteAllIntelligent(e),
                this.segmentManager.setTimelineSegmentLoading(e.id, !1, this._segmentIdLoadingTimestamp),
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                this.deleteUserActionDelta(e.id),
                this._segmentIdDurationMap.delete(e.id),
                this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),
                this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),
                null === (a = this._segmentIdGlobalLoadingMessageCloseMap.get(e.id)) || void 0 === a || a(),
                this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)
            }
            handleError(e, t, i) {
                var a;
                this.deleteTokenBySegmentId(e.id),
                this.segmentManager.setTimelineSegmentLoading(e.id, !1, this._segmentIdLoadingTimestamp),
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                this.deleteUserActionDelta(e.id);
                let r = this._getNextParams(e).nextParams
                  , n = this._getPipelineFailedMessageContent(t, r);
                n && this._notificationService.error(n),
                this._reportFn(e, {
                    toolType: t,
                    functionName: this._getFunctionName(t),
                    status: "fail",
                    duration: this._segmentIdDurationMap.get(e.id) ? performance.now() - this._segmentIdDurationMap.get(e.id) : 0,
                    errorCode: i.code.toString()
                }),
                this._segmentIdDurationMap.delete(e.id),
                this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),
                this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),
                null === (a = this._segmentIdGlobalLoadingMessageCloseMap.get(e.id)) || void 0 === a || a(),
                this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)
            }
            handleProgress(e, t, i) {
                var a;
                let r = this.getLoadingText(t)
                  , {tool_type: n} = null != t ? t : {};
                if (t && n === o.F2.VideoCut) {
                    let {nextParams: e} = this._getNextParams(i)
                      , a = e.findIndex(e => e.toolType === o.F2.VideoCut) + 1;
                    if (a < e.length) {
                        let {toolType: i} = e[a];
                        r = this.getLoadingText({
                            ...t,
                            tool_type: i,
                            process: 0
                        })
                    }
                }
                this.segmentManager.setTimelineSegmentLoading(i.id, !0, this._segmentIdLoadingTimestamp, null != r ? r : g.ZP.t("load_web_ing", {}, "loading")),
                this.setLoadingState(i.id, {
                    loading: !0,
                    loadingText: r,
                    progress: null !== (a = null == t ? void 0 : t.process) && void 0 !== a ? a : 0,
                    toolType: null == t ? void 0 : t.tool_type
                })
            }
            handleCancel(e, t) {
                var i;
                this.getTokenBySegmentId(e.id) && this._reportFn(e, {
                    toolType: t,
                    functionName: this._getFunctionName(t),
                    status: "cancel",
                    duration: this._segmentIdDurationMap.get(e.id) ? performance.now() - this._segmentIdDurationMap.get(e.id) : 0
                }),
                this.deleteTokenBySegmentId(e.id),
                this.segmentManager.setTimelineSegmentLoading(e.id, !1, this._segmentIdLoadingTimestamp),
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                this.deleteUserActionDelta(e.id),
                this._segmentIdDurationMap.delete(e.id),
                this._segmentIdGlobalLoadingMessageContentMap.delete(e.id),
                this._segmentIdGlobalSuccessMessageContentMap.delete(e.id),
                null === (i = this._segmentIdGlobalLoadingMessageCloseMap.get(e.id)) || void 0 === i || i(),
                this._segmentIdGlobalLoadingMessageCloseMap.delete(e.id)
            }
            cancelPipelineModify(e) {
                let t = !(arguments.length > 1) || void 0 === arguments[1] || arguments[1];
                (Array.isArray(e) ? e : [e]).forEach(e => {
                    var i;
                    if (this._segmentIdDurationMap.delete(e),
                    null === (i = this._segmentIdTokenMap.get(e)) || void 0 === i || i.cancel(),
                    t) {
                        let t = this._segmentIdMaterialMap.get(e);
                        t && this._recoverMutable(t)
                    }
                    this.deleteTokenBySegmentId(e),
                    this._intelligenceStore.actionIntelligentReset(e, f.Sc.Pipeline)
                }
                )
            }
            addTokenBySegmentId(e, t) {
                this._segmentIdTokenMap.set(e, t)
            }
            getTokenBySegmentId(e) {
                return this._segmentIdTokenMap.get(e)
            }
            deleteTokenBySegmentId(e) {
                this._segmentIdTokenMap.delete(e)
            }
            setLoadingState(e, t) {
                this._segmentIdLoadingState.set(e, t)
            }
            getLoadingState(e) {
                var t;
                return null !== (t = this._segmentIdLoadingState.get(e)) && void 0 !== t ? t : {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }
            }
            recordUserActionDelta(e, t) {
                var i;
                let a = null !== (i = this._segmentIdUserActionDelta.get(e)) && void 0 !== i ? i : [];
                this._segmentIdUserActionDelta.set(e, a.filter(e => e.toolType !== t.toolType).concat(t))
            }
            getUserActionDelta(e) {
                var t;
                return null !== (t = this._segmentIdUserActionDelta.get(e)) && void 0 !== t ? t : []
            }
            deleteUserActionDelta(e) {
                this._segmentIdUserActionDelta.delete(e)
            }
            checkApplyDelta(e, t) {
                let {oldData: i, newData: a, nextParams: r} = this._getNextParams(e, t)
                  , {algorithmList: n} = a;
                return {
                    isEqual: (0,
                    m.isEqual)(i, a),
                    isEmpty: 0 === n.filter(e => e.enable).length && !a.isReverse && !a.isMatting,
                    nextParams: r
                }
            }
            getIntelligentState(e, t) {
                var i, a, r, s, d, l, c, u, h, p, g, _, f, v, y, S, w, b, M, k, T, I, P, F, D, A, x, C, R, E;
                switch (t) {
                case o.F2.VideoReverseTask:
                    return {
                        toolType: t,
                        enable: !!e.reverse,
                        param: {}
                    };
                case o.F2.VideoMaskTask:
                case o.F2.ImageMaskTask:
                    return {
                        toolType: t,
                        enable: !!(null === (a = e.material) || void 0 === a ? void 0 : null === (i = a.matting) || void 0 === i ? void 0 : i.flag),
                        param: {}
                    };
                case o.F2.VideoIntelligentToning:
                case o.F2.PictureIntelligentToning:
                    {
                        let i = null === (s = e.adjust) || void 0 === s ? void 0 : null === (r = s.smartAdjustColor) || void 0 === r ? void 0 : r.value;
                        if ((0,
                        m.isNil)(i))
                            return;
                        return {
                            toolType: t,
                            enable: !!(null === (d = e.adjust) || void 0 === d ? void 0 : d.enableSmartColorAdjust),
                            param: {
                                level: i
                            }
                        }
                    }
                case o.F2.VideoStabilization:
                    {
                        let i = null === (c = e.material) || void 0 === c ? void 0 : null === (l = c.stable) || void 0 === l ? void 0 : l.stableLevel;
                        if ((0,
                        m.isNil)(i))
                            return;
                        return {
                            toolType: t,
                            enable: !!(null === (h = e.material) || void 0 === h ? void 0 : null === (u = h.stable) || void 0 === u ? void 0 : u.stableLevel),
                            param: {
                                level: i
                            }
                        }
                    }
                case o.F2.VideoSlowMotion:
                    {
                        let i = null === (_ = e.material) || void 0 === _ ? void 0 : null === (g = _.videoAlgorithm) || void 0 === g ? void 0 : null === (p = g.algorithms) || void 0 === p ? void 0 : p.find(e => e.type === n.zzh.ComplementFrame)
                          , a = null === (y = e.material) || void 0 === y ? void 0 : null === (v = y.videoAlgorithm) || void 0 === v ? void 0 : null === (f = v.complementFrameConfig) || void 0 === f ? void 0 : f.mode;
                        if ((0,
                        m.isNil)(a))
                            return;
                        return {
                            toolType: t,
                            enable: !!i,
                            param: {
                                name: a
                            }
                        }
                    }
                case o.F2.TemplateCVTask:
                    {
                        let i = (0,
                        n.MnT)(e.material)
                          , {algorithm: a} = null != i ? i : {};
                        if ((0,
                        m.isNil)(a))
                            return;
                        return {
                            toolType: t,
                            enable: !!a,
                            param: {
                                req_json: null == i ? void 0 : i.algorithm
                            }
                        }
                    }
                case o.F2.ImageNoiseReduction:
                case o.F2.VideoNoiseReduction:
                    {
                        let i = null === (b = e.material) || void 0 === b ? void 0 : null === (w = b.videoAlgorithm) || void 0 === w ? void 0 : null === (S = w.algorithms) || void 0 === S ? void 0 : S.find(e => e.type === n.zzh.NoiseReduction);
                        if ((0,
                        m.isNil)(i))
                            return;
                        return {
                            toolType: t,
                            enable: !!i,
                            param: {
                                level: null === (T = e.material) || void 0 === T ? void 0 : null === (k = T.videoAlgorithm) || void 0 === k ? void 0 : null === (M = k.noiseReduction) || void 0 === M ? void 0 : M.level
                            }
                        }
                    }
                case o.F2.Deflicker:
                    {
                        let i = null === (F = e.material) || void 0 === F ? void 0 : null === (P = F.videoAlgorithm) || void 0 === P ? void 0 : null === (I = P.algorithms) || void 0 === I ? void 0 : I.find(e => e.type === n.zzh.Deflicker);
                        if ((0,
                        m.isNil)(i))
                            return;
                        return {
                            toolType: t,
                            enable: !!i,
                            param: {
                                level: null === (x = e.material) || void 0 === x ? void 0 : null === (A = x.videoAlgorithm) || void 0 === A ? void 0 : null === (D = A.deflicker) || void 0 === D ? void 0 : D.level,
                                mode: null === (E = e.material) || void 0 === E ? void 0 : null === (R = E.videoAlgorithm) || void 0 === R ? void 0 : null === (C = R.deflicker) || void 0 === C ? void 0 : C.mode
                            }
                        }
                    }
                default:
                    return
                }
            }
            handleEqualUserAction(e) {
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                this.deleteUserActionDelta(e.id)
            }
            handleEmptyUserAction(e, t, i) {
                this._updateAllIntelligent(e, t, {
                    path: "",
                    url: "",
                    key: "",
                    pipelineId: ""
                }, i),
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                this.deleteUserActionDelta(e.id)
            }
            getToastWhenDisabling(e) {
                return ({
                    [o.F2.VideoIntelligentToning]: g.ZP.t("web_color_correction_name_correction", {}, "AI color correction"),
                    [o.F2.PictureIntelligentToning]: g.ZP.t("web_color_correction_name_correction", {}, "AI color correction"),
                    [o.F2.VideoStabilization]: g.ZP.t("web_video_stable_text_stablize", {}, "Stabilize"),
                    [o.F2.VideoSlowMotion]: g.ZP.t("web_frame_fill_text_smooth_slow", {}, "Smooth slow-mo"),
                    [o.F2.VideoReverseTask]: g.ZP.t("reverse_web", {}, "Video reverse"),
                    [o.F2.VideoMaskTask]: g.ZP.t("web_auto_remove", {}, "Intelligent Object Removal"),
                    [o.F2.ImageMaskTask]: g.ZP.t("web_auto_remove", {}, "Intelligent Object Removal"),
                    [o.F2.TemplateCVTask]: g.ZP.t("gameplay", {}, "gameplay"),
                    [o.F2.VideoNoiseReduction]: g.ZP.t("web_noise_feature_name", {}, "Reduce image noise"),
                    [o.F2.ImageNoiseReduction]: g.ZP.t("web_noise_feature_name", {}, "Reduce image noise"),
                    [o.F2.Deflicker]: g.ZP.t("web_flicker_feature_name", {}, "Remove flicker"),
                    [o.F2.VideoCut]: ""
                })[e]
            }
            deleteAllIntelligent(e) {
                var t, i, a, r, o, s, d, l, c, u, h, p, g, m;
                if (![n.cVg.MetaTypeVideo, n.cVg.MetaTypePhoto].some(t => e.material.type === t))
                    return;
                let _ = e.id;
                e.reverse && this.dataSdk.api.video.reverse({
                    segId: _,
                    isReverse: !1,
                    reversePath: ""
                }),
                (null === (i = e.material) || void 0 === i ? void 0 : null === (t = i.matting) || void 0 === t ? void 0 : t.flag) && (this.dataSdk.api.video.clearMatting({
                    segId: _,
                    path: ""
                }),
                e.material.type === n.cVg.MetaTypePhoto && this.dataSdk.api.video.setVideoAlgorithm({
                    segmentId: _,
                    path: "",
                    timeRange: e.targetTimerange
                })),
                (null === (a = e.adjust) || void 0 === a ? void 0 : a.enableSmartColorAdjust) && this.dataSdk.api.video.setSmartColorAdjust({
                    enable: !1,
                    segmentId: _,
                    path: null,
                    smartAdjustColor: void 0
                }),
                (null === (o = e.material) || void 0 === o ? void 0 : null === (r = o.stable) || void 0 === r ? void 0 : r.stableLevel) && this.dataSdk.api.video.setStable({
                    stableLevel: 0,
                    matrixPath: "",
                    segmentId: _,
                    path: ""
                });
                let f = null === (l = e.material) || void 0 === l ? void 0 : null === (d = l.videoAlgorithm) || void 0 === d ? void 0 : null === (s = d.algorithms) || void 0 === s ? void 0 : s.find(e => e.type === n.zzh.ComplementFrame)
                  , v = null === (h = e.material) || void 0 === h ? void 0 : null === (u = h.videoAlgorithm) || void 0 === u ? void 0 : null === (c = u.algorithms) || void 0 === c ? void 0 : c.find(e => e.type === n.zzh.NoiseReduction)
                  , y = null === (m = e.material) || void 0 === m ? void 0 : null === (g = m.videoAlgorithm) || void 0 === g ? void 0 : null === (p = g.algorithms) || void 0 === p ? void 0 : p.find(e => e.type === n.zzh.Deflicker);
                f && this.dataSdk.api.video.setVideoAlgorithm({
                    segmentId: _,
                    path: "",
                    enable: !1,
                    algorithm: {
                        algorithmId: "",
                        type: n.zzh.ComplementFrame
                    },
                    complementFrameConfig: {
                        mode: n.zAn.OpticalFlow
                    }
                }),
                v && this.dataSdk.api.video.setVideoAlgorithm({
                    segmentId: _,
                    path: "",
                    enable: !1,
                    algorithm: {
                        algorithmId: "",
                        type: n.zzh.NoiseReduction
                    },
                    complementFrameConfig: {
                        mode: n.zAn.Origin
                    }
                }),
                y && this.dataSdk.api.video.setVideoAlgorithm({
                    segmentId: _,
                    path: "",
                    enable: !1,
                    algorithm: {
                        algorithmId: "",
                        type: n.zzh.Deflicker
                    },
                    complementFrameConfig: {
                        mode: n.zAn.Origin
                    }
                })
            }
            async _recoverMutable(e) {
                let t = await (0,
                k.jm)(this._dataSdk, this._renderManager, e);
                this._dataSdk.api.template.setMutableVideos(t)
            }
            getLoadingText(e) {
                if (!e)
                    return;
                let {tool_type: t, process: i} = e;
                return ({
                    [o.F2.PictureIntelligentToning]: g.ZP.t("web_color_correction_loading_correction", {
                        number0: i
                    }, "Applying AI color correction... {number0}%"),
                    [o.F2.VideoIntelligentToning]: g.ZP.t("web_color_correction_loading_correction", {
                        number0: i
                    }, "Applying AI color correction... {number0}%"),
                    [o.F2.VideoStabilization]: g.ZP.t("web_video_stable_text_being_applied", {
                        number0: i
                    }, "Stabilizing... {number0}%"),
                    [o.F2.VideoSlowMotion]: g.ZP.t("web_frame_fill_text_processing_hundred", {
                        number0: i
                    }, "Applying smooth slow-mo... {number0}%"),
                    [o.F2.VideoReverseTask]: `${g.ZP.t("reverse_web", {}, "Video Reverse")}...${i}%`,
                    [o.F2.VideoMaskTask]: g.ZP.t("web_video_stable_text_auto_cut_all", {
                        number0: i
                    }, "Removing background... {number0}%"),
                    [o.F2.ImageMaskTask]: g.ZP.t("web_video_stable_text_auto_cut_all", {
                        number0: i
                    }, "Removing background... {number0}%"),
                    [o.F2.VideoNoiseReduction]: g.ZP.t("web_noise_in_progress", {
                        number0: i
                    }, "Reducing image noise... {number0}%"),
                    [o.F2.ImageNoiseReduction]: g.ZP.t("web_noise_in_progress", {
                        number0: i
                    }, "Reducing image noise... {number0}%"),
                    [o.F2.Deflicker]: g.ZP.t("web_flicker_removing_flicker", {
                        number0: i
                    }, "Removing flicker\u2026 {number0}%")
                })[t]
            }
            getProductResourceType(e) {
                let t = this._getAppliedToolTypes(e);
                return this.getPipelineId(e) ? this._accoutService.hasLogin && (!t.isReverse || t.algorithmList.length) ? u._g.UserVideo : u._g.UserFile : void 0
            }
            setGlobalLoadingMessageContent(e, t) {
                this._segmentIdGlobalLoadingMessageContentMap.set(e.id, t)
            }
            setGlobalSuccessMessageContent(e, t) {
                this._segmentIdGlobalSuccessMessageContentMap.set(e.id, t)
            }
            _getAppliedToolTypes(e) {
                var t, i;
                let a = this._getOrderedToolType(e);
                return {
                    isReverse: !!(null === (t = this.getIntelligentState(e, o.F2.VideoReverseTask)) || void 0 === t ? void 0 : t.enable),
                    isMatting: !!(null === (i = this.getIntelligentState(e, o.F2.VideoMaskTask)) || void 0 === i ? void 0 : i.enable),
                    algorithmList: a
                }
            }
            _getToolType(e, t) {
                if ((0,
                k.AG)(e))
                    return o.F2.TemplateCVTask;
                let i = e.material.type === n.cVg.MetaTypeVideo;
                return ({
                    [n.G3_.SmartColor]: i ? o.F2.VideoIntelligentToning : o.F2.PictureIntelligentToning,
                    [n.G3_.Stable]: o.F2.VideoStabilization,
                    [n.G3_.ComplementFrame]: o.F2.VideoSlowMotion,
                    [n.G3_.NoiseReduction]: i ? o.F2.VideoNoiseReduction : o.F2.ImageNoiseReduction,
                    [n.G3_.Deflicker]: o.F2.Deflicker
                })[t.type]
            }
            _getOrderedToolType(e) {
                var t, i;
                return (null !== (i = null === (t = this.dataSdk.draftView.getVideoAlgorithm(e.id)) || void 0 === t ? void 0 : t.algorithms) && void 0 !== i ? i : []).map(t => this.getIntelligentState(e, this._getToolType(e, t))).filter(e => !(0,
                m.isUndefined)(e)).filter(e => e.enable)
            }
            _getNextParams(e, t) {
                var i, a;
                let r = e.material.type === n.cVg.MetaTypeVideo
                  , s = {
                    [o.F2.VideoReverseTask]: !0,
                    [o.F2.VideoMaskTask]: !0,
                    [o.F2.ImageMaskTask]: !0
                }
                  , d = t ? this.getUserActionDelta(e.id).filter(e => e.toolType !== t.toolType).concat(t) : this.getUserActionDelta(e.id)
                  , l = this._getAppliedToolTypes(e)
                  , c = l.algorithmList.filter(e => !d.find(t => t.toolType === e.toolType)).concat(d.filter(e => e.enable && !s[e.toolType]))
                  , u = d.find(e => e.toolType === o.F2.VideoReverseTask)
                  , h = d.find(e => [o.F2.VideoMaskTask, o.F2.ImageMaskTask].some(t => t === e.toolType))
                  , p = {
                    isReverse: !!(u ? u.enable : null === (i = this.getIntelligentState(e, o.F2.VideoReverseTask)) || void 0 === i ? void 0 : i.enable),
                    isMatting: !!(h ? h.enable : null === (a = this.getIntelligentState(e, o.F2.VideoMaskTask)) || void 0 === a ? void 0 : a.enable),
                    algorithmList: c
                }
                  , g = [];
                return p.isReverse && g.push({
                    toolType: o.F2.VideoReverseTask,
                    param: {}
                }),
                p.isMatting && g.push({
                    toolType: r ? o.F2.VideoMaskTask : o.F2.ImageMaskTask,
                    param: {}
                }),
                g.push(...c.map(e => (0,
                m.omit)(e, "enable"))),
                {
                    oldData: l,
                    newData: p,
                    nextParams: g
                }
            }
            _updateAllIntelligent(e, t, i, a) {
                let s;
                (0,
                p.Y2)(this.dataSdk),
                !a && (s = this.dataSdk.api.batch.batchStart());
                let d = Object.values({
                    video: [o.F2.VideoReverseTask, o.F2.VideoMaskTask, o.F2.VideoIntelligentToning, o.F2.VideoStabilization, o.F2.VideoSlowMotion, o.F2.TemplateCVTask, o.F2.VideoNoiseReduction, o.F2.Deflicker],
                    image: [o.F2.ImageMaskTask, o.F2.PictureIntelligentToning, o.F2.TemplateCVTask, o.F2.ImageNoiseReduction]
                }[e.material.type === n.cVg.MetaTypeVideo ? "video" : "image"]).map(t => this.getIntelligentState(e, t)).filter(e => e)
                  , l = t.reduce( (e, t) => (e[t.toolType] = t,
                e), {})
                  , c = this._dataSdk.draftView.getDraftIdAndSegById(e.id)
                  , u = (null == c ? void 0 : c.draftId) || this._dataSdk.draftView.getDraftId()
                  , h = this._dataSdk.draftView.getDraftId()
                  , m = (0,
                T.JY)(this._environmentService) || h !== (null == c ? void 0 : c.draftId);
                d.forEach(t => {
                    if ((null == t ? void 0 : t.enable) && !l[t.toolType])
                        switch (t.toolType) {
                        case o.F2.VideoReverseTask:
                            this.dataSdk.api.video.reverse({
                                segId: e.id,
                                isReverse: !1,
                                reversePath: ""
                            }),
                            this.dataSdk.api.video.setVideoAlgorithm({
                                segmentId: e.id,
                                path: "",
                                timeRange: e.targetTimerange
                            });
                            break;
                        case o.F2.VideoMaskTask:
                            this.dataSdk.api.video.clearMatting({
                                segId: e.id,
                                path: ""
                            });
                            break;
                        case o.F2.ImageMaskTask:
                            this.dataSdk.api.video.clearMatting({
                                segId: e.id,
                                path: ""
                            }),
                            this.dataSdk.api.video.setVideoAlgorithm({
                                segmentId: e.id,
                                path: "",
                                timeRange: e.targetTimerange
                            });
                            break;
                        case o.F2.PictureIntelligentToning:
                        case o.F2.VideoIntelligentToning:
                            this.dataSdk.api.video.setSmartColorAdjust({
                                enable: !1,
                                segmentId: e.id,
                                path: null,
                                smartAdjustColor: void 0
                            });
                            break;
                        case o.F2.VideoStabilization:
                            this.dataSdk.api.video.setStable({
                                stableLevel: 0,
                                matrixPath: "",
                                segmentId: e.id,
                                path: ""
                            });
                            break;
                        case o.F2.VideoSlowMotion:
                            this.dataSdk.api.video.setVideoAlgorithm({
                                segmentId: e.id,
                                path: "",
                                enable: !1,
                                algorithm: {
                                    algorithmId: "",
                                    type: n.zzh.ComplementFrame
                                },
                                timeRange: e.targetTimerange,
                                complementFrameConfig: {
                                    mode: t.param.name
                                }
                            });
                            break;
                        case o.F2.ImageNoiseReduction:
                        case o.F2.VideoNoiseReduction:
                            this.dataSdk.api.video.setVideoAlgorithm({
                                segmentId: e.id,
                                path: "",
                                enable: !1,
                                algorithm: {
                                    algorithmId: "",
                                    type: n.zzh.NoiseReduction
                                },
                                timeRange: e.targetTimerange
                            });
                            break;
                        case o.F2.Deflicker:
                            this.dataSdk.api.video.setVideoAlgorithm({
                                segmentId: e.id,
                                path: "",
                                enable: !1,
                                algorithm: {
                                    algorithmId: "",
                                    type: n.zzh.Deflicker
                                },
                                timeRange: e.targetTimerange
                            });
                            break;
                        default:
                            return
                        }
                }
                ),
                t.forEach(t => {
                    switch (t.toolType) {
                    case o.F2.VideoReverseTask:
                        this._renderManager.clearTrackingRelation(e.id, !0) && r.Z.warning(g.ZP.t("web_tracking_toast_tracking_removed_reversed", {}, "The video is reversed. Tracking is removed.")),
                        e.material.objectLocked && (this.dataSdk.api.video.removeObjectLocked({
                            segmentId: e.id
                        }),
                        r.Z.warning(g.ZP.t("web_camera_tracking_reversed", {}, "Clip reversed. Camera tracking is removed."))),
                        this._replaceReverseResult(e, i, u, m);
                        break;
                    case o.F2.VideoMaskTask:
                        this._replaceVideoMattingResult(e, i, u, m);
                        break;
                    case o.F2.ImageMaskTask:
                        this._replaceImageMattingResult(e, i, u, m);
                        break;
                    case o.F2.PictureIntelligentToning:
                    case o.F2.VideoIntelligentToning:
                        this.dataSdk.api.video.setSmartColorAdjust({
                            enable: !0,
                            segmentId: e.id,
                            path: i.path,
                            smartAdjustColor: {
                                value: t.param.level,
                                type: n.cVg.MetaTypeSmartColorAdjust,
                                subType: n.DeX.MetaSubTypeNone,
                                effectId: "",
                                resId: "",
                                platform: "all",
                                path: ""
                            }
                        });
                        break;
                    case o.F2.VideoStabilization:
                        this._renderManager.clearTrackingRelation(e.id, !0) && r.Z.warning(g.ZP.t("web_tracking_text_stabilized_no_tracking", {}, "The video is stabilized. Tracking is removed.")),
                        e.material.objectLocked && (this.dataSdk.api.video.removeObjectLocked({
                            segmentId: e.id
                        }),
                        r.Z.warning(g.ZP.t("web_camera_tracking_stabilized", {}, "Clip stabilized. Camera tracking is removed."))),
                        this._replaceStableResult(e, i, u, m, t);
                        break;
                    case o.F2.VideoSlowMotion:
                        this._renderManager.clearTrackingRelation(e.id, !0) && r.Z.warning(g.ZP.t("web_tracking_text_smooth_slow_mo_no_tracking", {}, "Smooth slow motion applied. Tracking is removed.")),
                        m ? this._replaceTemplateVideoAlgorithmResult(e, i, u) : this.dataSdk.api.video.setVideoAlgorithm({
                            segmentId: e.id,
                            path: i.path,
                            enable: !0,
                            algorithm: {
                                algorithmId: "",
                                type: n.zzh.ComplementFrame
                            },
                            timeRange: e.targetTimerange,
                            complementFrameConfig: {
                                mode: t.param.name
                            }
                        });
                        break;
                    case o.F2.TemplateCVTask:
                        this._replaceImageToVideoGamePlayResult(e, i, u);
                        break;
                    case o.F2.ImageNoiseReduction:
                    case o.F2.VideoNoiseReduction:
                        this.dataSdk.api.video.setVideoAlgorithm({
                            segmentId: e.id,
                            path: i.path,
                            enable: !0,
                            algorithm: {
                                algorithmId: "",
                                type: n.zzh.NoiseReduction
                            },
                            noiseReduction: {
                                segmentId: e.id,
                                level: t.param.level
                            },
                            timeRange: e.targetTimerange
                        });
                        break;
                    case o.F2.Deflicker:
                        this.dataSdk.api.video.setVideoAlgorithm({
                            segmentId: e.id,
                            path: i.path,
                            enable: !0,
                            algorithm: {
                                algorithmId: "",
                                type: n.zzh.Deflicker
                            },
                            deflicker: {
                                segmentId: e.id,
                                mode: t.param.mode,
                                level: t.param.level
                            },
                            timeRange: e.targetTimerange
                        });
                        break;
                    default:
                        return
                    }
                }
                ),
                !a && this.dataSdk.api.batch.batchEnd(s, {
                    canUndoRedo: !m
                })
            }
            _replaceReverseResult(e, t, i, a) {
                let {path: r} = t;
                a ? this._segmentInnerReplace(e, {
                    material: {
                        reversePath: r,
                        videoAlgorithm: {
                            path: r
                        }
                    }
                }, i) : (this.dataSdk.api.video.reverse({
                    segId: e.id,
                    isReverse: !0,
                    reversePath: r
                }),
                this.dataSdk.api.video.setVideoAlgorithm({
                    segmentId: e.id,
                    path: r,
                    timeRange: e.targetTimerange
                }))
            }
            _replaceVideoMattingResult(e, t, i, a) {
                var r;
                let o = (0,
                _.t)({
                    mattingPath: t.matting.path,
                    edgeMattingPath: null === (r = t.mattingEdge) || void 0 === r ? void 0 : r.path
                });
                a ? this._segmentInnerReplace(e, {
                    material: {
                        matting: {
                            flag: BigInt(n.R6k.webAiMattingFlag | n.R6k.enableFlag),
                            path: o
                        }
                    }
                }, i) : this.dataSdk.api.video.setMatting({
                    segId: e.id,
                    path: o
                })
            }
            _replaceImageMattingResult(e, t, i, a) {
                let {path: r} = t;
                a ? this._segmentInnerReplace(e, {
                    material: {
                        matting: {
                            flag: BigInt(n.R6k.webAiMattingFlag | n.R6k.enableFlag),
                            path: r
                        },
                        videoAlgorithm: {
                            path: r
                        }
                    }
                }, i) : (this.dataSdk.api.video.setMatting({
                    segId: e.id,
                    path: r
                }),
                this.dataSdk.api.video.setVideoAlgorithm({
                    segmentId: e.id,
                    path: r,
                    timeRange: e.targetTimerange
                }))
            }
            _replaceStableResult(e, t, i, a, r) {
                let {path: n} = t;
                a ? this._segmentInnerReplace(e, {
                    material: {
                        stable: {
                            stableLevel: r.param.level,
                            matrixPath: ""
                        },
                        videoAlgorithm: {
                            path: n
                        }
                    }
                }, i) : this.dataSdk.api.video.setStable({
                    stableLevel: r.param.level,
                    matrixPath: "",
                    segmentId: e.id,
                    path: n
                })
            }
            _replaceTemplateVideoAlgorithmResult(e, t, i) {
                let {path: a} = t;
                this._segmentInnerReplace(e, {
                    material: {
                        videoAlgorithm: {
                            path: a
                        }
                    }
                }, i)
            }
            _replaceImageToVideoGamePlayResult(e, t, i) {
                let {path: a, resourceId: r, productType: o} = t;
                this._segmentInnerReplace(e, {
                    material: {
                        path: a,
                        type: o,
                        materialId: r,
                        sourcePlatform: n.cvu.MaterialPlatformDefault,
                        duration: e.targetTimerange.duration
                    }
                }, i)
            }
            _segmentInnerReplace(e, t, i) {
                this._dataSdk.api.segment.innerReplace({
                    draftId: i,
                    identifier: {
                        id: e.id,
                        material: {
                            path: e.material.path
                        }
                    },
                    substitute: t
                })
            }
            getPipelineId(e) {
                var t;
                return null === (t = this.dataSdk.draftView.getVideoAlgorithm(e.id)) || void 0 === t ? void 0 : t.pipelineId
            }
            _updatePipelineId(e, t) {
                var i, a, r;
                let n = this._dataSdk.draftView.getTrackBySegmentId(e.id);
                this._control.updateAttachmentJson(e.id, n.id, {
                    pipelineId: t.pipelineId,
                    materialId: e.material.id,
                    path: t.path,
                    mattingPath: (0,
                    _.t)({
                        mattingPath: null !== (r = null === (i = t.matting) || void 0 === i ? void 0 : i.path) && void 0 !== r ? r : "",
                        edgeMattingPath: null === (a = t.mattingEdge) || void 0 === a ? void 0 : a.path
                    })
                }, this._dataSdk)
            }
            getFailedText(e) {
                this._getSpecificToolTypeFailedContent(e)
            }
            _getSpecificToolTypeFailedContent(e) {
                switch (e) {
                case o.F2.VideoNoiseReduction:
                case o.F2.ImageNoiseReduction:
                    return g.ZP.t("web_noise_toast_fail", {}, "Couldn\u2019t reduce image noise. Try again.");
                case o.F2.VideoIntelligentToning:
                case o.F2.PictureIntelligentToning:
                    return g.ZP.t("web_color_correction_toast_not_applied", {}, "Couldn\u2019t apply AI color correction");
                case o.F2.VideoStabilization:
                    return g.ZP.t("web_video_stable_text_fail_stable", {}, "Couldn\u2019t stabilize");
                case o.F2.VideoSlowMotion:
                    return g.ZP.t("web_frame_fill_text_failed_frame", {}, "Couldn\u2019t apply smooth slow-mo");
                case o.F2.VideoReverseTask:
                    return g.ZP.t("fail_operate_retry", {}, "Operation failed, please try again later");
                case o.F2.VideoMaskTask:
                case o.F2.ImageMaskTask:
                    return g.ZP.t("web_smart_keying_failed", {}, "Intelligent Object Removal Failed");
                case o.F2.Deflicker:
                    return g.ZP.t("web_flicker_toast_fail", {}, "Couldn\u2019t remove flicker. Try again.");
                default:
                    return ""
                }
            }
            _getPipelineFailedMessageContent(e, t) {
                var i;
                if (!(null === (i = navigator) || void 0 === i ? void 0 : i.onLine))
                    return g.ZP.t("network_unavailable__please_try_again_later", {}, "Network error. Try again later.");
                let a = g.ZP.t("web_noise_something_went_wrong", {}, "Something went wrong");
                return t.length > 1 ? a : this._getSpecificToolTypeFailedContent(e)
            }
            _getSuccessText(e, t, i) {
                let a = this._segmentIdGlobalSuccessMessageContentMap.get(e.id);
                if (a)
                    return a;
                if (i.length > 1)
                    return g.ZP.t("web_noise_toast_multiple_success", {}, "Features applied");
                switch (t) {
                case o.F2.VideoSlowMotion:
                    return g.ZP.t("web_editor_toolsmodify_toast_slowmo_success", {}, "Smooth slow-mo applied");
                case o.F2.VideoMaskTask:
                    return g.ZP.t("web_editor_toolsmodify_toast_removebg_success", {}, "Background removed");
                case o.F2.VideoNoiseReduction:
                case o.F2.ImageNoiseReduction:
                    return g.ZP.t("web_noise_toast_reduced", {}, "Image noise reduced");
                case o.F2.Deflicker:
                    return g.ZP.t("web_flicker_removed_toast", {}, "Flicker removed");
                case o.F2.VideoStabilization:
                    return g.ZP.t("web_editor_toolsmodify_toast_stabilize_success", {}, "Video stabilized");
                default:
                    return ""
                }
            }
            _getFunctionName(e) {
                return ({
                    [o.F2.VideoIntelligentToning]: "ai_color_correction",
                    [o.F2.PictureIntelligentToning]: "ai_color_correction",
                    [o.F2.VideoStabilization]: "stabilize",
                    [o.F2.VideoSlowMotion]: "smooth_slow_mo",
                    [o.F2.VideoReverseTask]: void 0,
                    [o.F2.VideoMaskTask]: void 0,
                    [o.F2.ImageMaskTask]: void 0,
                    [o.F2.TemplateCVTask]: void 0,
                    [o.F2.VideoNoiseReduction]: "denoise",
                    [o.F2.ImageNoiseReduction]: "denoise",
                    [o.F2.VideoCut]: "video_cut",
                    [o.F2.Deflicker]: "deflicker"
                })[e]
            }
            async _reportFn(e, t) {
                let i = (0,
                S.p8)(e)
                  , {path: a, type: r} = e.material
                  , d = this._draftPathStore.getResourceKeyFromDraftPath(a)
                  , l = {
                    materialCategory: i.material_category,
                    materialFormat: "",
                    materialDuration: "",
                    materialResolution: "",
                    materialSize: "",
                    materialName: i.material_name,
                    panelCategory: i.panel_category,
                    ...t
                };
                if (d) {
                    let e, t, i;
                    try {
                        i = this._draftMaterialsService.getMaterialByKey(d)
                    } catch {}
                    switch (r) {
                    case n.cVg.MetaTypeVideo:
                        if (i) {
                            let {width: e, height: t, size: a=0, subType: r="", duration: n=0} = i;
                            Object.assign(l, {
                                materialFormat: r,
                                materialDuration: (1e3 * n).toString(),
                                materialResolution: `${e}x${t}`,
                                materialSize: (a / 1024).toString()
                            })
                        } else if (e = u._g.Video,
                        (t = this._resourceService.get(d, e)) && (await (0,
                        s.Z)(t)).ok) {
                            let {originVideo: e} = t.value
                              , {width: i, height: a, size: r, format: n} = e;
                            Object.assign(l, {
                                materialFormat: n,
                                materialDuration: "",
                                materialResolution: `${i}x${a}`,
                                materialSize: (r / 1024).toString()
                            })
                        }
                        break;
                    case n.cVg.MetaTypePhoto:
                        if (i) {
                            let {width: e, height: t, size: a=0, subType: r=""} = i;
                            Object.assign(l, {
                                materialFormat: r,
                                materialResolution: `${e}x${t}`,
                                materialSize: (a / 1024).toString()
                            });
                            break
                        }
                        if (e = u._g.Photo,
                        (t = this._resourceService.get(d, e)) && (await (0,
                        s.Z)(t)).ok) {
                            let {format: e} = t.value;
                            Object.assign(l, {
                                materialFormat: e
                            })
                        }
                    }
                }
                let c = t.toolType === o.F2.ImageMaskTask || t.toolType === o.F2.VideoMaskTask;
                !c && (0,
                y.x)(this._containerService, l),
                c && (0,
                b.TK)(this._containerService, l)
            }
            _initSegmentSplitListener() {
                this._dataSdk.onChangeDiff(e => {
                    var t, i, a, r, o;
                    let s, d;
                    let {actionOperateType: l, hasMainTrackSegmentTargetTimeChange: c, isRecovery: u, isInBatchMode: h, segment: p} = e;
                    if (l !== n.aWQ.Local || !c || u || h || 2 !== p.length || !p.every(e => [n.C8.UPDATE, n.C8.ADD].includes(e.type)))
                        return;
                    for (let e of p)
                        e.type === n.C8.UPDATE ? s = e.item : e.type === n.C8.ADD && (d = e.item);
                    if (!d || !s)
                        return;
                    let {segment: g} = d;
                    if (!(0,
                    n.hey)(g))
                        return;
                    let m = this._dataSdk.draftView.getSegmentById(s.id);
                    if (!m || !(0,
                    n.hey)(m) || (null === (t = m.material) || void 0 === t ? void 0 : t.path) !== (null == g ? void 0 : null === (i = g.material) || void 0 === i ? void 0 : i.path))
                        return;
                    let {start: _, duration: f} = null !== (a = null == m ? void 0 : m.sourceTimerange) && void 0 !== a ? a : {}
                      , {start: v} = null !== (r = null == g ? void 0 : g.sourceTimerange) && void 0 !== r ? r : {};
                    if (v !== _ + f || !v)
                        return;
                    let y = this.getTokenBySegmentId(m.id);
                    if (!y)
                        return;
                    let S = this.getUserActionDelta(m.id);
                    this._segmentIdUserActionDelta.set(g.id, S),
                    this._segmentIdDurationMap.set(g.id, null !== (o = this._segmentIdDurationMap.get(m.id)) && void 0 !== o ? o : performance.now()),
                    this._segmentIdTokenMap.set(g.id, y);
                    let[{toolType: w}] = S;
                    y.onSuccess(e => {
                        this.handleSuccess(g, w, e)
                    }
                    ),
                    y.onError(e => {
                        this.handleError(g, w, e)
                    }
                    ),
                    y.onProgress( (e, t) => {
                        this.handleProgress(e, t, g)
                    }
                    ),
                    y.onCancel( () => {
                        this.handleCancel(g, w)
                    }
                    ),
                    y.onCancelWithMidProdApply(e => {
                        let {product: t, successToolTypes: i} = null != e ? e : {};
                        this.handleCancelWithMidProdApply(g, t, i)
                    }
                    )
                }
                )
            }
            constructor(e, t, i, a, r, n, o, s, d, l, c, u) {
                this._dataSdk = e,
                this._timelineManager = t,
                this._renderManager = i,
                this._draftPathStore = a,
                this._intelligenceStore = r,
                this._playManager = n,
                this._containerService = o,
                this._resourceService = s,
                this._draftMaterialsService = d,
                this._notificationService = l,
                this._accoutService = c,
                this._environmentService = u,
                this._segmentIdTokenMap = (0,
                v.LO)(new Map),
                this._segmentIdLoadingState = (0,
                v.LO)(new Map),
                this._segmentIdUserActionDelta = (0,
                v.LO)(new Map),
                this._segmentIdDurationMap = new Map,
                this._segmentIdMaterialMap = new Map,
                this._segmentIdGlobalLoadingMessageContentMap = new Map,
                this._segmentIdGlobalLoadingMessageCloseMap = new Map,
                this._segmentIdGlobalSuccessMessageContentMap = new Map,
                this._segmentIdLoadingTimestamp = new Date().getTime(),
                this._initSegmentSplitListener()
            }
        }
        P = (0,
        a.gn)([(0,
        a.fM)(6, d.T), (0,
        a.fM)(7, l.c), (0,
        a.fM)(8, w.D), (0,
        a.fM)(9, M.lT), (0,
        a.fM)(10, c.D), (0,
        a.fM)(11, T.rO), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof IDataSdk ? Object : IDataSdk, Object, "undefined" == typeof RenderManager ? Object : RenderManager, "undefined" == typeof DraftPathStore ? Object : DraftPathStore, "undefined" == typeof IntelligenceStore ? Object : IntelligenceStore, "undefined" == typeof PlayerManager ? Object : PlayerManager, void 0 === d.T ? Object : d.T, void 0 === l.c ? Object : l.c, void 0 === w.D ? Object : w.D, void 0 === M.lT ? Object : M.lT, void 0 === c.D ? Object : c.D, void 0 === T.rO ? Object : T.rO])], P)
    },
    286311: function(e, t, i) {
        i.d(t, {
            v: function() {
                return w
            }
        });
        var a = i(789786);
        i(4987);
        var r = i(439389)
          , n = i(266225)
          , o = i(260963)
          , s = i(801497)
          , d = i(113486)
          , l = i(120706)
          , c = i(363818)
          , u = i(970184)
          , h = i(106161)
          , p = i(272619)
          , g = i(532666)
          , m = i(425241)
          , _ = i(854894)
          , f = i(374287)
          , v = i(924436)
          , y = i(937746)
          , S = i(657405);
        class w extends g.JT {
            get dataSdk() {
                return this._mainDraftService.dataSdk
            }
            get timelineManager() {
                return this._timelineManager
            }
            get segmentManager() {
                return this._timelineManager.segmentManager
            }
            updateRenderManager(e) {
                this._renderManager = e
            }
            _setLoadingUI(e, t, i, a) {
                let r = this._noticeLoadingIdsMap.get(e)
                  , n = `smart-crop-loading-notice-${e}`;
                if (t) {
                    if (this.segmentManager.setTimelineSegmentLoading(e, t, this._segmentIdLoadingTimestamp, s.ZP.t("web_edit_text_smart_ratio_wait", {
                        number0: null != i ? i : 0
                    }, "Applying auto reframe... {number0}%")),
                    r)
                        this._notificationService.updateLoading(e, s.ZP.t("web_edit_text_smart_ratio_wait", {
                            number0: null != i ? i : 0
                        }, "Applying auto reframe... {number0}%"), {
                            duration: 4e4,
                            className: n
                        });
                    else {
                        let {id: t} = this._notificationService.loading(s.ZP.t("web_edit_text_smart_ratio_wait", {
                            number0: null != i ? i : 0
                        }, "Applying auto reframe... {number0}%"), {}, {
                            id: e,
                            duration: 4e4,
                            className: n
                        });
                        setTimeout( () => {
                            let e = document.querySelector(`.${n}`);
                            e && e.addEventListener("click", () => {
                                null == a || a()
                            }
                            )
                        }
                        , 2e3),
                        this._noticeLoadingIdsMap.set(e, t)
                    }
                } else {
                    this.segmentManager.setTimelineSegmentLoading(e, !1, this._segmentIdLoadingTimestamp);
                    let t = this._noticeLoadingIdsMap.get(e);
                    this._notificationService.updateLoading(e, s.ZP.t("web_edit_text_smart_ratio_wait", {
                        number0: null != i ? i : 100
                    }, "Applying auto reframe... {number0}%"), {
                        duration: 1
                    }),
                    this._notificationService.close(t, e),
                    this._noticeLoadingIdsMap.delete(e)
                }
            }
            setLoadingState(e, t) {
                this._segmentIdLoadingState.set(e, t)
            }
            getLoadingState(e) {
                var t;
                return null !== (t = this._segmentIdLoadingState.get(e)) && void 0 !== t ? t : {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }
            }
            async getSubject(e) {
                let t = performance.now()
                  , i = {
                    material_type: "video",
                    reco_time_ms: e.currentFrameTime
                };
                (0,
                _.V)(this._containerService, {
                    ...i
                });
                let a = await this._smartCropDataService.getSmartCropSubject(e)
                  , r = performance.now() - t;
                if (!a.ok) {
                    (0,
                    f.C)(this._containerService, {
                        ...i,
                        time: r,
                        status: -1
                    });
                    return
                }
                return a.value.subjectList.length > 0 ? (0,
                f.C)(this._containerService, {
                    ...i,
                    time: r,
                    status: 1
                }) : (0,
                f.C)(this._containerService, {
                    ...i,
                    time: r,
                    status: 0
                }),
                a
            }
            getSmartCropToken(e) {
                return this._segmentIdTokenMap.get(e)
            }
            setTimelineManager(e) {
                this._timelineManager = e
            }
            startSmartCrop(e, t, i) {
                let {segment: a, params: r} = e
                  , n = performance.now();
                this._segmentIdLoadingTimestamp = new Date().getTime();
                let o = this.getSmartCropToken(a.id);
                null == o || o.cancel(),
                this.setLoadingState(a.id, {
                    loading: !0,
                    loadingText: void 0,
                    progress: 0
                }),
                this._setLoadingUI(a.id, !0, 0, t);
                let s = this._containerService.createInstance(d.c, a, r, this._mainDraftService.draftPathStore, this._algorithmFilerManager);
                return (0,
                v.e)(this._containerService, {
                    material_type: r.extra.material_type,
                    material_format: r.extra.material_format,
                    material_resolution: r.extra.material_resolution,
                    crop_resolution: r.extra.crop_resolution,
                    duration: r.extra.duration,
                    status: "start"
                }),
                this._segmentIdTokenMap.set(a.id, s),
                s.onProgress( (e, i) => {
                    this._setLoadingUI(a.id, !0, e, t),
                    this.setLoadingState(a.id, {
                        loading: !0,
                        loadingText: void 0,
                        progress: null != e ? e : 0
                    }),
                    this._onProgress.fire({
                        segmentId: a.id,
                        progress: null != e ? e : 0
                    })
                }
                ),
                s.onSuccess(e => {
                    if (this._deleteIfEqual(a.id, s),
                    e) {
                        let t = performance.now() - n;
                        this.handleSuccess(a, r, e, e.cache_path, t),
                        this._onSuccess.fire({
                            segmentId: a.id,
                            params: r
                        })
                    }
                }
                ),
                s.onError(e => {
                    this._deleteIfEqual(a.id, s),
                    this._slardarAdapterService.captureException("smart crop error", e),
                    this.handleError(a.id, e, r, i),
                    this._onError.fire({
                        segmentId: a.id,
                        params: r
                    })
                }
                ),
                s.onCancel( () => {
                    this._setLoadingUI(a.id, !1, 0),
                    this._deleteIfEqual(a.id, s),
                    this.setLoadingState(a.id, {
                        loading: !1,
                        loadingText: void 0,
                        progress: 0
                    }),
                    this._onCancel.fire({
                        segmentId: a.id,
                        params: r
                    }),
                    (0,
                    v.e)(this._containerService, {
                        material_type: r.extra.material_type,
                        material_format: r.extra.material_format,
                        material_resolution: r.extra.material_resolution,
                        crop_resolution: r.extra.crop_resolution,
                        duration: r.extra.duration,
                        status: "cancel",
                        fail_reason: "cancel"
                    })
                }
                ),
                s
            }
            _deleteIfEqual(e, t) {
                t === this._segmentIdTokenMap.get(e) && this._segmentIdTokenMap.delete(e)
            }
            cancelSmartCrop(e) {
                var t;
                null === (t = this._segmentIdTokenMap.get(e)) || void 0 === t || t.cancel()
            }
            handleSuccess(e, t, i, a, o) {
                var d, l;
                this._setLoadingUI(e.id, !1),
                this.setLoadingState(e.id, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                (0,
                m.Y2)(this.dataSdk);
                let c = this.dataSdk.api.batch.batchStart();
                this._renderManager.clearTrackingRelation(e.id, !0) && setTimeout( () => {
                    r.Z.warning(s.ZP.t("web_tracking_text_auto_reframe_no_tracking", {}, "Auto reframe applied. Tracking is removed."))
                }
                , 500),
                this.dataSdk.api.video.crop({
                    segId: e.id,
                    cropRatio: n.j8m.CropRatioFree
                });
                let u = null !== (l = null === (d = S.A9[t.extra.crop_ratio]) || void 0 === d ? void 0 : d.strValue) && void 0 !== l ? l : "original";
                this.dataSdk.api.video.addSmartCrop({
                    segId: e.id,
                    cropRatio: "free" === u ? "custom" : u,
                    stability: t.stableWeight,
                    trackSpeed: null == t ? void 0 : t.keyFrameFps,
                    cachePath: a
                }),
                (0,
                v.e)(this._containerService, {
                    material_type: t.extra.material_type,
                    material_format: t.extra.material_format,
                    material_resolution: t.extra.material_resolution,
                    crop_resolution: t.extra.crop_resolution,
                    duration: t.extra.duration,
                    time: o,
                    status: "success"
                }),
                this.dataSdk.api.batch.batchEnd(c),
                this._notificationService.success(s.ZP.t("web_editor_toolsmodify_toast_resize_success", {}, "Auto reframe applied"))
            }
            handleError(e, t, i, a) {
                this._setLoadingUI(e, !1, 0),
                this.setLoadingState(e, {
                    loading: !1,
                    loadingText: void 0,
                    progress: 0
                }),
                (0,
                v.e)(this._containerService, {
                    material_type: i.extra.material_type,
                    material_format: i.extra.material_format,
                    material_resolution: i.extra.material_resolution,
                    crop_resolution: i.extra.crop_resolution,
                    duration: i.extra.duration,
                    status: "fail",
                    fail_reason: -1 === t.code ? "network_error" : "server_error"
                }),
                this._slardarAdapterService.captureException("smart crop error", t),
                null == a || a(e)
            }
            removeSmartCrop(e) {
                (0,
                m.Y2)(this.dataSdk),
                this.dataSdk.api.video.removeSmartCrop({
                    segId: e
                })
            }
            async _checkDisable() {
                let e = await this._smartCropDataService.checkSmartCropDisable();
                e.ok && (0,
                o.z)( () => {
                    this.observableData.disableSmartCrop = e.value
                }
                )
            }
            constructor(e, t, i, a, r, n, s, d) {
                super(),
                this._algorithmFilerManager = e,
                this._timelineManager = t,
                this._renderManager = i,
                this._containerService = a,
                this._mainDraftService = r,
                this._smartCropDataService = n,
                this._slardarAdapterService = s,
                this._notificationService = d,
                this._segmentIdTokenMap = (0,
                o.LO)(new Map, {
                    deep: !1
                }),
                this._segmentIdLoadingState = (0,
                o.LO)(new Map),
                this._segmentIdLoadingTimestamp = new Date().getTime(),
                this._noticeLoadingIdsMap = new Map,
                this._onProgress = this._register(new p.Q),
                this._onSuccess = this._register(new p.Q),
                this._onError = this._register(new p.Q),
                this._onCancel = this._register(new p.Q),
                this.observableData = (0,
                o.LO)({
                    disableSmartCrop: !0
                }),
                this._checkDisable(),
                this.onProgress = this._onProgress.event,
                this.onSuccess = this._onSuccess.event,
                this.onError = this._onError.event,
                this.onCancel = this._onCancel.event,
                this._mainDraftService.dataSdk.onChangeDiff(e => {
                    let t = [];
                    this._segmentIdTokenMap.forEach( (e, i) => {
                        !this._mainDraftService.dataSdk.draftView.getSegmentById(i) && t.push(e)
                    }
                    ),
                    t.forEach(e => e.cancel())
                }
                )
            }
        }
        w = (0,
        a.gn)([(0,
        a.fM)(3, l.T), (0,
        a.fM)(4, h.n), (0,
        a.fM)(5, c.I), (0,
        a.fM)(6, u.L), (0,
        a.fM)(7, y.lT), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof AlgorithmFilerManager ? Object : AlgorithmFilerManager, Object, "undefined" == typeof RenderManager ? Object : RenderManager, void 0 === l.T ? Object : l.T, void 0 === h.n ? Object : h.n, void 0 === c.I ? Object : c.I, void 0 === u.L ? Object : u.L, void 0 === y.lT ? Object : y.lT])], w)
    },
    650271: function(e, t, i) {
        i.d(t, {
            d: function() {
                return o
            }
        });
        var a = i(789786)
          , r = i(120706)
          , n = i(290341);
        class o {
            updateRenderManager(e) {
                this._renderManager = e
            }
            startVideoSmartSplit(e) {
                return this._containerService.createInstance(n.C, e, this._renderManager, this._draftPathStore)
            }
            constructor(e, t, i, a) {
                this._cache = e,
                this._renderManager = t,
                this._draftPathStore = i,
                this._containerService = a
            }
        }
        o = (0,
        a.gn)([(0,
        a.fM)(3, r.T), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", ["undefined" == typeof ProductCache ? Object : ProductCache, "undefined" == typeof RenderManager ? Object : RenderManager, "undefined" == typeof DraftPathStore ? Object : DraftPathStore, void 0 === r.T ? Object : r.T])], o)
    },
    13605: function(e, t, i) {
        i.d(t, {
            F: () => n
        });
        var a = i("272619");
        class r {
            get token() {
                return this._token
            }
            setToken(e) {
                this._token = e,
                this._onDidStartToken.fire(e)
            }
            constructor() {
                this._onDidStartToken = new a.Q,
                this.onDidStartToken = this._onDidStartToken.event
            }
        }
        class n {
            set(e, t) {
                this._getOrCreateSource(e).setToken(t)
            }
            get(e) {
                return this._getOrCreateSource(e)
            }
            _getOrCreateSource(e) {
                return !this._mapping.has(e) && this._mapping.set(e, new r),
                this._mapping.get(e)
            }
            constructor() {
                this._mapping = new Map
            }
        }
    },
    483438: function(e, t, i) {
        i.d(t, {
            FI: function() {
                return l
            },
            Sc: function() {
                return s
            },
            uG: function() {
                return d
            },
            xR: function() {
                return c
            }
        });
        var a, r, n, o, s = ((a = {}).Algorithm = "Algorithm",
        a.Gameplay = "Gameplay",
        a.Matting = "Matting",
        a.Stable = "Stable",
        a.Reverse = "Reverse",
        a.Vc = "Vc",
        a.SmartCrop = "SmartCrop",
        a.Pipeline = "Pipeline",
        a.Split = "Split",
        a.ObjectLock = "ObjectLock",
        a);
        var d = ((r = {})[r.MattingVideo = 5] = "MattingVideo",
        r[r.MattingPhoto = 10] = "MattingPhoto",
        r[r.Reverse = 6] = "Reverse",
        r[r.SmartTools = 13] = "SmartTools",
        r[r.PipelineVideo = 14] = "PipelineVideo",
        r[r.PipelinePhoto = 15] = "PipelinePhoto",
        r[r.VC = 15] = "VC",
        r);
        var l = ((n = {})[n.Video = 0] = "Video",
        n[n.Image = 1] = "Image",
        n);
        var c = ((o = {})[o.Running = 0] = "Running",
        o[o.Cancelled = 1] = "Cancelled",
        o[o.Error = 2] = "Error",
        o[o.Success = 3] = "Success",
        o)
    },
    901888: function(e, t, i) {
        i.d(t, {
            Dc: function() {
                return f
            },
            EZ: function() {
                return p
            },
            LL: function() {
                return h
            },
            OJ: function() {
                return v
            },
            R5: function() {
                return S
            },
            _Y: function() {
                return w
            },
            aP: function() {
                return m
            },
            hi: function() {
                return g
            },
            if: function() {
                return u
            },
            qk: function() {
                return y
            }
        });
        var a = i(425241)
          , r = i(266225)
          , n = i(186215)
          , o = i(483590)
          , s = i(510973)
          , d = i(254050)
          , l = i(42680)
          , c = i(722169);
        async function u(e, t, i, d, c) {
            let {path: u} = e.material
              , {sourcePlatform: h} = e.material
              , {materialId: p} = e.material
              , g = "";
            switch (h) {
            case r.cvu.MaterialPlatformArtist:
            case r.cvu.MaterialPlatformGiphy:
                g = p;
                break;
            case r.cvu.MaterialPlatformDefault:
                {
                    let h = i.get(t.getResourceKeyFromDraftPath(u), [r.cVg.MetaTypePhoto, r.cVg.MetaTypeGif, r.cVg.MetaTypeImage].includes(e.material.type) ? l._g.UserPhoto : l._g.UserVideo);
                    await (0,
                    n.Z)(h),
                    (0,
                    a.Y2)((0,
                    o.R)(h.value)),
                    h.value.sourceType === s.ov.PublicSpace ? ((0,
                    a.ZB)(h.value.vid, "vid must be existed"),
                    g = d.hasLogin ? c ? h.value.assetId : h.value.md5 : h.value.vid) : g = c ? h.value.assetId : h.value.md5;
                    break
                }
            case r.cvu.MaterialPlatformBrand:
                g = p;
                break;
            default:
                g = p
            }
            return g
        }
        function h(e, t) {
            let i;
            let {teamId: a, sourcePlatform: n} = e.material;
            if (n === r.cvu.MaterialPlatformBrand)
                i = a;
            else
                i = t;
            return i
        }
        async function p(e, t, i) {
            var r, d, u;
            let h = (0,
            c.isString)(e) ? e : e.material.path
              , p = ""
              , g = null !== (r = i.get(t.getResourceKeyFromDraftPath(h), l._g.UserAudio)) && void 0 !== r ? r : i.get(t.getResourceKeyFromDraftPath(h), l._g.UserFile);
            if (await (0,
            n.Z)(g),
            (0,
            a.Y2)((0,
            o.R)(g.value)),
            g.value.sourceType === s.ov.PublicSpace) {
                let {vid: e} = null !== (d = g.value) && void 0 !== d ? d : {};
                (0,
                a.ZB)(e, "vid must be existed"),
                p = e
            } else {
                let {assetId: e} = null !== (u = g.value) && void 0 !== u ? u : {};
                p = e
            }
            return p
        }
        async function g(e, t, i) {
            var r, d, u;
            let h = (0,
            c.isString)(e) ? e : e.material.path
              , p = ""
              , g = null !== (r = i.get(t.getResourceKeyFromDraftPath(h), l._g.UserVideo)) && void 0 !== r ? r : i.get(t.getResourceKeyFromDraftPath(h), l._g.UserFile);
            if (await (0,
            n.Z)(g),
            (0,
            a.Y2)((0,
            o.R)(g.value)),
            g.value.sourceType === s.ov.PublicSpace) {
                let {vid: e} = null !== (d = g.value) && void 0 !== d ? d : {};
                (0,
                a.ZB)(e, "vid must be existed"),
                p = e
            } else {
                let {assetId: e} = null !== (u = g.value) && void 0 !== u ? u : {};
                p = e
            }
            return p
        }
        async function m(e, t, i) {
            let {path: d} = e.material
              , {sourcePlatform: c} = e.material
              , {materialId: u} = e.material
              , h = "";
            switch (c) {
            case r.cvu.MaterialPlatformArtist:
            case r.cvu.MaterialPlatformGiphy:
                h = u;
                break;
            case r.cvu.MaterialPlatformDefault:
                {
                    let c = i.get(t.getResourceKeyFromDraftPath(d), e.material.type === r.cVg.MetaTypePhoto ? l._g.UserPhoto : l._g.UserVideo);
                    await (0,
                    n.Z)(c),
                    (0,
                    a.Y2)((0,
                    o.R)(c.value)),
                    c.value.sourceType === s.ov.PublicSpace ? ((0,
                    a.ZB)(c.value.vid, "vid must be existed"),
                    h = c.value.vid) : h = c.value.assetId;
                    break
                }
            default:
                h = u
            }
            return h
        }
        async function _(e, t, i, r) {
            var s;
            let d = null !== (s = i.get(t.getResourceKeyFromDraftPath(r), l._g.UserFile)) && void 0 !== s ? s : i.get(t.getResourceKeyFromDraftPath(r), l._g.UserVideo);
            if (!!d)
                return await (0,
                n.Z)(d),
                (0,
                a.Y2)((0,
                o.R)(d.value)),
                d.value
        }
        async function f(e, t, i) {
            let r = await _(e, t, i, e.material.reversePath)
              , n = "";
            return r ? (r.sourceType === s.ov.PublicSpace ? ((0,
            a.ZB)(r.vid, "vid must be existed"),
            n = r.vid) : n = r.md5,
            n) : n
        }
        async function v(e, t, i) {
            var r;
            let n = await _(e, t, i, null === (r = e.material.videoAlgorithm) || void 0 === r ? void 0 : r.path)
              , o = "";
            return n ? (n.sourceType === s.ov.PublicSpace ? ((0,
            a.ZB)(n.vid, "vid must be existed"),
            o = n.vid) : o = n.assetId,
            o) : o
        }
        async function y(e, t, i) {
            let r = e.material.matting.path.split(";")
              , d = [];
            for (let e of r) {
                let r = i.get(t.getResourceKeyFromDraftPath(e), l._g.UserFile);
                await (0,
                n.Z)(r),
                (0,
                a.Y2)((0,
                o.R)(r.value)),
                r.value.sourceType === s.ov.PublicSpace ? ((0,
                a.ZB)(r.value.vid, "vid must be existed"),
                d.push(r.value.vid)) : d.push(r.value.md5)
            }
            return d
        }
        function S(e, t) {
            let {sourcePlatform: i} = e.material;
            switch (i) {
            case r.cvu.MaterialPlatformArtist:
                return d.hn.HeyCan;
            case r.cvu.MaterialPlatformGiphy:
                return d.hn.Giphy;
            case r.cvu.MaterialPlatformDefault:
                return t ? d.hn.EverPhoto : d.hn.VideoArch;
            case r.cvu.MaterialPlatformBrand:
                return d.hn.UserBrand;
            default:
                return d.hn.HeyCan
            }
        }
        function w(e) {
            return e ? d.hn.EverPhoto : d.hn.VideoArch
        }
    },
    967315: function(e, t, i) {
        i.d(t, {
            U: function() {
                return U
            },
            b: function() {
                return W
            }
        });
        var a = i(789786)
          , r = i(272619)
          , n = i(532666)
          , o = i(511216)
          , s = i(357200)
          , d = i(425241)
          , l = i(483438)
          , c = i(133907)
          , u = i(106161)
          , h = i(137124)
          , p = i(254050)
          , g = i(186215)
          , m = i(230267)
          , _ = i(120706)
          , f = i(947926)
          , v = i(810968)
          , y = i(392554)
          , S = i(42680)
          , w = i(283731)
          , b = i(201359)
          , M = i(266225)
          , k = i(10134)
          , T = i(901888)
          , I = i(379851)
          , P = i(765726)
          , F = i(178203)
          , D = i(271466)
          , A = i(124027)
          , x = i(614767)
          , C = i(372406)
          , R = i(913237)
          , E = i(133152)
          , O = i(385800)
          , j = i(657405)
          , V = i(597251);
        function U(e, t) {
            return t && t.path ? t : [{
                path: (0,
                M.hey)(e) ? e.material.videoAlgorithm.path : "",
                type: M.cVg.MetaTypeVideo
            }, {
                path: (0,
                M.hey)(e) ? e.material.reversePath : "",
                type: M.cVg.MetaTypeVideo
            }, {
                path: e.material.path,
                type: e.material.type
            }].find(e => e.path)
        }
        class W extends n.JT {
            static generateKey(e, t, i, a) {
                let[r,n] = null != i ? i : [];
                return `${e.id}_${U(e, a).path}_${t}_${r}_${n}`
            }
            static parseKey(e) {
                let[t,i,a,r,n] = e.split("_");
                return {
                    segmentId: t,
                    path: i,
                    mode: a,
                    start: BigInt(r),
                    end: BigInt(n)
                }
            }
            dispose() {
                this._onProgress.dispose(),
                this._onError.dispose(),
                this._onSuccess.dispose(),
                this._onCancel.dispose(),
                super.dispose()
            }
            get key() {
                return this._key
            }
            get mode() {
                return this._mode
            }
            get timeRange() {
                return this._timeRange
            }
            get source() {
                return l.Sc.Vc
            }
            get product() {
                return (0,
                d.Y2)(this._product),
                this._product
            }
            get status() {
                return this._job ? (0,
                k.s)(this._job.status) : l.xR.Running
            }
            get error() {
                return this._error
            }
            cancel() {
                this._job ? this._job.cancel() : this._cancellation.cancel(),
                this._onCancel.fire()
            }
            async _startJob() {
                let e;
                if (this._store.clear(),
                this._cancellation.token.isCancellationRequested)
                    return;
                this._tokenStartTime = Date.now(),
                (0,
                V.X)(this._containerService, {
                    segment: this._segment,
                    time: 0,
                    status: "start",
                    functionName: "voice_isolation"
                });
                let t = this._smartToolsService.makeBuilder()
                  , i = "";
                e = (0,
                T.R5)(this._segment, this._accountService.hasLogin);
                let a = U(this._segment, this._material);
                try {
                    a.type === M.cVg.MetaTypeVideoOriginalSound ? (i = await this._separateAudio(),
                    e = this._accountService.hasLogin ? p.hn.EverPhoto : p.hn.VideoArch) : i = a.type === M.cVg.MetaTypeVideo ? await this._separateAudio() : await (0,
                    T.EZ)(U(this._segment, this._material).path, this._draftPathStore, this._resourceService)
                } catch (e) {
                    var r;
                    this._error = (0,
                    o.wf)(-1, null !== (r = e.message) && void 0 !== r ? r : "separateAudio error.")
                }
                if (!i) {
                    this._onError.fire(this._error);
                    return
                }
                let n = (0,
                j.lr)(w._A.SoundSeparation);
                t.createVocalSeparationTask(i, e, this._mode, this._timeRange, n),
                this._job = t.build(),
                this._job.onCancel( () => {
                    (0,
                    V.X)(this._containerService, {
                        segment: this._segment,
                        time: Date.now() - this._tokenStartTime,
                        status: "cancel",
                        functionName: "voice_isolation"
                    }),
                    this._onCancel.fire()
                }
                ),
                this._job.onError(e => {
                    this._error = e,
                    (0,
                    V.X)(this._containerService, {
                        segment: this._segment,
                        time: Date.now() - this._tokenStartTime,
                        status: "fail",
                        functionName: "voice_isolation"
                    }),
                    this._onError.fire(this._error)
                }
                ),
                this._job.onProgress(e => {
                    this.progress = e,
                    this._onProgress.fire(e)
                }
                ),
                this._job.onSuccess(e => {
                    (0,
                    d.Y2)(1 === e.length),
                    (0,
                    V.X)(this._containerService, {
                        segment: this._segment,
                        time: Date.now() - this._tokenStartTime,
                        status: "success",
                        functionName: "voice_isolation"
                    }),
                    this._onProgress.fire(100),
                    this._downloadAndAddResourceService(e[0])
                }
                )
            }
            _separateAudio() {
                return new Promise(async (e, t) => {
                    try {
                        var i, a, r, n, o, s, d, l;
                        let {workspaceId: t} = this._mainDraftService.draftWorkspaceManager || {}
                          , c = U(this._segment, this._material).path
                          , u = null !== (n = null !== (r = this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c), S._g.UserVideo)) && void 0 !== r ? r : this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c), S._g.Video)) && void 0 !== n ? n : this._resourceService.get(this._draftPathStore.getResourceKeyFromDraftPath(c), S._g.UserFile);
                        await (0,
                        g.Z)(u);
                        let h = null !== (s = null !== (o = null === (i = u.getOriginResourceToken) || void 0 === i ? void 0 : i.call(u)) && void 0 !== o ? o : null === (a = u.getVideoResourceToken) || void 0 === a ? void 0 : a.call(u)) && void 0 !== s ? s : u.getUserFileResourceToken();
                        await (0,
                        m.x)(h);
                        let {decryptKey: p} = (null == h ? void 0 : h.value) || {}
                          , {buffer: _} = (null == h ? void 0 : h.value) || {};
                        if (!_)
                            return;
                        let f = new Blob([_],{
                            type: "video/mp4"
                        })
                          , v = (0,
                        O.h)({
                            source: f,
                            fileName: `${u.value.key}_extractor`
                        })
                          , {hasLogin: y} = this._accountService;
                        if (y) {
                            let i = await (null === (d = this._veExtractAudioAndUploadMaterialManager) || void 0 === d ? void 0 : d.extractAudioAndUpload({
                                files: [v],
                                decryptKey: p,
                                fromWorkspaceId: t,
                                toWorkspaceId: t,
                                uploadReportParams: {
                                    action_type: F.jm.VOICE_EFFECT,
                                    material_source: F.O9.EXTRA_AUDIO
                                }
                            }))
                              , a = null == i ? void 0 : i[0];
                            if (null == a ? void 0 : a.ok)
                                a.value.onUploadFailure(e => {
                                    this._onError.fire(null != e ? e : this._error)
                                }
                                ),
                                a.value.onPrepareFailure(async t => {
                                    e(await this._useFfmpeg(v))
                                }
                                ),
                                a.value.onTranscodeFailure(async () => {
                                    e(await this._useFfmpeg(v))
                                }
                                ),
                                a.value.onDidDone( () => {
                                    let t = a.value.getModel();
                                    e(null == t ? void 0 : t.assetId)
                                }
                                );
                            else {
                                let t = await this._useFfmpeg(v);
                                e(t)
                            }
                        } else {
                            let t = await (null === (l = this._veExtraAudioAndUploadNoSignManager) || void 0 === l ? void 0 : l.upload({
                                files: [v],
                                uploadReportParams: {
                                    action_type: F.jm.VOICE_EFFECT,
                                    material_source: F.O9.EXTRA_AUDIO
                                }
                            }))
                              , i = null == t ? void 0 : t[0];
                            (null == i ? void 0 : i.ok) ? (i.value.onDidTranscode( () => {
                                let t = i.value.getModel();
                                e(t.vid)
                            }
                            ),
                            i.value.onUploadFailure(e => {
                                this._onError.fire(null != e ? e : this._error)
                            }
                            ),
                            i.value.onPrepareFailure(async t => {
                                e(await this._useFfmpeg(v))
                            }
                            ),
                            i.value.onTranscodeFailure(async () => {
                                e(await this._useFfmpeg(v))
                            }
                            )) : e(await this._useFfmpeg(v))
                        }
                    } catch (e) {
                        t(e)
                    }
                }
                )
            }
            _useFfmpeg(e) {
                let {hasLogin: t} = this._accountService
                  , {workspaceId: i} = this._mainDraftService.draftWorkspaceManager;
                return new Promise(async (a, r) => {
                    var n, s;
                    if (t) {
                        let t = await (null === (n = this._extractAudioAndUploadMaterialManager) || void 0 === n ? void 0 : n.extractAudioAndUpload({
                            files: [e],
                            fromWorkspaceId: i,
                            toWorkspaceId: i,
                            uploadReportParams: {
                                action_type: F.jm.VOICE_EFFECT,
                                material_source: F.O9.EXTRA_AUDIO
                            }
                        }))
                          , r = null == t ? void 0 : t[0];
                        (null == r ? void 0 : r.ok) ? (r.value.onDidDone( () => {
                            let e = r.value.getModel();
                            a(null == e ? void 0 : e.assetId)
                        }
                        ),
                        r.value.onUploadFailure(e => {
                            this._onError.fire(null != e ? e : this.error)
                        }
                        ),
                        r.value.onPrepareFailure(e => {
                            this._onError.fire(null != e ? e : this.error)
                        }
                        ),
                        r.value.onTranscodeFailure(e => {
                            this._onError.fire(null != e ? e : this.error)
                        }
                        )) : this._onError.fire((0,
                        o.wf)(-1, "extractor fail"))
                    } else {
                        let t = await (null === (s = this._extraAudioAndUploadNoSignManager) || void 0 === s ? void 0 : s.extractAudioAndUpload({
                            files: [e],
                            uploadReportParams: {
                                action_type: F.jm.VOICE_EFFECT,
                                material_source: F.O9.EXTRA_AUDIO
                            }
                        }))
                          , i = null == t ? void 0 : t[0];
                        (null == i ? void 0 : i.ok) ? (i.value.onDidTranscode( () => {
                            a(i.value.getModel().vid)
                        }
                        ),
                        i.value.onUploadFailure(e => {
                            this._onError.fire(this.error)
                        }
                        ),
                        i.value.onPrepareFailure(e => {
                            this._onError.fire(null != e ? e : this.error)
                        }
                        ),
                        i.value.onTranscodeFailure(e => {
                            this._onError.fire(null != e ? e : this.error)
                        }
                        )) : this._onError.fire((0,
                        o.wf)(-1, "extractor fail"))
                    }
                }
                )
            }
            async _downloadAndAddResourceService(e) {
                var t, i, a, r, n, o, s, c, u;
                let h = [{
                    md5: null !== (n = null === (t = e.cloudData) || void 0 === t ? void 0 : t.md5) && void 0 !== n ? n : "",
                    vid: null !== (o = null === (i = e.onlineData) || void 0 === i ? void 0 : i.vid) && void 0 !== o ? o : "",
                    url: null !== (s = null === (a = e.onlineData) || void 0 === a ? void 0 : a.url) && void 0 !== s ? s : "",
                    key: null !== (c = null === (r = e.onlineData) || void 0 === r ? void 0 : r.key) && void 0 !== c ? c : "",
                    resourceId: null !== (u = e.taskId) && void 0 !== u ? u : ""
                }].filter(e => "" !== e.md5 || "" !== e.vid)
                  , p = await this._containerService.invokeFunction(b.CH, {
                    list: h
                }, {
                    resourceType: l.uG.VC,
                    isGameplay: !0
                });
                if (!p.ok)
                    return p;
                let g = this._containerService.invokeFunction(b.Jy, p.value, this._draftPathStore);
                (0,
                d.Y2)(g.length >= 1);
                let m = {
                    url: "",
                    key: ""
                };
                if (e.cloudData) {
                    let e = await (0,
                    b.gF)(this._resourceService, g[0].id);
                    m.url = e.url,
                    m.key = e.key
                } else
                    e.onlineData && (m.url = e.onlineData.url,
                    m.key = e.onlineData.key);
                this._product = {
                    path: g[0].path,
                    ...m
                };
                let _ = await this._containerService.invokeFunction(I.P$, this._renderManager, this._product, p.value, g[0].id);
                if (!_.ok) {
                    this._error = _,
                    this._onError.fire(this._error);
                    return
                }
                this._onSuccess.fire(this._product)
            }
            constructor(e, t, i, a, n, d, l, c, u, h, p, g, m) {
                super(),
                this._segment = e,
                this._mode = t,
                this._timeRange = i,
                this._material = a,
                this._renderManager = n,
                this._draftPathStore = d,
                this._accountService = l,
                this._smartToolsService = c,
                this._containerService = u,
                this._resourceService = h,
                this._mainEditorWidgetService = p,
                this._mainDraftService = g,
                this._draftMaterialsService = m,
                this.progress = 0,
                this._tokenStartTime = Date.now(),
                this._extractAudioAndUploadMaterialManager = null,
                this._veExtractAudioAndUploadMaterialManager = null,
                this._extraAudioAndUploadNoSignManager = null,
                this._veExtraAudioAndUploadNoSignManager = null,
                this._onProgress = new r.Q,
                this._onError = new r.Q,
                this._onSuccess = new r.Q,
                this._onCancel = new r.Q,
                this._cancellation = new s.A,
                this._error = (0,
                o.wf)(-1, "voice effect failed!"),
                this.onProgress = this._onProgress.event,
                this.onError = this._onError.event,
                this.onSuccess = this._onSuccess.event,
                this.onCancel = this._onCancel.event;
                let _ = this._containerService.createInstance(E.o);
                this._extractAudioAndUploadMaterialManager = this._containerService.createInstance(D.Z, {
                    onCreated: () => {}
                    ,
                    payinPayoutHelper: _,
                    fastImportHelper: this._mainEditorWidgetService.fastImportAnalyzeManager
                }),
                this._veExtractAudioAndUploadMaterialManager = this._containerService.createInstance(A.C, {
                    onCreated: () => {}
                    ,
                    payinPayoutHelper: _,
                    fastImportHelper: this._mainEditorWidgetService.fastImportAnalyzeManager
                }),
                this._extraAudioAndUploadNoSignManager = this._containerService.createInstance(x.d, {
                    onCreated: e => {
                        let {} = e
                    }
                    ,
                    payinPayoutHelper: _,
                    fastImportHelper: this._mainEditorWidgetService.fastImportAnalyzeManager
                }),
                this._veExtraAudioAndUploadNoSignManager = this._containerService.createInstance(C.D, {
                    onCreated: () => {}
                    ,
                    payinPayoutHelper: _,
                    fastImportHelper: this._mainEditorWidgetService.fastImportAnalyzeManager
                }),
                this._key = W.generateKey(this._segment, this._mode, this._timeRange, this._material),
                this._startJob()
            }
        }
        W = (0,
        a.gn)([(0,
        a.fM)(6, y.D), (0,
        a.fM)(7, h.dM), (0,
        a.fM)(8, _.T), (0,
        a.fM)(9, f.c), (0,
        a.fM)(10, c.a), (0,
        a.fM)(11, u.n), (0,
        a.fM)(12, R.D), (0,
        a.w6)("design:type", Function), (0,
        a.w6)("design:paramtypes", [Object, void 0 === v.gx ? Object : v.gx, Object, Object, void 0 === P.zo ? Object : P.zo, "undefined" == typeof DraftPathStore ? Object : DraftPathStore, void 0 === y.D ? Object : y.D, void 0 === h.dM ? Object : h.dM, void 0 === _.T ? Object : _.T, void 0 === f.c ? Object : f.c, void 0 === c.a ? Object : c.a, void 0 === u.n ? Object : u.n, void 0 === R.D ? Object : R.D])], W)
    },
    379851: function(e, t, i) {
        i.d(t, {
            F4: function() {
                return b
            },
            Nv: function() {
                return f
            },
            P$: function() {
                return v
            },
            RG: function() {
                return w
            },
            U3: function() {
                return S
            },
            V7: function() {
                return M
            },
            rn: function() {
                return y
            }
        });
        var a = i(511216)
          , r = i(425241)
          , n = i(266225)
          , o = i(199845)
          , s = i(947926)
          , d = i(483590)
          , l = i(392554)
          , c = i(42680)
          , u = i(271412)
          , h = i(234075)
          , p = i.n(h)
          , g = i(133907);
        function m(e, t, i, a, r) {
            (0,
            u.M9)(e, {
                uniquePath: i,
                url: a,
                decryptKey: r
            }, {
                headers: {
                    "x-everphoto-global-session-token": t.token,
                    "x-everphoto-token": t.token
                }
            })
        }
        function _(e, t, i, a) {
            (0,
            u.M9)(e, {
                uniquePath: t,
                url: i,
                decryptKey: a
            })
        }
        async function f(e, t, i) {
            if (e.get(l.D).hasLogin) {
                let a = e.get(o.o)
                  , r = await a.getEvercloudToken();
                if (!r.ok)
                    return r;
                m(t, r.value, i.path, i.url, i.key),
                i.edgeProductPath && m(t, r.value, i.edgeProductPath, i.edgeProductUrl, i.edgeProductKey)
            } else
                _(t, i.path, i.url, i.key),
                i.edgeProductPath && _(t, i.edgeProductPath, i.edgeProductUrl, i.edgeProductKey);
            return (0,
            a.ly)()
        }
        async function v(e, t, i, o, l) {
            let u = e.get(g.a)
              , h = e.get(s.c)
              , m = o[0].getModel()
              , _ = h.get(m.key, c._g.UserFile);
            (0,
            r.Y2)((0,
            d.R)(_.value));
            let f = _.getUserFileResourceToken()
              , v = n.P4R.ensureRootPath(p().join("/editor", i.path));
            return await u.ensureManager.warmupFileResource(null != l ? l : i.key, f, i.path, v, i.key),
            (0,
            a.ly)()
        }
        async function y(e, t, i) {
            if (e.get(l.D).hasLogin) {
                let a = e.get(o.o)
                  , r = await a.getEvercloudToken();
                if (!r.ok)
                    return r;
                m(t, r.value, i.path, i.url, i.key),
                i.matting && m(t, r.value, i.matting.path, i.matting.url, i.matting.key),
                i.mattingEdge && m(t, r.value, i.mattingEdge.path, i.mattingEdge.url, i.mattingEdge.key)
            } else
                _(t, i.path, i.url, i.key),
                i.matting && _(t, i.matting.path, i.matting.url, i.matting.key),
                i.mattingEdge && _(t, i.mattingEdge.path, i.mattingEdge.url, i.mattingEdge.key);
            return (0,
            a.ly)()
        }
        async function S(e, t, i) {
            if (e.get(l.D).hasLogin) {
                let a = e.get(o.o)
                  , r = await a.getEvercloudToken();
                if (!r.ok)
                    return r;
                m(t, r.value, i.path, i.url, i.key)
            } else
                _(t, i.path, i.url, i.key);
            return (0,
            a.ly)()
        }
        async function w(e, t, i) {
            let o = e.get(g.a)
              , l = e.get(s.c).get(t, c._g.UserPhoto);
            (0,
            r.Y2)((0,
            d.R)(l.value)),
            await l.getAllResolutionResourceTokens();
            let u = l.getResolutionResourceTokenByQueue(["480p", "360p", "540p", "720p", "origin"])
              , h = n.P4R.ensureRootPath(p().join("/editor", i));
            return await o.ensureManager.warmupFileResource(t, u, i, h),
            (0,
            a.ly)()
        }
        async function b(e, t, i) {
            let o = e.get(g.a)
              , l = e.get(s.c).get(t, c._g.UserFile);
            (0,
            r.Y2)((0,
            d.R)(l.value));
            let u = l.getContentResourceToken()
              , h = n.P4R.ensureRootPath(p().join("/editor", i));
            return await o.ensureManager.warmupFileResource(t, u, i, h),
            (0,
            a.ly)()
        }
        async function M(e, t, i) {
            if (e.get(l.D).hasLogin) {
                let a = e.get(o.o)
                  , r = await a.getEvercloudToken();
                if (!r.ok)
                    return r;
                i.path && m(t, r.value, i.path, i.url, i.key),
                i.matting && m(t, r.value, i.matting.path, i.matting.url, i.matting.key),
                i.mattingEdge && m(t, r.value, i.mattingEdge.path, i.mattingEdge.url, i.mattingEdge.key)
            } else
                i.path && _(t, i.path, i.url, i.key),
                i.matting && _(t, i.matting.path, i.matting.url, i.matting.key),
                i.mattingEdge && _(t, i.mattingEdge.path, i.mattingEdge.url, i.mattingEdge.key);
            return (0,
            a.ly)()
        }
    },
    563365: function(e, t, i) {
        i.d(t, {
            x: function() {
                return a
            }
        });
        let a = (0,
        i(218571).createContext)(null)
    }
}]);
