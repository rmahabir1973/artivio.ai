# ScrollArea Fix for Media Panel

## The Problem:
The media panel keeps growing downward without showing a scrollbar when clicking "Load More". This is a common flex layout issue.

## Root Cause:
The ScrollArea component needs proper height constraints in a flex layout. The issue is that:
1. The parent container has `flex flex-col` but no fixed height
2. ScrollArea's `flex-1` tries to fill available space, but there's infinite space
3. The content inside keeps pushing the boundaries

## Solution Options:

### Option 1: Fixed Height (Most Reliable)

Replace the ScrollArea with a fixed max-height:

```tsx
{/* Collapsible Media/Asset Panel */}
{mediaPanelOpen && (
  <div 
    className="w-72 border-r flex flex-col shrink-0 bg-background"
    style={{ height: '100vh' }}  // Fixed to viewport height
    data-testid="media-panel"
  >
    <div className="flex items-center justify-between p-3 border-b shrink-0">
      <span className="text-sm font-medium capitalize">{activeCategory}</span>
      <Button 
        variant="ghost" 
        size="icon" 
        className="h-7 w-7"
        onClick={() => setMediaPanelOpen(false)}
        data-testid="button-close-media-panel"
      >
        <PanelLeftClose className="h-4 w-4" />
      </Button>
    </div>
    
    {/* Use max-height with overflow-y-auto instead of ScrollArea */}
    <div 
      className="flex-1 overflow-y-auto overflow-x-hidden"
      style={{ maxHeight: 'calc(100vh - 60px)' }} // Subtract header height
    >
      <div className="p-3 space-y-3">
        {/* ... your content ... */}
      </div>
    </div>
  </div>
)}
```

### Option 2: Use Absolute Positioning

```tsx
{/* Collapsible Media/Asset Panel */}
{mediaPanelOpen && (
  <div 
    className="w-72 border-r bg-background shrink-0 relative"
    style={{ height: '100%' }}
    data-testid="media-panel"
  >
    {/* Header - Fixed at top */}
    <div className="absolute top-0 left-0 right-0 flex items-center justify-between p-3 border-b bg-background z-10">
      <span className="text-sm font-medium capitalize">{activeCategory}</span>
      <Button 
        variant="ghost" 
        size="icon" 
        className="h-7 w-7"
        onClick={() => setMediaPanelOpen(false)}
        data-testid="button-close-media-panel"
      >
        <PanelLeftClose className="h-4 w-4" />
      </Button>
    </div>
    
    {/* Scrollable content - Positioned below header */}
    <div 
      className="absolute top-[60px] bottom-0 left-0 right-0 overflow-y-auto overflow-x-hidden"
    >
      <div className="p-3 space-y-3">
        {/* ... your content ... */}
      </div>
    </div>
  </div>
)}
```

### Option 3: Fix ScrollArea with Proper Constraints (Radix UI)

If you're using Radix UI's ScrollArea, it needs explicit height:

```tsx
{/* Collapsible Media/Asset Panel */}
{mediaPanelOpen && (
  <div 
    className="w-72 border-r flex flex-col shrink-0 bg-background h-full"
    data-testid="media-panel"
  >
    <div className="flex items-center justify-between p-3 border-b shrink-0">
      <span className="text-sm font-medium capitalize">{activeCategory}</span>
      <Button 
        variant="ghost" 
        size="icon" 
        className="h-7 w-7"
        onClick={() => setMediaPanelOpen(false)}
        data-testid="button-close-media-panel"
      >
        <PanelLeftClose className="h-4 w-4" />
      </Button>
    </div>
    
    {/* Key: Set explicit height on ScrollArea */}
    <ScrollArea 
      className="flex-1"
      style={{ height: 0 }} // Force ScrollArea to respect flex-1
    >
      <div className="p-3 space-y-3">
        {/* ... your content ... */}
      </div>
    </ScrollArea>
  </div>
)}
```

### Option 4: Use Grid Layout Instead of Flex

```tsx
<div className="flex-1 flex overflow-hidden">
  {/* Left Icon Sidebar */}
  <EditorSidebar 
    activeCategory={activeCategory} 
    onCategoryChange={setActiveCategory} 
  />
  
  {/* Use CSS Grid for media panel + preview */}
  <div 
    className="flex-1 grid"
    style={{ 
      gridTemplateColumns: mediaPanelOpen ? '288px 1fr' : '0 1fr',
      height: '100%'
    }}
  >
    {/* Media Panel - Grid item with overflow */}
    {mediaPanelOpen && (
      <div className="border-r bg-background overflow-hidden flex flex-col">
        <div className="flex items-center justify-between p-3 border-b shrink-0">
          <span className="text-sm font-medium capitalize">{activeCategory}</span>
          <Button 
            variant="ghost" 
            size="icon" 
            className="h-7 w-7"
            onClick={() => setMediaPanelOpen(false)}
          >
            <PanelLeftClose className="h-4 w-4" />
          </Button>
        </div>
        
        <div className="flex-1 overflow-y-auto">
          <div className="p-3 space-y-3">
            {/* ... content ... */}
          </div>
        </div>
      </div>
    )}
    
    {/* Preview - Grid item */}
    <div className="flex flex-col min-w-0 relative overflow-hidden">
      {/* Preview content */}
    </div>
  </div>
</div>
```

## Recommended Solution (Simplest):

**Use Option 1 with simple overflow-y-auto:**

```tsx
{mediaPanelOpen && (
  <div 
    className="w-72 border-r flex flex-col shrink-0 bg-background"
    style={{ height: '100vh' }}
    data-testid="media-panel"
  >
    <div className="flex items-center justify-between p-3 border-b shrink-0 bg-background">
      <span className="text-sm font-medium capitalize">{activeCategory}</span>
      <Button 
        variant="ghost" 
        size="icon" 
        className="h-7 w-7"
        onClick={() => setMediaPanelOpen(false)}
        data-testid="button-close-media-panel"
      >
        <PanelLeftClose className="h-4 w-4" />
      </Button>
    </div>
    
    {/* Replace ScrollArea with simple div */}
    <div className="flex-1 overflow-y-auto overflow-x-hidden">
      <div className="p-3 space-y-3">
        {/* Media Category Content */}
        {activeCategory === 'media' && (
          <div className="space-y-3">
            {!isAuthenticated ? (
              <div className="text-center py-8">
                <Video className="h-10 w-10 mx-auto text-muted-foreground mb-2" />
                <p className="text-sm text-muted-foreground">Sign in to access your videos</p>
                <Button size="sm" className="mt-2" onClick={() => setShowGuestModal(true)}>
                  Sign In
                </Button>
              </div>
            ) : generationsLoading ? (
              <div className="grid grid-cols-2 gap-2">
                {Array.from({ length: 4 }).map((_, i) => (
                  <Skeleton key={i} className="aspect-video rounded-md" />
                ))}
              </div>
            ) : videos.length === 0 ? (
              <div className="text-center py-8">
                <Video className="h-10 w-10 mx-auto text-muted-foreground mb-2" />
                <p className="text-sm text-muted-foreground">No videos yet</p>
              </div>
            ) : (
              <div className="grid grid-cols-2 gap-2">
                {videos.map((video) => (
                  <DraggableMediaItem
                    key={video.id}
                    item={video}
                    mediaType="video"
                    onClick={() => addClipToTimeline(video)}
                  />
                ))}
              </div>
            )}
            
            {/* Load More Button */}
            {hasNextPage && (
              <div className="pt-2 pb-2">
                <Button 
                  variant="outline" 
                  size="sm" 
                  className="w-full"
                  onClick={() => fetchNextPage()}
                  disabled={isFetchingNextPage}
                  data-testid="button-load-more-videos"
                >
                  {isFetchingNextPage ? (
                    <>
                      <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                      Loading...
                    </>
                  ) : (
                    'Load More'
                  )}
                </Button>
              </div>
            )}
          </div>
        )}
        
        {/* ... other categories ... */}
      </div>
    </div>
  </div>
)}
```

## Why This Works:

1. **`height: '100vh'`** - Panel has explicit height constraint
2. **`flex flex-col`** - Vertical flex layout
3. **Header is `shrink-0`** - Won't shrink, takes only needed space
4. **Content is `flex-1 overflow-y-auto`** - Takes remaining space and scrolls
5. **Simple browser scrolling** - No complex ScrollArea component issues

## Alternative: If you MUST use ScrollArea

```tsx
<ScrollArea className="h-[calc(100vh-120px)]">
  <div className="p-3 space-y-3">
    {/* content */}
  </div>
</ScrollArea>
```

But plain `overflow-y-auto` is more reliable and simpler!

## Testing:

After applying the fix:
1. Click "Load More" multiple times
2. You should see a scrollbar appear in the media panel
3. The panel should NOT extend beyond the viewport
4. Scrolling should work smoothly

This is **definitely fixable** - it's just a CSS layout issue!
